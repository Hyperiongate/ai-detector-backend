"""
Email service - Email sending functionality
"""
import smtplib
import config

# Safe email import handling for Python 3.13 compatibility
try:
    from email.mime.text import MIMEText
    from email.mime.multipart import MIMEMultipart
    EMAIL_AVAILABLE = True
except ImportError:
    try:
        from email.MIMEText import MIMEText
        from email.MIMEMultipart import MIMEMultipart
        EMAIL_AVAILABLE = True
    except ImportError:
        EMAIL_AVAILABLE = False
        MIMEText = None
        MIMEMultipart = None
        print("âš  Email modules not available - email features disabled")

def send_email(to_email, subject, html_content, text_content):
    """Send email with graceful fallback"""
    if not EMAIL_AVAILABLE:
        print(f"Email not available - would send to {to_email}: {subject}")
        return False
    
    if not all([config.SMTP_SERVER, config.SMTP_USERNAME, config.SMTP_PASSWORD]):
        print("Email configuration incomplete")
        return False
    
    try:
        msg = MIMEMultipart('alternative')
        msg['Subject'] = subject
        msg['From'] = f"Facts & Fakes AI <{config.SMTP_USERNAME}>"
        msg['To'] = to_email
        
        text_part = MIMEText(text_content, 'plain')
        html_part = MIMEText(html_content, 'html')
        
        msg.attach(text_part)
        msg.attach(html_part)
        
        with smtplib.SMTP(config.SMTP_SERVER, config.SMTP_PORT) as server:
            server.starttls()
            server.login(config.SMTP_USERNAME, config.SMTP_PASSWORD)
            server.send_message(msg)
        
        return True
    except Exception as e:
        print(f"Email error: {e}")
        return False

def send_welcome_email(email):
    """Send welcome email to new beta users"""
    subject = "Welcome to Facts & Fakes AI - Your Beta Access is Active!"
    
    html_content = """
    <html>
    <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
        <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
            <h1 style="color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px;">
                Welcome to Facts & Fakes AI! ðŸŽ‰
            </h1>
            
            <p>Thank you for joining our beta program! You're among the first to experience our advanced AI detection platform.</p>
            
            <h2 style="color: #34495e;">Your Beta Access Includes:</h2>
            <ul style="background-color: #ecf0f1; padding: 20px; border-radius: 5px;">
                <li><strong>AI Text Detection:</strong> Identify AI-generated content with advanced analysis</li>
                <li><strong>News Verification:</strong> Check articles for bias, credibility, and fact accuracy</li>
                <li><strong>Image Analysis:</strong> Detect deepfakes and image manipulation</li>
                <li><strong>Daily Free Analyses:</strong> 5 free analyses per day (10 with Pro)</li>
            </ul>
            
            <div style="background-color: #3498db; color: white; padding: 15px; border-radius: 5px; text-align: center; margin: 20px 0;">
                <h3 style="margin: 0;">Ready to Start?</h3>
                <a href="https://factsandfakes.ai/login" style="display: inline-block; background-color: white; color: #3498db; padding: 10px 30px; text-decoration: none; border-radius: 5px; margin-top: 10px; font-weight: bold;">
                    Log In to Your Account
                </a>
            </div>
            
            <h3 style="color: #34495e;">Quick Start Guide:</h3>
            <ol>
                <li>Log in to your account at factsandfakes.ai</li>
                <li>Choose any analysis tool from the navigation menu</li>
                <li>Paste or upload your content</li>
                <li>Get instant, detailed results</li>
            </ol>
            
            <p style="background-color: #f8f9fa; padding: 15px; border-left: 4px solid #3498db;">
                <strong>Beta Feedback:</strong> Your input shapes our platform! Use the contact form to share suggestions, report issues, or request features.
            </p>
            
            <p>Questions? Reply to this email or visit our <a href="https://factsandfakes.ai/contact">contact page</a>.</p>
            
            <p style="color: #7f8c8d; font-size: 14px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #bdc3c7;">
                Best regards,<br>
                The Facts & Fakes AI Team<br>
                <a href="https://factsandfakes.ai">factsandfakes.ai</a>
            </p>
        </div>
    </body>
    </html>
    """
    
    text_content = """
Welcome to Facts & Fakes AI!

Thank you for joining our beta program! You're among the first to experience our advanced AI detection platform.

Your Beta Access Includes:
- AI Text Detection: Identify AI-generated content with advanced analysis
- News Verification: Check articles for bias, credibility, and fact accuracy
- Image Analysis: Detect deepfakes and image manipulation
- Daily Free Analyses: 5 free analyses per day (10 with Pro)

Ready to Start?
Log in at: https://factsandfakes.ai/login

Quick Start Guide:
1. Log in to your account
2. Choose any analysis tool from the navigation menu
3. Paste or upload your content
4. Get instant, detailed results

Beta Feedback: Your input shapes our platform! Use the contact form to share suggestions, report issues, or request features.

Questions? Reply to this email or visit https://factsandfakes.ai/contact

Best regards,
The Facts & Fakes AI Team
https://factsandfakes.ai
    """
    
    return send_email(email, subject, html_content, text_content)
