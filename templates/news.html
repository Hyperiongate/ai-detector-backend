{% extends "base.html" %}

{% block title %}AI News Intelligence System - Facts & Fakes{% endblock %}

{% block styles %}
<style>
    /* Enhanced contrast for better visibility */
    :root {
        --card-background: #ffffff;
        --card-border: #e2e8f0;
        --section-background: #f8fafc;
        --hover-background: #f1f5f9;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --primary-blue: #2563eb;
        --primary-hover: #1d4ed8;
    }

    /* Container adjustments */
    .container {
        padding-top: 40px;
    }

    /* Header styling */
    .page-header {
        text-align: center;
        margin-bottom: 50px;
        padding: 40px;
        background: var(--section-background);
        border-radius: 12px;
        border: 1px solid var(--card-border);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .page-header h1 {
        font-size: 3.5em;
        font-weight: 900;
        margin-bottom: 10px;
        background: linear-gradient(135deg, #2563eb 0%, #6366f1 50%, #2563eb 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .page-header p {
        font-size: 1.3em;
        color: var(--text-secondary);
        margin-bottom: 20px;
    }

    /* Tech intro section with visible borders */
    .tech-intro {
        background: var(--card-background);
        border: 2px solid var(--card-border);
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 40px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .tech-intro:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
        border-color: var(--primary-blue);
    }

    .tech-intro h3 {
        color: var(--primary-blue);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .tech-intro-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-out;
        color: var(--text-secondary);
    }

    .tech-intro.expanded .tech-intro-content {
        max-height: 500px;
        padding-top: 20px;
    }

    .tech-intro-content li {
        margin-bottom: 15px;
        line-height: 1.6;
    }

    /* Input section with clear boundaries */
    .input-section {
        background: var(--card-background);
        border: 2px solid var(--card-border);
        border-radius: 12px;
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .input-tabs {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .input-tab {
        padding: 12px 30px;
        border: 2px solid var(--card-border);
        background: var(--section-background);
        color: var(--text-secondary);
        font-weight: 600;
        cursor: pointer;
        border-radius: 50px;
        transition: all 0.3s;
        font-size: 16px;
    }

    .input-tab:hover {
        background: var(--hover-background);
        border-color: var(--primary-blue);
        color: var(--primary-blue);
    }

    .input-tab.active {
        background: var(--primary-blue);
        border-color: var(--primary-blue);
        color: white;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    /* Analysis explanation with visible background */
    .analysis-explanation {
        background: var(--section-background);
        border: 1px solid var(--card-border);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 25px;
        font-size: 15px;
        line-height: 1.6;
    }

    .analysis-explanation h4 {
        color: var(--primary-blue);
        margin-bottom: 10px;
    }

    .input-content {
        display: none;
    }

    .input-content.active {
        display: block;
    }

    .input-group {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
    }

    .url-input, .text-input {
        flex: 1;
        padding: 18px 24px;
        border: 2px solid var(--card-border);
        border-radius: 8px;
        background: var(--section-background);
        color: var(--text-primary);
        font-size: 16px;
        transition: all 0.3s;
        font-family: inherit;
    }

    .text-input {
        min-height: 200px;
        resize: vertical;
        width: 100%;
    }

    .url-input:focus, .text-input:focus {
        outline: none;
        border-color: var(--primary-blue);
        background: white;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .url-input::placeholder, .text-input::placeholder {
        color: #94a3b8;
    }

    .analyze-btn {
        padding: 18px 40px;
        background: linear-gradient(135deg, #2563eb 0%, #6366f1 100%);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .analyze-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
    }

    .analyze-btn:disabled {
        background: var(--hover-background);
        color: var(--text-secondary);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    /* Loading state with clear visibility */
    .loading {
        display: none;
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 800px;
        padding: 30px;
        background: white;
        border: 2px solid var(--card-border);
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        z-index: 1000;
    }

    .loading.active {
        display: block;
    }

    .checkpoint {
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 2;
        opacity: 0.5;
        transition: all 0.3s;
    }

    .checkpoint.active,
    .checkpoint.completed {
        opacity: 1;
    }

    .checkpoint-icon {
        width: 50px;
        height: 50px;
        background: var(--section-background);
        border: 2px solid var(--card-border);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-bottom: 8px;
        transition: all 0.3s;
    }

    .checkpoint.active .checkpoint-icon {
        background: var(--primary-blue);
        border-color: var(--primary-blue);
        color: white;
        box-shadow: 0 0 20px rgba(37, 99, 235, 0.4);
    }

    .checkpoint.completed .checkpoint-icon {
        background: #10b981;
        border-color: #10b981;
        color: white;
    }

    .checkpoint-label {
        font-size: 12px;
        color: var(--text-secondary);
        text-align: center;
    }

    .checkpoints {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        position: relative;
    }

    .progress-bar-container {
        position: absolute;
        top: 25px;
        left: 25px;
        right: 25px;
        height: 4px;
        background: var(--hover-background);
        z-index: 1;
        border-radius: 2px;
    }

    .progress-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #2563eb 0%, #6366f1 50%, #2563eb 100%);
        transition: width 0.5s ease;
        border-radius: 2px;
        box-shadow: 0 0 10px rgba(37, 99, 235, 0.4);
    }

    .loading-status {
        text-align: center;
        font-size: 16px;
        color: var(--text-secondary);
        margin-top: 20px;
    }

    /* Results section */
    .results {
        display: none;
    }

    .results.active {
        display: block;
    }

    /* Overall summary with clear sections */
    .overall-summary {
        background: white;
        border: 2px solid var(--card-border);
        border-radius: 12px;
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .summary-header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 2px solid var(--card-border);
    }

    .trust-score-container {
        display: inline-block;
        position: relative;
        margin-bottom: 20px;
    }

    .trust-score {
        width: 200px;
        height: 200px;
        position: relative;
    }

    .trust-score svg {
        transform: rotate(-90deg);
    }

    .trust-score-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 48px;
        font-weight: bold;
    }

    .trust-label {
        font-size: 20px;
        font-weight: 600;
        margin-top: 10px;
    }

    .summary-sections {
        display: grid;
        gap: 25px;
    }

    .summary-section {
        padding: 25px;
        border-left: 4px solid var(--primary-blue);
        background: var(--section-background);
        border-radius: 8px;
        border: 1px solid var(--card-border);
        border-left: 4px solid var(--primary-blue);
    }

    .summary-section h3 {
        color: var(--primary-blue);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.3em;
    }

    .summary-section p {
        color: var(--text-secondary);
        line-height: 1.6;
    }

    .summary-section strong {
        color: var(--text-primary);
    }

    /* Pro section */
    .pro-section {
        margin-top: 40px;
    }

    .pro-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .pro-badge {
        display: inline-block;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        padding: 8px 20px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 20px;
    }

    /* Analysis dropdowns with visible borders */
    .analysis-dropdown {
        background: white;
        border: 2px solid;
        border-radius: 12px;
        margin-bottom: 20px;
        overflow: hidden;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .analysis-dropdown:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .analysis-dropdown.expanded {
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);
    }

    /* Different colors for each dropdown */
    .analysis-dropdown:nth-child(1) { border-color: #2563eb; }
    .analysis-dropdown:nth-child(2) { border-color: #0ea5e9; }
    .analysis-dropdown:nth-child(3) { border-color: #6366f1; }
    .analysis-dropdown:nth-child(4) { border-color: #10b981; }
    .analysis-dropdown:nth-child(5) { border-color: #f59e0b; }
    .analysis-dropdown:nth-child(6) { border-color: #8b5cf6; }
    .analysis-dropdown:nth-child(7) { border-color: #ef4444; }
    .analysis-dropdown:nth-child(8) { border-color: #14b8a6; }

    .dropdown-header {
        padding: 25px 30px;
        background: var(--section-background);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--card-border);
    }

    .dropdown-header:hover {
        background: var(--hover-background);
    }

    .dropdown-icon-wrapper {
        display: flex;
        align-items: center;
        gap: 20px;
        flex: 1;
    }

    .dropdown-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, var(--icon-color-1), var(--icon-color-2));
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        flex-shrink: 0;
        color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .dropdown-title-section {
        flex: 1;
    }

    .dropdown-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 5px;
    }

    .dropdown-preview {
        font-size: 14px;
        color: var(--text-secondary);
    }

    .expand-icon {
        font-size: 20px;
        color: var(--text-secondary);
        transition: transform 0.3s;
    }

    .analysis-dropdown.expanded .expand-icon {
        transform: rotate(180deg);
    }

    .dropdown-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-out;
    }

    .analysis-dropdown.expanded .dropdown-content {
        max-height: 2000px;
    }

    .dropdown-body {
        padding: 30px;
        background: white;
    }

    .analysis-intro {
        background: var(--section-background);
        border-left: 4px solid var(--primary-blue);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        border: 1px solid var(--card-border);
        border-left: 4px solid var(--primary-blue);
    }

    .analysis-intro h4 {
        color: var(--primary-blue);
        margin-bottom: 10px;
    }

    .analysis-intro p {
        color: var(--text-secondary);
        line-height: 1.6;
    }

    .analysis-details {
        margin-top: 25px;
    }

    .metric-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--card-border);
    }

    .metric-item:last-child {
        border-bottom: none;
    }

    .metric-label {
        font-weight: 600;
        color: var(--text-primary);
    }

    .metric-value {
        font-weight: 500;
        color: var(--primary-blue);
    }

    .metric-visual {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .metric-bar {
        width: 100px;
        height: 8px;
        background: var(--hover-background);
        border-radius: 4px;
        overflow: hidden;
        border: 1px solid var(--card-border);
    }

    .metric-bar-fill {
        height: 100%;
        background: #10b981;
        transition: width 0.5s ease;
    }

    /* Bias gauge */
    .bias-gauge {
        margin: 25px 0;
        padding: 25px;
        background: var(--section-background);
        border-radius: 8px;
        border: 1px solid var(--card-border);
    }

    .gauge-container {
        position: relative;
        height: 50px;
        background: linear-gradient(to right, #3b82f6 0%, #a78bfa 50%, #ef4444 100%);
        border-radius: 25px;
        margin: 20px 0;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .gauge-marker {
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 30px;
        height: 30px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        border: 2px solid var(--text-primary);
    }

    /* Claim cards */
    .claim-card {
        background: var(--section-background);
        border: 1px solid var(--card-border);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .claim-icon {
        font-size: 30px;
        flex-shrink: 0;
    }

    .claim-content {
        flex: 1;
    }

    .claim-text {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--text-primary);
    }

    .claim-verdict {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        margin-right: 10px;
    }

    .claim-verdict.true {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .claim-verdict.false {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .claim-verdict.unverified {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border: 1px solid rgba(245, 158, 11, 0.3);
    }

    /* Finding items */
    .finding-item {
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 15px;
        background: var(--section-background);
        border: 1px solid var(--card-border);
    }

    .finding-icon {
        font-size: 30px;
        flex-shrink: 0;
    }

    .finding-text {
        flex: 1;
        line-height: 1.6;
        color: var(--text-secondary);
    }

    /* Action section */
    .action-section {
        text-align: center;
        margin-top: 40px;
        padding: 40px;
        background: var(--section-background);
        border-radius: 12px;
        border: 1px solid var(--card-border);
    }

    /* Messages */
    .message {
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
        text-align: center;
        font-weight: 500;
        border: 1px solid;
    }

    .message.error {
        background: rgba(239, 68, 68, 0.05);
        border-color: rgba(239, 68, 68, 0.3);
        color: #dc2626;
    }

    .message.success {
        background: rgba(16, 185, 129, 0.05);
        border-color: rgba(16, 185, 129, 0.3);
        color: #059669;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .page-header h1 {
            font-size: 2.5em;
        }
        
        .input-group {
            flex-direction: column;
        }
        
        .analyze-btn {
            width: 100%;
        }
        
        .checkpoints {
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .progress-bar-container {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>AI News Intelligence System</h1>
        <p>State-of-the-Art Neural Analysis Powered by GPT-4</p>
    </div>

    <!-- State of the Art Explanation -->
    <div class="tech-intro" onclick="toggleTechIntro()">
        <h3>🚀 How Our Analysis Works - Click to Learn More</h3>
        <div class="tech-intro-content">
            <p style="margin-bottom: 20px;">Our system provides comprehensive news analysis using advanced AI technology:</p>
            <ul style="list-style: none; padding: 0;">
                <li>🧠 <strong>GPT-4 Language Model:</strong> OpenAI's most sophisticated AI for understanding context, detecting bias, and evaluating claims with human-level comprehension</li>
                <li>📊 <strong>Statistical Content Analysis:</strong> Real-time counting of sources, quotes, statistics, and other journalistic quality indicators</li>
                <li>🔍 <strong>Pattern Detection:</strong> Advanced algorithms to identify manipulation patterns, emotional language, and missing context</li>
                <li>⚡ <strong>Real-Time Processing:</strong> Instant analysis with comprehensive results in seconds, providing immediate insights</li>
                <li>🎯 <strong>Bias Detection AI:</strong> Sophisticated analysis to identify political lean, emotional manipulation, and perspective framing</li>
                <li>📈 <strong>Source Credibility Database:</strong> Comprehensive database of news sources with historical accuracy ratings and bias assessments</li>
            </ul>
            <p style="margin-top: 20px; padding: 15px; background: rgba(37, 99, 235, 0.1); border-radius: 8px; border: 1px solid rgba(37, 99, 235, 0.2);">
                <strong>Transparency Note:</strong> All analysis is performed by AI and should be used as one tool among many for evaluating news. We recommend verifying important information with multiple sources.
            </p>
        </div>
    </div>

    <!-- Input Section -->
    <div class="input-section">
        <div class="input-tabs">
            <button class="input-tab active" onclick="switchInputType('url')">🔗 URL Analysis</button>
            <button class="input-tab" onclick="switchInputType('text')">📝 Text Analysis</button>
        </div>
        
        <!-- URL Input -->
        <div class="input-content active" id="urlInput">
            <div class="analysis-explanation">
                <h4>🔗 URL Analysis - Recommended for Best Results</h4>
                <p>URL analysis provides the most accurate results by accessing the full article context, including metadata, publication date, author information, and source credibility. Our system can extract all relevant information directly from the webpage, ensuring nothing is missed. This method also allows us to verify the source domain and check for any updates or corrections to the article.</p>
            </div>
            <div class="input-group">
                <input type="url" 
                       id="articleUrl" 
                       placeholder="Enter news article URL for deep analysis..." 
                       class="url-input">
            </div>
        </div>
        
        <!-- Text Input -->
        <div class="input-content" id="textInput">
            <div class="analysis-explanation">
                <h4>📝 Text Analysis - Alternative Method</h4>
                <p>Text analysis is useful when you have article text but no URL, or when a website blocks automated access. While still highly accurate, this method may miss some context like publication date, author credentials, or source domain verification. For best results, include the complete article text including title, author name, publication date, and all content. The more complete the text, the more accurate our analysis will be.</p>
            </div>
            <textarea id="articleText" 
                      placeholder="Paste complete article text including title, author, date, and full content for most accurate analysis..."
                      class="text-input"></textarea>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="analyze-btn" onclick="analyzeArticle()">
                🤖 INITIATE AI ANALYSIS
            </button>
        </div>
    </div>

    <!-- Advanced Loading State -->
    <div class="loading" id="loading">
        <div class="checkpoint-progress">
            <div class="checkpoints">
                <div class="checkpoint" data-stage="0">
                    <div class="checkpoint-icon">📡</div>
                    <div class="checkpoint-label">Extracting</div>
                </div>
                <div class="checkpoint" data-stage="1">
                    <div class="checkpoint-icon">🧠</div>
                    <div class="checkpoint-label">AI Analysis</div>
                </div>
                <div class="checkpoint" data-stage="2">
                    <div class="checkpoint-icon">📊</div>
                    <div class="checkpoint-label">Statistics</div>
                </div>
                <div class="checkpoint" data-stage="3">
                    <div class="checkpoint-icon">⚖️</div>
                    <div class="checkpoint-label">Bias Scan</div>
                </div>
                <div class="checkpoint" data-stage="4">
                    <div class="checkpoint-icon">✅</div>
                    <div class="checkpoint-label">Finalizing</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
        </div>
        <div class="loading-status" id="loadingStatus">Initializing analysis systems...</div>
    </div>

    <!-- Results -->
    <div class="results" id="results">
        <!-- Will be dynamically populated -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // State management
    let currentInputType = 'url';
    let currentAnalysisData = null;
    let currentStage = 0;

    // Toggle functions
    window.toggleTechIntro = function() {
        document.querySelector('.tech-intro').classList.toggle('expanded');
    }

    window.switchInputType = function(type) {
        currentInputType = type;
        
        document.querySelectorAll('.input-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        event.target.classList.add('active');
        
        document.querySelectorAll('.input-content').forEach(content => {
            content.classList.remove('active');
        });
        
        if (type === 'url') {
            document.getElementById('urlInput').classList.add('active');
        } else {
            document.getElementById('textInput').classList.add('active');
        }
    }

    // Main analysis function
    window.analyzeArticle = async function() {
        let content = '';
        let contentType = currentInputType;
        
        if (currentInputType === 'url') {
            content = document.getElementById('articleUrl').value.trim();
            if (!content) {
                showMessage('Please enter a valid URL to analyze. The URL should be a complete web address starting with http:// or https://', 'error');
                return;
            }
        } else {
            content = document.getElementById('articleText').value.trim();
            if (!content) {
                showMessage('Please enter the article text to analyze. Include as much information as possible for accurate results.', 'error');
                return;
            }
            contentType = 'text';
        }
        
        // Reset and show loading
        currentStage = 0;
        document.querySelector('.analyze-btn').disabled = true;
        document.querySelector('.analyze-btn').textContent = '⏳ ANALYZING...';
        document.getElementById('loading').classList.add('active');
        document.getElementById('results').classList.remove('active');
        
        // Reset checkpoints
        document.querySelectorAll('.checkpoint').forEach(cp => {
            cp.classList.remove('active', 'completed');
        });
        document.getElementById('progressBar').style.width = '0%';
        
        // Start checkpoint animation
        animateCheckpoints();
        
        try {
            const response = await fetch('/api/analyze-news', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    content: content,
                    type: contentType,
                    is_pro: true
                })
            });
            
            const data = await response.json();
            
            if (!response.ok || !data.success) {
                throw new Error(data.error || 'Analysis failed');
            }
            
            currentAnalysisData = data;
            
            // Complete remaining stages quickly
            while (currentStage < 5) {
                await new Promise(resolve => setTimeout(resolve, 200));
                updateCheckpoint(currentStage);
                currentStage++;
            }
            
            // Display results
            setTimeout(() => {
                displayResults(data);
            }, 500);
            
        } catch (error) {
            console.error('Analysis error:', error);
            let errorMessage = 'Analysis failed: ';
            
            if (error.message.includes('403') || error.message.includes('Forbidden')) {
                errorMessage = '⚠️ This website blocks automated access for security reasons. Please use the Text Analysis option instead by copying and pasting the article content.';
            } else if (error.message.includes('Invalid URL')) {
                errorMessage = '⚠️ The URL appears to be invalid. Please check that it\'s a complete web address starting with http:// or https://';
            } else {
                errorMessage += error.message + '. Please try again or contact support if the issue persists.';
            }
            
            showMessage(errorMessage, 'error');
        } finally {
            document.querySelector('.analyze-btn').disabled = false;
            document.querySelector('.analyze-btn').textContent = '🤖 INITIATE AI ANALYSIS';
            document.getElementById('loading').classList.remove('active');
        }
    }

    // Checkpoint animation
    function animateCheckpoints() {
        const stages = [
            'Extracting article content and metadata from source...',
            'Running GPT-4 neural network analysis on content...',
            'Analyzing statistical patterns and content metrics...',
            'Detecting bias patterns and framing techniques...',
            'Generating comprehensive intelligence report...'
        ];
        
        const interval = setInterval(() => {
            if (currentStage >= stages.length) {
                clearInterval(interval);
                return;
            }
            
            updateCheckpoint(currentStage);
            document.getElementById('loadingStatus').textContent = stages[currentStage];
            currentStage++;
        }, 1500);
    }

    function updateCheckpoint(stage) {
        const checkpoints = document.querySelectorAll('.checkpoint');
        const progressBar = document.getElementById('progressBar');
        
        if (stage > 0) {
            checkpoints[stage - 1].classList.remove('active');
            checkpoints[stage - 1].classList.add('completed');
        }
        
        if (stage < checkpoints.length) {
            checkpoints[stage].classList.add('active');
        }
        
        const progress = ((stage + 1) / checkpoints.length) * 100;
        progressBar.style.width = progress + '%';
    }

    // Display results - keeping ALL original features
    function displayResults(data) {
        const results = data.results;
        const resultsDiv = document.getElementById('results');
        
        resultsDiv.classList.add('active');
        
        // Generate overall summary - all in one box
        const overallSummary = `
            <div class="overall-summary">
                <div class="summary-header">
                    <div class="trust-score-container">
                        <div class="trust-score">
                            <svg width="200" height="200">
                                <circle cx="100" cy="100" r="90" fill="none" stroke="#e2e8f0" stroke-width="20"/>
                                <circle id="trustCircle" cx="100" cy="100" r="90" fill="none" 
                                        stroke="${getTrustColor(results.credibility)}" 
                                        stroke-width="20" 
                                        stroke-dasharray="565.5" 
                                        stroke-dashoffset="565.5"
                                        style="filter: drop-shadow(0 0 20px ${getTrustColor(results.credibility)})"/>
                            </svg>
                            <div class="trust-score-text" style="color: ${getTrustColor(results.credibility)}">
                                ${results.credibility || 0}%
                            </div>
                        </div>
                        <div class="trust-label" style="color: ${getTrustColor(results.credibility)}">
                            ${getTrustLabel(results.credibility)}
                        </div>
                    </div>
                </div>
                
                <div class="summary-sections">
                    <!-- Source & Author -->
                    <div class="summary-section">
                        <h3>📰 Source & Author Information</h3>
                        <p><strong>News Source:</strong> ${results.sources?.name || 'Unknown'} 
                           ${results.sources?.domain && results.sources.domain !== 'Direct Input' ? `(${results.sources.domain})` : ''}</p>
                        <p><strong>Article Author:</strong> ${results.author && results.author !== 'Unknown' ? results.author : 'No author attribution found - this may indicate lower credibility'}</p>
                        ${results.sources?.credibility ? `<p><strong>Source Credibility Score:</strong> ${results.sources.credibility}% - ${getCredibilityDescription(results.sources.credibility)}</p>` : ''}
                    </div>
                    
                    <!-- What the Article is About -->
                    <div class="summary-section">
                        <h3>📋 Article Summary & Main Points</h3>
                        <p>${results.summary || 'The article content covers current events and news topics. Our AI system has analyzed the full content to provide detailed insights below.'}</p>
                    </div>
                    
                    <!-- Key Findings with graphics -->
                    <div class="summary-section">
                        <h3>🔍 Key Analysis Findings</h3>
                        ${generateKeyFindings(results)}
                    </div>
                </div>
            </div>
        `;
        
        // Generate pro analysis dropdowns - KEEPING ALL 8 SECTIONS
        const proAnalysis = `
            <div class="pro-section">
                <div class="pro-header">
                    <span class="pro-badge">PRO ANALYSIS</span>
                    <h2 style="color: var(--text-primary); font-size: 2em; margin-top: 10px;">Deep AI Intelligence Report</h2>
                    <p style="color: var(--text-secondary); margin-top: 10px;">Click on any section below to expand detailed analysis</p>
                </div>
                
                <div class="analysis-list">
                    ${generateAnalysisDropdowns(results)}
                </div>
            </div>
        `;
        
        // Action buttons
        const actions = `
            <div class="action-section">
                <button class="btn btn-primary" onclick="shareResults()">
                    📤 Share Analysis Results
                </button>
                <button class="btn btn-secondary" onclick="resetAnalysis()">
                    🔄 Analyze Another Article
                </button>
            </div>
        `;
        
        resultsDiv.innerHTML = overallSummary + proAnalysis + actions;
        
        // Animate trust score
        animateTrustScore(results.credibility || 0);
        
        // Add click handlers for dropdowns
        document.querySelectorAll('.dropdown-header').forEach(header => {
            header.addEventListener('click', function() {
                const dropdown = this.closest('.analysis-dropdown');
                dropdown.classList.toggle('expanded');
            });
        });
        
        // Animate metric bars
        setTimeout(() => {
            document.querySelectorAll('.metric-bar-fill').forEach(bar => {
                const width = bar.getAttribute('data-width');
                if (width) {
                    bar.style.width = width;
                }
            });
        }, 100);
        
        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Generate key findings with visual indicators
    function generateKeyFindings(results) {
        const findings = [];
        
        // Source credibility with icon
        if (results.sources?.credibility >= 80) {
            findings.push({ 
                icon: '✅', 
                text: `Highly credible and trustworthy news source: ${results.sources.name}. This source has a strong track record of accurate reporting and journalistic integrity.`, 
                type: 'success' 
            });
        } else if (results.sources?.credibility >= 60) {
            findings.push({ 
                icon: '⚠️', 
                text: `Moderately credible source: ${results.sources.name}. This source generally provides reliable information but may have occasional accuracy issues or bias.`, 
                type: 'warning' 
            });
        } else {
            findings.push({ 
                icon: '❌', 
                text: 'Low credibility or unverified source detected. Information from this source should be cross-referenced with other reliable sources before accepting as fact.', 
                type: 'danger' 
            });
        }
        
        // Author information
        if (results.author && results.author !== 'Unknown') {
            findings.push({ 
                icon: '👤', 
                text: `Author properly identified as ${results.author}. Author attribution is a positive sign of accountability and transparency in journalism.`, 
                type: 'success' 
            });
        } else {
            findings.push({ 
                icon: '❓', 
                text: 'No author attribution found in this article. Anonymous or unattributed articles may be less reliable as there is no accountability for the content.', 
                type: 'warning' 
            });
        }
        
        // Bias detection
        if (results.bias?.objectivity >= 80) {
            findings.push({ 
                icon: '⚖️', 
                text: 'Highly objective and balanced reporting detected. The article presents facts without significant bias or emotional manipulation.', 
                type: 'success' 
            });
        } else if (results.bias?.label) {
            findings.push({ 
                icon: '📊', 
                text: `${results.bias.label} perspective detected in the article. While bias doesn\'t necessarily mean inaccuracy, readers should be aware of the political or ideological framing.`, 
                type: 'warning' 
            });
        }
        
        // Overall accuracy assessment
        if (results.overall_accuracy >= 80) {
            findings.push({ 
                icon: '🎯', 
                text: `High factual accuracy verified: ${results.overall_accuracy}% of claims are supported by evidence. This article appears to be well-researched and factually reliable.`, 
                type: 'success' 
            });
        } else if (results.overall_accuracy >= 60) {
            findings.push({ 
                icon: '📈', 
                text: `Moderate factual accuracy: ${results.overall_accuracy}% of claims verified. Some statements may require additional verification from other sources.`, 
                type: 'warning' 
            });
        }
        
        // Add GPT-4 specific findings
        if (results.key_findings?.length > 0) {
            results.key_findings.slice(0, 3).forEach(finding => {
                findings.push({ 
                    icon: '🧠', 
                    text: finding, 
                    type: 'info' 
                });
            });
        }
        
        return findings.map(f => `
            <div class="finding-item">
                <span class="finding-icon">${f.icon}</span>
                <span class="finding-text">${f.text}</span>
            </div>
        `).join('');
    }

    // Generate ALL 8 analysis dropdowns with proper data
    function generateAnalysisDropdowns(results) {
        const dropdowns = [];
        
        // 1. Author Credibility Analysis
        if (results.author || results.author === 'Unknown') {
            dropdowns.push({
                icon: '👤',
                title: 'Author Credibility & Background Analysis',
                preview: results.author !== 'Unknown' ? `Author: ${results.author}` : 'No author attribution found',
                iconColors: ['#2563eb', '#6366f1'],
                content: `
                    <div class="analysis-intro">
                        <h4>What this analysis reveals:</h4>
                        <p>Author credibility is a crucial factor in determining article reliability. We evaluate the author's professional background, expertise in the subject matter, track record of accurate reporting, and any potential conflicts of interest.</p>
                    </div>
                    <div class="analysis-details">
                        <div class="metric-item">
                            <span class="metric-label">Author Name:</span>
                            <span class="metric-value">${results.author !== 'Unknown' ? results.author : 'Not Provided'}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Attribution Status:</span>
                            <span class="metric-value">${results.author !== 'Unknown' ? 'Verified ✓' : 'Missing ✗'}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Credibility Impact:</span>
                            <div class="metric-visual">
                                <span class="metric-value">${results.author !== 'Unknown' ? 'Positive' : 'Negative'}</span>
                                <div class="metric-bar">
                                    <div class="metric-bar-fill" data-width="${results.author !== 'Unknown' ? '80%' : '20%'}" style="background: ${results.author !== 'Unknown' ? '#10b981' : '#ef4444'};"></div>
                                </div>
                            </div>
                        </div>
                        <p style="margin-top: 20px; padding: 20px; background: var(--section-background); border-radius: 8px; border: 1px solid var(--card-border);">
                            <strong>Why this matters:</strong> ${results.author !== 'Unknown' ? 
                            'Author attribution demonstrates accountability and allows readers to verify the writer\'s credentials and potential biases.' : 
                            'The absence of author attribution is a red flag. Anonymous articles lack accountability and make it impossible to verify expertise.'}
                        </p>
                    </div>
                `
            });
        }
        
        // 2. Source Verification & History
        if (results.sources) {
            dropdowns.push({
                icon: '🏛️',
                title: 'News Source Verification & Credibility Assessment',
                preview: `${results.sources.name} - ${results.sources.credibility || 'Unknown'}% credibility score`,
                iconColors: ['#0ea5e9', '#06b6d4'],
                content: `
                    <div class="analysis-intro">
                        <h4>What this analysis reveals:</h4>
                        <p>We verify news sources against our comprehensive database of media outlets. This analysis examines the source's historical accuracy, editorial standards, transparency policies, and any known political affiliations.</p>
                    </div>
                    <div class="analysis-details">
                        <div class="metric-item">
                            <span class="metric-label">Source Name:</span>
                            <span class="metric-value">${results.sources.name}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Website Domain:</span>
                            <span class="metric-value">${results.sources.domain}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Credibility Score:</span>
                            <div class="metric-visual">
                                <span class="metric-value">${results.sources.credibility || 'N/A'}%</span>
                                <div class="metric-bar">
                                    <div class="metric-bar-fill" data-width="${results.sources.credibility || 0}%" style="background: ${getScoreColor(results.sources.credibility)};"></div>
                                </div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Known Political Bias:</span>
                            <span class="metric-value">${results.sources.bias || 'Not detected'}</span>
                        </div>
                        ${results.sources.assessment ? `
                        <p style="margin-top: 20px; padding: 20px; background: var(--section-background); border-radius: 8px; border: 1px solid var(--card-border);">
                            <strong>AI Assessment:</strong> ${results.sources.assessment}
                        </p>` : ''}
                    </div>
                `
            });
        }
        
        // 3. Bias & Objectivity Detection
        if (results.bias) {
            dropdowns.push({
                icon: '⚖️',
                title: 'Political Bias & Objectivity Analysis',
                preview: `${results.bias.label} perspective - ${results.bias.objectivity}% objective reporting`,
                iconColors: ['#6366f1', '#8b5cf6'],
                content: `
                    <div class="analysis-intro">
                        <h4>What this analysis reveals:</h4>
                        <p>Our AI examines linguistic patterns, word choices, source selection, and story framing to detect political bias. Remember: bias doesn't necessarily mean inaccuracy.</p>
                    </div>
                    ${createBiasGauge(results.bias)}
                    <div class="analysis-details">
                        ${results.bias.reasoning ? `
                        <p style="margin-bottom: 20px; padding: 20px; background: var(--section-background); border-radius: 8px; border: 1px solid var(--card-border);">
                            <strong>GPT-4 Analysis:</strong> ${results.bias.reasoning}
                        </p>` : ''}
                        <div class="metric-item">
                            <span class="metric-label">Political Lean Detected:</span>
                            <span class="metric-value">${results.bias.label}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Objectivity Score:</span>
                            <div class="metric-visual">
                                <span class="metric-value">${results.bias.objectivity}%</span>
                                <div class="metric-bar">
                                    <div class="metric-bar-fill" data-width="${results.bias.objectivity}%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Bias Intensity:</span>
                            <span class="metric-value">${results.bias.score > 0 ? '+' : ''}${results.bias.score} (${Math.abs(results.bias.score) <= 3 ? 'Mild' : Math.abs(results.bias.score) <= 6 ? 'Moderate' : 'Strong'})</span>
                        </div>
                    </div>
                `
            });
        }
        
        // 4. Fact Verification Results
        if (results.claims && results.claims.length > 0) {
            dropdowns.push({
                icon: '✓',
                title: 'Fact-Checking & Claim Verification Results',
                preview: `${results.claims.length} factual claims analyzed and verified`,
                iconColors: ['#10b981', '#059669'],
                content: `
                    <div class="analysis-intro">
                        <h4>What this analysis reveals:</h4>
                        <p>GPT-4 identifies specific factual claims made in the article and evaluates them based on its training data. High confidence scores indicate strong evidence supporting the claim.</p>
                    </div>
                    <div class="analysis-details">
                        ${results.claims.map(claim => `
                            <div class="claim-card">
                                <span class="claim-icon">${getClaimIcon(claim.status)}</span>
                                <div class="claim-content">
                                    <div class="claim-text">"${claim.claim}"</div>
                                    <div>
                                        <span class="claim-verdict ${getClaimClass(claim.status)}">
                                            ${getClaimLabel(claim.status)}
                                        </span>
                                        <span style="color: var(--text-secondary);">AI Confidence: ${claim.confidence}%</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        ${results.overall_accuracy ? `
                        <div style="margin-top: 20px; padding: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; text-align: center; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <strong style="color: #10b981; font-size: 1.2em;">Overall Factual Accuracy Score: ${results.overall_accuracy}%</strong>
                            <p style="margin-top: 10px; color: var(--text-secondary);">This score represents the percentage of verifiable claims that our AI confirmed as accurate.</p>
                        </div>` : ''}
                    </div>
                `
            });
        }
        
        // 5. Writing Quality & Journalistic Standards
        if (results.style) {
            dropdowns.push({
                icon: '✍️',
                title: 'Writing Quality & Journalistic Standards Analysis',
                preview: `${results.style.tone || 'Unknown'} tone - ${results.style.balanced ? 'Balanced' : 'Unbalanced'} reporting`,
                iconColors: ['#f59e0b', '#f97316'],
                content: `
                    <div class="analysis-intro">
                        <h4>What this analysis reveals:</h4>
                        <p>Quality journalism follows specific standards: multiple sources, verifiable data, balanced perspectives, and clear attribution. We analyze these factors in detail.</p>
                    </div>
                    <div class="analysis-details">
                        <div class="metric-item">
                            <span class="metric-label">Direct Quote Usage:</span>
                            <div class="metric-visual">
                                <span class="metric-value">${results.style.quotes} quotes ${results.style.quotes >= 2 ? '✅' : '⚠️'}</span>
                                <div class="metric-bar">
                                    <div class="metric-bar-fill" data-width="${Math.min(results.style.quotes * 20, 100)}%" style="background: ${results.style.quotes >= 2 ? '#10b981' : '#f59e0b'};"></div>
                                </div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Statistical Evidence:</span>
                            <div class="metric-visual">
                                <span class="metric-value">${results.style.statistics} references ${results.style.statistics >= 2 ? '✅' : '⚠️'}</span>
                                <div class="metric-bar">
                                    <div class="metric-bar-fill" data-width="${Math.min(results.style.statistics * 20, 100)}%" style="background: ${results.style.statistics >= 2 ? '#10b981' : '#f59e0b'};"></div>
                                </div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Reading Complexity:</span>
                            <span class="metric-value">Grade ${results.style.readingLevel} level</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Writing Tone:</span>
                            <span class="metric-value">${results.style.tone || 'Not analyzed'}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Balanced Perspective:</span>
                            <span class="metric-value">${results.style.balanced ? 'Yes ✅' : 'No ❌'}</span>
                        </div>
                    </div>
                `
            });
        }
        
        // 6. AI Deep Insights & Pattern Recognition
        if (results.key_findings && results.key_findings.length > 0) {
            dropdowns.push({
                icon: '🧠',
                title: 'AI Deep Insights & Pattern Recognition',
                preview: `${results.key_findings.length} advanced observations detected`,
                iconColors: ['#8b5cf6', '#a855f7'],
                content: `
                    <div class="analysis-intro">
                        <h4>What this analysis reveals:</h4>
                        <p>GPT-4 can identify subtle patterns, logical inconsistencies, missing context, and manipulation techniques that readers might miss.</p>
                    </div>
                    <div class="analysis-details">
                        ${results.key_findings.map((finding, i) => `
                            <div style="margin-bottom: 15px; padding: 20px; background: var(--section-background); border-radius: 8px; border-left: 4px solid var(--primary-blue); border: 1px solid var(--card-border); border-left: 4px solid var(--primary-blue);">
                                <strong style="color: var(--primary-blue);">Key Insight ${i + 1}:</strong>
                                <p style="margin-top: 10px; line-height: 1.6; color: var(--text-secondary);">${finding}</p>
                            </div>
                        `).join('')}
                    </div>
                `
            });
        }
        
        // 7. Warning Signs & Red Flags
        if (results.red_flags && results.red_flags.length > 0) {
            dropdowns.push({
                icon: '⚠️',
                title: 'Warning Signs & Credibility Red Flags',
                preview: `${results.red_flags.length} potential issues identified`,
                iconColors: ['#ef4444', '#dc2626'],
                content: `
                    <div class="analysis-intro">
                        <h4>What this analysis reveals:</h4>
                        <p>Our system identifies specific warning signs that may indicate unreliable information or poor journalistic practices.</p>
                    </div>
                    <div class="analysis-details">
                        ${results.red_flags.map(flag => `
                            <div style="margin-bottom: 15px; padding: 20px; background: rgba(239, 68, 68, 0.05); border-radius: 8px; border-left: 4px solid #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); border-left: 4px solid #ef4444;">
                                <strong style="color: #ef4444;">⚠️ Warning:</strong>
                                <p style="margin-top: 10px; line-height: 1.6; color: var(--text-secondary);">${flag}</p>
                            </div>
                        `).join('')}
                    </div>
                `
            });
        }
        
        // 8. Recommendations for Readers
        dropdowns.push({
            icon: '💡',
            title: 'Recommendations & Best Practices for Verification',
            preview: 'How to verify this information independently',
            iconColors: ['#14b8a6', '#0d9488'],
            content: `
                <div class="analysis-intro">
                    <h4>What we recommend:</h4>
                    <p>Based on our analysis, here are specific steps you can take to verify this information and develop a complete understanding of the topic.</p>
                </div>
                <div class="analysis-details">
                    <div style="margin-bottom: 20px; padding: 20px; background: var(--section-background); border-radius: 8px; border: 1px solid var(--card-border);">
                        <strong>🔍 Verification Steps:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px; color: var(--text-secondary);">
                            <li>Search for this story on 2-3 other reputable news sources</li>
                            <li>Check if sources with different political leanings report similar facts</li>
                            <li>Look for original documents or primary sources mentioned</li>
                            <li>Verify quotes by searching for the original context</li>
                            <li>Check fact-checking websites for any disputed claims</li>
                        </ul>
                    </div>
                    <div style="padding: 20px; background: rgba(37, 99, 235, 0.05); border-radius: 8px; border: 1px solid rgba(37, 99, 235, 0.2);">
                        <strong>💡 Remember:</strong>
                        <p style="margin-top: 10px; color: var(--text-secondary);">This AI analysis is one tool among many. Always think critically, consider multiple perspectives, and verify important information through multiple independent sources before forming conclusions.</p>
                    </div>
                </div>
            `
        });
        
        return dropdowns.map((dropdown, index) => `
            <div class="analysis-dropdown" style="--icon-color-1: ${dropdown.iconColors[0]}; --icon-color-2: ${dropdown.iconColors[1]};">
                <div class="dropdown-header">
                    <div class="dropdown-icon-wrapper">
                        <div class="dropdown-icon">
                            ${dropdown.icon}
                        </div>
                        <div class="dropdown-title-section">
                            <div class="dropdown-title">${dropdown.title}</div>
                            <div class="dropdown-preview">${dropdown.preview}</div>
                        </div>
                    </div>
                    <div class="expand-icon">▼</div>
                </div>
                <div class="dropdown-content">
                    <div class="dropdown-body">
                        ${dropdown.content}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Helper functions
    function getTrustColor(score) {
        if (score >= 80) return '#10b981';
        if (score >= 60) return '#f59e0b';
        return '#ef4444';
    }

    function getTrustLabel(score) {
        if (score >= 80) return 'HIGHLY TRUSTWORTHY';
        if (score >= 60) return 'MODERATELY TRUSTWORTHY';
        if (score >= 40) return 'QUESTIONABLE RELIABILITY';
        return 'LOW TRUST - VERIFY CAREFULLY';
    }

    function getCredibilityDescription(score) {
        if (score >= 80) return 'This source has an excellent track record of accurate reporting';
        if (score >= 60) return 'This source is generally reliable but may have occasional issues';
        if (score >= 40) return 'This source has mixed credibility and should be cross-referenced';
        return 'This source has poor credibility or is unverified';
    }

    function getScoreColor(score) {
        if (score >= 80) return '#10b981';
        if (score >= 60) return '#f59e0b';
        return '#ef4444';
    }

    function getClaimClass(status) {
        if (status.toLowerCase().includes('verif')) return 'true';
        if (status.toLowerCase().includes('false')) return 'false';
        return 'unverified';
    }

    function getClaimLabel(status) {
        if (status.toLowerCase().includes('verif')) return 'VERIFIED AS TRUE';
        if (status.toLowerCase().includes('false')) return 'FALSE OR MISLEADING';
        return 'CANNOT BE VERIFIED';
    }

    function getClaimIcon(status) {
        if (status.toLowerCase().includes('verif')) return '✅';
        if (status.toLowerCase().includes('false')) return '❌';
        return '❓';
    }

    function createBiasGauge(biasData) {
        const biasScore = biasData.score || 0;
        const position = 50 + (biasScore * 5);
        
        return `
            <div class="bias-gauge">
                <h5 style="text-align: center; color: var(--text-primary); margin-bottom: 20px;">Political Bias Spectrum Visualization</h5>
                <div class="gauge-container">
                    <div class="gauge-marker" style="left: ${position}%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px;">
                    <span style="color: #3b82f6;">← Far Left</span>
                    <span style="color: #3b82f6;">Left</span>
                    <span style="color: #a78bfa;">Center</span>
                    <span style="color: #ef4444;">Right</span>
                    <span style="color: #ef4444;">Far Right →</span>
                </div>
                <p style="text-align: center; margin-top: 20px; color: var(--text-secondary); font-size: 14px;">
                    Political bias indicates the ideological perspective from which news is presented. Quality journalism can exist across the political spectrum.
                </p>
            </div>
        `;
    }

    function animateTrustScore(score) {
        const circle = document.getElementById('trustCircle');
        const circumference = 2 * Math.PI * 90;
        const offset = circumference - (score / 100) * circumference;
        
        setTimeout(() => {
            circle.style.strokeDashoffset = offset;
            circle.style.transition = 'stroke-dashoffset 1.5s ease-in-out';
        }, 100);
    }

    // Action functions
    window.resetAnalysis = function() {
        document.getElementById('articleUrl').value = '';
        document.getElementById('articleText').value = '';
        document.getElementById('results').classList.remove('active');
        currentAnalysisData = null;
        switchInputType('url');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.shareResults = function() {
        if (!currentAnalysisData) {
            showMessage('No analysis results to share. Please analyze an article first.', 'error');
            return;
        }
        
        const shareText = `I analyzed this article with AI News Intelligence System. Trust Score: ${currentAnalysisData.results.credibility || 0}%`;
        
        if (navigator.share) {
            navigator.share({
                title: 'AI News Analysis Results',
                text: shareText,
                url: window.location.href
            }).catch(err => console.log('Share failed:', err));
        } else {
            // Fallback - copy to clipboard
            const textArea = document.createElement('textarea');
            textArea.value = shareText + '\n' + window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showMessage('Analysis link copied to clipboard! You can now share it.', 'success');
        }
    }

    function showMessage(text, type) {
        const existing = document.querySelector('.message');
        if (existing) existing.remove();
        
        const message = document.createElement('div');
        message.className = `message ${type}`;
        message.textContent = text;
        
        document.querySelector('.input-section').after(message);
        
        setTimeout(() => {
            if (message.parentNode) {
                message.remove();
            }
        }, 5000);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        console.log('AI News Intelligence System initialized successfully');
        
        document.getElementById('articleUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') analyzeArticle();
        });
    });
</script>
{% endblock %}
