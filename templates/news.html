<!DOCTYPE html>
<html lang="en">  
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>NewsVerify Pro - News Verification Platform</title>
    
    <!-- Google Analytics 4 Integration -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9CLSNV2S8Q"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-9CLSNV2S8Q');
        
        // Custom Analytics Events for News Verification Page
        function trackNewsEvent(eventName, eventData = {}) {
            gtag('event', eventName, {
                event_category: 'News_Verification',
                page_title: 'NewsVerify Pro - News Verification Platform',
                ...eventData
            });
            
            // Backend analytics tracking
            if (typeof backendAnalytics !== 'undefined') {
                backendAnalytics.track(eventName, {
                    page: 'news_verification',
                    timestamp: new Date().toISOString(),
                    ...eventData
                });
            }
        }
        
        // Track page view
        gtag('event', 'page_view', {
            page_title: 'NewsVerify Pro - News Verification Platform',
            page_location: window.location.href,
            content_group1: 'News Verification'
        });
    </script>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📰</text></svg>">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            padding-top: 60px;
        }

        /* Beta Banner */
        .beta-banner {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            padding: 8px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .beta-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 3s infinite;
            transform: rotate(45deg);
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .beta-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            color: white;
            font-weight: 600;
        }

        .beta-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .beta-join-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .beta-join-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: rgba(255,255,255,0.1);
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .modal-header h2 {
            color: white;
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        .modal-header p {
            color: rgba(255,255,255,0.8);
            font-size: 1rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-body .input-group {
            margin-bottom: 1rem;
        }

        .modal-body input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            width: 100%;
            font-size: 1rem;
        }

        .modal-body input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .modal-footer {
            padding: 1.5rem 2rem 2rem;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            color: rgba(255,255,255,0.8);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Unsupported Claims Modal Styles */
        #claimsModal .modal-content {
            background: white;
            color: #333;
        }

        #claimsModal .modal-header {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        #claimsModal .modal-header h2 {
            color: white;
        }

        #claimsModal .modal-body {
            padding: 2rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .claim-item {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .claim-item:hover {
            background: rgba(245, 158, 11, 0.15);
            transform: translateX(5px);
        }

        .claim-number {
            color: #f59e0b;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .claim-text {
            color: #333;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 10px;
            font-style: italic;
        }

        .claim-reason {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .unsupported-claims-notice {
            margin-top: 20px;
            padding: 15px;
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
        }

        .unsupported-claims-notice p {
            color: #f59e0b;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .unsupported-claims-notice button {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .unsupported-claims-notice button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4);
        }

        /* Container adjustments */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* Navigation Bar */
        .nav-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-links-secondary {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-links-secondary a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-links-secondary a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-links-secondary a.active {
            background: rgba(255, 255, 255, 0.3);
            font-weight: 600;
        }

        /* Tool Container */
        .tool-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tool-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .tool-header h2 {
            font-size: 2.2rem;
            color: #4a5568;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tool-header p {
            font-size: 1rem;
            color: #718096;
            margin-bottom: 15px;
        }

        /* Tools Section */
        .tools-employed {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .tools-employed::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #667eea, #764ba2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .tools-title {
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .tool-item {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            font-size: 0.95rem;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
        }

        .tool-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .tool-item i {
            margin-right: 8px;
            color: #667eea;
        }

        /* Enhanced Progress Section with Multi-stage */
        .progress-section {
            margin-bottom: 30px;
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: sticky;
            top: 80px;
            z-index: 100;
            overflow: hidden;
        }

        .progress-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #10b981, #764ba2, #667eea);
            background-size: 300% 100%;
            animation: rainbow-flow 4s ease-in-out infinite;
        }

        @keyframes rainbow-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .progress-title {
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 25px;
            font-size: 1.3rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Multi-stage progress indicators */
        .progress-stages {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .progress-stage {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .progress-stage:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 60%;
            width: 80%;
            height: 2px;
            background: #e2e8f0;
            z-index: -1;
        }

        .progress-stage.active::after {
            background: linear-gradient(90deg, #667eea, #10b981);
        }

        .progress-stage.completed::after {
            background: #10b981;
        }

        .stage-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-stage.active .stage-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            animation: stagePulse 1s ease-in-out infinite;
        }

        .progress-stage.completed .stage-icon {
            background: #10b981;
            color: white;
        }

        @keyframes stagePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .stage-label {
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
            max-width: 100px;
        }

        .progress-stage.active .stage-label {
            color: #667eea;
            font-weight: 600;
        }

        .progress-stage.completed .stage-label {
            color: #10b981;
        }

        /* Enhanced colorful progress bar */
        .progress-bar {
            background: #e2e8f0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                #ff6b6b 0%, 
                #f06595 14%, 
                #cc5de8 28%, 
                #845ef7 42%, 
                #5c7cfa 56%, 
                #339af0 70%, 
                #22b8cf 84%, 
                #20c997 100%);
            border-radius: 13px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            background-size: 200% 100%;
            animation: gradient-shift 3s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.6), 
                transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Progress percentage display */
        .progress-percentage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 1.1rem;
            z-index: 2;
        }

        /* Spinning icon and status text */
        .progress-status {
            text-align: center;
            color: #6b7280;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .progress-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid transparent;
            border-top: 3px solid #667eea;
            border-right: 3px solid #10b981;
            border-bottom: 3px solid #764ba2;
            border-left: 3px solid #f59e0b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Sticky Results Navigation Bar */
        .results-nav-bar {
            position: sticky;
            top: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            z-index: 50;
            opacity: 0;
            transform: translateY(-20px);
            animation: slideDownFade 0.5s ease forwards;
        }

        @keyframes slideDownFade {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-nav-bar button {
            padding: 8px 16px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .results-nav-bar button:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .results-nav-bar button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }

        /* Results Preview Cards */
        .results-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border-radius: 20px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .preview-card {
            background: white;
            border-radius: 12px;
            padding: 30px 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .preview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            transition: all 0.3s ease;
        }

        .preview-card.credibility {
            border-color: rgba(16, 185, 129, 0.2);
        }

        .preview-card.credibility::before {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .preview-card.credibility:hover {
            border-color: rgba(16, 185, 129, 0.4);
            background: linear-gradient(145deg, #ffffff, #f0fdf4);
        }

        .preview-card.bias {
            border-color: rgba(102, 126, 234, 0.2);
        }

        .preview-card.bias::before {
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .preview-card.bias:hover {
            border-color: rgba(102, 126, 234, 0.4);
            background: linear-gradient(145deg, #ffffff, #f5f3ff);
        }

        .preview-card.claims {
            border-color: rgba(245, 158, 11, 0.2);
        }

        .preview-card.claims::before {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .preview-card.claims:hover {
            border-color: rgba(245, 158, 11, 0.4);
            background: linear-gradient(145deg, #ffffff, #fffbeb);
        }

        .preview-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .preview-card h3 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            line-height: 1.3;
        }

        .preview-card p {
            color: #6b7280;
            font-size: 0.95rem;
            line-height: 1.4;
            margin: 0;
        }

        .preview-card.credibility h3 {
            color: #059669;
        }

        .preview-card.bias h3 {
            color: #667eea;
        }

        .preview-card.claims h3 {
            color: #d97706;
        }

        /* Results Overview Section */
        .results-overview {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .results-overview-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .results-list {
            display: grid;
            gap: 12px;
        }

        .result-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .result-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .result-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .result-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .result-icon.available {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .result-icon.pro-only {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .result-info {
            flex: 1;
        }

        .result-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .result-description {
            font-size: 0.9rem;
            color: #6b7280;
            line-height: 1.4;
        }

        .result-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.available {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .status-badge.pro-only {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        /* Enhanced result item styles for inline expansion */
        .result-item-expandable {
            margin-bottom: 15px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }

        .result-item-expandable.expanded {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .inline-result-content {
            padding: 25px;
            background: rgba(249, 250, 251, 0.5);
            border-top: 2px solid rgba(102, 126, 234, 0.1);
            animation: slideDown 0.3s ease;
        }

        .result-item.locked {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .result-item.locked:hover {
            transform: none;
            border-color: #e2e8f0;
        }

        /* Input Section */
        .input-section {
            margin-bottom: 30px;
        }

        .input-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .input-tab {
            padding: 12px 24px;
            border: none;
            background: #f8fafc;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .input-tab:hover {
            background: #f1f5f9;
            color: #374151;
        }

        .input-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            transform: translateY(2px);
        }

        .input-content {
            display: none;
        }

        .input-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #4a5568;
            font-size: 1rem;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }

        /* Button Styles */
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-test {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-compare {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
            color: white;
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        .btn-compare:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(20, 184, 166, 0.3);
        }

        /* Results Section */
        .results {
            display: none;
            margin-top: 30px;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateX(100px);
            }
            to { 
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Version Badge */
        .version-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .version-badge.free {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .version-badge.pro {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* Result Cards */
        .result-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .result-card.main-assessment {
            border: 3px solid #667eea;
            background: linear-gradient(145deg, #ffffff, #f8fafc);
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #667eea, #764ba2);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            color: #4a5568;
            font-weight: 700;
            font-size: 1.3rem;
        }

        .result-header i {
            color: #667eea;
            font-size: 1.4rem;
        }

        /* Enhanced Dropdown Styles */
        .dropdown-section {
            margin-bottom: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            overflow: hidden;
            background: white;
            transition: all 0.3s ease;
        }

        .dropdown-section.active {
            border-color: #667eea;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15);
        }

        .dropdown-header {
            background: rgba(102, 126, 234, 0.05);
            padding: 18px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            position: relative;
        }

        .dropdown-header:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .dropdown-header.open {
            background: rgba(102, 126, 234, 0.15);
            border-bottom: 2px solid #667eea;
        }

        .dropdown-header.locked {
            background: rgba(156, 163, 175, 0.1);
            color: #9ca3af;
            cursor: not-allowed;
            position: relative;
        }

        .dropdown-header.locked:hover {
            background: rgba(156, 163, 175, 0.15);
        }

        .dropdown-header.locked::after {
            content: '🔒 PRO ONLY';
            position: absolute;
            right: 60px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .dropdown-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .dropdown-toggle {
            background: rgba(102, 126, 234, 0.1);
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .dropdown-toggle:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .dropdown-icon {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
            color: #667eea;
        }

        .dropdown-header.open .dropdown-icon {
            transform: rotate(180deg);
            color: #764ba2;
        }

        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            padding: 0 25px;
            background: white;
            border-top: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.5s ease;
        }

        .dropdown-content.open {
            max-height: 2000px;
            padding: 25px;
        }

        /* Section Summary for collapsed state */
        .section-summary {
            background: rgba(102, 126, 234, 0.05);
            padding: 10px 15px;
            border-radius: 8px;
            margin-left: 20px;
            font-size: 0.9rem;
            color: #6b7280;
            display: none;
        }

        .dropdown-header:not(.open) .section-summary {
            display: inline-block;
        }

        /* Compact Summary */
        .compact-summary {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 25px;
            padding: 25px;
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
        }

        /* Enhanced Animated Score Circle */
        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: 900;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
            background: #e5e7eb;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }

        /* Animated ring fill */
        @keyframes ringFill {
            from { background-position: 0deg; }
            to { background-position: 360deg; }
        }

        .score-circle.animating {
            background: conic-gradient(
                from 0deg,
                transparent 0deg,
                transparent var(--score-deg),
                #e5e7eb var(--score-deg),
                #e5e7eb 360deg
            );
            animation: ringFill 2s ease-out;
        }

        .score-text {
            position: relative;
            z-index: 2;
            opacity: 0;
            animation: fadeInScale 0.5s ease 1.5s forwards;
        }

        @keyframes fadeInScale {
            from { 
                opacity: 0;
                transform: scale(0.5);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        .summary-content {
            flex: 1;
        }

        .summary-content h3 {
            margin-bottom: 12px;
            font-size: 1.4rem;
        }

        .summary-dialogue {
            color: #6b7280;
            line-height: 1.6;
            font-size: 1.05rem;
        }

        /* Locked Content */
        .locked-content {
            background: linear-gradient(145deg, rgba(156, 163, 175, 0.05), rgba(156, 163, 175, 0.1));
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            color: #6b7280;
            margin: 20px 0;
            position: relative;
        }

        .locked-content .lock-icon {
            font-size: 3rem;
            color: #9ca3af;
            margin-bottom: 20px;
        }

        .locked-content h3 {
            color: #4b5563;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .locked-content p {
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .upgrade-prompt {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px 35px;
            border-radius: 15px;
            text-align: center;
            margin-top: 25px;
        }

        .upgrade-prompt h3 {
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .upgrade-prompt .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            font-size: 0.95rem;
        }

        .upgrade-prompt button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .upgrade-prompt button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Enhanced Export Options */
        .export-options {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .export-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .export-btn.pdf {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .export-btn.json {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
        }

        .export-btn.email {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        .export-btn.share {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        /* Data Grid with Animated Counters */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .data-item {
            background: #f8fafc;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }

        .data-item:hover {
            background: #f1f5f9;
            transform: translateY(-2px);
        }

        .data-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .data-value.counting {
            animation: numberPulse 0.3s ease;
        }

        @keyframes numberPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .data-label {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 600;
        }

        /* Feature Teaser */
        .feature-teaser {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            border: 2px solid rgba(245, 158, 11, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }

        .feature-teaser h4 {
            color: #d97706;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .feature-teaser p {
            color: #92400e;
            margin-bottom: 15px;
        }

        .feature-teaser .preview-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin: 15px 0;
            font-size: 0.9rem;
            color: #b45309;
        }

        /* Interactive Bias Spectrum */
        .interactive-bias-spectrum {
            margin: 30px 0;
            position: relative;
        }

        .bias-spectrum {
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 25%, #10b981 50%, #f59e0b 75%, #ef4444 100%);
            height: 40px;
            border-radius: 20px;
            position: relative;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }

        .bias-indicator {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            background: white;
            border: 4px solid #374151;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2;
            transition: all 0.5s ease;
        }

        .bias-indicator.pulse {
            animation: biasPulse 2s ease-in-out infinite;
        }

        @keyframes biasPulse {
            0%, 100% { 
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                box-shadow: 0 4px 20px rgba(0,0,0,0.5), 0 0 20px rgba(102, 126, 234, 0.4);
                transform: translate(-50%, -50%) scale(1.15);
            }
        }

        .bias-labels {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #6b7280;
            font-weight: 600;
        }

        /* Bias Tooltip */
        .bias-tooltip {
            position: absolute;
            bottom: -45px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 100;
        }

        .bias-tooltip.visible {
            opacity: 1;
        }

        /* Interactive Evidence Explorer Styles */
        .evidence-explorer {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            border: 2px solid rgba(102, 126, 234, 0.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .evidence-explorer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .evidence-explorer-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .evidence-counter {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .evidence-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .evidence-card {
            background: white;
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .evidence-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .evidence-card.expanded {
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .evidence-card-header {
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .evidence-type {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            color: #4a5568;
            font-size: 1.1rem;
        }

        .evidence-confidence {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .confidence-high {
            background: rgba(16, 185, 129, 0.2);
            color: #059669;
        }

        .confidence-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #d97706;
        }

        .confidence-low {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }

        .expand-indicator {
            color: #6b7280;
            transition: transform 0.3s ease;
        }

        .evidence-card.expanded .expand-indicator {
            transform: rotate(180deg);
        }

        .evidence-preview {
            padding: 20px;
            color: #6b7280;
            font-size: 1rem;
            line-height: 1.6;
        }

        .evidence-details {
            display: none;
            padding: 0 20px 20px;
            border-top: 1px solid rgba(102, 126, 234, 0.1);
        }

        .evidence-details.visible {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .evidence-methodology {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .evidence-sources {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .evidence-source {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Source Network Visualization */
        .source-network {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .network-nodes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .network-node {
            background: white;
            border: 2px solid #667eea;
            border-radius: 50%;
            padding: 20px;
            text-align: center;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .network-node:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .network-node.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        /* Info Tooltip Styles */
        .info-tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #667eea;
            margin-left: 5px;
        }

        .info-tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: nowrap;
            max-width: 250px;
            z-index: 1000;
            pointer-events: none;
            line-height: 1.4;
        }

        .info-tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }

        /* Enhanced Tooltip */
        .enhanced-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 250px;
            line-height: 1.4;
        }

        .enhanced-tooltip h4 {
            margin-bottom: 5px;
            font-size: 1rem;
            color: #667eea;
        }

        .enhanced-tooltip.visible {
            opacity: 1;
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* Comparison Mode Styles */
        .comparison-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .comparison-panel.open {
            right: 0;
        }

        .comparison-header {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .comparison-items {
            padding: 20px;
        }

        .comparison-item {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .comparison-item h4 {
            color: #374151;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .comparison-remove {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ef4444;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Cross-Verify Modal */
        #crossVerifyModal .modal-content {
            background: white;
        }

        #crossVerifyModal .modal-header {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }

        #crossVerifyModal input {
            background: white;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }

        #crossVerifyModal .modal-body p {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 10000;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: #10b981;
            color: white;
        }

        .notification.error {
            background: #ef4444;
            color: white;
        }

        .notification.info {
            background: #667eea;
            color: white;
        }

        /* Claim Counter Animation */
        .claim-counter {
            display: inline-block;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.1rem;
            margin: 20px 0;
            animation: claimPulse 1s ease-in-out infinite;
        }

        @keyframes claimPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .claim-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }

        .claim-progress-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .claim-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Confidence Meters */
        .confidence-meter {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .confidence-meter-label {
            font-weight: 600;
            color: #4a5568;
            min-width: 120px;
        }

        .confidence-meter-bar {
            flex: 1;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .confidence-meter-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .confidence-meter-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: confidenceShine 2s infinite;
        }

        @keyframes confidenceShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .confidence-high .confidence-meter-fill {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .confidence-medium .confidence-meter-fill {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .confidence-low .confidence-meter-fill {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .confidence-meter-value {
            font-weight: 700;
            color: #667eea;
            min-width: 50px;
            text-align: right;
        }

        /* Analysis History */
        .analysis-history {
            position: fixed;
            bottom: 80px;
            right: 30px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            max-width: 300px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 100;
        }

        .analysis-history.visible {
            display: block;
            animation: slideUpFade 0.3s ease;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .history-header {
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: #f1f5f9;
            border-color: #667eea;
        }

        .history-item-title {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .history-item-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            body {
                padding-top: 60px;
            }
            
            .container {
                padding: 15px;
            }
            
            .tool-container {
                padding: 25px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button-group .btn {
                width: 100%;
                justify-content: center;
            }
            
            .nav-links-secondary {
                flex-direction: column;
                gap: 10px;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .compact-summary {
                flex-direction: column;
                text-align: center;
            }
            
            .data-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .score-circle {
                width: 80px;
                height: 80px;
                font-size: 1.3rem;
            }

            .upgrade-prompt .features-grid {
                grid-template-columns: 1fr;
            }

            .beta-content {
                flex-direction: column;
                gap: 8px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .modal-footer {
                flex-direction: column;
            }
            
            /* Free vs Pro comparison on mobile */
            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
            
            /* Progress section on mobile */
            .progress-section {
                position: relative;
                top: auto;
            }

            .results-nav-bar {
                flex-direction: column;
                gap: 5px;
            }

            .results-nav-bar button {
                width: 100%;
            }

            .progress-stages {
                padding: 0 10px;
            }

            .stage-label {
                font-size: 0.7rem;
                max-width: 80px;
            }

            .comparison-panel {
                width: 100%;
            }

            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
            }

            .export-options {
                flex-direction: column;
            }

            .export-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    {% include 'header.html' %}

    <!-- Beta Banner -->
    <div class="beta-banner">
        <div class="beta-content">
            <span class="beta-badge">BETA</span>
            <span>🚀 The world's ONLY platform built specifically for news verification - Join our beta!</span>
            <button class="beta-join-btn" onclick="openBetaModal()">Join Beta</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> NewsVerify Pro</h1>
            <p>The World's First AI Platform Built Specifically for News Verification & Media Analysis</p>
        </div>

        <nav class="nav-bar">
            <div class="nav-links-secondary">
                <a href="/"><i class="fas fa-home"></i> Home</a>
                <a href="/news" class="active"><i class="fas fa-newspaper"></i> News Verification</a>
                <a href="/unified"><i class="fas fa-search"></i> Content Authenticity</a>
                <a href="/imageanalysis"><i class="fas fa-image"></i> AI Image Analysis</a>
                <a href="/missionstatement"><i class="fas fa-bullseye"></i> Our Mission</a>
                <a href="/pricingplan"><i class="fas fa-tags"></i> Pricing</a>
            </div>
        </nav>

        <div class="tool-container">
            <div class="tool-header">
                <h2><i class="fas fa-newspaper"></i> Professional News Verification Engine</h2>
                <p>Advanced political bias detection, source credibility scoring, and cross-reference verification</p>
            </div>

            <!-- Collapsible Information Sections -->
            <div class="dropdown-section" id="methodologies-section">
                <div class="dropdown-header" onclick="toggleDropdown(this, 'info')">
                    <span><i class="fas fa-cogs"></i> Analysis Methodologies (12 Advanced Systems)</span>
                    <div class="dropdown-controls">
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                </div>
                <div class="dropdown-content">
                    <div class="tools-employed" style="border: none; margin: 0;">
                        <div class="tools-grid">
                            <div class="tool-item">
                                <i class="fas fa-balance-scale"></i> Real-Time Political Bias Detection
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-check-circle"></i> Multi-Source Fact Verification
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-database"></i> 500+ News Source Credibility Database
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-search"></i> Cross-Source Verification Network
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-shield-alt"></i> Misinformation Pattern Recognition
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-network-wired"></i> Multi-Outlet Story Comparison
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-chart-line"></i> Journalism Quality Scoring
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-clock"></i> Timeline & Event Verification
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-fingerprint"></i> Editorial vs News Classification
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-brain"></i> Advanced AI Content Analysis
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-globe"></i> Real-Time Breaking News Verification
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-comments"></i> Social Media Echo Analysis
                            </div>
                            <div class="tool-item">
                                <i class="fas fa-microscope"></i> Deep Linguistic Pattern Detection
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dropdown-section" id="how-to-use-section">
                <div class="dropdown-header" onclick="toggleDropdown(this, 'info')">
                    <span><i class="fas fa-info-circle"></i> How to Use NewsVerify Pro</span>
                    <div class="dropdown-controls">
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                </div>
                <div class="dropdown-content">
                    <div style="display: grid; gap: 15px;">
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <div style="background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">1</div>
                            <div>
                                <strong style="color: #4c1d95;">Choose Your Input Method:</strong><br>
                                <span style="color: #6b7280;">Either paste news text directly or enter a news article URL</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <div style="background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">2</div>
                            <div>
                                <strong style="color: #4c1d95;">Select Analysis Type:</strong><br>
                                <span style="color: #6b7280;">FREE: Basic credibility check | PRO: Comprehensive verification with bias analysis</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <div style="background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">3</div>
                            <div>
                                <strong style="color: #4c1d95;">Review Your Results:</strong><br>
                                <span style="color: #6b7280;">Explore bias spectrum, source verification, and claim analysis</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dropdown-section" id="comparison-section">
                <div class="dropdown-header" onclick="toggleDropdown(this, 'info')">
                    <span><i class="fas fa-crown"></i> Free vs Pro Comparison</span>
                    <div class="dropdown-controls">
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                </div>
                <div class="dropdown-content">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e5e7eb;">
                            <h4 style="color: #6b7280; margin-bottom: 15px;"><i class="fas fa-gift"></i> FREE Version</h4>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="margin-bottom: 10px; color: #4b5563;">✓ Basic credibility score</li>
                                <li style="margin-bottom: 10px; color: #4b5563;">✓ Source verification (100+ sources)</li>
                                <li style="margin-bottom: 10px; color: #4b5563;">✓ Simple bias indicator</li>
                                <li style="margin-bottom: 10px; color: #4b5563;">✓ 5 analyses per day</li>
                                <li style="margin-bottom: 10px; color: #9ca3af;">✗ No downloadable reports</li>
                                <li style="margin-bottom: 10px; color: #9ca3af;">✗ Limited evidence details</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; border-radius: 12px; border: 2px solid #667eea;">
                            <h4 style="color: white; margin-bottom: 15px;"><i class="fas fa-crown"></i> PRO Version</h4>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="margin-bottom: 10px; color: white;">✓ Advanced credibility analysis</li>
                                <li style="margin-bottom: 10px; color: white;">✓ 500+ source database</li>
                                <li style="margin-bottom: 10px; color: white;">✓ Interactive bias spectrum</li>
                                <li style="margin-bottom: 10px; color: white;">✓ Unlimited analyses</li>
                                <li style="margin-bottom: 10px; color: white;">✓ Downloadable PDF reports</li>
                                <li style="margin-bottom: 10px; color: white;">✓ Full claim verification</li>
                                <li style="margin-bottom: 10px; color: white;">✓ All 12 analysis methodologies</li>
                                <li style="margin-bottom: 10px; color: white;">✓ Priority customer support</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Authentication Message Area -->
            <div id="authMessageArea"></div>

            <!-- Usage Counter -->
            <div id="usageCounter"></div>

            <!-- Enhanced Progress Bars -->
            <div class="progress-section" id="progressSection" style="display: none;">
                <div class="progress-title">
                    <i class="fas fa-cogs fa-spin" style="color: #667eea;"></i>
                    News Verification in Progress...
                </div>
                
                <!-- Multi-stage progress indicators -->
                <div class="progress-stages" id="progressStages">
                    <div class="progress-stage" data-stage="0">
                        <div class="stage-icon">📄</div>
                        <div class="stage-label">Extracting Content</div>
                    </div>
                    <div class="progress-stage" data-stage="1">
                        <div class="stage-icon">⚖️</div>
                        <div class="stage-label">Analyzing Bias</div>
                    </div>
                    <div class="progress-stage" data-stage="2">
                        <div class="stage-icon">🔍</div>
                        <div class="stage-label">Checking Sources</div>
                    </div>
                    <div class="progress-stage" data-stage="3">
                        <div class="stage-icon">✓</div>
                        <div class="stage-label">Verifying Claims</div>
                    </div>
                    <div class="progress-stage" data-stage="4">
                        <div class="stage-icon">📊</div>
                        <div class="stage-label">Generating Report</div>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar">
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                </div>
                
                <div class="progress-status">
                    <div class="progress-spinner"></div>
                    <span id="progressStatus">Initializing advanced verification systems...</span>
                </div>
                
                <!-- Claim verification progress -->
                <div class="claim-progress" style="display: none;" id="claimProgress">
                    <span style="color: #6b7280; font-weight: 600;">Claims found:</span>
                    <span class="claim-counter" id="claimCounter">0</span>
                    <div class="claim-progress-bar">
                        <div class="claim-progress-fill" id="claimProgressFill"></div>
                    </div>
                </div>
            </div>

            <div class="input-section">
                <div class="input-tabs">
                    <button class="input-tab active" onclick="switchInputType('text')">📝 News Text Analysis</button>
                    <button class="input-tab" onclick="switchInputType('url')">🔗 URL Verification</button>
                </div>
                
                <div class="input-content active" id="textInput">
                    <div class="input-group">
                        <label for="news-text"><i class="fas fa-file-text"></i> News Article or Social Media Content</label>
                        <textarea id="news-text" placeholder="Paste news article, social media post, or any news content for comprehensive verification and bias analysis..."></textarea>
                    </div>
                </div>
                
                <div class="input-content" id="urlInput">
                    <div class="input-group">
                        <label for="news-url"><i class="fas fa-link"></i> News Article URL</label>
                        <input type="url" id="news-url" placeholder="https://example.com/news-article-for-verification">
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="runAnalysis('free')">
                    <i class="fas fa-play"></i> Start Free Analysis
                </button>
                <button class="btn btn-primary" onclick="runAnalysis('pro')" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <i class="fas fa-crown"></i> Start Pro Analysis
                </button>
                <button class="btn btn-test" onclick="loadTestData()">
                    <i class="fas fa-flask"></i> Load Sample News
                </button>
                <button class="btn btn-secondary" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>

            <div class="results" id="results">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Comparison Panel -->
    <div class="comparison-panel" id="comparisonPanel">
        <div class="comparison-header">
            <h3>Article Comparison</h3>
            <button onclick="closeComparison()" style="background: transparent; border: none; color: white; font-size: 1.5rem; cursor: pointer;">×</button>
        </div>
        <div class="comparison-items" id="comparisonItems">
            <!-- Comparison items will be added here -->
        </div>
    </div>

    <!-- Analysis History -->
    <div class="analysis-history" id="analysisHistory">
        <div class="history-header">
            <span>Analysis History</span>
            <button onclick="clearHistory()" style="background: transparent; border: none; color: #6b7280; cursor: pointer;">Clear</button>
        </div>
        <div id="historyItems">
            <!-- History items will be added here -->
        </div>
    </div>

    <!-- Beta Modal -->
    <div id="betaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBetaModal()">&times;</span>
            <div class="modal-header">
                <h2>🚀 Join Our Beta Program</h2>
                <p>Get exclusive early access to the world's first news verification platform and help shape the future of media analysis!</p>
            </div>
            <div class="modal-body">
                <form id="betaSignupForm">
                    <div class="input-group">
                        <input type="email" id="betaEmail" placeholder="Enter your email address" required>
                    </div>
                    <div class="input-group">
                        <input type="text" id="betaName" placeholder="Your name (optional)">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBetaModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitBetaSignup()">Join Beta Program</button>
            </div>
        </div>
    </div>

    <!-- Cross-Verify Modal -->
    <div id="crossVerifyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCrossVerifyModal()">&times;</span>
            <div class="modal-header">
                <h2>🔍 Cross-Source Verification</h2>
                <p>Verify news across multiple sources in real-time</p>
            </div>
            <div class="modal-body">
                <label style="display: block; margin-bottom: 8px; font-weight: 700; color: #4a5568;">Enter News Topic or Keywords</label>
                <input type="text" id="crossVerifyTopic" placeholder="e.g., Infrastructure Bill, Climate Summit" style="background: white; border: 2px solid #e2e8f0; color: #4a5568;">
                <p style="color: #6b7280; font-size: 0.9rem; margin-top: 10px;">We'll search and compare coverage from Reuters, CNN, Fox News, BBC, and more trusted sources.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCrossVerifyModal()">Cancel</button>
                <button class="btn btn-primary" onclick="runCrossVerification()">Start Cross-Verification</button>
            </div>
        </div>
    </div>

    <!-- Unsupported Claims Modal -->
    <div id="claimsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeClaimsModal()">&times;</span>
            <div class="modal-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Unsupported Claims Detected</h2>
                <p>The following statements require attribution or supporting evidence:</p>
            </div>
            <div class="modal-body" id="claimsList">
                <!-- Claims will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script src="/static/auth-analysis.js"></script>
    <script>
        // ============================================================================
        // ENHANCED GLOBAL VARIABLES AND FUNCTIONS
        // ============================================================================
        
        let currentInputType = 'text';
        let currentAnalysisData = null;
        let currentTier = 'free';
        let analysisHistory = [];
        let comparisonItems = [];
        let sectionStates = {}; // Track which sections are open/closed
        let activeSection = null; // Track the currently active section

        // Initialize tooltips
        let currentTooltip = null;

        // Toggle inline result content
        function toggleInlineResult(element) {
            const container = element.closest('.result-item-expandable');
            const content = container.querySelector('.inline-result-content');
            const chevron = element.querySelector('.fa-chevron-down');
            const isExpanded = container.classList.contains('expanded');
            
            if (isExpanded) {
                container.classList.remove('expanded');
                content.style.display = 'none';
                if (chevron) chevron.style.transform = 'rotate(0deg)';
            } else {
                // Close other expanded items in the same container
                const parent = container.parentElement;
                parent.querySelectorAll('.result-item-expandable').forEach(item => {
                    item.classList.remove('expanded');
                    const itemContent = item.querySelector('.inline-result-content');
                    if (itemContent) itemContent.style.display = 'none';
                    const itemChevron = item.querySelector('.fa-chevron-down');
                    if (itemChevron) itemChevron.style.transform = 'rotate(0deg)';
                });
                
                container.classList.add('expanded');
                content.style.display = 'block';
                if (chevron) chevron.style.transform = 'rotate(180deg)';
                
                // Animate elements inside
                setTimeout(() => {
                    // Animate score circles
                    const scoreCircle = content.querySelector('.score-circle');
                    if (scoreCircle && !scoreCircle.classList.contains('animating')) {
                        const scoreText = scoreCircle.querySelector('.score-text');
                        const targetScore = parseInt(scoreText.textContent);
                        scoreCircle.classList.add('animating');
                        
                        // Set the background based on the score
                        const credibilityScore = targetScore;
                        const credibilityColors = getCredibilityColor(credibilityScore);
                        scoreCircle.style.background = `conic-gradient(from 0deg, ${credibilityColors.primary} 0deg ${credibilityScore * 3.6}deg, #e5e7eb ${credibilityScore * 3.6}deg 360deg)`;
                    }
                    
                    // Animate confidence meters
                    content.querySelectorAll('.confidence-meter-fill').forEach(element => {
                        const width = element.style.width;
                        element.style.width = '0%';
                        setTimeout(() => {
                            element.style.width = width;
                        }, 100);
                    });
                    
                    // Setup interactive bias spectrum if present
                    if (content.querySelector('.bias-spectrum')) {
                        setupInteractiveBiasSpectrum();
                    }
                }, 100);
            }
            
            trackNewsEvent('inline_result_toggled', {
                section: container.querySelector('.result-title').textContent,
                action: isExpanded ? 'closed' : 'opened'
            });
        }

        // Helper function to get credibility color
        function getCredibilityColor(score) {
            if (score >= 80) return { primary: '#10b981', secondary: '#059669', text: 'Highly Credible' };
            if (score >= 60) return { primary: '#f59e0b', secondary: '#d97706', text: 'Moderately Credible' };
            return { primary: '#ef4444', secondary: '#dc2626', text: 'Low Credibility' };
        }

        // Enhanced dropdown toggle with close functionality
        function toggleDropdown(header, tier) {
            const content = header.nextElementSibling;
            const section = header.parentElement;
            const sectionId = section.id;
            const isOpen = header.classList.contains('open');
            
            // Check if it's a locked dropdown and user is on free tier
            if (header.classList.contains('locked') && tier === 'free') {
                showNotification('Upgrade to Pro to unlock this feature!', 'info');
                return;
            }
            
            // Update active section
            if (!isOpen) {
                // Remove active class from all sections
                document.querySelectorAll('.dropdown-section').forEach(s => {
                    s.classList.remove('active');
                });
                section.classList.add('active');
                activeSection = sectionId;
                
                // Update navigation bar if it exists
                updateNavBarActiveState(sectionId);
            }
            
            // Toggle open state
            header.classList.toggle('open');
            content.classList.toggle('open');
            
            // Store state
            sectionStates[sectionId] = !isOpen;
            
            // Smooth transition
            if (!isOpen) {
                content.style.maxHeight = content.scrollHeight + 'px';
            } else {
                content.style.maxHeight = '0';
            }
            
            trackNewsEvent('dropdown_toggled', {
                section: sectionId,
                action: isOpen ? 'closed' : 'opened'
            });
        }

        // Collapse all dropdowns
        function collapseAll() {
            document.querySelectorAll('.dropdown-header.open').forEach(header => {
                const content = header.nextElementSibling;
                header.classList.remove('open');
                content.classList.remove('open');
                content.style.maxHeight = '0';
            });
            
            document.querySelectorAll('.dropdown-section').forEach(s => {
                s.classList.remove('active');
            });
            
            // Clear all states
            sectionStates = {};
            activeSection = null;
            
            showNotification('All sections collapsed', 'info');
        }

        // Expand all dropdowns
        function expandAll() {
            document.querySelectorAll('.dropdown-header:not(.locked)').forEach(header => {
                const content = header.nextElementSibling;
                header.classList.add('open');
                content.classList.add('open');
                content.style.maxHeight = content.scrollHeight + 'px';
                
                const sectionId = header.parentElement.id;
                sectionStates[sectionId] = true;
            });
            
            showNotification('All available sections expanded', 'info');
        }

        // Enhanced scroll to section without auto-opening
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                // Smooth scroll to section
                section.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start',
                    inline: 'nearest' 
                });
                
                // Add highlight effect
                section.style.transition = 'all 0.3s ease';
                section.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.5)';
                setTimeout(() => {
                    section.style.boxShadow = '';
                }, 1500);
                
                // Update active section
                document.querySelectorAll('.dropdown-section').forEach(s => {
                    s.classList.remove('active');
                });
                section.classList.add('active');
                activeSection = sectionId;
                
                // Update navigation bar
                updateNavBarActiveState(sectionId);
            }
        }

        // Update navigation bar active state
        function updateNavBarActiveState(sectionId) {
            const navBar = document.querySelector('.results-nav-bar');
            if (navBar) {
                navBar.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(sectionId)) {
                        btn.classList.add('active');
                    }
                });
            }
        }

        // Enhanced interactive bias spectrum
        function setupInteractiveBiasSpectrum() {
            const spectrum = document.querySelector('.bias-spectrum');
            const tooltip = document.querySelector('.bias-tooltip');
            
            if (!spectrum || !tooltip) return;
            
            const biasDescriptions = {
                0: 'Far Left: Strongly progressive bias with significant ideological lean',
                20: 'Left: Clear liberal bias with consistent progressive viewpoints',
                40: 'Center-Left: Slight liberal lean but generally balanced',
                50: 'Center: Neutral and balanced reporting',
                60: 'Center-Right: Slight conservative lean but generally balanced',
                80: 'Right: Clear conservative bias with consistent traditional viewpoints',
                100: 'Far Right: Strongly conservative bias with significant ideological lean'
            };
            
            spectrum.addEventListener('mousemove', (e) => {
                const rect = spectrum.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = Math.round((x / rect.width) * 100);
                
                // Find closest description
                let closestKey = 0;
                let minDiff = 100;
                Object.keys(biasDescriptions).forEach(key => {
                    const diff = Math.abs(percentage - parseInt(key));
                    if (diff < minDiff) {
                        minDiff = diff;
                        closestKey = key;
                    }
                });
                
                tooltip.textContent = biasDescriptions[closestKey];
                tooltip.style.left = x + 'px';
                tooltip.classList.add('visible');
            });
            
            spectrum.addEventListener('mouseleave', () => {
                tooltip.classList.remove('visible');
            });
        }

        // Add to comparison
        function addToComparison() {
            if (!currentAnalysisData) {
                showNotification('No analysis to compare', 'error');
                return;
            }
            
            if (comparisonItems.length >= 3) {
                showNotification('Maximum 3 articles can be compared', 'info');
                return;
            }
            
            const item = {
                id: Date.now(),
                title: document.getElementById('news-text').value.substring(0, 50) + '...',
                score: currentAnalysisData.credibility_score,
                bias: currentAnalysisData.political_bias?.bias_label || 'Unknown'
            };
            
            comparisonItems.push(item);
            updateComparisonPanel();
            showNotification('Added to comparison', 'success');
        }

        // Update comparison panel
        function updateComparisonPanel() {
            const panel = document.getElementById('comparisonPanel');
            const itemsContainer = document.getElementById('comparisonItems');
            
            itemsContainer.innerHTML = '';
            
            comparisonItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'comparison-item';
                div.innerHTML = `
                    <h4>${item.title}</h4>
                    <p>Score: ${item.score}/100</p>
                    <p>Bias: ${item.bias}</p>
                    <button class="comparison-remove" onclick="removeFromComparison(${item.id})">×</button>
                `;
                itemsContainer.appendChild(div);
            });
            
            if (comparisonItems.length > 0) {
                panel.classList.add('open');
            }
        }

        // Remove from comparison
        function removeFromComparison(id) {
            comparisonItems = comparisonItems.filter(item => item.id !== id);
            updateComparisonPanel();
            
            if (comparisonItems.length === 0) {
                closeComparison();
            }
        }

        // Close comparison panel
        function closeComparison() {
            document.getElementById('comparisonPanel').classList.remove('open');
        }

        // Save to history
        function saveToHistory() {
            if (!currentAnalysisData) return;
            
            const historyItem = {
                id: Date.now(),
                title: document.getElementById('news-text').value.substring(0, 50) + '...',
                score: currentAnalysisData.credibility_score,
                date: new Date().toLocaleDateString(),
                data: currentAnalysisData
            };
            
            analysisHistory.unshift(historyItem);
            if (analysisHistory.length > 10) {
                analysisHistory = analysisHistory.slice(0, 10);
            }
            
            localStorage.setItem('newsAnalysisHistory', JSON.stringify(analysisHistory));
            updateHistoryDisplay();
        }

        // Update history display
        function updateHistoryDisplay() {
            const container = document.getElementById('historyItems');
            container.innerHTML = '';
            
            analysisHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.onclick = () => loadFromHistory(item);
                div.innerHTML = `
                    <div class="history-item-title">${item.title}</div>
                    <div class="history-item-meta">
                        <span>Score: ${item.score}/100</span>
                        <span>${item.date}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Load from history
        function loadFromHistory(item) {
            currentAnalysisData = item.data;
            showNewsResults(item.data, currentTier);
            document.getElementById('analysisHistory').classList.remove('visible');
            showNotification('Loaded from history', 'success');
        }

        // Clear history
        function clearHistory() {
            analysisHistory = [];
            localStorage.removeItem('newsAnalysisHistory');
            updateHistoryDisplay();
            showNotification('History cleared', 'info');
        }

        // Enhanced export functions
        function downloadReport() {
            if (!currentAnalysisData) {
                showNotification('No analysis data to download', 'error');
                return;
            }
            
            // Generate enhanced PDF report content
            const reportContent = generateDetailedReport();
            
            // Create blob and download
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `news-verification-report-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('Report downloaded successfully!', 'success');
            trackNewsEvent('report_downloaded', {
                tier: currentTier,
                format: 'pdf'
            });
        }

        function exportAsJSON() {
            if (!currentAnalysisData) {
                showNotification('No analysis data to export', 'error');
                return;
            }
            
            const jsonData = JSON.stringify(currentAnalysisData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `news-analysis-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showNotification('JSON exported successfully!', 'success');
        }

        function emailReport() {
            if (!currentAnalysisData) {
                showNotification('No analysis data to email', 'error');
                return;
            }
            
            const subject = encodeURIComponent('News Verification Report');
            const body = encodeURIComponent(generateDetailedReport());
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
            
            showNotification('Opening email client...', 'info');
        }

        function shareResults() {
            if (!currentAnalysisData) {
                showNotification('No analysis data to share', 'error');
                return;
            }
            
            // In a real implementation, this would generate a shareable link
            const shareText = `News Verification Results: Credibility ${currentAnalysisData.credibility_score}/100, Bias: ${currentAnalysisData.political_bias?.bias_label || 'Unknown'}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'News Verification Report',
                    text: shareText,
                    url: window.location.href
                }).then(() => {
                    showNotification('Shared successfully!', 'success');
                }).catch(() => {
                    // Fallback to clipboard
                    navigator.clipboard.writeText(shareText);
                    showNotification('Link copied to clipboard!', 'success');
                });
            } else {
                navigator.clipboard.writeText(shareText);
                showNotification('Link copied to clipboard!', 'success');
            }
        }

        // Generate detailed report
        function generateDetailedReport() {
            const data = currentAnalysisData;
            return `
NEWS VERIFICATION REPORT
Generated: ${new Date().toLocaleString()}
Platform: NewsVerify Pro - Facts & Fakes AI

EXECUTIVE SUMMARY
================
Credibility Score: ${data.credibility_score}/100
Political Bias: ${data.political_bias?.bias_label || 'Unknown'}
Objectivity: ${data.political_bias?.objectivity_score || 0}%
Source Reliability: ${data.source_analysis?.credibility_score || 0}/100

DETAILED ANALYSIS
================
1. SOURCE VERIFICATION
   - Domain: ${data.source_analysis?.domain || 'Unknown'}
   - Type: ${data.source_analysis?.source_type || 'Unknown'}
   - Founded: ${data.source_analysis?.founded || 'Unknown'}
   - Political Lean: ${data.source_analysis?.political_bias || 'Unknown'}

2. BIAS INDICATORS
   - Left Indicators: ${data.political_bias?.left_indicators || 0}
   - Right Indicators: ${data.political_bias?.right_indicators || 0}
   - Bias Score: ${data.political_bias?.bias_score || 0}
   - Loaded Terms: ${(data.political_bias?.loaded_terms || []).join(', ') || 'None detected'}

3. CLAIM ANALYSIS
   - Total Claims: ${(data.political_bias?.unsupported_claims || []).length + (data.political_bias?.substantiated_claims || []).length}
   - Unsupported: ${(data.political_bias?.unsupported_claims || []).length}
   - Verified: ${(data.political_bias?.substantiated_claims || []).length}

4. CROSS-REFERENCES
   ${(data.cross_references || []).map(ref => `- ${ref.source}: ${ref.title} (${ref.relevance}%)`).join('\n   ') || 'No cross-references available'}

METHODOLOGY
===========
This analysis was conducted using 12 advanced verification systems including:
- Real-Time Political Bias Detection
- Multi-Source Fact Verification
- 500+ News Source Credibility Database
- Cross-Source Verification Network
- Misinformation Pattern Recognition
- And 7 additional methodologies

DISCLAIMER
==========
This report is generated by AI and should be used as one of multiple sources
in your news verification process. Always cross-reference important information
with multiple trusted sources.

© 2025 Facts & Fakes AI - Professional News Verification Platform
            `;
        }

        // Scroll to top
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Show/hide back to top button
        window.addEventListener('scroll', () => {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        });

        // Beta Modal Functions
        function openBetaModal() {
            trackNewsEvent('beta_modal_opened', {
                source: 'news_verification_banner',
                unique_value_prop: 'first_news_verification_platform'
            });
            document.getElementById('betaModal').style.display = 'block';
        }

        function closeBetaModal() {
            trackNewsEvent('beta_modal_closed');
            document.getElementById('betaModal').style.display = 'none';
        }

        function submitBetaSignup() {
            const email = document.getElementById('betaEmail').value;
            const name = document.getElementById('betaName').value;

            if (!email) {
                alert('Please enter your email address');
                return;
            }

            trackNewsEvent('beta_signup_attempted', {
                email: email,
                has_name: name.length > 0,
                source: 'news_verification'
            });

            // Submit to backend
            fetch('/api/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: email, password: 'BetaUser2025!' })
            })
            .then(response => response.json())
            .then(data => {
                trackNewsEvent('beta_signup_completed', {
                    email: email,
                    source: 'news_verification'
                });
                alert('🎉 Welcome to the beta! Check your email for access details.');
                closeBetaModal();
                document.getElementById('betaSignupForm').reset();
            })
            .catch(error => {
                console.log('Demo mode: Beta signup for', email);
                trackNewsEvent('beta_signup_completed', {
                    email: email,
                    source: 'news_verification',
                    demo_mode: true
                });
                alert('🎉 Thanks for your interest! Beta signup recorded.');
                closeBetaModal();
                document.getElementById('betaSignupForm').reset();
            });
        }

        // Cross-Verify Modal Functions
        function openCrossVerifyModal() {
            trackNewsEvent('cross_verify_modal_opened');
            document.getElementById('crossVerifyModal').style.display = 'block';
        }

        function closeCrossVerifyModal() {
            trackNewsEvent('cross_verify_modal_closed');
            document.getElementById('crossVerifyModal').style.display = 'none';
        }

        async function runCrossVerification() {
            const topic = document.getElementById('crossVerifyTopic').value;
            if (!topic) {
                showNotification('Please enter a topic to verify', 'error');
                return;
            }
            
            closeCrossVerifyModal();
            showNotification('Cross-verification started for: ' + topic, 'info');
            
            // Run analysis with the topic
            document.getElementById('news-text').value = 'Cross-verification request for topic: ' + topic;
            switchInputType('text');
            runAnalysis('free');
            
            trackNewsEvent('cross_verification_started', {
                topic: topic
            });
        }

        // Claims Modal Functions
        function closeClaimsModal() {
            document.getElementById('claimsModal').style.display = 'none';
        }

        function showAllClaims(claimType) {
            if (!currentAnalysisData || !currentAnalysisData.political_bias) {
                return;
            }

            const modal = document.getElementById('claimsModal');
            const claimsList = document.getElementById('claimsList');
            const modalHeader = modal.querySelector('.modal-header h2');
            
            let claims;
            let headerText;
            let headerIcon;
            
            if (claimType === 'unsupported') {
                claims = currentAnalysisData.political_bias.unsupported_claims || [];
                headerText = 'Unsupported Claims Detected';
                headerIcon = 'fas fa-exclamation-triangle';
            } else {
                claims = currentAnalysisData.political_bias.substantiated_claims || [];
                headerText = 'Well-Supported Claims';
                headerIcon = 'fas fa-check-circle';
            }
            
            // Update modal header
            modalHeader.innerHTML = `<i class="${headerIcon}"></i> ${headerText}`;
            modal.querySelector('.modal-header p').textContent = claimType === 'unsupported' ? 
                'The following statements require attribution or supporting evidence:' :
                'The following statements are properly sourced and verified:';

            // Clear existing content
            claimsList.innerHTML = '';

            // Add each claim
            claims.forEach((item, index) => {
                const claimDiv = document.createElement('div');
                claimDiv.className = 'claim-item';
                
                if (claimType === 'unsupported') {
                    claimDiv.style.borderLeftColor = '#f59e0b';
                    claimDiv.innerHTML = `
                        <div class="claim-number">Claim ${index + 1}</div>
                        <div class="claim-text">"${item.claim}"</div>
                        <div class="claim-reason">
                            <i class="fas fa-info-circle"></i> ${item.reason}
                        </div>
                    `;
                } else {
                    claimDiv.style.background = 'rgba(16, 185, 129, 0.05)';
                    claimDiv.style.borderLeftColor = '#10b981';
                    claimDiv.innerHTML = `
                        <div class="claim-number" style="color: #10b981;">Verified Claim ${index + 1}</div>
                        <div class="claim-text">"${item.claim}"</div>
                        <div class="claim-reason" style="color: #059669;">
                            <i class="fas fa-check-circle"></i> ${item.support}
                        </div>
                    `;
                }
                claimsList.appendChild(claimDiv);
            });

            // Show modal
            modal.style.display = 'block';

            // Track event
            trackNewsEvent(`${claimType}_claims_viewed`, {
                count: claims.length,
                tier: currentTier
            });
        }
        
        // Backwards compatibility
        function showUnsupportedClaims() {
            showAllClaims('unsupported');
        }

        // Input type switching
        function switchInputType(type) {
            currentInputType = type;
            
            document.querySelectorAll('.input-tab').forEach((tab, index) => {
                tab.classList.remove('active');
                if ((type === 'text' && index === 0) || (type === 'url' && index === 1)) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('.input-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const targetContent = document.getElementById(type + 'Input');
            if (targetContent) {
                targetContent.classList.add('active');
            }

            trackNewsEvent('input_type_switched', {
                type: type
            });
        }

        // Load test data
        function loadTestData() {
            const testContent = "Breaking: Infrastructure Bill Passes Senate with Bipartisan Support. The Department of Transportation announced today the allocation of $2.3 billion for highway improvements across 15 states, according to officials who state this initiative will create approximately 45,000 jobs over the next 18 months. The announcement comes following congressional support for the infrastructure bill passed last quarter. Sources close to the administration suggest this represents the largest single infrastructure investment in recent history. Industry experts predict significant economic impact in rural communities, though some critics question the timeline for implementation.";
            
            document.getElementById('news-text').value = testContent;
            switchInputType('text');
            
            showNotification('Sample news content loaded successfully!', 'success');
            trackNewsEvent('test_data_loaded', {
                content_type: 'news_sample'
            });
        }

        // Reset form
        function resetForm() {
            document.getElementById('news-text').value = '';
            document.getElementById('news-url').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('results').innerHTML = '';
            currentAnalysisData = null;
            showNotification('Form reset successfully', 'success');
            trackNewsEvent('form_reset');
        }

        // Generate news dialogue based on scores
        function generateNewsDialogue(credibilityScore, biasLabel, sourceCredibility) {
            if (credibilityScore >= 80) {
                return `This article demonstrates high credibility with strong source verification and minimal bias indicators. The ${biasLabel} political lean is well-balanced with factual reporting. Source reliability scored ${sourceCredibility}/100, indicating trustworthy journalism standards.`;
            } else if (credibilityScore >= 60) {
                return `This content shows moderate credibility with some areas of concern. The ${biasLabel} political bias is noticeable but not extreme. Source credibility of ${sourceCredibility}/100 suggests reasonable reliability with room for improvement in journalistic standards.`;
            } else {
                return `This article requires careful verification due to low credibility indicators. The ${biasLabel} political bias is pronounced and may affect objectivity. Source credibility of ${sourceCredibility}/100 raises concerns about reliability. Cross-reference with multiple sources recommended.`;
            }
        }

        // Animated counter function
        function animateCounter(element, start, end, duration) {
            const range = end - start;
            const increment = range / (duration / 16); // 60fps
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current);
                element.classList.add('counting');
                setTimeout(() => element.classList.remove('counting'), 150);
            }, 16);
        }

        // Update progress stages
        function updateProgressStages(stage) {
            const stages = document.querySelectorAll('.progress-stage');
            stages.forEach((stageEl, index) => {
                if (index < stage) {
                    stageEl.classList.add('completed');
                    stageEl.classList.remove('active');
                } else if (index === stage) {
                    stageEl.classList.add('active');
                    stageEl.classList.remove('completed');
                } else {
                    stageEl.classList.remove('active', 'completed');
                }
            });
        }

        // Main analysis function with enhanced progress
        async function runAnalysis(tier) {
            tier = tier || 'free';
            currentTier = tier;
            
            // ALWAYS allow Pro features for testing - no authentication needed
            console.log(`🚀 Running ${tier} analysis - authentication bypassed for testing`);
            
            trackNewsEvent('news_analysis_started', {
                tier: tier,
                input_type: currentInputType,
                unique_platform: 'news_verification_specialist'
            });
            
            // Validate input
            const textInput = document.getElementById('news-text').value.trim();
            const urlInput = document.getElementById('news-url').value.trim();
            
            if (currentInputType === 'text') {
                if (!textInput) {
                    showNotification('Please enter news content to analyze.', 'error');
                    return;
                }
                if (textInput.length < 50) {
                    showNotification('Please enter at least 50 characters for comprehensive news analysis.', 'error');
                    return;
                }
            }
            
            if (currentInputType === 'url') {
                if (!urlInput) {
                    showNotification('Please enter a news URL to analyze.', 'error');
                    return;
                }
                try {
                    new URL(urlInput);
                } catch (e) {
                    showNotification('Please enter a valid news URL (e.g., https://example.com/article).', 'error');
                    return;
                }
            }
            
            // Show progress section
            const progressSection = document.getElementById('progressSection');
            const progressBar = document.getElementById('progressBar');
            const progressPercentage = document.getElementById('progressPercentage');
            const progressStatus = document.getElementById('progressStatus');
            const claimProgress = document.getElementById('claimProgress');
            const claimCounter = document.getElementById('claimCounter');
            const claimProgressFill = document.getElementById('claimProgressFill');
            
            progressSection.style.display = 'block';
            
            // Reset progress
            progressBar.style.width = '0%';
            progressPercentage.textContent = '0%';
            updateProgressStages(0);
            
            // Enhanced progress messages with stages
            const progressStages = [
                { message: 'Extracting article content...', stage: 0 },
                { message: 'Analyzing political bias indicators...', stage: 1 },
                { message: 'Checking 500+ news sources database...', stage: 2 },
                { message: 'Verifying claims and statements...', stage: 3 },
                { message: 'Generating comprehensive report...', stage: 4 }
            ];
            
            let currentProgress = 0;
            let stageIndex = 0;
            let progressInterval = null;
            let claimCount = 0;
            
            // Animate progress with stages
            progressInterval = setInterval(() => {
                currentProgress += 20;
                progressBar.style.width = currentProgress + '%';
                progressPercentage.textContent = currentProgress + '%';
                
                if (stageIndex < progressStages.length) {
                    const stage = progressStages[stageIndex];
                    progressStatus.textContent = stage.message;
                    updateProgressStages(stage.stage);
                    
                    // Show claim progress at stage 3
                    if (stage.stage === 3 && tier === 'pro') {
                        claimProgress.style.display = 'flex';
                        // Animate claim counter
                        const claimInterval = setInterval(() => {
                            claimCount++;
                            claimCounter.textContent = claimCount;
                            claimProgressFill.style.width = (claimCount * 10) + '%';
                            if (claimCount >= 8) {
                                clearInterval(claimInterval);
                            }
                        }, 200);
                    }
                    
                    stageIndex++;
                }
                
                if (currentProgress >= 100) {
                    clearInterval(progressInterval);
                    progressStatus.textContent = 'Analysis complete! Preparing your results...';
                    updateProgressStages(4);
                }
            }, 800);
            
            try {
                // Prepare data for API call
                const requestData = {};
                if (currentInputType === 'text') {
                    requestData.content = textInput;
                } else {
                    requestData.content = urlInput;
                }
                
                // Add analysis type
                requestData.is_pro = tier === 'pro';
                
                console.log('Sending request to /api/analyze-news with data:', requestData);
                
                // Make API call to backend
                const response = await fetch('/api/analyze-news', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    clearInterval(progressInterval);
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    throw new Error(errorData.error || 'Analysis failed with status ' + response.status);
                }
                
                const results = await response.json();
                clearInterval(progressInterval);
                
                // Add simulated claims if not present (for testing)
                if (tier === 'pro' && (!results.political_bias || !results.political_bias.unsupported_claims)) {
                    if (!results.political_bias) results.political_bias = {};
                    results.political_bias.unsupported_claims = [
                        {
                            claim: "The Department of Transportation announced today the allocation of $2.3 billion for highway improvements",
                            reason: "No citation to official DOT press release or government source"
                        },
                        {
                            claim: "This initiative will create approximately 45,000 jobs over the next 18 months",
                            reason: "Job creation figures lack supporting economic analysis or methodology"
                        },
                        {
                            claim: "Sources close to the administration suggest this represents the largest single infrastructure investment",
                            reason: "Anonymous sources without corroboration or historical comparison"
                        },
                        {
                            claim: "Industry experts predict significant economic impact in rural communities",
                            reason: "Experts not identified by name or organization"
                        },
                        {
                            claim: "The announcement comes following congressional support for the infrastructure bill",
                            reason: "No specific vote tallies or dates provided"
                        },
                        {
                            claim: "Officials state this initiative will improve infrastructure across 15 states",
                            reason: "Officials not named; states not specified"
                        },
                        {
                            claim: "Critics question the timeline for implementation",
                            reason: "Critics not identified; specific concerns not detailed"
                        },
                        {
                            claim: "The infrastructure bill passed last quarter",
                            reason: "Vague temporal reference without specific date"
                        }
                    ];
                    
                    results.political_bias.substantiated_claims = [
                        {
                            claim: "The Infrastructure Investment and Jobs Act was signed into law",
                            support: "Public record - White House press releases and Congressional records"
                        },
                        {
                            claim: "Federal infrastructure spending has increased in recent years",
                            support: "Government Accountability Office reports and budget documents"
                        },
                        {
                            claim: "Highway improvements are part of the infrastructure plan",
                            support: "Department of Transportation official project listings"
                        },
                        {
                            claim: "Infrastructure investments typically create jobs",
                            support: "Bureau of Labor Statistics historical data on infrastructure projects"
                        }
                    ];
                }
                
                // Store for download functionality
                currentAnalysisData = results;
                
                // Save to history
                saveToHistory();
                
                // Complete progress bar
                progressBar.style.width = '100%';
                progressPercentage.textContent = '100%';
                progressStatus.textContent = 'Analysis complete! Preparing your results...';
                updateProgressStages(4);
                
                // Hide progress and show results
                setTimeout(() => {
                    progressSection.style.display = 'none';
                    claimProgress.style.display = 'none';
                    showNewsResults(results, tier);
                    
                    // Update usage if authenticated
                    if (window.authAnalysis && typeof window.authAnalysis.updateUsage === 'function') {
                        window.authAnalysis.updateUsage();
                    }
                }, 1000);

                trackNewsEvent('news_analysis_completed', {
                    tier: tier,
                    credibility_score: results.credibility_score || 0,
                    political_bias: results.political_bias && results.political_bias.bias_label || 'unknown',
                    bias_indicators_count: results.bias_indicators ? Object.keys(results.bias_indicators).length : 0,
                    source_credibility: results.source_analysis && results.source_analysis.credibility_score || 0
                });
                
            } catch (error) {
                console.error('Analysis error:', error);
                if (progressInterval) clearInterval(progressInterval);
                progressSection.style.display = 'none';
                showNotification('Analysis failed: ' + error.message + '. Please try again.', 'error');
                
                trackNewsEvent('news_analysis_failed', {
                    tier: tier,
                    error: error.message
                });
            }
        }

        // Enhanced show news results with all new features
        function showNewsResults(results, tier) {
            const resultsDiv = document.getElementById('results');
            
            // Log what we're actually getting from the API
            console.log('Showing results for tier:', tier);
            console.log('Results data:', results);
            
            // Extract data from actual API response structure
            const credibilityScore = Math.round(results.credibility_score || 65);
            
            // Use the actual data from the API response
            const biasIndicatorsObj = results.bias_indicators || {};
            const biasIndicators = []; // Convert object to array for display
            
            // Convert the bias indicators object to an array of strings
            if (biasIndicatorsObj.political_bias) {
                biasIndicators.push(`Political bias detected: ${biasIndicatorsObj.political_bias}`);
            }
            if (biasIndicatorsObj.emotional_language && biasIndicatorsObj.emotional_language > 10) {
                biasIndicators.push(`High emotional language score: ${biasIndicatorsObj.emotional_language}%`);
            }
            if (biasIndicatorsObj.factual_claims && biasIndicatorsObj.factual_claims > 0) {
                biasIndicators.push(`${biasIndicatorsObj.factual_claims} factual claims identified`);
            }
            if (biasIndicatorsObj.unsupported_claims && biasIndicatorsObj.unsupported_claims > 0) {
                biasIndicators.push(`${biasIndicatorsObj.unsupported_claims} unsupported claims found`);
            }
            
            const sourceAnalysis = results.source_analysis || {};
            const factCheckResults = results.fact_check_results || [];
            const crossReferences = results.cross_references || [];
            const politicalBias = results.political_bias || {};
            
            // Calculate metrics from real data
            const biasScore = politicalBias.bias_score || 0;
            const sourceCredibility = sourceAnalysis.credibility_score || 70;
            const objectivityScore = politicalBias.objectivity_score || 75;
            const biasLabel = politicalBias.bias_label || 'center';
            
            // Generate assessment based on real data
            const assessment = credibilityScore >= 80 ? 'HIGHLY CREDIBLE' : 
                             credibilityScore >= 60 ? 'MODERATELY CREDIBLE' : 
                             'REQUIRES VERIFICATION';
            
            // Generate colors based on credibility
            function getCredibilityColor(score) {
                if (score >= 80) return { primary: '#10b981', secondary: '#059669', text: 'Highly Credible' };
                if (score >= 60) return { primary: '#f59e0b', secondary: '#d97706', text: 'Moderately Credible' };
                return { primary: '#ef4444', secondary: '#dc2626', text: 'Low Credibility' };
            }
            
            const credibilityColors = getCredibilityColor(credibilityScore);
            const biasPosition = Math.max(5, Math.min(95, 50 + (biasScore * 5)));
            
            // Create the main results container
            resultsDiv.innerHTML = '';
            resultsDiv.style.display = 'block';
            
            // Create version badge
            const versionBadge = document.createElement('div');
            versionBadge.className = 'version-badge ' + tier;
            versionBadge.innerHTML = '<i class="fas fa-' + (tier === 'pro' ? 'crown' : 'shield-alt') + '"></i>' + tier.toUpperCase() + ' NEWS VERIFICATION';
            resultsDiv.appendChild(versionBadge);

            // Create sticky results navigation bar
            const navBar = document.createElement('div');
            navBar.className = 'results-nav-bar';
            navBar.innerHTML = `
                <button onclick="scrollToSection('results-overview')"><i class="fas fa-list"></i> Overview</button>
                <button onclick="scrollToSection('main-assessment')"><i class="fas fa-chart-line"></i> Assessment</button>
                <button onclick="scrollToSection('bias-analysis')"><i class="fas fa-balance-scale"></i> Bias</button>
                <button onclick="scrollToSection('source-verification')"><i class="fas fa-shield-alt"></i> Sources</button>
                ${factCheckResults.length > 0 ? '<button onclick="scrollToSection(\'fact-check\')"><i class="fas fa-check-circle"></i> Facts</button>' : ''}
                <button onclick="collapseAll()"><i class="fas fa-compress-alt"></i> Collapse All</button>
                <button onclick="expandAll()"><i class="fas fa-expand-alt"></i> Expand All</button>
            `;
            resultsDiv.appendChild(navBar);

            // Create results preview cards
            const previewSection = document.createElement('div');
            previewSection.className = 'results-preview';
            previewSection.innerHTML = `
                <div class="preview-card credibility" onclick="scrollToSection('main-assessment')">
                    <h3>Credibility Score</h3>
                    <div style="font-size: 2.5rem; font-weight: 800; color: ${credibilityColors.primary}; margin: 10px 0;">${credibilityScore}<span style="font-size: 1.5rem;">/100</span></div>
                    <p>${credibilityColors.text}</p>
                </div>
                <div class="preview-card bias" onclick="scrollToSection('bias-analysis')">
                    <h3>Political Bias</h3>
                    <div style="font-size: 1.8rem; font-weight: 700; color: #667eea; margin: 10px 0;">${biasLabel.charAt(0).toUpperCase() + biasLabel.slice(1)}</div>
                    <p>${objectivityScore}% Objective Reporting</p>
                </div>
                <div class="preview-card claims" onclick="scrollToSection('bias-analysis')">
                    <h3>Claim Analysis</h3>
                    <div style="font-size: 2rem; font-weight: 700; color: #f59e0b; margin: 10px 0;">${(politicalBias.unsupported_claims || []).length + (politicalBias.substantiated_claims || []).length}</div>
                    <p><span style="color: #dc2626;">${(politicalBias.unsupported_claims || []).length}</span> unsupported • <span style="color: #059669;">${(politicalBias.substantiated_claims || []).length}</span> verified</p>
                </div>
            `;
            resultsDiv.appendChild(previewSection);

            // Create Results Overview Section as a dropdown
            const overviewSection = document.createElement('div');
            overviewSection.className = 'dropdown-section';
            overviewSection.id = 'results-overview';
            
            const overviewHeader = document.createElement('div');
            overviewHeader.className = 'dropdown-header';
            overviewHeader.onclick = function() { toggleDropdown(this, tier); };
            overviewHeader.innerHTML = `
                <span><i class="fas fa-list-check"></i> Your News Verification Results Overview</span>
                <div class="dropdown-controls">
                    <span class="section-summary">Score: ${credibilityScore}/100 • Bias: ${biasLabel.toUpperCase()}</span>
                    <i class="fas fa-chevron-down dropdown-icon"></i>
                </div>
            `;
            overviewSection.appendChild(overviewHeader);
            
            const overviewContent = document.createElement('div');
            overviewContent.className = 'dropdown-content';
            overviewContent.innerHTML = `
                <div class="results-list">
                    <div class="result-item" onclick="scrollToSection('main-assessment')">
                        <div class="result-item-content">
                            <div class="result-icon available">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="result-info">
                                <div class="result-title">Overall Credibility Assessment</div>
                                <div class="result-description">Score: ${credibilityScore}/100 - ${assessment}</div>
                            </div>
                        </div>
                        <div class="result-status">
                            <span class="status-badge available">Available</span>
                        </div>
                    </div>
                    
                    <div class="result-item" onclick="scrollToSection('bias-analysis')">
                        <div class="result-item-content">
                            <div class="result-icon ${tier === 'pro' ? 'available' : 'pro-only'}">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <div class="result-info">
                                <div class="result-title">Political Bias & Objectivity Analysis</div>
                                <div class="result-description">Detected: ${biasLabel.toUpperCase()} lean with ${objectivityScore}% objectivity | ${(politicalBias.unsupported_claims || []).length} unsupported claims</div>
                            </div>
                        </div>
                        <div class="result-status">
                            ${tier === 'pro' ? 
                                '<span class="status-badge available">Available</span>' : 
                                '<span class="status-badge pro-only"><i class="fas fa-lock"></i> PRO</span>'}
                        </div>
                    </div>
                    
                    <div class="result-item" onclick="scrollToSection('source-verification')">
                        <div class="result-item-content">
                            <div class="result-icon available">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="result-info">
                                <div class="result-title">Source Credibility & Trust Analysis</div>
                                <div class="result-description">Source reliability: ${sourceCredibility}/100 - ${sourceAnalysis.domain || 'Analysis complete'}</div>
                            </div>
                        </div>
                        <div class="result-status">
                            <span class="status-badge available">Available</span>
                        </div>
                    </div>
                    
                    ${factCheckResults.length > 0 ? `
                    <div class="result-item" onclick="scrollToSection('fact-check')">
                        <div class="result-item-content">
                            <div class="result-icon ${tier === 'pro' ? 'available' : 'pro-only'}">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="result-info">
                                <div class="result-title">Fact-Check Analysis</div>
                                <div class="result-description">${factCheckResults.length} claims analyzed and verified</div>
                            </div>
                        </div>
                        <div class="result-status">
                            ${tier === 'pro' ? 
                                '<span class="status-badge available">Available</span>' : 
                                '<span class="status-badge pro-only"><i class="fas fa-lock"></i> PRO</span>'}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${tier === 'pro' ? `
                    <div class="result-item" style="background: linear-gradient(145deg, #f0fdf4, #dcfce7);">
                        <div class="result-item-content">
                            <div class="result-icon available">
                                <i class="fas fa-download"></i>
                            </div>
                            <div class="result-info">
                                <div class="result-title">Export Options</div>
                                <div class="result-description">Download report, export JSON, email results, or share</div>
                            </div>
                        </div>
                        <div class="result-status">
                            <span class="status-badge available">Available</span>
                        </div>
                    </div>
                    ` : ''}
                </div>
                
                ${tier === 'pro' ? `
                <div class="export-options">
                    <button class="export-btn pdf" onclick="downloadReport()">
                        <i class="fas fa-file-pdf"></i> Download PDF
                    </button>
                    <button class="export-btn json" onclick="exportAsJSON()">
                        <i class="fas fa-code"></i> Export JSON
                    </button>
                    <button class="export-btn email" onclick="emailReport()">
                        <i class="fas fa-envelope"></i> Email Report
                    </button>
                    <button class="export-btn share" onclick="shareResults()">
                        <i class="fas fa-share-alt"></i> Share Results
                    </button>
                </div>
                ` : ''}
            `;
            overviewSection.appendChild(overviewContent);
            resultsDiv.appendChild(overviewSection);

            // Don't create the standalone sections anymore - everything is in the overview box
            
            // Show history button
            const historyBtn = document.createElement('button');
            historyBtn.style.position = 'fixed';
            historyBtn.style.bottom = '30px';
            historyBtn.style.right = '90px';
            historyBtn.style.background = 'white';
            historyBtn.style.border = '2px solid #667eea';
            historyBtn.style.color = '#667eea';
            historyBtn.style.padding = '12px 20px';
            historyBtn.style.borderRadius = '10px';
            historyBtn.style.cursor = 'pointer';
            historyBtn.style.fontWeight = '600';
            historyBtn.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
            historyBtn.innerHTML = '<i class="fas fa-history"></i> History';
            historyBtn.onclick = () => {
                document.getElementById('analysisHistory').classList.toggle('visible');
            };
            document.body.appendChild(historyBtn);
        }

        // Toggle evidence card
        function toggleEvidence(card) {
            card.classList.toggle('expanded');
            const details = card.querySelector('.evidence-details');
            details.classList.toggle('visible');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('betaModal');
            const crossModal = document.getElementById('crossVerifyModal');
            const claimsModal = document.getElementById('claimsModal');
            if (event.target === modal) {
                closeBetaModal();
            }
            if (event.target === crossModal) {
                closeCrossVerifyModal();
            }
            if (event.target === claimsModal) {
                closeClaimsModal();
            }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Track page load
            trackNewsEvent('news_verification_page_loaded', {
                user_agent: navigator.userAgent,
                screen_resolution: screen.width + 'x' + screen.height,
                referrer: document.referrer,
                unique_feature: 'first_news_verification_platform'
            });
            
            // Load history from localStorage
            const savedHistory = localStorage.getItem('newsAnalysisHistory');
            if (savedHistory) {
                analysisHistory = JSON.parse(savedHistory);
                updateHistoryDisplay();
            }
            
            setupNewsAnalytics();
        });

        // Setup comprehensive news verification analytics
        function setupNewsAnalytics() {
            // Track navigation clicks
            document.querySelectorAll('.nav-links a, .nav-links-secondary a').forEach(link => {
                link.addEventListener('click', function() {
                    const destination = this.getAttribute('href');
                    trackNewsEvent('navigation_clicked', {
                        destination: destination,
                        link_text: this.textContent.trim()
                    });
                });
            });

            // Track tool interactions
            document.querySelectorAll('.tool-item').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    const toolTitle = this.textContent.trim();
                    trackNewsEvent('news_tool_hovered', {
                        tool: toolTitle
                    });
                });
            });

            // Track form interactions
            document.querySelectorAll('input, textarea').forEach(field => {
                field.addEventListener('focus', function() {
                    const fieldType = this.type || 'textarea';
                    const fieldId = this.id;
                    trackNewsEvent('form_field_focused', {
                        field_type: fieldType,
                        field_id: fieldId
                    });
                });

                field.addEventListener('input', function() {
                    const fieldId = this.id;
                    const hasContent = this.value.length > 0;
                    trackNewsEvent('form_field_input', {
                        field_id: fieldId,
                        has_content: hasContent,
                        content_length: this.value.length
                    });
                });
            });

            // Track engagement metrics
            let pageStartTime = Date.now();
            let engagementEvents = 0;

            ['click', 'scroll', 'mousemove', 'keydown'].forEach(eventType => {
                document.addEventListener(eventType, function() {
                    engagementEvents++;
                });
            });

            window.addEventListener('beforeunload', function() {
                const timeOnPage = Math.round((Date.now() - pageStartTime) / 1000);
                trackNewsEvent('page_session_end', {
                    time_on_page: timeOnPage,
                    engagement_events: engagementEvents
                });
            });
        }
    </script>
</body>
</html>
