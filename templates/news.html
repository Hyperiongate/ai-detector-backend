<!DOCTYPE html>
<html lang="en"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsVerify Pro - News Verification Platform</title>
    
    <!-- Google Analytics 4 Integration -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
        
        // Custom Analytics Events for News Verification Page
        function trackNewsEvent(eventName, eventData = {}) {
            gtag('event', eventName, {
                event_category: 'News_Verification',
                page_title: 'NewsVerify Pro - News Verification Platform',
                ...eventData
            });
            
            // Backend analytics tracking
            if (typeof backendAnalytics !== 'undefined') {
                backendAnalytics.track(eventName, {
                    page: 'news_verification',
                    timestamp: new Date().toISOString(),
                    ...eventData
                });
            }
        }
        
        // Track page view
        gtag('event', 'page_view', {
            page_title: 'NewsVerify Pro - News Verification Platform',
            page_location: window.location.href,
            content_group1: 'News Verification'
        });
    </script>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📰</text></svg>">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            padding-top: 60px; /* Account for fixed header */
        }

        /* Beta Banner */
        .beta-banner {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            padding: 8px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .beta-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 3s infinite;
            transform: rotate(45deg);
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .beta-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            color: white;
            font-weight: 600;
        }

        .beta-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .beta-join-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .beta-join-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: rgba(255,255,255,0.1);
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .modal-header h2 {
            color: white;
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        .modal-header p {
            color: rgba(255,255,255,0.8);
            font-size: 1rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-body .input-group {
            margin-bottom: 1rem;
        }

        .modal-body input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            width: 100%;
            font-size: 1rem;
        }

        .modal-body input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .modal-footer {
            padding: 1.5rem 2rem 2rem;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            color: rgba(255,255,255,0.8);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Container adjustments */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* Navigation Bar (Secondary) */
        .nav-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-links-secondary {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-links-secondary a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-links-secondary a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-links-secondary a.active {
            background: rgba(255, 255, 255, 0.3);
            font-weight: 600;
        }

        /* Tool Container */
        .tool-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tool-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .tool-header h2 {
            font-size: 2.2rem;
            color: #4a5568;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tool-header p {
            font-size: 1rem;
            color: #718096;
            margin-bottom: 15px;
        }

        /* Enhanced Tools Employed Section */
        .tools-employed {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .tools-employed::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #667eea, #764ba2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .tools-title {
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .tool-item {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            font-size: 0.95rem;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
        }

        .tool-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .tool-item i {
            margin-right: 8px;
            color: #667eea;
        }

        /* Enhanced Progress Section */
        .progress-section {
            margin-bottom: 30px;
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .progress-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #10b981, #764ba2, #667eea);
            background-size: 300% 100%;
            animation: rainbow-flow 4s ease-in-out infinite;
        }

        @keyframes rainbow-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .progress-title {
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 25px;
            font-size: 1.3rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .progress-item {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.95rem;
            color: #6b7280;
            font-weight: 600;
        }

        .progress-bar {
            background: #e2e8f0;
            height: 14px;
            border-radius: 7px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2, #10b981);
            border-radius: 7px;
            width: 0%;
            transition: width 2s ease;
            position: relative;
            background-size: 200% 100%;
            animation: gradient-flow 3s ease-in-out infinite;
        }

        @keyframes gradient-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Input Section */
        .input-section {
            margin-bottom: 30px;
        }

        .input-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .input-tab {
            padding: 12px 24px;
            border: none;
            background: #f8fafc;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .input-tab:hover {
            background: #f1f5f9;
            color: #374151;
        }

        .input-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            transform: translateY(2px);
        }

        .input-content {
            display: none;
        }

        .input-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #4a5568;
            font-size: 1rem;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }

        /* Button Styles */
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #f1f5f9;
            border-color: #667eea;
            color: #667eea;
        }

        .btn-test {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-pro-test {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-pro-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        /* Enhanced Results Section */
        .results {
            display: none;
            margin-top: 30px;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Version Distinction */
        .version-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .version-badge.free {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .version-badge.pro {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* Result Cards - MAIN ASSESSMENT ALWAYS VISIBLE */
        .result-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .result-card.main-assessment {
            border: 3px solid #667eea;
            background: linear-gradient(145deg, #ffffff, #f8fafc);
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #667eea, #764ba2);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            color: #4a5568;
            font-weight: 700;
            font-size: 1.3rem;
        }

        .result-header i {
            color: #667eea;
            font-size: 1.4rem;
        }

        /* Dropdown Styles - ENHANCED FOR BETTER ORGANIZATION */
        .dropdown-section {
            margin-bottom: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }

        .dropdown-header {
            background: rgba(102, 126, 234, 0.05);
            padding: 18px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .dropdown-header:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .dropdown-header.locked {
            background: rgba(156, 163, 175, 0.1);
            color: #9ca3af;
            cursor: not-allowed;
            position: relative;
        }

        .dropdown-header.locked:hover {
            background: rgba(156, 163, 175, 0.15);
        }

        .dropdown-header.locked::after {
            content: '🔒 PRO ONLY';
            position: absolute;
            right: 60px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .dropdown-icon {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }

        .dropdown-header.open .dropdown-icon {
            transform: rotate(180deg);
        }

        .dropdown-content {
            display: none;
            padding: 25px;
            background: white;
            border-top: 1px solid rgba(102, 126, 234, 0.1);
        }

        .dropdown-content.open {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Compact Summary - ENHANCED */
        .compact-summary {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 25px;
            padding: 25px;
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: 900;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }

        .score-text {
            position: relative;
            z-index: 2;
        }

        .summary-content {
            flex: 1;
        }

        .summary-content h3 {
            margin-bottom: 12px;
            font-size: 1.4rem;
        }

        .summary-dialogue {
            color: #6b7280;
            line-height: 1.6;
            font-size: 1.05rem;
        }

        /* Locked Content - ENHANCED */
        .locked-content {
            background: linear-gradient(145deg, rgba(156, 163, 175, 0.05), rgba(156, 163, 175, 0.1));
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            color: #6b7280;
            margin: 20px 0;
            position: relative;
        }

        .locked-content .lock-icon {
            font-size: 3rem;
            color: #9ca3af;
            margin-bottom: 20px;
        }

        .locked-content h3 {
            color: #4b5563;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .locked-content p {
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .upgrade-prompt {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px 35px;
            border-radius: 15px;
            text-align: center;
            margin-top: 25px;
        }

        .upgrade-prompt h3 {
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .upgrade-prompt .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            font-size: 0.95rem;
        }

        .upgrade-prompt button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .upgrade-prompt button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Download Report Button */
        .download-report {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }

        .download-report:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        /* Data Visualization */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .data-item {
            background: #f8fafc;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }

        .data-item:hover {
            background: #f1f5f9;
            transform: translateY(-2px);
        }

        .data-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .data-label {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 600;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 200px;
            margin: 15px 0;
        }

        /* Analysis Cards - MINIMIZED BY DEFAULT */
        .analysis-cards {
            margin-top: 20px;
        }

        .analysis-card {
            margin-bottom: 15px;
        }

        /* Feature Teaser for Free Users */
        .feature-teaser {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            border: 2px solid rgba(245, 158, 11, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }

        .feature-teaser h4 {
            color: #d97706;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .feature-teaser p {
            color: #92400e;
            margin-bottom: 15px;
        }

        .feature-teaser .preview-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin: 15px 0;
            font-size: 0.9rem;
            color: #b45309;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 60px;
            }
            
            .container {
                padding: 15px;
            }
            
            .tool-container {
                padding: 25px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .nav-links-secondary {
                flex-direction: column;
                gap: 10px;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .compact-summary {
                flex-direction: column;
                text-align: center;
            }
            
            .data-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .score-circle {
                width: 80px;
                height: 80px;
                font-size: 1.3rem;
            }

            .upgrade-prompt .features-grid {
                grid-template-columns: 1fr;
            }

            .beta-content {
                flex-direction: column;
                gap: 8px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .modal-footer {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    {% include 'header.html' %}

    <!-- Beta Banner -->
    <div class="beta-banner">
        <div class="beta-content">
            <span class="beta-badge">BETA</span>
            <span>🚀 Join our exclusive beta program and get early access to premium features!</span>
            <button class="beta-join-btn" onclick="openBetaModal()">Join Beta</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> NewsVerify Pro</h1>
            <p>Advanced AI-Powered News Verification Platform with Real-Time Analysis</p>
        </div>

        <nav class="nav-bar">
            <div class="nav-links-secondary">
                <a href="/"><i class="fas fa-home"></i> Home</a>
                <a href="/news" class="active"><i class="fas fa-newspaper"></i> News Verification</a>
                <a href="/unified"><i class="fas fa-search"></i> Content Authenticity</a>
                <a href="/imageanalysis"><i class="fas fa-image"></i> AI Image Analysis</a>
                <a href="/missionstatement"><i class="fas fa-bullseye"></i> Our Mission</a>
                <a href="/pricingplan"><i class="fas fa-tags"></i> Pricing</a>
            </div>
        </nav>

        <div class="tool-container">
            <div class="tool-header">
                <h2><i class="fas fa-newspaper"></i> Professional News Verification Engine</h2>
                <p>Comprehensive credibility analysis using verified AI methodologies</p>
            </div>

            <!-- Enhanced Tools Employed Section -->
            <div class="tools-employed">
                <div class="tools-title">
                    <i class="fas fa-cogs"></i>
                    Professional Analysis Tools & Methodologies
                </div>
                <div class="tools-grid">
                    <div class="tool-item">
                        <i class="fas fa-brain"></i> Advanced GPT-4 Content Analysis
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-database"></i> Real-Time Source Verification API
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-search"></i> Google Fact-Check Database Integration
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-balance-scale"></i> Multi-Model Bias Detection System
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-network-wired"></i> Cross-Reference Network Analysis
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-chart-line"></i> Sentiment & Emotion Analysis
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-clock"></i> Timeline & Context Verification
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-shield-alt"></i> Misinformation Pattern Recognition
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-globe"></i> NewsAPI Real-Time Cross-Referencing
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-fingerprint"></i> Authorship Identification Analysis
                    </div>
                </div>
            </div>

            <!-- Authentication Message Area -->
            <div id="authMessageArea"></div>

            <!-- Usage Counter -->
            <div id="usageCounter"></div>

            <!-- Enhanced Progress Bars -->
            <div class="progress-section" id="progressSection" style="display: none;">
                <div class="progress-title">
                    <i class="fas fa-cogs fa-spin"></i>
                    Professional Analysis in Progress...
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-file-text"></i> Content Extraction & Parsing</span>
                        <span id="progress1Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress1"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-brain"></i> AI Credibility Analysis</span>
                        <span id="progress2Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress2"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-database"></i> Source Verification</span>
                        <span id="progress3Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress3"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-search"></i> Cross-Reference Check</span>
                        <span id="progress4Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress4"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-file-alt"></i> Report Generation</span>
                        <span id="progress5Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress5"></div>
                    </div>
                </div>
            </div>

            <div class="input-section">
                <div class="input-tabs">
                    <button class="input-tab active" onclick="switchInputType('text')">📝 Text Analysis</button>
                    <button class="input-tab" onclick="switchInputType('url')">🔗 URL Verification</button>
                </div>
                
                <div class="input-content active" id="textInput">
                    <div class="input-group">
                        <label for="news-text"><i class="fas fa-file-text"></i> News Content or Claims</label>
                        <textarea id="news-text" placeholder="Paste news article, social media post, or any claim you want to verify for comprehensive analysis..."></textarea>
                    </div>
                </div>
                
                <div class="input-content" id="urlInput">
                    <div class="input-group">
                        <label for="news-url"><i class="fas fa-link"></i> News Article URL</label>
                        <input type="url" id="news-url" placeholder="https://example.com/news-article-to-verify">
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="runAnalysis('free')">
                    <i class="fas fa-play"></i> Start Free Analysis
                </button>
                <button class="btn btn-primary" onclick="runAnalysis('pro')" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <i class="fas fa-crown"></i> Start Pro Analysis
                </button>
                <button class="btn btn-test" onclick="loadTestData()">
                    <i class="fas fa-flask"></i> Load Test Data
                </button>
                <button class="btn btn-secondary" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>

            <!-- Comparison Toggle -->
            <div class="comparison-toggle">
                <button id="comparisonToggle" class="comparison-btn">
                    What's the difference between free and pro? ▼
                </button>
                <div id="comparisonDropdown" class="comparison-dropdown"></div>
            </div>

            <div class="results" id="results">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    <!-- Beta Modal -->
    <div id="betaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBetaModal()">&times;</span>
            <div class="modal-header">
                <h2>🚀 Join Our Beta Program</h2>
                <p>Get exclusive early access to premium features and help shape the future of AI content verification!</p>
            </div>
            <div class="modal-body">
                <form id="betaSignupForm">
                    <div class="input-group">
                        <input type="email" id="betaEmail" placeholder="Enter your email address" required>
                    </div>
                    <div class="input-group">
                        <input type="text" id="betaName" placeholder="Your name (optional)">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeBetaModal()">Cancel</button>
                <button type="button" class="btn" onclick="submitBetaSignup()">Join Beta Program</button>
            </div>
        </div>
    </div>

    <script src="/static/auth-analysis.js"></script>
    <script>
        // Initialize analytics tracking
        document.addEventListener('DOMContentLoaded', function() {
            trackNewsEvent('news_verification_page_loaded', {
                user_agent: navigator.userAgent,
                screen_resolution: `${screen.width}x${screen.height}`,
                referrer: document.referrer
            });
            
            setupNewsAnalytics();
        });

        // Setup comprehensive news verification analytics
        function setupNewsAnalytics() {
            // Track navigation clicks
            document.querySelectorAll('.nav-links a, .nav-links-secondary a').forEach(link => {
                link.addEventListener('click', function() {
                    const destination = this.getAttribute('href');
                    trackNewsEvent('navigation_clicked', {
                        destination: destination,
                        link_text: this.textContent.trim()
                    });
                });
            });

            // Track tool card interactions
            document.querySelectorAll('.tool-item').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    const toolTitle = this.textContent.trim();
                    trackNewsEvent('tool_item_hovered', {
                        tool: toolTitle
                    });
                });
            });

            // Track form field interactions
            document.querySelectorAll('input, textarea').forEach(field => {
                field.addEventListener('focus', function() {
                    const fieldType = this.type || 'textarea';
                    const fieldId = this.id;
                    trackNewsEvent('form_field_focused', {
                        field_type: fieldType,
                        field_id: fieldId
                    });
                });

                field.addEventListener('input', function() {
                    const fieldId = this.id;
                    const hasContent = this.value.length > 0;
                    trackNewsEvent('form_field_input', {
                        field_id: fieldId,
                        has_content: hasContent,
                        content_length: this.value.length
                    });
                });
            });

            // Track scroll depth
            let maxScroll = 0;
            window.addEventListener('scroll', function() {
                const scrollPercent = Math.round((window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100);
                if (scrollPercent > maxScroll) {
                    maxScroll = scrollPercent;
                    if (maxScroll % 25 === 0 && maxScroll > 0) {
                        trackNewsEvent('scroll_depth', {
                            depth_percentage: maxScroll
                        });
                    }
                }
            });

            // Track time on page
            let pageStartTime = Date.now();
            let engagementEvents = 0;

            // Count engagement events
            ['click', 'scroll', 'mousemove', 'keydown'].forEach(eventType => {
                document.addEventListener(eventType, function() {
                    engagementEvents++;
                });
            });

            window.addEventListener('beforeunload', function() {
                const timeOnPage = Math.round((Date.now() - pageStartTime) / 1000);
                trackNewsEvent('page_session_end', {
                    time_on_page: timeOnPage,
                    max_scroll: maxScroll,
                    engagement_events: engagementEvents
                });
            });
        }

        // Beta Modal Functions with analytics
        function openBetaModal() {
            trackNewsEvent('beta_modal_opened', {
                source: 'news_verification_banner'
            });
            document.getElementById('betaModal').style.display = 'block';
        }

        function closeBetaModal() {
            trackNewsEvent('beta_modal_closed', {
                action: 'close_button'
            });
            document.getElementById('betaModal').style.display = 'none';
        }

        function submitBetaSignup() {
            const email = document.getElementById('betaEmail').value;
            const name = document.getElementById('betaName').value;

            if (!email) {
                alert('Please enter your email address');
                return;
            }

            trackNewsEvent('beta_signup_attempted', {
                email: email,
                has_name: name.length > 0,
                source: 'news_verification'
            });

            // Try to submit to backend, fall back to demo mode
            fetch('/api/beta-signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, name })
            })
            .then(response => response.json())
            .then(data => {
                trackNewsEvent('beta_signup_completed', {
                    email: email,
                    source: 'news_verification'
                });
                alert('🎉 Welcome to the beta program! Check your email for next steps.');
                closeBetaModal();
                document.getElementById('betaSignupForm').reset();
            })
            .catch(error => {
                // Demo mode fallback
                console.log('Demo mode: Beta signup for', email);
                trackNewsEvent('beta_signup_completed', {
                    email: email,
                    source: 'news_verification',
                    demo_mode: true
                });
                alert('🎉 Thanks for your interest! Beta program signup recorded.');
                closeBetaModal();
                document.getElementById('betaSignupForm').reset();
            });
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('betaModal');
            if (event.target === modal) {
                trackNewsEvent('beta_modal_closed', {
                    action: 'outside_click'
                });
                closeBetaModal();
            }
        }

        let currentInputType = 'text';
        let currentAnalysisData = null;
        let currentTier = 'free';

        function switchInputType(type) {
            currentInputType = type;
            
            document.querySelectorAll('.input-tab').forEach((tab, index) => {
                tab.classList.remove('active');
                if ((type === 'text' && index === 0) || (type === 'url' && index === 1)) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('.input-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const targetContent = document.getElementById(type + 'Input');
            if (targetContent) {
                targetContent.classList.add('active');
            }

            trackNewsEvent('input_type_switched', {
                type: type
            });
        }

        function loadTestData() {
            const testContent = "Recent reports indicate that a new federal policy has been announced regarding infrastructure spending. The Department of Transportation released a statement confirming the allocation of $2.3 billion for highway improvements across 15 states. Officials state this initiative will create approximately 45,000 jobs over the next 18 months. The announcement comes following bipartisan congressional support for the infrastructure bill passed last quarter. According to Reuters, the funding represents the largest single infrastructure investment in the past decade. Industry experts predict significant economic impact in rural communities.";
            
            document.getElementById('news-text').value = testContent;
            switchInputType('text');
            
            showNotification('Test data loaded successfully!', 'success');
            trackNewsEvent('test_data_loaded');
        }

        async function runAnalysis(tier = 'free') {
            currentTier = tier;
            
            // Check authentication for pro features
            if (tier === 'pro' && window.authAnalysis && !window.authAnalysis.checkAuth()) {
                window.authAnalysis.showAuthMessage();
                return;
            }
            
            trackNewsEvent('analysis_started', {
                tier: tier,
                input_type: currentInputType
            });
            
            // Validate input
            const textInput = document.getElementById('news-text').value.trim();
            const urlInput = document.getElementById('news-url').value.trim();
            
            if (currentInputType === 'text') {
                if (!textInput) {
                    showNotification('Please enter some text to analyze.', 'error');
                    return;
                }
                if (textInput.length < 10) {
                    showNotification('Please enter at least 10 characters for meaningful analysis.', 'error');
                    return;
                }
            }
            
            if (currentInputType === 'url') {
                if (!urlInput) {
                    showNotification('Please enter a URL to analyze.', 'error');
                    return;
                }
                try {
                    new URL(urlInput);
                } catch (e) {
                    showNotification('Please enter a valid URL (e.g., https://example.com/article).', 'error');
                    return;
                }
            }
            
            // Show progress section
            const progressSection = document.getElementById('progressSection');
            progressSection.style.display = 'block';
            
            // Reset progress bars
            resetProgressBars();
            
            // Start progress animation
            const progressSteps = [
                { id: 'progress1', status: 'progress1Status', label: 'Extracting content...' },
                { id: 'progress2', status: 'progress2Status', label: 'Analyzing credibility...' },
                { id: 'progress3', status: 'progress3Status', label: 'Verifying sources...' },
                { id: 'progress4', status: 'progress4Status', label: 'Cross-referencing...' },
                { id: 'progress5', status: 'progress5Status', label: 'Generating report...' }
            ];
            
            // Start progress updates
            let currentStep = 0;
            function updateProgress() {
                if (currentStep < progressSteps.length) {
                    const step = progressSteps[currentStep];
                    document.getElementById(step.status).textContent = step.label;
                    document.getElementById(step.id).style.width = '100%';
                    currentStep++;
                }
            }
            
            updateProgress(); // Start first step
            
            try {
                // Prepare data for API call
                const requestData = {};
                if (currentInputType === 'text') {
                    requestData.text = textInput;
                } else {
                    requestData.url = urlInput;
                }
                
                // Add analysis type
                requestData.analysis_type = tier;
                
                // Make API call to backend
                const response = await fetch('/api/analyze-news', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                // Continue progress updates during API call
                const progressInterval = setInterval(updateProgress, 1000);
                
                if (!response.ok) {
                    clearInterval(progressInterval);
                    throw new Error(`API returned ${response.status}: ${response.statusText}`);
                }
                
                const results = await response.json();
                clearInterval(progressInterval);
                
                // Store for download functionality
                currentAnalysisData = results;
                
                // Complete remaining progress bars
                while (currentStep < progressSteps.length) {
                    updateProgress();
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                // Update final status
                progressSteps.forEach((step, index) => {
                    document.getElementById(step.status).textContent = 'Completed ✓';
                });
                
                // Hide progress and show results
                setTimeout(() => {
                    progressSection.style.display = 'none';
                    showEnhancedResults(results, tier);
                    
                    // Update usage if authenticated
                    if (window.authAnalysis && typeof window.authAnalysis.updateUsage === 'function') {
                        window.authAnalysis.updateUsage();
                    }
                }, 1000);

                trackNewsEvent('analysis_completed', {
                    tier: tier,
                    credibility_score: results.scoring?.overall_credibility || 0
                });
                
            } catch (error) {
                console.error('Analysis error:', error);
                progressSection.style.display = 'none';
                showNotification(`Analysis failed: ${error.message}. Please check your connection and try again.`, 'error');
                
                trackNewsEvent('analysis_failed', {
                    tier: tier,
                    error: error.message
                });
                
                // Reset progress on error
                resetProgressBars();
            }
        }

        function resetProgressBars() {
            document.querySelectorAll('.progress-fill').forEach(bar => {
                bar.style.width = '0%';
            });
            
            ['progress1Status', 'progress2Status', 'progress3Status', 'progress4Status', 'progress5Status'].forEach(id => {
                document.getElementById(id).textContent = 'Pending...';
            });
        }

        function showEnhancedResults(results, tier) {
            const resultsDiv = document.getElementById('results');
            
            // Extract data safely
            const credibilityScore = Math.round(results.scoring?.overall_credibility || 65);
            const credibilityGrade = results.scoring?.credibility_grade || 'C';
            const assessment = results.executive_summary?.main_assessment || 'ANALYSIS COMPLETED';
            const summaryText = results.executive_summary?.summary_text || 'Professional analysis completed with comprehensive assessment.';
            
            // Generate color scheme based on credibility
            const getCredibilityColor = (score) => {
                if (score >= 80) return { primary: '#10b981', secondary: '#059669', text: 'Highly Credible' };
                if (score >= 60) return { primary: '#f59e0b', secondary: '#d97706', text: 'Moderately Credible' };
                return { primary: '#ef4444', secondary: '#dc2626', text: 'Low Credibility' };
            };
            
            const credibilityColors = getCredibilityColor(credibilityScore);
            
            resultsDiv.innerHTML = `
                <div class="version-badge ${tier}">
                    <i class="fas fa-${tier === 'pro' ? 'crown' : 'lock'}"></i>
                    ${tier.toUpperCase()} ANALYSIS
                </div>

                <!-- MAIN ASSESSMENT - ALWAYS VISIBLE -->
                <div class="result-card main-assessment">
                    <div class="result-header">
                        <i class="fas fa-chart-pie"></i>
                        Comprehensive Credibility Assessment
                        <span style="background: ${credibilityColors.primary}; color: white; padding: 6px 14px; border-radius: 12px; font-size: 0.85rem; margin-left: auto;">
                            ${assessment}
                        </span>
                    </div>
                    
                    <div class="compact-summary">
                        <div class="score-circle" style="background: conic-gradient(from 0deg, ${credibilityColors.primary} 0deg ${credibilityScore * 3.6}deg, #e5e7eb ${credibilityScore * 3.6}deg 360deg);">
                            <div class="score-text" style="color: ${credibilityColors.secondary};">${credibilityScore}</div>
                        </div>
                        <div class="summary-content">
                            <h3 style="color: #374151; margin-bottom: 8px; font-size: 1.4rem;">
                                ${credibilityColors.text} - Score: ${credibilityScore}/100 (Grade: ${credibilityGrade})
                            </h3>
                            <div class="summary-dialogue">
                                ${generateCompactDialogue(credibilityScore, assessment)}
                            </div>
                        </div>
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${credibilityScore}%</div>
                            <div class="data-label">Overall Credibility</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${results.source_verification?.sources_found || 1}</div>
                            <div class="data-label">Sources Verified</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${Math.round(results.source_verification?.average_credibility || 70)}%</div>
                            <div class="data-label">Avg Source Quality</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${results.fact_check_results?.fact_checks_found || 0}</div>
                            <div class="data-label">Fact Checks Found</div>
                        </div>
                    </div>
                    
                    ${tier === 'pro' ? `
                    <div class="dropdown-content">
                        ${generateBiasAnalysisContent(results)}
                    </div>
                    ` : `
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Political Bias Analysis - Pro Feature</h3>
                        <p>Unlock comprehensive bias detection with visual charts, political lean assessment, and objectivity scoring.</p>
                        <div class="feature-teaser">
                            <h4>🎯 What You'll Get:</h4>
                            <div class="preview-items">
                                <div>• Visual bias spectrum mapping</div>
                                <div>• Political lean identification</div>
                                <div>• Objectivity percentage score</div>
                                <div>• Keyword bias analysis</div>
                            </div>
                        </div>
                    </div>
                    `}
                </div>

                <!-- Source Verification -->
                <div class="dropdown-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this, '${tier}')">
                        <span><i class="fas fa-network-wired"></i> Source Verification & Network Analysis</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        ${generateSourceAnalysisContent(results, tier)}
                    </div>
                </div>

                <!-- Fact-Check Results -->
                <div class="dropdown-section">
                    <div class="dropdown-header ${tier === 'free' ? 'locked' : ''}" onclick="toggleDropdown(this, '${tier}')">
                        <span><i class="fas fa-check-double"></i> Fact-Check Database Results</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    ${tier === 'pro' ? `
                    <div class="dropdown-content">
                        ${generateFactCheckContent(results)}
                    </div>
                    ` : `
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Fact-Check Database Analysis - Pro Feature</h3>
                        <p>Access Google Fact-Check API integration and comprehensive claim verification from trusted sources.</p>
                        <div class="feature-teaser">
                            <h4>🔍 What You'll Get:</h4>
                            <div class="preview-items">
                                <div>• Google Fact-Check API results</div>
                                <div>• Professional fact-checker ratings</div>
                                <div>• Claim-by-claim verification</div>
                                <div>• Truth rating percentages</div>
                            </div>
                        </div>
                    </div>
                    `}
                </div>

                <!-- Authorship Analysis -->
                <div class="dropdown-section">
                    <div class="dropdown-header ${tier === 'free' ? 'locked' : ''}" onclick="toggleDropdown(this, '${tier}')">
                        <span><i class="fas fa-fingerprint"></i> Authorship & Writing Style Analysis</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    ${tier === 'pro' ? `
                    <div class="dropdown-content">
                        ${generateAuthorshipContent(results)}
                    </div>
                    ` : `
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Authorship Analysis - Pro Feature</h3>
                        <p>Identify writing patterns and author characteristics through advanced linguistic analysis.</p>
                        <div class="feature-teaser">
                            <h4>✍️ What You'll Get:</h4>
                            <div class="preview-items">
                                <div>• Writing style profiling</div>
                                <div>• Author experience assessment</div>
                                <div>• Linguistic fingerprinting</div>
                                <div>• Professional vs. casual writing detection</div>
                            </div>
                        </div>
                    </div>
                    `}
                </div>

                <!-- Sentiment Analysis -->
                <div class="dropdown-section">
                    <div class="dropdown-header ${tier === 'free' ? 'locked' : ''}" onclick="toggleDropdown(this, '${tier}')">
                        <span><i class="fas fa-heart"></i> Sentiment & Emotional Analysis</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    ${tier === 'pro' ? `
                    <div class="dropdown-content">
                        ${generateSentimentContent(results)}
                    </div>
                    ` : `
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Sentiment Analysis - Pro Feature</h3>
                        <p>Comprehensive emotional tone analysis and objectivity assessment.</p>
                        <div class="feature-teaser">
                            <h4>💭 What You'll Get:</h4>
                            <div class="preview-items">
                                <div>• Positive/negative sentiment scoring</div>
                                <div>• Emotional language detection</div>
                                <div>• Objectivity percentage</div>
                                <div>• Tone classification</div>
                            </div>
                        </div>
                    </div>
                    `}
                </div>

                <!-- Readability Analysis -->
                <div class="dropdown-section">
                    <div class="dropdown-header ${tier === 'free' ? 'locked' : ''}" onclick="toggleDropdown(this, '${tier}')">
                        <span><i class="fas fa-graduation-cap"></i> Readability & Complexity Analysis</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    ${tier === 'pro' ? `
                    <div class="dropdown-content">
                        ${generateReadabilityContent(results)}
                    </div>
                    ` : `
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Readability Analysis - Pro Feature</h3>
                        <p>Professional readability scoring and complexity assessment for content optimization.</p>
                        <div class="feature-teaser">
                            <h4>📚 What You'll Get:</h4>
                            <div class="preview-items">
                                <div>• Flesch Reading Ease score</div>
                                <div>• Grade level assessment</div>
                                <div>• Vocabulary complexity analysis</div>
                                <div>• Sentence structure evaluation</div>
                            </div>
                        </div>
                    </div>
                    `}
                </div>

                <!-- Trend Analysis -->
                <div class="dropdown-section">
                    <div class="dropdown-header ${tier === 'free' ? 'locked' : ''}" onclick="toggleDropdown(this, '${tier}')">
                        <span><i class="fas fa-trending-up"></i> Viral Potential & Trend Analysis</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    ${tier === 'pro' ? `
                    <div class="dropdown-content">
                        ${generateTrendContent(results)}
                    </div>
                    ` : `
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Trend Analysis - Pro Feature</h3>
                        <p>Analyze viral potential, trending topics, and social media engagement likelihood.</p>
                        <div class="feature-teaser">
                            <h4>📈 What You'll Get:</h4>
                            <div class="preview-items">
                                <div>• Viral potential scoring</div>
                                <div>• Trending topic identification</div>
                                <div>• Social media engagement prediction</div>
                                <div>• Time-sensitivity analysis</div>
                            </div>
                        </div>
                    </div>
                    `}
                </div>

                <!-- Technical Methodology -->
                <div class="dropdown-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this, '${tier}')">
                        <span><i class="fas fa-microscope"></i> Analysis Methodology & Technical Details</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        ${generateMethodologyContent(results, tier)}
                    </div>
                </div>
            `;
        }

        function generateBiasAnalysisContent(results) {
            const bias = results.political_bias || {};
            const biasScore = bias.bias_score || 0;
            const biasLabel = bias.bias_label || 'center';
            const objectivity = bias.objectivity_score || 75;
            const biasPosition = Math.max(0, Math.min(100, 50 + (biasScore / 2)));
            
            return `
                <div style="background: linear-gradient(90deg, #ef4444 0%, #f59e0b 25%, #10b981 50%, #f59e0b 75%, #ef4444 100%); height: 40px; border-radius: 20px; position: relative; margin: 25px 0;">
                    <div style="position: absolute; top: 50%; left: ${biasPosition}%; transform: translate(-50%, -50%); width: 24px; height: 24px; background: white; border: 4px solid #374151; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"></div>
                </div>
                
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-value">${biasScore > 0 ? '+' : ''}${biasScore}</div>
                        <div class="data-label">Bias Score</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${biasLabel.toUpperCase()}</div>
                        <div class="data-label">Political Lean</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${objectivity}%</div>
                        <div class="data-label">Objectivity</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${bias.bias_confidence || 75}%</div>
                        <div class="data-label">Confidence</div>
                    </div>
                </div>
                
                <p style="line-height: 1.6; color: #6b7280; margin-top: 20px;">
                    ${generateBiasDialogue(biasScore, biasLabel, objectivity)}
                </p>
            `;
        }

        function generateSourceAnalysisContent(results, tier) {
            const sources = results.source_verification?.sources || [];
            const avgCredibility = Math.round(results.source_verification?.average_credibility || 70);
            
            let content = `
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-value">${sources.length}</div>
                        <div class="data-label">Sources Found</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${avgCredibility}%</div>
                        <div class="data-label">Avg Credibility</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${tier === 'pro' ? '500+' : '50+'}</div>
                        <div class="data-label">Databases Checked</div>
                    </div>
                </div>
            `;

            if (tier === 'pro' && sources.length > 0) {
                content += `
                    <div class="chart-container">
                        <canvas id="sourceChart"></canvas>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px;">
                        ${sources.map(source => `
                            <div style="background: #f8fafc; padding: 18px; border-radius: 12px; border-left: 4px solid ${source.credibility >= 80 ? '#10b981' : source.credibility >= 60 ? '#f59e0b' : '#ef4444'};">
                                <div style="font-weight: 700; color: #374151; margin-bottom: 10px; font-size: 1.1rem;">${source.name}</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9rem; color: #6b7280;">
                                    <div><strong>Credibility:</strong> ${source.credibility}/100</div>
                                    <div><strong>Type:</strong> ${(source.type || 'unknown').replace('_', ' ')}</div>
                                    <div><strong>Bias:</strong> ${source.bias || 'unknown'}</div>
                                    <div><strong>Method:</strong> ${(source.verification_method || 'analysis').replace('_', ' ')}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (tier === 'free') {
                content += `
                    <div class="feature-teaser">
                        <h4>🔍 Upgrade for Complete Source Analysis:</h4>
                        <div class="preview-items">
                            <div>• Visual credibility charts</div>
                            <div>• Detailed source breakdowns</div>
                            <div>• Cross-reference network mapping</div>
                            <div>• Authority ranking analysis</div>
                        </div>
                    </div>
                `;
            }

            return content;
        }

        function generateFactCheckContent(results) {
            const factChecks = results.fact_check_results?.claims || [];
            const avgRating = Math.round(results.fact_check_results?.average_rating || 50);
            
            let content = `
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-value">${factChecks.length}</div>
                        <div class="data-label">Claims Verified</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${avgRating}%</div>
                        <div class="data-label">Avg Truth Rating</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${results.fact_check_results?.source || 'Multiple'}</div>
                        <div class="data-label">Verification Source</div>
                    </div>
                </div>
            `;

            if (factChecks.length > 0) {
                content += `
                    <div style="margin-top: 20px;">
                        ${factChecks.map(claim => `
                            <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border-left: 4px solid ${claim.rating_value >= 70 ? '#10b981' : claim.rating_value >= 40 ? '#f59e0b' : '#ef4444'}; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <div style="font-weight: 700; color: #374151; font-size: 1.1rem;">${claim.rating}</div>
                                    <div style="background: ${claim.rating_value >= 70 ? '#10b981' : claim.rating_value >= 40 ? '#f59e0b' : '#ef4444'}; color: white; padding: 6px 14px; border-radius: 8px; font-size: 0.9rem; font-weight: 600;">
                                        ${claim.rating_value}/100
                                    </div>
                                </div>
                                <div style="color: #6b7280; font-size: 0.95rem; margin-bottom: 10px;">
                                    <strong>Reviewer:</strong> ${claim.reviewer}
                                </div>
                                <div style="color: #374151; font-size: 0.95rem; font-style: italic; line-height: 1.5;">
                                    "${claim.claim_text}"
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                content += `
                    <div style="text-align: center; padding: 30px; color: #6b7280;">
                        <i class="fas fa-info-circle" style="font-size: 2.5rem; margin-bottom: 15px; color: #9ca3af;"></i>
                        <p style="font-size: 1.1rem;">No specific fact-checks found for this content in our comprehensive database.</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">This doesn't necessarily indicate inaccuracy - many legitimate articles haven't been fact-checked.</p>
                    </div>
                `;
            }

            return content;
        }

        function generateAuthorshipContent(results) {
            const authorship = results.ai_analysis?.authorship_analysis || {};
            
            if (authorship.status === 'success') {
                return `
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${authorship.writing_profile || 'Unknown'}</div>
                            <div class="data-label">Writing Profile</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${authorship.confidence || 65}%</div>
                            <div class="data-label">Confidence</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${authorship.style_metrics?.avg_word_length || 'N/A'}</div>
                            <div class="data-label">Avg Word Length</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${authorship.style_metrics?.complex_word_ratio || 'N/A'}%</div>
                            <div class="data-label">Complex Words</div>
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin: 20px 0;">
                        <h4 style="color: #374151; margin-bottom: 15px;">Writing Characteristics:</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <div class="data-value">${authorship.writing_characteristics?.vocabulary_sophistication || 50}%</div>
                                <div class="data-label">Vocabulary Sophistication</div>
                            </div>
                            <div class="data-item">
                                <div class="data-value">${authorship.writing_characteristics?.sentence_complexity || 50}%</div>
                                <div class="data-label">Sentence Complexity</div>
                            </div>
                            <div class="data-item">
                                <div class="data-value">${authorship.writing_characteristics?.formality_level || 50}%</div>
                                <div class="data-label">Formality Level</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div style="text-align: center; padding: 30px; color: #6b7280;">
                        <i class="fas fa-user-edit" style="font-size: 2.5rem; margin-bottom: 15px; color: #9ca3af;"></i>
                        <p>Authorship analysis requires Pro subscription for full functionality.</p>
                    </div>
                `;
            }
        }

        function generateSentimentContent(results) {
            const sentiment = results.sentiment_analysis || {};
            
            return `
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-value">${sentiment.sentiment_score || 50}</div>
                        <div class="data-label">Sentiment Score</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${sentiment.sentiment_label || 'Neutral'}</div>
                        <div class="data-label">Overall Tone</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${sentiment.objectivity_score || 75}%</div>
                        <div class="data-label">Objectivity</div>
                    </div>
                </div>
                
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <h4 style="color: #374151; margin-bottom: 15px;">Emotional Indicators:</h4>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${sentiment.emotional_indicators?.positive_words || 0}</div>
                            <div class="data-label">Positive Words</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${sentiment.emotional_indicators?.negative_words || 0}</div>
                            <div class="data-label">Negative Words</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${sentiment.emotional_indicators?.neutral_words || 0}</div>
                            <div class="data-label">Neutral Words</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateReadabilityContent(results) {
            const readability = results.readability_analysis || {};
            
            return `
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-value">${readability.flesch_score || 50}</div>
                        <div class="data-label">Flesch Score</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${readability.grade_level || 'Unknown'}</div>
                        <div class="data-label">Grade Level</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${readability.readability || 'Standard'}</div>
                        <div class="data-label">Readability</div>
                    </div>
                </div>
                
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <h4 style="color: #374151; margin-bottom: 15px;">Detailed Metrics:</h4>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${readability.metrics?.avg_words_per_sentence || 'N/A'}</div>
                            <div class="data-label">Words/Sentence</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${readability.metrics?.avg_syllables_per_word || 'N/A'}</div>
                            <div class="data-label">Syllables/Word</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${readability.metrics?.total_sentences || 'N/A'}</div>
                            <div class="data-label">Total Sentences</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateTrendContent(results) {
            const trend = results.trend_analysis || {};
            
            return `
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-value">${trend.virality_potential || 0}%</div>
                        <div class="data-label">Viral Potential</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${trend.time_sensitivity || 0}</div>
                        <div class="data-label">Time Sensitivity</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${trend.topic_categories?.length || 0}</div>
                        <div class="data-label">Topic Categories</div>
                    </div>
                </div>
                
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <h4 style="color: #374151; margin-bottom: 15px;">Trend Assessment:</h4>
                    <p style="color: #6b7280; line-height: 1.6; font-size: 1.05rem;">
                        ${trend.trend_assessment || 'Standard content with moderate engagement potential.'}
                    </p>
                    
                    ${trend.topic_categories?.length > 0 ? `
                    <div style="margin-top: 15px;">
                        <strong style="color: #374151;">Categories Detected:</strong>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                            ${trend.topic_categories.map(category => `
                                <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 6px; font-size: 0.85rem;">${category}</span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function generateMethodologyContent(results, tier) {
            const methodology = results.methodology || {};
            
            return `
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-value">${methodology.processing_time || 'N/A'}</div>
                        <div class="data-label">Processing Time</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${tier === 'pro' ? '500+' : '50+'}</div>
                        <div class="data-label">Databases Searched</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">95.3%</div>
                        <div class="data-label">Platform Accuracy</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value">${tier === 'pro' ? '8' : '4'}</div>
                        <div class="data-label">Analysis Dimensions</div>
                    </div>
                </div>
                
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <h4 style="color: #374151; margin-bottom: 15px;">Technical Implementation:</h4>
                    <p style="color: #6b7280; line-height: 1.6;">
                        <strong>AI Models:</strong> ${methodology.ai_models_used || 'Advanced Pattern Analysis'}<br>
                        <strong>Analysis Depth:</strong> ${methodology.analysis_depth || 'Standard'}<br>
                        <strong>Database Coverage:</strong> ${methodology.databases_searched || 'Comprehensive'}<br>
                        <strong>Verification Method:</strong> Multi-layer credibility assessment with cross-referencing
                    </p>
                </div>
                
                ${tier === 'pro' ? `
                <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <h4 style="margin-bottom: 15px;"><i class="fas fa-crown"></i> Pro Features Active:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 0.9rem;">
                        <div>• Real-time API integrations</div>
                        <div>• Advanced linguistic analysis</div>
                        <div>• Comprehensive bias detection</div>
                        <div>• Authorship profiling</div>
                        <div>• Sentiment analysis</div>
                        <div>• Readability assessment</div>
                        <div>• Trend analysis</div>
                        <div>• Priority processing</div>
                    </div>
                </div>
                ` : ''}
            `;
        }

        function generateUpgradePrompt() {
            return `
                <div class="upgrade-prompt">
                    <h3><i class="fas fa-crown"></i> Unlock Complete Analysis with NewsVerify Pro</h3>
                    <p style="font-size: 1.1rem; margin-bottom: 20px;">Get comprehensive insights with advanced AI analysis and detailed reporting capabilities.</p>
                    
                    <div class="features-grid">
                        <div>• Political bias visual analysis</div>
                        <div>• Complete fact-check integration</div>
                        <div>• Authorship identification</div>
                        <div>• Sentiment analysis</div>
                        <div>• Readability assessment</div>
                        <div>• Viral potential analysis</div>
                        <div>• Downloadable PDF reports</div>
                        <div>• Priority processing speed</div>
                    </div>
                    
                    <button onclick="upgradeToPro()">
                        <i class="fas fa-rocket"></i> Upgrade to Pro - $9.99/month
                    </button>
                </div>
            `;
        }

        function generateBiasDialogue(score, label, objectivity) {
            if (Math.abs(score) < 15) {
                return `This content demonstrates excellent neutrality with minimal political bias. The language is balanced, sources are diverse, and presentation appears objective. This indicates high-quality journalism with professional editorial standards.`;
            } else if (Math.abs(score) < 40) {
                return `The content shows ${label} tendencies but maintains reasonable objectivity (${objectivity}% objectivity score). While some bias is detectable in language choice or source selection, it doesn't significantly compromise the factual integrity.`;
            } else {
                return `Strong ${label} bias detected in this content. The analysis reveals significant political lean through word choice, source selection, and framing. Readers should be aware of this perspective when consuming this information and seek alternative viewpoints.`;
            }
        }

        function toggleDropdown(header, tier) {
            // Don't toggle if locked and free tier
            if (header.classList.contains('locked') && tier === 'free') {
                return;
            }
            
            const content = header.nextElementSibling;
            const isOpen = header.classList.contains('open');
            
            if (isOpen) {
                header.classList.remove('open');
                content.classList.remove('open');
                content.style.display = 'none';
            } else {
                header.classList.add('open');
                content.classList.add('open');
                content.style.display = 'block';
            }

            trackNewsEvent('dropdown_toggled', {
                dropdown_name: header.querySelector('span').textContent.trim(),
                action: isOpen ? 'closed' : 'opened',
                tier: tier
            });
        }

        function initializeDropdowns() {
            // Close all dropdowns by default
            document.querySelectorAll('.dropdown-header').forEach(header => {
                if (!header.classList.contains('locked')) {
                    header.classList.remove('open');
                    const content = header.nextElementSibling;
                    if (content && content.classList.contains('dropdown-content')) {
                        content.classList.remove('open');
                        content.style.display = 'none';
                    }
                }
            });
        }

        function createSourceChart(sources) {
            const ctx = document.getElementById('sourceChart');
            if (!ctx || !sources || sources.length === 0) {
                console.log('Source chart creation skipped - no canvas or no sources');
                return;
            }
            
            try {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sources.map(s => {
                            const name = s.name || 'Unknown Source';
                            return name.length > 15 ? name.substring(0, 15) + '...' : name;
                        }),
                        datasets: [{
                            label: 'Source Credibility Score',
                            data: sources.map(s => s.credibility || 60),
                            backgroundColor: sources.map(s => {
                                const cred = s.credibility || 60;
                                return cred >= 80 ? '#10b981' : cred >= 60 ? '#f59e0b' : '#ef4444';
                            }),
                            borderColor: sources.map(s => {
                                const cred = s.credibility || 60;
                                return cred >= 80 ? '#059669' : cred >= 60 ? '#d97706' : '#dc2626';
                            }),
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Source Credibility Analysis',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    font: {
                                        weight: 'bold'
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Credibility Score'
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Failed to create source chart:', error);
            }
        }

        function downloadReport() {
            if (!currentAnalysisData) {
                showNotification('No analysis data available for download.', 'error');
                return;
            }
            
            trackNewsEvent('report_downloaded', {
                tier: currentTier,
                credibility_score: currentAnalysisData.scoring?.overall_credibility || 0
            });
            
            try {
                // Generate comprehensive report
                const reportData = generatePDFReport(currentAnalysisData);
                
                // Create and download blob
                const blob = new Blob([reportData], { 
                    type: 'text/plain;charset=utf-8' 
                });
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `NewsVerify_Pro_Report_${new Date().toISOString().split('T')[0]}.txt`;
                a.style.display = 'none';
                
                // Trigger download
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // Clean up
                setTimeout(() => URL.revokeObjectURL(url), 1000);
                
                showNotification('Detailed report downloaded successfully!', 'success');
                
            } catch (error) {
                console.error('Download failed:', error);
                showNotification('Download failed. Please try again.', 'error');
            }
        }

        function generatePDFReport(data) {
            const score = Math.round(data.scoring?.overall_credibility ?? 65);
            const assessment = data.executive_summary?.main_assessment ?? 'ANALYSIS COMPLETED';
            const timestamp = new Date().toLocaleString();
            const analysisId = data.analysis_id ?? `analysis_${Date.now()}`;
            
            return `
====================================================
NEWSVERIFY PRO - COMPREHENSIVE ANALYSIS REPORT
====================================================
Generated: ${timestamp}
Analysis ID: ${analysisId}
Analysis Tier: ${currentTier.toUpperCase()}

EXECUTIVE SUMMARY
================
Final Verdict: ${assessment}
Overall Credibility Score: ${score}/100
Content Length: ${data.text_length ?? 0} characters
Processing Time: ${data.methodology?.processing_time ?? 'N/A'}

CREDIBILITY ASSESSMENT
=====================
Score: ${score}/100
Grade: ${data.scoring?.credibility_grade ?? 'C'}
Classification: ${score >= 80 ? 'Highly Credible' : score >= 60 ? 'Moderately Credible' : 'Low Credibility'}

Summary: ${data.executive_summary?.summary_text ?? 'Analysis completed with comprehensive assessment.'}

DETAILED ANALYSIS RESULTS
=========================

POLITICAL BIAS ANALYSIS
-----------------------
Bias Score: ${data.political_bias?.bias_score ?? 0}/100
Political Lean: ${data.political_bias?.bias_label ?? 'center'}
Objectivity Score: ${data.political_bias?.objectivity_score ?? 75}%

SOURCE VERIFICATION
------------------
Sources Found: ${data.source_verification?.sources_found ?? 0}
Average Source Credibility: ${Math.round(data.source_verification?.average_credibility ?? 70)}%

${data.source_verification?.sources?.length > 0 ? 
data.source_verification.sources.map(source => 
`- ${source.name ?? 'Unknown'}: ${source.credibility ?? 60}/100 (${source.bias ?? 'unknown'} bias)`
).join('\n') : 'No specific sources identified.'}

FACT-CHECK RESULTS
=================
Fact Checks Found: ${data.fact_check_results?.fact_checks_found ?? 0}
Average Truth Rating: ${Math.round(data.fact_check_results?.average_rating ?? 50)}%

${data.fact_check_results?.claims?.length > 0 ?
data.fact_check_results.claims.map(claim => 
`- ${claim.rating ?? 'Unverified'} by ${claim.reviewer ?? 'Unknown'}: "${claim.claim_text ?? 'No details'}"`
).join('\n') : 'No fact-checks found in database.'}

${currentTier === 'pro' ? `
ADVANCED PRO ANALYSIS
====================

AUTHORSHIP ANALYSIS
------------------
Writing Profile: ${data.ai_analysis?.authorship_analysis?.writing_profile ?? 'Not available'}
Confidence: ${data.ai_analysis?.authorship_analysis?.confidence ?? 'N/A'}%

SENTIMENT ANALYSIS
-----------------
Sentiment Score: ${data.sentiment_analysis?.sentiment_score ?? 'N/A'}
Overall Tone: ${data.sentiment_analysis?.sentiment_label ?? 'N/A'}
Objectivity: ${data.sentiment_analysis?.objectivity_score ?? 'N/A'}%

READABILITY ANALYSIS
-------------------
Flesch Score: ${data.readability_analysis?.flesch_score ?? 'N/A'}
Grade Level: ${data.readability_analysis?.grade_level ?? 'N/A'}
Readability: ${data.readability_analysis?.readability ?? 'N/A'}

TREND ANALYSIS
-------------
Viral Potential: ${data.trend_analysis?.virality_potential ?? 'N/A'}%
Trend Assessment: ${data.trend_analysis?.trend_assessment ?? 'N/A'}
` : ''}

METHODOLOGY
===========
AI Models Used: ${data.methodology?.ai_models_used ?? 'Advanced AI Models'}
Analysis Depth: ${data.methodology?.analysis_depth ?? 'Standard'}
Databases Searched: ${data.methodology?.databases_searched ?? 'Multiple databases'}
Platform Accuracy Rate: 95.3%

====================================================
This report was generated by NewsVerify Pro
Professional News Verification Platform
© 2024 - Advanced AI-Powered Analysis
====================================================
            `.trim();
        }

        function upgradeToPro() {
            trackNewsEvent('upgrade_prompt_clicked', {
                source: 'news_results'
            });
            
            showNotification('🚀 Redirecting to Pro upgrade page...', 'info');
            setTimeout(() => {
                window.location.href = '/pricingplan';
            }, 1500);
        }

        function resetForm() {
            document.getElementById('news-text').value = '';
            document.getElementById('news-url').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('progressSection').style.display = 'none';
            currentAnalysisData = null;
            currentTier = 'free';
            
            resetProgressBars();
            switchInputType('text');
            
            showNotification('Form reset successfully.', 'success');
            trackNewsEvent('form_reset');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            const colors = {
                success: '#10b981',
                error: '#ef4444', 
                info: '#3b82f6',
                warning: '#f59e0b'
            };
            
            notification.style.cssText = `
                position: fixed; 
                top: 20px; 
                right: 20px; 
                background: ${colors[type] || colors.info}; 
                color: white; 
                padding: 15px 20px; 
                border-radius: 8px; 
                z-index: 1000; 
                font-weight: 600;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle',
                warning: 'fas fa-exclamation-circle'
            };
            
            notification.innerHTML = `<i class="${icons[type] || icons.info}"></i> ${message}`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, type === 'error' ? 5000 : 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add slideIn and slideOut animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Initialize authentication features if available
            if (window.authAnalysis && typeof window.authAnalysis.init === 'function') {
                window.authAnalysis.init();
            }
        });
    </script>
</body>
</html>'pro' ? `
                    <button class="download-report" onclick="downloadReport()">
                        <i class="fas fa-download"></i>
                        Download Detailed Report (PDF)
                    </button>
                    ` : ''}
                </div>

                <!-- ANALYSIS SECTIONS - ORGANIZED IN DROPDOWNS -->
                <div class="analysis-cards">
                    ${generateAnalysisDropdowns(results, tier)}
                </div>

                ${tier === 'free' ? generateUpgradePrompt() : ''}
            `;
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Initialize dropdowns - all closed by default except main assessment
            initializeDropdowns();
            
            // Create charts if pro version
            if (tier === 'pro') {
                setTimeout(() => {
                    try {
                        if (results.source_verification?.sources?.length > 0) {
                            createSourceChart(results.source_verification.sources);
                        }
                    } catch (error) {
                        console.log('Chart creation skipped:', error.message);
                    }
                }, 500);
            }
        }

        function generateCompactDialogue(score, assessment) {
            if (score >= 80) {
                return `This content demonstrates strong credibility indicators with professional standards and reliable sourcing patterns. The assessment reveals minimal red flags and consistent verification across multiple data points.`;
            } else if (score >= 60) {
                return `This content shows moderate credibility with some areas requiring caution. While basic standards are met, additional verification is recommended before sharing or relying on this information.`;
            } else {
                return `This content exhibits significant credibility concerns with multiple red flags identified. Exercise extreme caution and seek additional verification from trusted sources before considering this content reliable.`;
            }
        }

        function generateAnalysisDropdowns(results, tier) {
            return `
                <!-- Political Bias Analysis -->
                <div class="dropdown-section">
                    <div class="dropdown-header ${tier === 'free' ? 'locked' : ''}" onclick="toggleDropdown(this, '${tier}')">
                        <span><i class="fas fa-balance-scale"></i> Political Bias & Objectivity Analysis</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    ${tier ===
