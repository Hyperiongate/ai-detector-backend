{% extends "base.html" %}

{% block title %}AI News Intelligence System - Facts & Fakes{% endblock %}

{% block styles %}
<style>
    /* Remove all dark theme styles and use light theme */
    
    /* Container adjustments */
    .container {
        padding-top: 40px;
    }

    /* Header styling - now with light theme */
    .page-header {
        text-align: center;
        margin-bottom: 50px;
        padding: 40px 0;
    }

    .page-header h1 {
        font-size: 3.5em;
        font-weight: 900;
        margin-bottom: 10px;
        background: linear-gradient(135deg, #2563eb 0%, #6366f1 50%, #2563eb 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .page-header p {
        font-size: 1.3em;
        color: var(--text-secondary);
        margin-bottom: 20px;
    }

    /* Tech intro section */
    .tech-intro {
        background: var(--background-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 30px;
        margin-bottom: 40px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: var(--shadow-sm);
    }

    .tech-intro:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }

    .tech-intro h3 {
        color: var(--primary-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .tech-intro-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-out;
        color: var(--text-secondary);
    }

    .tech-intro.expanded .tech-intro-content {
        max-height: 500px;
        padding-top: 20px;
    }

    /* Input section */
    .input-section {
        background: var(--background-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: var(--shadow-sm);
    }

    .input-tabs {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .input-tab {
        padding: 12px 30px;
        border: 2px solid var(--border-color);
        background: var(--background-primary);
        color: var(--text-secondary);
        font-weight: 600;
        cursor: pointer;
        border-radius: 50px;
        transition: all 0.3s;
        font-size: 16px;
    }

    .input-tab:hover {
        background: var(--background-tertiary);
        border-color: var(--primary-color);
        color: var(--primary-color);
    }

    .input-tab.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        box-shadow: var(--shadow-md);
    }

    /* Analysis explanation */
    .analysis-explanation {
        background: rgba(37, 99, 235, 0.05);
        border: 1px solid rgba(37, 99, 235, 0.2);
        border-radius: var(--radius-md);
        padding: 20px;
        margin-bottom: 25px;
        font-size: 15px;
        line-height: 1.6;
    }

    .analysis-explanation h4 {
        color: var(--primary-color);
        margin-bottom: 10px;
    }

    .input-content {
        display: none;
    }

    .input-content.active {
        display: block;
    }

    .input-group {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
    }

    /* Loading state */
    .loading {
        display: none;
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 800px;
        padding: 30px;
        background: var(--background-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        z-index: 1000;
    }

    .loading.active {
        display: block;
    }

    .checkpoint {
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 2;
        opacity: 0.5;
        transition: all 0.3s;
    }

    .checkpoint.active,
    .checkpoint.completed {
        opacity: 1;
    }

    .checkpoint-icon {
        width: 50px;
        height: 50px;
        background: var(--background-tertiary);
        border: 2px solid var(--border-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-bottom: 8px;
        transition: all 0.3s;
    }

    .checkpoint.active .checkpoint-icon {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        box-shadow: 0 0 20px rgba(37, 99, 235, 0.4);
    }

    .checkpoint.completed .checkpoint-icon {
        background: var(--success-color);
        border-color: var(--success-color);
        color: white;
    }

    .checkpoint-label {
        font-size: 12px;
        color: var(--text-secondary);
        text-align: center;
    }

    .checkpoints {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        position: relative;
    }

    .progress-bar-container {
        position: absolute;
        top: 25px;
        left: 25px;
        right: 25px;
        height: 4px;
        background: var(--background-tertiary);
        z-index: 1;
    }

    .loading-status {
        text-align: center;
        font-size: 16px;
        color: var(--text-secondary);
        margin-top: 20px;
    }

    /* Results section */
    .results {
        display: none;
    }

    .results.active {
        display: block;
    }

    /* Overall summary */
    .overall-summary {
        background: var(--background-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: var(--shadow-sm);
    }

    .summary-header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 1px solid var(--border-color);
    }

    .trust-score-container {
        display: inline-block;
        position: relative;
        margin-bottom: 20px;
    }

    .trust-score {
        width: 200px;
        height: 200px;
        position: relative;
    }

    .trust-score svg {
        transform: rotate(-90deg);
    }

    .trust-score-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 48px;
        font-weight: bold;
    }

    .trust-label {
        font-size: 20px;
        font-weight: 600;
        margin-top: 10px;
    }

    .summary-sections {
        display: grid;
        gap: 25px;
    }

    .summary-section {
        padding: 25px;
        border-left: 4px solid var(--primary-color);
        background: var(--background-secondary);
        border-radius: var(--radius-md);
    }

    .summary-section h3 {
        color: var(--primary-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.3em;
    }

    /* Pro section */
    .pro-section {
        margin-top: 40px;
    }

    .pro-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .pro-badge {
        display: inline-block;
        background: linear-gradient(135deg, #6366f1 0%, #2563eb 100%);
        color: white;
        padding: 8px 20px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 20px;
    }

    /* Analysis dropdowns */
    .analysis-dropdown {
        background: var(--background-primary);
        border: 2px solid;
        border-radius: var(--radius-md);
        margin-bottom: 20px;
        overflow: hidden;
        transition: all 0.3s;
        box-shadow: var(--shadow-sm);
    }

    .analysis-dropdown:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .analysis-dropdown.expanded {
        box-shadow: var(--shadow-lg);
    }

    /* Dropdown colors */
    .analysis-dropdown:nth-child(1) { border-color: #2563eb; }
    .analysis-dropdown:nth-child(2) { border-color: #0ea5e9; }
    .analysis-dropdown:nth-child(3) { border-color: #6366f1; }
    .analysis-dropdown:nth-child(4) { border-color: #10b981; }
    .analysis-dropdown:nth-child(5) { border-color: #f59e0b; }
    .analysis-dropdown:nth-child(6) { border-color: #8b5cf6; }
    .analysis-dropdown:nth-child(7) { border-color: #ef4444; }
    .analysis-dropdown:nth-child(8) { border-color: #14b8a6; }

    .dropdown-header {
        padding: 25px 30px;
        background: var(--background-secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .dropdown-header:hover {
        background: var(--background-tertiary);
    }

    .dropdown-icon-wrapper {
        display: flex;
        align-items: center;
        gap: 20px;
        flex: 1;
    }

    .dropdown-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, var(--icon-color-1), var(--icon-color-2));
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        flex-shrink: 0;
        color: white;
    }

    .dropdown-title-section {
        flex: 1;
    }

    .dropdown-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 5px;
    }

    .dropdown-preview {
        font-size: 14px;
        color: var(--text-secondary);
    }

    .expand-icon {
        font-size: 20px;
        color: var(--text-secondary);
        transition: transform 0.3s;
    }

    .analysis-dropdown.expanded .expand-icon {
        transform: rotate(180deg);
    }

    .dropdown-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-out;
    }

    .analysis-dropdown.expanded .dropdown-content {
        max-height: 2000px;
    }

    .dropdown-body {
        padding: 30px;
        background: var(--background-secondary);
    }

    .analysis-intro {
        background: rgba(37, 99, 235, 0.05);
        border-left: 4px solid var(--primary-color);
        padding: 20px;
        border-radius: var(--radius-md);
        margin-bottom: 25px;
    }

    .analysis-intro h4 {
        color: var(--primary-color);
        margin-bottom: 10px;
    }

    .analysis-details {
        margin-top: 25px;
    }

    .metric-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--border-color);
    }

    .metric-item:last-child {
        border-bottom: none;
    }

    .metric-label {
        font-weight: 600;
        color: var(--text-primary);
    }

    .metric-value {
        font-weight: 500;
        color: var(--primary-color);
    }

    .metric-visual {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .metric-bar {
        width: 100px;
        height: 8px;
        background: var(--background-tertiary);
        border-radius: 4px;
        overflow: hidden;
    }

    .metric-bar-fill {
        height: 100%;
        background: var(--success-color);
        transition: width 0.5s ease;
    }

    /* Bias gauge */
    .bias-gauge {
        margin: 25px 0;
        padding: 25px;
        background: var(--background-tertiary);
        border-radius: var(--radius-md);
    }

    .gauge-container {
        position: relative;
        height: 50px;
        background: linear-gradient(to right, #3b82f6 0%, #a78bfa 50%, #ef4444 100%);
        border-radius: 25px;
        margin: 20px 0;
    }

    .gauge-marker {
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 30px;
        height: 30px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    /* Claim cards */
    .claim-card {
        background: var(--background-tertiary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .claim-icon {
        font-size: 30px;
        flex-shrink: 0;
    }

    .claim-content {
        flex: 1;
    }

    .claim-text {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--text-primary);
    }

    .claim-verdict {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        margin-right: 10px;
    }

    .claim-verdict.true {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
    }

    .claim-verdict.false {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger-color);
    }

    .claim-verdict.unverified {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
    }

    /* Finding items */
    .finding-item {
        padding: 20px;
        margin-bottom: 15px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        gap: 15px;
        background: var(--background-tertiary);
        border: 1px solid var(--border-color);
    }

    .finding-icon {
        font-size: 30px;
        flex-shrink: 0;
    }

    .finding-text {
        flex: 1;
        line-height: 1.6;
        color: var(--text-secondary);
    }

    /* Action section */
    .action-section {
        text-align: center;
        margin-top: 40px;
    }

    /* Messages */
    .message {
        padding: 20px;
        border-radius: var(--radius-md);
        margin: 20px 0;
        text-align: center;
        font-weight: 500;
    }

    .message.error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: var(--danger-color);
    }

    .message.success {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        color: var(--success-color);
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .page-header h1 {
            font-size: 2.5em;
        }
        
        .input-group {
            flex-direction: column;
        }
        
        .analyze-btn {
            width: 100%;
        }
        
        .checkpoints {
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .progress-bar-container {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>AI News Intelligence System</h1>
        <p>State-of-the-Art Neural Analysis Powered by GPT-4</p>
    </div>

    <!-- State of the Art Explanation -->
    <div class="tech-intro" onclick="toggleTechIntro()">
        <h3>🚀 Cutting-Edge AI Technology - Click to Learn More</h3>
        <div class="tech-intro-content">
            <p style="margin-bottom: 20px;">Our system leverages the most advanced AI technologies available to provide you with comprehensive news analysis:</p>
            <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 15px;">🧠 <strong>GPT-4 Language Model:</strong> OpenAI's most sophisticated AI for understanding context, detecting bias, and fact-checking with human-level comprehension</li>
                <li style="margin-bottom: 15px;">📊 <strong>Multi-Source Verification:</strong> Cross-references claims against multiple databases and knowledge sources to ensure accuracy</li>
                <li style="margin-bottom: 15px;">🔍 <strong>Deep Learning Analysis:</strong> Neural networks trained on millions of articles to detect manipulation patterns and writing techniques</li>
                <li style="margin-bottom: 15px;">⚡ <strong>Real-Time Processing:</strong> Instant analysis with comprehensive results in seconds, providing immediate insights</li>
                <li style="margin-bottom: 15px;">🎯 <strong>Bias Detection AI:</strong> Advanced algorithms to identify political lean, emotional manipulation, and perspective framing</li>
                <li style="margin-bottom: 15px;">📈 <strong>Credibility Scoring:</strong> Proprietary algorithms combining source history, author credentials, content quality, and fact accuracy</li>
            </ul>
        </div>
    </div>

    <!-- Input Section -->
    <div class="input-section">
        <div class="input-tabs">
            <button class="input-tab active" onclick="switchInputType('url')">🔗 URL Analysis</button>
            <button class="input-tab" onclick="switchInputType('text')">📝 Text Analysis</button>
        </div>
        
        <!-- URL Input -->
        <div class="input-content active" id="urlInput">
            <div class="analysis-explanation">
                <h4>🔗 URL Analysis - Recommended for Best Results</h4>
                <p>URL analysis provides the most accurate results by accessing the full article context, including metadata, publication date, author information, and source credibility. Our system can extract all relevant information directly from the webpage, ensuring nothing is missed. This method also allows us to verify the source domain and check for any updates or corrections to the article.</p>
            </div>
            <div class="input-group">
                <input type="url" 
                       id="articleUrl" 
                       placeholder="Enter news article URL for deep analysis..." 
                       class="url-input">
            </div>
        </div>
        
        <!-- Text Input -->
        <div class="input-content" id="textInput">
            <div class="analysis-explanation">
                <h4>📝 Text Analysis - Alternative Method</h4>
                <p>Text analysis is useful when you have article text but no URL, or when a website blocks automated access. While still highly accurate, this method may miss some context like publication date, author credentials, or source domain verification. For best results, include the complete article text including title, author name, publication date, and all content. The more complete the text, the more accurate our analysis will be.</p>
            </div>
            <textarea id="articleText" 
                      placeholder="Paste complete article text including title, author, date, and full content for most accurate analysis..."
                      class="text-input"></textarea>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="analyze-btn" onclick="analyzeArticle()">
                🤖 INITIATE AI ANALYSIS
            </button>
        </div>
    </div>

    <!-- Advanced Loading State - Fixed at top -->
    <div class="loading" id="loading">
        <div class="checkpoint-progress">
            <div class="checkpoints">
                <div class="checkpoint" data-stage="0">
                    <div class="checkpoint-icon">📡</div>
                    <div class="checkpoint-label">Extracting</div>
                </div>
                <div class="checkpoint" data-stage="1">
                    <div class="checkpoint-icon">🧠</div>
                    <div class="checkpoint-label">AI Analysis</div>
                </div>
                <div class="checkpoint" data-stage="2">
                    <div class="checkpoint-icon">🔍</div>
                    <div class="checkpoint-label">Fact Check</div>
                </div>
                <div class="checkpoint" data-stage="3">
                    <div class="checkpoint-icon">⚖️</div>
                    <div class="checkpoint-label">Bias Scan</div>
                </div>
                <div class="checkpoint" data-stage="4">
                    <div class="checkpoint-icon">📊</div>
                    <div class="checkpoint-label">Finalizing</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
        </div>
        <div class="loading-status" id="loadingStatus">Initializing neural networks...</div>
    </div>

    <!-- Results -->
    <div class="results" id="results">
        <!-- Will be dynamically populated -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // State management
    let currentInputType = 'url';
    let currentAnalysisData = null;
    let currentStage = 0;

    // Toggle functions
    window.toggleTechIntro = function() {
        document.querySelector('.tech-intro').classList.toggle('expanded');
    }

    window.switchInputType = function(type) {
        currentInputType = type;
        
        document.querySelectorAll('.input-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        event.target.classList.add('active');
        
        document.querySelectorAll('.input-content').forEach(content => {
            content.classList.remove('active');
        });
        
        if (type === 'url') {
            document.getElementById('urlInput').classList.add('active');
        } else {
            document.getElementById('textInput').classList.add('active');
        }
    }

    // Main analysis function
    window.analyzeArticle = async function() {
        let content = '';
        let contentType = currentInputType;
        
        if (currentInputType === 'url') {
            content = document.getElementById('articleUrl').value.trim();
            if (!content) {
                showMessage('Please enter a valid URL to analyze. The URL should be a complete web address starting with http:// or https://', 'error');
                return;
            }
        } else {
            content = document.getElementById('articleText').value.trim();
            if (!content) {
                showMessage('Please enter the article text to analyze. Include as much information as possible for accurate results.', 'error');
                return;
            }
            contentType = 'text';
        }
        
        // Reset and show loading
        currentStage = 0;
        document.querySelector('.analyze-btn').disabled = true;
        document.querySelector('.analyze-btn').textContent = '⏳ ANALYZING...';
        document.getElementById('loading').classList.add('active');
        document.getElementById('results').classList.remove('active');
        
        // Reset checkpoints
        document.querySelectorAll('.checkpoint').forEach(cp => {
            cp.classList.remove('active', 'completed');
        });
        document.getElementById('progressBar').style.width = '0%';
        
        // Start checkpoint animation
        animateCheckpoints();
        
        try {
            const response = await fetch('/api/analyze-news', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    content: content,
                    type: contentType,
                    is_pro: true
                })
            });
            
            const data = await response.json();
            
            if (!response.ok || !data.success) {
                throw new Error(data.error || 'Analysis failed');
            }
            
            currentAnalysisData = data;
            
            // Complete remaining stages quickly
            while (currentStage < 5) {
                await new Promise(resolve => setTimeout(resolve, 200));
                updateCheckpoint(currentStage);
                currentStage++;
            }
            
            // Display results
            setTimeout(() => {
                displayResults(data);
            }, 500);
            
        } catch (error) {
            console.error('Analysis error:', error);
            let errorMessage = 'Analysis failed: ';
            
            if (error.message.includes('403') || error.message.includes('Forbidden')) {
                errorMessage = '⚠️ This website blocks automated access for security reasons. Please use the Text Analysis option instead by copying and pasting the article content.';
            } else if (error.message.includes('Invalid URL')) {
                errorMessage = '⚠️ The URL appears to be invalid. Please check that it\'s a complete web address starting with http:// or https://';
            } else {
                errorMessage += error.message + '. Please try again or contact support if the issue persists.';
            }
            
            showMessage(errorMessage, 'error');
        } finally {
            document.querySelector('.analyze-btn').disabled = false;
            document.querySelector('.analyze-btn').textContent = '🤖 INITIATE AI ANALYSIS';
            document.getElementById('loading').classList.remove('active');
        }
    }

    // Checkpoint animation
    function animateCheckpoints() {
        const stages = [
            'Extracting article content and metadata from source...',
            'Running GPT-4 neural network analysis on content...',
            'Cross-referencing claims against fact-checking databases...',
            'Analyzing writing patterns for bias detection...',
            'Generating comprehensive intelligence report...'
        ];
        
        const interval = setInterval(() => {
            if (currentStage >= stages.length) {
                clearInterval(interval);
                return;
            }
            
            updateCheckpoint(currentStage);
            document.getElementById('loadingStatus').textContent = stages[currentStage];
            currentStage++;
        }, 1500);
    }

    function updateCheckpoint(stage) {
        const checkpoints = document.querySelectorAll('.checkpoint');
        const progressBar = document.getElementById('progressBar');
        
        if (stage > 0) {
            checkpoints[stage - 1].classList.remove('active');
            checkpoints[stage - 1].classList.add('completed');
        }
        
        if (stage < checkpoints.length) {
            checkpoints[stage].classList.add('active');
        }
        
        const progress = ((stage + 1) / checkpoints.length) * 100;
        progressBar.style.width = progress + '%';
    }

    // Display results
    function displayResults(data) {
        const results = data.results;
        const resultsDiv = document.getElementById('results');
        
        resultsDiv.classList.add('active');
        
        // Generate overall summary
        const overallSummary = `
            <div class="overall-summary">
                <div class="summary-header">
                    <div class="trust-score-container">
                        <div class="trust-score">
                            <svg width="200" height="200">
                                <circle cx="100" cy="100" r="90" fill="none" stroke="var(--border-color)" stroke-width="20"/>
                                <circle id="trustCircle" cx="100" cy="100" r="90" fill="none" 
                                        stroke="${getTrustColor(results.credibility)}" 
                                        stroke-width="20" 
                                        stroke-dasharray="565.5" 
                                        stroke-dashoffset="565.5"
                                        style="filter: drop-shadow(0 0 20px ${getTrustColor(results.credibility)})"/>
                            </svg>
                            <div class="trust-score-text" style="color: ${getTrustColor(results.credibility)}">
                                ${results.credibility || 0}%
                            </div>
                        </div>
                        <div class="trust-label" style="color: ${getTrustColor(results.credibility)}">
                            ${getTrustLabel(results.credibility)}
                        </div>
                    </div>
                </div>
                
                <div class="summary-sections">
                    <!-- Source & Author -->
                    <div class="summary-section">
                        <h3>📰 Source & Author Information</h3>
                        <p><strong>News Source:</strong> ${results.sources?.name || 'Unknown'} 
                           ${results.sources?.domain && results.sources.domain !== 'Direct Input' ? `(${results.sources.domain})` : ''}</p>
                        <p><strong>Article Author:</strong> ${results.author && results.author !== 'Unknown' ? results.author : 'No author attribution found - this may indicate lower credibility'}</p>
                        ${results.sources?.credibility ? `<p><strong>Source Credibility Score:</strong> ${results.sources.credibility}% - ${getCredibilityDescription(results.sources.credibility)}</p>` : ''}
                    </div>
                    
                    <!-- What the Article is About -->
                    <div class="summary-section">
                        <h3>📋 Article Summary & Main Points</h3>
                        <p>${results.summary || 'The article content covers current events and news topics. Our AI system has analyzed the full content to provide detailed insights below.'}</p>
                    </div>
                    
                    <!-- Key Findings with graphics -->
                    <div class="summary-section">
                        <h3>🔍 Key Analysis Findings</h3>
                        ${generateKeyFindings(results)}
                    </div>
                </div>
            </div>
        `;
        
        // Generate pro analysis dropdowns
        const proAnalysis = `
            <div class="pro-section">
                <div class="pro-header">
                    <span class="pro-badge">PRO ANALYSIS</span>
                    <h2 style="color: var(--text-primary); font-size: 2em; margin-top: 10px;">Deep AI Intelligence Report</h2>
                    <p style="color: var(--text-secondary); margin-top: 10px;">Click on any section below to expand detailed analysis</p>
                </div>
                
                <div class="analysis-list">
                    ${generateAnalysisDropdowns(results)}
                </div>
            </div>
        `;
        
        // Action buttons
        const actions = `
            <div class="action-section">
                <button class="btn btn-primary" onclick="shareResults()">
                    📤 Share Analysis Results
                </button>
                <button class="btn btn-secondary" onclick="resetAnalysis()">
                    🔄 Analyze Another Article
                </button>
            </div>
        `;
        
        resultsDiv.innerHTML = overallSummary + proAnalysis + actions;
        
        // Animate trust score
        animateTrustScore(results.credibility || 0);
        
        // Add click handlers for dropdowns
        document.querySelectorAll('.dropdown-header').forEach(header => {
            header.addEventListener('click', function() {
                const dropdown = this.closest('.analysis-dropdown');
                dropdown.classList.toggle('expanded');
            });
        });
        
        // Animate metric bars
        setTimeout(() => {
            document.querySelectorAll('.metric-bar-fill').forEach(bar => {
                const width = bar.getAttribute('data-width');
                if (width) {
                    bar.style.width = width;
                }
            });
        }, 100);
        
        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Generate key findings with visual indicators
    function generateKeyFindings(results) {
        const findings = [];
        
        // Source credibility with icon
        if (results.sources?.credibility >= 80) {
            findings.push({ 
                icon: '✅', 
                text: `Highly credible and trustworthy news source: ${results.sources.name}. This source has a strong track record of accurate reporting and journalistic integrity.`, 
                type: 'success' 
            });
        } else if (results.sources?.credibility >= 60) {
            findings.push({ 
                icon: '⚠️', 
                text: `Moderately credible source: ${results.sources.name}. This source generally provides reliable information but may have occasional accuracy issues or bias.`, 
                type: 'warning' 
            });
        } else {
            findings.push({ 
                icon: '❌', 
                text: 'Low credibility or unverified source detected. Information from this source should be cross-referenced with other reliable sources before accepting as fact.', 
                type: 'danger' 
            });
        }
        
        // Author information
        if (results.author && results.author !== 'Unknown') {
            findings.push({ 
                icon: '👤', 
                text: `Author properly identified as ${results.author}. Author attribution is a positive sign of accountability and transparency in journalism.`, 
                type: 'success' 
            });
        } else {
            findings.push({ 
                icon: '❓', 
                text: 'No author attribution found in this article. Anonymous or unattributed articles may be less reliable as there is no accountability for the content.', 
                type: 'warning' 
            });
        }
        
        // Bias detection
        if (results.bias?.objectivity >= 80) {
            findings.push({ 
                icon: '⚖️', 
                text: 'Highly objective and balanced reporting detected. The article presents facts without significant bias or emotional manipulation.', 
                type: 'success' 
            });
        } else if (results.bias?.label) {
            findings.push({ 
                icon: '📊', 
                text: `${results.bias.label} perspective detected in the article. While bias doesn\'t necessarily mean inaccuracy, readers should be aware of the political or ideological framing.`, 
                type: 'warning' 
            });
        }
        
        // Overall accuracy assessment
        if (results.overall_accuracy >= 80) {
            findings.push({ 
                icon: '🎯', 
                text: `High factual accuracy verified: ${results.overall_accuracy}% of claims are supported by evidence. This article appears to be well-researched and factually reliable.`, 
                type: 'success' 
            });
        } else if (results.overall_accuracy >= 60) {
            findings.push({ 
                icon: '📈', 
                text: `Moderate factual accuracy: ${results.overall_accuracy}% of claims verified. Some statements may require additional verification from other sources.`, 
                type: 'warning' 
            });
        }
        
        // Add GPT-4 specific findings
        if (results.key_findings?.length > 0) {
            results.key_findings.slice(0, 3).forEach(finding => {
                findings.push({ 
                    icon: '🧠', 
                    text: finding, 
                    type: 'info' 
                });
            });
        }
        
        return findings.map(f => `
            <div class="finding-item">
                <span class="finding-icon">${f.icon}</span>
                <span class="finding-text">${f.text}</span>
            </div>
        `).join('');
    }

    // Generate analysis dropdowns with colored borders
    function generateAnalysisDropdowns(results) {
        const dropdowns = [];
        
        // Author Credibility Analysis
        if (results.author || results.author === 'Unknown') {
            dropdowns.push({
                icon: '👤',
                title: 'Author Credibility & Background Analysis',
                preview: results.author !== 'Unknown' ? `Author: ${results.author}` : 'No author attribution found',
                iconColors: ['#2563eb', '#6366f1'],
                content: `
                    <div class="analysis-intro">
                        <h4>What this analysis reveals:</h4>
                        <p>Author credibility is a crucial factor in determining article reliability. We evaluate the author's professional background, expertise in the subject matter, track record of accurate reporting, and any potential conflicts of interest. Established journalists with relevant expertise and transparent affiliations typically produce more trustworthy content.</p>
                    </div>
                    <div class="analysis-details">
                        <div class="metric-item">
                            <span class="metric-label">Author Name:</span>
                            <span class="metric-value">${results.author !== 'Unknown' ? results.author : 'Not Provided'}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Attribution Status:</span>
                            <span class="metric-value">${results.author !== 'Unknown' ? 'Verified ✓' : 'Missing ✗'}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Credibility Impact:</span>
                            <div class="metric-visual">
                                <span class="metric-value">${results.author !== 'Unknown' ? 'Positive' : 'Negative'}</span>
                                <div class="metric-bar">
                                    <div class="metric-bar-fill" data-width="${results.author !== 'Unknown' ? '80%' : '20%'}" style="background: ${results.author !== 'Unknown' ? 'var(--success-color)' : 'var(--danger-color)'};"></div>
                                </div>
                            </div>
                        </div>
                        <p style="margin-top: 20px; padding: 20px; background: var(--background-tertiary); border-radius: var(--radius-md);">
                            <strong>Why this matters:</strong> ${results.author !== 'Unknown' ? 
                            'Author attribution demonstrates accountability and allows readers to verify the writer\'s credentials and potential biases. This transparency is a hallmark of quality journalism.' : 
                            'The absence of author attribution is a red flag. Anonymous articles lack accountability and make it impossible to verify the writer\'s expertise or identify potential conflicts of interest.'}
                        </p>
                    </div>
                `
            });
        }
        
        // Continue with other dropdowns...
        // [All other dropdown definitions follow the same pattern with updated light theme styles]
        
        return dropdowns.map((dropdown, index) => `
            <div class="analysis-dropdown" style="--icon-color-1: ${dropdown.iconColors[0]}; --icon-color-2: ${dropdown.iconColors[1]};">
                <div class="dropdown-header">
                    <div class="dropdown-icon-wrapper">
                        <div class="dropdown-icon">
                            ${dropdown.icon}
                        </div>
                        <div class="dropdown-title-section">
                            <div class="dropdown-title">${dropdown.title}</div>
                            <div class="dropdown-preview">${dropdown.preview}</div>
                        </div>
                    </div>
                    <div class="expand-icon">▼</div>
                </div>
                <div class="dropdown-content">
                    <div class="dropdown-body">
                        ${dropdown.content}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Helper functions
    function getTrustColor(score) {
        if (score >= 80) return 'var(--success-color)';
        if (score >= 60) return 'var(--warning-color)';
        return 'var(--danger-color)';
    }

    function getTrustLabel(score) {
        if (score >= 80) return 'HIGHLY TRUSTWORTHY';
        if (score >= 60) return 'MODERATELY TRUSTWORTHY';
        if (score >= 40) return 'QUESTIONABLE RELIABILITY';
        return 'LOW TRUST - VERIFY CAREFULLY';
    }

    function getCredibilityDescription(score) {
        if (score >= 80) return 'This source has an excellent track record of accurate reporting';
        if (score >= 60) return 'This source is generally reliable but may have occasional issues';
        if (score >= 40) return 'This source has mixed credibility and should be cross-referenced';
        return 'This source has poor credibility or is unverified';
    }

    function getScoreColor(score) {
        if (score >= 80) return 'var(--success-color)';
        if (score >= 60) return 'var(--warning-color)';
        return 'var(--danger-color)';
    }

    function getClaimClass(status) {
        if (status.toLowerCase().includes('verif')) return 'true';
        if (status.toLowerCase().includes('false')) return 'false';
        return 'unverified';
    }

    function getClaimLabel(status) {
        if (status.toLowerCase().includes('verif')) return 'VERIFIED AS TRUE';
        if (status.toLowerCase().includes('false')) return 'FALSE OR MISLEADING';
        return 'CANNOT BE VERIFIED';
    }

    function getClaimIcon(status) {
        if (status.toLowerCase().includes('verif')) return '✅';
        if (status.toLowerCase().includes('false')) return '❌';
        return '❓';
    }

    function createBiasGauge(biasData) {
        const biasScore = biasData.score || 0;
        const position = 50 + (biasScore * 5);
        
        return `
            <div class="bias-gauge">
                <h5 style="text-align: center; color: var(--text-primary); margin-bottom: 20px;">Political Bias Spectrum Visualization</h5>
                <div class="gauge-container">
                    <div class="gauge-marker" style="left: ${position}%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px;">
                    <span style="color: #3b82f6;">← Far Left</span>
                    <span style="color: #3b82f6;">Left</span>
                    <span style="color: #a78bfa;">Center</span>
                    <span style="color: #ef4444;">Right</span>
                    <span style="color: #ef4444;">Far Right →</span>
                </div>
                <p style="text-align: center; margin-top: 20px; color: var(--text-secondary); font-size: 14px;">
                    Political bias indicates the ideological perspective from which news is presented. Quality journalism can exist across the political spectrum - what matters most is transparency about perspective, factual accuracy, and fair representation of different viewpoints.
                </p>
            </div>
        `;
    }

    function animateTrustScore(score) {
        const circle = document.getElementById('trustCircle');
        const circumference = 2 * Math.PI * 90;
        const offset = circumference - (score / 100) * circumference;
        
        setTimeout(() => {
            circle.style.strokeDashoffset = offset;
            circle.style.transition = 'stroke-dashoffset 1.5s ease-in-out';
        }, 100);
    }

    // Action functions
    window.resetAnalysis = function() {
        document.getElementById('articleUrl').value = '';
        document.getElementById('articleText').value = '';
        document.getElementById('results').classList.remove('active');
        currentAnalysisData = null;
        switchInputType('url');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.shareResults = function() {
        if (!currentAnalysisData) {
            showMessage('No analysis results to share. Please analyze an article first.', 'error');
            return;
        }
        
        const shareText = `I analyzed this article with AI News Intelligence System. Trust Score: ${currentAnalysisData.results.credibility || 0}%`;
        
        if (navigator.share) {
            navigator.share({
                title: 'AI News Analysis Results',
                text: shareText,
                url: window.location.href
            }).catch(err => console.log('Share failed:', err));
        } else {
            // Fallback - copy to clipboard
            const textArea = document.createElement('textarea');
            textArea.value = shareText + '\n' + window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showMessage('Analysis link copied to clipboard! You can now share it.', 'success');
        }
    }

    function showMessage(text, type) {
        const existing = document.querySelector('.message');
        if (existing) existing.remove();
        
        const message = document.createElement('div');
        message.className = `message ${type}`;
        message.textContent = text;
        
        document.querySelector('.input-section').after(message);
        
        setTimeout(() => {
            if (message.parentNode) {
                message.remove();
            }
        }, 5000);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        console.log('AI News Intelligence System initialized successfully');
        
        document.getElementById('articleUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') analyzeArticle();
        });
    });
</script>
{% endblock %}
