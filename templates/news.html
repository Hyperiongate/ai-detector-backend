<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced News Analyzer - Facts & Fakes AI</title>
    <meta name="description" content="AI-powered news verification with bias detection, fact-checking, and credibility analysis. Detect fake news instantly with our advanced algorithms.">
    
    <!-- Bootstrap CSS from cdnjs (CSP approved) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    
    <style>
        /* Professional Color Scheme */
        :root {
            --primary-blue: #4a90e2;
            --primary-blue-dark: #357abd;
            --primary-gradient: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #ecf0f1;
            --bg-light: #f8f9fa;
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 8px 30px rgba(74, 144, 226, 0.2);
        }

        /* FIXED: Progress Bar Positioning */
        .analysis-progress-container {
            position: fixed;
            top: 60px; /* Below header */
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            padding: 20px;
            display: none;
            border-bottom: 3px solid var(--primary-blue);
        }
        
        .progress-wrapper {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .progress-stage {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stage-icon {
            width: 30px;
            height: 30px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            animation: pulse 2s infinite;
        }
        
        .progress-percentage {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        .progress-bar-container {
            position: relative;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: var(--primary-gradient);
            transition: width 0.3s ease;
            position: relative;
            border-radius: 6px;
        }
        
        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 40px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6));
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-40px); }
            100% { transform: translateX(40px); }
        }
        
        .progress-stages {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 0 10px;
        }
        
        .progress-stage-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
            position: relative;
        }
        
        .progress-stage-item:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #e5e7eb;
            z-index: -1;
        }
        
        .progress-stage-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        .progress-stage-item.active .progress-stage-dot {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
            transform: scale(1.2);
        }
        
        .progress-stage-item.completed .progress-stage-dot {
            background: var(--success-color);
            color: white;
            border-color: transparent;
        }
        
        .progress-stage-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            max-width: 100px;
        }
        
        .progress-stage-item.active .progress-stage-label {
            color: var(--primary-blue);
            font-weight: 600;
        }

        /* Enhanced Trust Meter with Explanation */
        .trust-meter-section {
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 10px 40px rgba(74, 144, 226, 0.2);
        }
        
        .trust-meter-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 30px auto;
            background: white;
            border-radius: 50%;
            box-shadow: 0 10px 40px rgba(74, 144, 226, 0.3);
            padding: 25px;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .trust-meter {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .trust-meter-circle {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .trust-meter-bg {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 20;
        }
        
        .trust-meter-fill {
            fill: none;
            stroke-width: 20;
            stroke-linecap: round;
            transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 10px currentColor);
        }
        
        .trust-meter-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .trust-score {
            font-size: 56px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
            margin-bottom: 5px;
        }
        
        .trust-label {
            font-size: 16px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .trust-score-interpretation {
            max-width: 600px;
            margin: 30px auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .trust-score-interpretation h4 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .trust-score-interpretation p {
            color: var(--text-primary);
            line-height: 1.7;
            margin-bottom: 15px;
        }
        
        .score-factors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .score-factor {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .score-factor-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .score-factor-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Enhanced Gauge for Emotional Manipulation */
        .gauge-container {
            width: 300px;
            height: 150px;
            position: relative;
            margin: 30px auto;
        }
        
        .gauge-svg {
            width: 100%;
            height: 100%;
        }
        
        .gauge-background {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 30;
        }
        
        .gauge-fill {
            fill: none;
            stroke-width: 30;
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease-out;
        }
        
        .gauge-labels {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .gauge-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .gauge-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .gauge-value-number {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .gauge-value-label {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Source Comparison Enhanced */
        .source-comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .source-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .source-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .source-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: var(--primary-blue);
        }
        
        .source-card:hover::before {
            transform: scaleX(1);
        }
        
        .source-card.current-source {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
        }
        
        .source-logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            background: var(--bg-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            color: var(--primary-blue);
        }
        
        .source-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .source-score {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .source-score-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .source-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        
        .source-detail {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 13px;
        }
        
        .source-detail-label {
            color: var(--text-secondary);
        }
        
        .source-detail-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        /* Author Verification Enhanced */
        .author-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            display: flex;
            gap: 25px;
            align-items: start;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        
        .author-avatar {
            width: 80px;
            height: 80px;
            background: var(--bg-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: var(--primary-blue);
            flex-shrink: 0;
        }
        
        .author-info {
            flex: 1;
        }
        
        .author-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .author-credentials {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .credential-badge {
            background: var(--bg-light);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .credential-badge.verified {
            background: #d4edda;
            color: #155724;
        }
        
        .credential-badge.unverified {
            background: #f8d7da;
            color: #721c24;
        }
        
        .author-social-links {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .social-link {
            width: 36px;
            height: 36px;
            background: var(--bg-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .social-link:hover {
            background: var(--primary-blue);
            color: white;
            transform: translateY(-2px);
        }
        
        .author-articles {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        .author-articles h5 {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .recent-articles {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .recent-article {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .recent-article-title {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-right: 10px;
        }
        
        .recent-article-date {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Fact Check Visualization */
        .fact-check-summary {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        
        .fact-check-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .fact-stat {
            text-align: center;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .fact-stat:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .fact-stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .fact-stat.verified .fact-stat-icon {
            color: var(--success-color);
        }
        
        .fact-stat.false .fact-stat-icon {
            color: var(--danger-color);
        }
        
        .fact-stat.unverified .fact-stat-icon {
            color: var(--warning-color);
        }
        
        .fact-stat-number {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .fact-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .fact-check-chart-container {
            height: 300px;
            margin: 30px 0;
        }
        
        .claim-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .claim-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
        }
        
        .claim-card.verified::before {
            background: var(--success-color);
        }
        
        .claim-card.false::before {
            background: var(--danger-color);
        }
        
        .claim-card.unverified::before {
            background: var(--warning-color);
        }
        
        .claim-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .claim-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .claim-text {
            flex: 1;
            font-size: 16px;
            color: var(--text-primary);
            line-height: 1.6;
            margin-right: 20px;
        }
        
        .claim-verdict {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .verdict-verified {
            background: #d4edda;
            color: #155724;
        }
        
        .verdict-false {
            background: #f8d7da;
            color: #721c24;
        }
        
        .verdict-unverified {
            background: #fff3cd;
            color: #856404;
        }
        
        .claim-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        
        .claim-explanation {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .claim-sources {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .claim-source {
            background: var(--bg-light);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .claim-source:hover {
            background: var(--primary-blue);
            color: white;
        }
        
        .claim-confidence {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .confidence-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .confidence-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: var(--primary-gradient);
            transition: width 0.6s ease;
        }
        
        .confidence-percentage {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-blue);
        }

        /* Source Diversity Visualization */
        .diversity-visualization {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        
        .source-network {
            height: 400px;
            background: var(--bg-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .source-node {
            position: absolute;
            width: 80px;
            height: 80px;
            background: white;
            border: 3px solid var(--primary-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .source-node:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .source-node.primary {
            width: 100px;
            height: 100px;
            background: var(--primary-gradient);
            color: white;
            font-size: 16px;
        }
        
        .source-connection {
            position: absolute;
            height: 2px;
            background: #e5e7eb;
            transform-origin: left center;
        }
        
        .coverage-timeline {
            margin-top: 30px;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .timeline-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .timeline-filter {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 6px 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: transparent;
        }
        
        .timeline-container {
            position: relative;
            padding: 20px 0;
        }
        
        .timeline-line {
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e5e7eb;
        }
        
        .timeline-item {
            position: relative;
            padding-left: 60px;
            margin-bottom: 30px;
        }
        
        .timeline-dot {
            position: absolute;
            left: 20px;
            top: 5px;
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid var(--primary-blue);
            border-radius: 50%;
        }
        
        .timeline-content {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 10px;
        }
        
        .timeline-source {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }
        
        .timeline-time {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Bias Visualization Enhanced */
        .bias-visualization {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        
        .bias-spectrum {
            position: relative;
            height: 60px;
            background: linear-gradient(to right, 
                #3b82f6 0%, 
                #60a5fa 25%, 
                #e5e7eb 45%, 
                #e5e7eb 55%, 
                #f87171 75%, 
                #ef4444 100%);
            border-radius: 30px;
            margin: 30px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .bias-marker {
            position: absolute;
            top: -10px;
            width: 80px;
            height: 80px;
            background: white;
            border: 4px solid #1f2937;
            border-radius: 50%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transform: translateX(-50%);
            transition: left 1s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .bias-marker-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .bias-marker-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        .bias-scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 0 10px;
        }
        
        .bias-scale-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .bias-examples {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .bias-example-card {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .bias-example-type {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-blue);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        
        .bias-example-text {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.6;
            font-style: italic;
        }
        
        .bias-example-explanation {
            margin-top: 10px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* AI Detection Enhanced */
        .ai-detection-panel {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.2);
        }
        
        .ai-probability-meter {
            width: 100%;
            max-width: 500px;
            margin: 30px auto;
            text-align: center;
        }
        
        .ai-probability-bar {
            height: 40px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .ai-probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            transition: width 1s ease;
            position: relative;
        }
        
        .ai-probability-marker {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translate(50%, -50%);
            width: 50px;
            height: 50px;
            background: white;
            border: 3px solid #1f2937;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .ai-indicators {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .ai-indicator {
            background: white;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .ai-indicator-icon {
            width: 40px;
            height: 40px;
            background: var(--bg-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .ai-indicator.detected .ai-indicator-icon {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .ai-indicator.not-detected .ai-indicator-icon {
            background: #d1fae5;
            color: #059669;
        }
        
        .ai-indicator-text {
            flex: 1;
        }
        
        .ai-indicator-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .ai-indicator-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Sticky Upgrade Button Enhanced */
        .sticky-upgrade {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        
        .upgrade-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .upgrade-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            animation: shimmer-rotate 3s linear infinite;
        }
        
        @keyframes shimmer-rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .upgrade-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(74, 144, 226, 0.5);
        }
        
        .upgrade-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ef4444;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        /* Tooltips Enhanced */
        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip-icon {
            width: 20px;
            height: 20px;
            background: #e5e7eb;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #6b7280;
            margin-left: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .tooltip-icon:hover {
            background: var(--primary-blue);
            color: white;
            transform: scale(1.1);
        }
        
        .tooltip-content {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: #1f2937;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            margin-bottom: 5px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            max-width: 300px;
            white-space: normal;
            z-index: 1000;
        }
        
        .tooltip-container:hover .tooltip-content {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1f2937;
        }

        /* News container and general layout */
        .news-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 100px; /* Account for fixed header and progress bar */
        }

        /* Header styling enhanced */
        .news-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 50px 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        .news-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-gradient);
        }

        .news-header::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74, 144, 226, 0.05) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .news-header h1 {
            font-size: 3em;
            margin-bottom: 20px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .news-header p {
            font-size: 1.3em;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto 25px;
            line-height: 1.7;
            position: relative;
            z-index: 1;
        }

        .header-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            position: relative;
            z-index: 1;
        }

        .header-stat {
            text-align: center;
        }

        .header-stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-blue);
            display: block;
        }

        .header-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Input Section Enhanced */
        .input-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }
        
        .input-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(74, 144, 226, 0.03) 50%, 
                transparent 70%);
            animation: wave 10s linear infinite;
        }
        
        @keyframes wave {
            from { transform: translateX(-50%) translateY(-50%) rotate(0deg); }
            to { transform: translateX(-50%) translateY(-50%) rotate(360deg); }
        }
        
        .input-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }
        
        .input-tab {
            flex: 1;
            padding: 15px;
            background: var(--bg-light);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .input-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            transition: left 0.3s ease;
            z-index: -1;
        }
        
        .input-tab:hover::before {
            left: 0;
        }
        
        .input-tab:hover {
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.3);
        }
        
        .input-tab.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.3);
        }
        
        .input-tab.active::before {
            left: 0;
        }
        
        .input-field {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            position: relative;
            z-index: 1;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
            transform: translateY(-2px);
        }
        
        textarea.input-field {
            min-height: 180px;
            resize: vertical;
            font-family: inherit;
        }
        
        .input-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            font-size: 14px;
            color: var(--text-secondary);
            position: relative;
            z-index: 1;
        }
        
        .input-hint i {
            color: var(--primary-blue);
        }
        
        .analyze-button {
            width: 100%;
            padding: 18px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 25px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .analyze-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .analyze-button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .analyze-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.4);
        }
        
        .analyze-button:active {
            transform: translateY(-1px);
        }
        
        .analyze-button.loading {
            pointer-events: none;
            opacity: 0.8;
        }
        
        .analyze-button.loading i {
            animation: spin 1s linear infinite;
        }

        /* Enhanced Error Container */
        .error-container {
            display: none;
            background: #fef2f2;
            border: 2px solid #fecaca;
            border-radius: 15px;
            padding: 40px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .error-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(239, 68, 68, 0.05) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        .error-icon {
            font-size: 4em;
            color: var(--danger-color);
            margin-bottom: 20px;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .error-container h3 {
            color: var(--danger-color);
            margin-bottom: 15px;
            font-size: 1.8em;
            font-weight: 600;
        }
        
        .error-container p {
            color: #991b1b;
            margin-bottom: 25px;
            line-height: 1.7;
            font-size: 16px;
        }
        
        .error-suggestions {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .error-suggestions h4 {
            color: #742a2a;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .error-suggestions ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .error-suggestions li {
            padding: 12px 0 12px 40px;
            position: relative;
            color: #5a2121;
            line-height: 1.6;
            border-bottom: 1px solid #fecaca;
        }
        
        .error-suggestions li:last-child {
            border-bottom: none;
        }
        
        .error-suggestions li:before {
            content: "â†’";
            position: absolute;
            left: 15px;
            color: var(--danger-color);
            font-weight: bold;
            font-size: 18px;
        }
        
        .error-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .error-btn {
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .retry-btn {
            background: var(--danger-color);
            color: white;
        }
        
        .retry-btn:hover {
            background: #c53030;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }
        
        .alternate-btn {
            background: var(--primary-blue);
            color: white;
        }
        
        .alternate-btn:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }

        /* Results Section Enhanced */
        .results-section {
            display: none;
            margin-top: 50px;
            animation: fadeInUp 0.6s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .results-header {
            background: var(--primary-gradient);
            color: white;
            padding: 40px;
            border-radius: 20px 20px 0 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .results-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        .results-header h2 {
            font-size: 2.5em;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .results-header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .results-content {
            background: var(--bg-light);
            border-radius: 0 0 20px 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        
        /* Analysis Sections Enhanced */
        .analysis-section {
            background: white;
            border-radius: 15px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .analysis-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .section-header {
            padding: 25px 30px;
            cursor: pointer;
            background: white;
            border-left: 5px solid var(--primary-blue);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-header:hover {
            background: var(--bg-light);
        }
        
        .section-header.active {
            background: var(--bg-light);
            border-left-color: var(--primary-blue-dark);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .section-title i {
            font-size: 24px;
            color: var(--primary-blue);
        }
        
        .section-toggle {
            font-size: 20px;
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }
        
        .section-header.active .section-toggle {
            transform: rotate(180deg);
        }
        
        .section-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }
        
        .section-content.show {
            max-height: none;
            padding: 30px;
        }
        
        /* Section-specific border colors */
        .section-trust { border-left-color: #10b981; }
        .section-bias { border-left-color: #f59e0b; }
        .section-fact { border-left-color: #3b82f6; }
        .section-author { border-left-color: #8b5cf6; }
        .section-quality { border-left-color: #ec4899; }
        .section-agenda { border-left-color: #ef4444; }
        .section-clickbait { border-left-color: #f97316; }
        .section-emotion { border-left-color: #06b6d4; }
        .section-diversity { border-left-color: #84cc16; }
        .section-time { border-left-color: var(--primary-blue); }
        .section-ai { border-left-color: #14b8a6; }

        /* AI Insight Boxes Enhanced */
        .ai-insight-box {
            background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
            border: 2px solid var(--primary-blue);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
            overflow: hidden;
        }
        
        .ai-insight-box::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74, 144, 226, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        .ai-insight-box h4 {
            color: var(--primary-blue-dark);
            margin: 0 0 15px 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
        }
        
        .ai-insight-box h4 i {
            font-size: 24px;
            color: var(--primary-blue);
            animation: pulse 2s infinite;
        }
        
        .ai-insight-box p {
            color: var(--text-primary);
            margin: 0;
            font-size: 16px;
            line-height: 1.8;
            position: relative;
            z-index: 1;
        }
        
        .ai-insight-box ul {
            margin: 15px 0 0 0;
            padding-left: 25px;
            position: relative;
            z-index: 1;
        }
        
        .ai-insight-box li {
            color: var(--text-primary);
            margin: 10px 0;
            font-size: 16px;
            line-height: 1.7;
        }
        
        .insight-highlight {
            background: rgba(74, 144, 226, 0.15);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: 600;
            color: var(--primary-blue-dark);
        }

        /* Why This Matters Boxes */
        .why-matters-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .why-matters-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(251, 191, 36, 0.1) 0%, transparent 70%);
            animation: rotate 25s linear infinite reverse;
        }
        
        .why-matters-box h4 {
            color: #92400e;
            margin: 0 0 12px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }
        
        .why-matters-box p {
            color: #78350f;
            margin: 0;
            font-size: 15px;
            line-height: 1.7;
            position: relative;
            z-index: 1;
        }

        /* Methodology Snippets */
        .methodology-snippet {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            border: 2px solid #a78bfa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            color: #5b21b6;
            position: relative;
            overflow: hidden;
        }
        
        .methodology-snippet::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .methodology-snippet code {
            background: #c7d2fe;
            padding: 3px 8px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #4c1d95;
        }

        /* What This Means / How Detected Boxes */
        .explanation-box {
            background: var(--bg-light);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .explanation-box h5 {
            color: var(--primary-blue);
            margin: 0 0 12px 0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .explanation-box p {
            color: var(--text-primary);
            margin: 0;
            font-size: 15px;
            line-height: 1.7;
        }

        /* Mobile Responsive Enhancements */
        @media (max-width: 768px) {
            .news-container {
                padding: 15px;
                padding-top: 140px;
            }
            
            .news-header h1 {
                font-size: 2em;
            }
            
            .header-stats {
               flex-direction: column;
                gap: 20px;
            }
            
            .trust-meter-container {
                width: 250px;
                height: 250px;
            }
            
            .trust-score {
                font-size: 48px;
            }
            
            .progress-stages {
                display: none;
            }
            
            .source-comparison-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bias-spectrum {
                height: 50px;
            }
            
            .bias-marker {
                width: 60px;
                height: 60px;
            }
            
            .sticky-upgrade {
                bottom: 20px;
                right: 20px;
            }
            
            .upgrade-button {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .analysis-section {
                margin-bottom: 15px;
            }
            
            .section-header {
                padding: 20px;
            }
            
            .section-title {
                font-size: 18px;
            }
            
            .ai-insight-box h4 {
                font-size: 18px;
            }
            
            .error-container {
                padding: 30px 20px;
            }
            
            .error-icon {
                font-size: 3em;
            }
            
            .gauge-container {
                width: 250px;
                height: 125px;
            }
            
            .author-card {
                flex-direction: column;
                text-align: center;
            }
            
            .timeline-item {
                padding-left: 50px;
            }
            
            .source-network {
                height: 300px;
            }
            
            .ai-indicators {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .input-tabs {
                flex-direction: column;
                gap: 10px;
            }
            
            .source-comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .score-factors {
                grid-template-columns: 1fr;
            }
            
            .bias-examples {
                grid-template-columns: 1fr;
            }
            
            .fact-check-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Print styles for PDF generation */
        @media print {
            body {
                font-size: 12pt;
                line-height: 1.5;
            }
            
            .sticky-upgrade,
            .navigation,
            .analyze-button,
            .input-section,
            .error-container {
                display: none !important;
            }
            
            .analysis-section {
                page-break-inside: avoid;
                margin-bottom: 20px;
            }
            
            .section-content {
                max-height: none !important;
                padding: 20px !important;
                display: block !important;
            }
            
            .ai-insight-box {
                background: #f0f4ff !important;
                border: 2px solid #4a90e2 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .trust-meter-container {
                width: 200px;
                height: 200px;
                margin: 20px auto;
            }
        }

        /* Loading states */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-text {
            height: 20px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .skeleton-title {
            height: 30px;
            width: 60%;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .skeleton-box {
            height: 150px;
            border-radius: 10px;
            margin: 20px 0;
        }

        /* Animations */
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease;
        }
        
        .slide-in-left {
            animation: slideInLeft 0.6s ease;
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s ease;
        }

        /* Utility classes */
        .text-success { color: var(--success-color); }
        .text-warning { color: var(--warning-color); }
        .text-danger { color: var(--danger-color); }
        .text-primary { color: var(--primary-blue); }
        .text-secondary { color: var(--text-secondary); }
        
        .bg-success { background-color: var(--success-color); }
        .bg-warning { background-color: var(--warning-color); }
        .bg-danger { background-color: var(--danger-color); }
        .bg-primary { background-color: var(--primary-blue); }
        
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .mt-5 { margin-top: 3rem; }
        
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mb-5 { margin-bottom: 3rem; }
        
        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }
        .p-3 { padding: 1.5rem; }
        .p-4 { padding: 2rem; }
        .p-5 { padding: 3rem; }
        
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-normal { font-weight: 400; }
        
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }
        
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
    .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }

        /* Missing CSS Classes */
        .pdf-button {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pdf-button:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-2px);
        }

        .analysis-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 10px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .learn-more-link {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .learn-more-link:hover {
            color: var(--primary-blue-dark);
            transform: translateX(5px);
        }

        .verification-sources-grid,
        .clickbait-patterns-grid,
        .agenda-tactics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .verification-source,
        .clickbait-pattern,
        .agenda-tactic {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--bg-light);
            border-radius: 8px;
            font-size: 14px;
        }

        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .emotion-item {
            text-align: center;
        }

        .emotion-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .emotion-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .emotion-fill {
            height: 100%;
            transition: width 0.6s ease;
        }

        .emotion-value {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .ai-pattern-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    
    <!-- Facts & Fakes AI Navigation Header --> 
    <style>
    /* Reset any conflicting styles */
    .ff-nav * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    /* Main navigation bar */
    .ff-nav {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 9999;
        height: 60px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    .ff-nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
    }

    /* Logo */
    .ff-nav-logo {
        display: flex;
        align-items: center;
        gap: 12px;
        text-decoration: none;
        color: #4a90e2;
        font-weight: 700;
        font-size: 1.15rem;
        transition: all 0.3s ease;
        position: relative;
    }

    .ff-nav-logo:hover {
        transform: scale(1.05);
        color: #357abd;
    }

    .ff-nav-logo i {
        font-size: 1.5rem;
        background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .ff-nav-logo span {
        background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Navigation links */
    .ff-nav-links {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .ff-nav-link {
        color: #2c3e50;
        text-decoration: none;
        padding: 10px 18px;
        border-radius: 10px;
        transition: all 0.3s ease;
        font-weight: 500;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
    }

    .ff-nav-link::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(74, 144, 226, 0.1), transparent);
        transition: left 0.5s ease;
    }

    .ff-nav-link:hover::before {
        left: 100%;
    }

    .ff-nav-link:hover {
        background: rgba(74, 144, 226, 0.08);
        color: #4a90e2;
        transform: translateY(-1px);
    }

    .ff-nav-link.active {
        background: linear-gradient(135deg, rgba(74, 144, 226, 0.15) 0%, rgba(53, 122, 189, 0.15) 100%);
        color: #4a90e2;
        font-weight: 600;
    }

    .ff-nav-link i {
        font-size: 1rem;
        opacity: 0.8;
    }

    /* Auth buttons */
    .ff-nav-auth {
        display: flex;
        gap: 12px;
        align-items: center;
        position: relative;
    }

    .ff-nav-login, .ff-nav-signup {
        padding: 10px 24px;
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .ff-nav-login {
        color: #4a90e2;
        border: 2px solid #4a90e2;
        background: transparent;
    }

    .ff-nav-login:hover {
        background: #4a90e2;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
    }

    .ff-nav-signup {
        background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        color: white;
        border: 2px solid transparent;
        box-shadow: 0 4px 15px rgba(74, 144, 226, 0.25);
    }

    .ff-nav-signup::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }

    .ff-nav-signup:hover::before {
        width: 300px;
        height: 300px;
    }

    .ff-nav-signup:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(74, 144, 226, 0.35);
    }

    /* Beta balloon */
    .ff-beta-balloon {
        position: absolute;
        top: -40px;
        right: 60px;
        background: linear-gradient(135deg, #ff6b35, #f7931e);
        color: white;
        padding: 8px 16px;
        border-radius: 25px;
        font-size: 0.8rem;
        font-weight: 600;
        white-space: nowrap;
        animation: ff-float 3s ease-in-out infinite;
        box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
        letter-spacing: 0.5px;
    }

    .ff-beta-balloon::after {
        content: '';
        position: absolute;
        bottom: -8px;
        right: 25px;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 8px solid #f7931e;
    }

    @keyframes ff-float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
    }

    /* User menu */
    .ff-user-menu {
        position: relative;
        display: none;
    }

    .ff-user-menu-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 20px;
        background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(53, 122, 189, 0.1) 100%);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #2c3e50;
        font-weight: 500;
        font-size: 0.95rem;
        border: 1px solid transparent;
    }

    .ff-user-menu-toggle:hover {
        background: linear-gradient(135deg, rgba(74, 144, 226, 0.2) 0%, rgba(53, 122, 189, 0.2) 100%);
        border-color: rgba(74, 144, 226, 0.3);
    }

    .ff-user-avatar {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
    }

    .ff-user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 12px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(0, 0, 0, 0.08);
        min-width: 300px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .ff-user-dropdown.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .ff-user-dropdown-header {
        padding: 20px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-bottom: 1px solid #e2e8f0;
    }

    .ff-user-dropdown-email {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 4px;
        font-size: 0.95rem;
    }

    .ff-user-dropdown-plan {
        font-size: 0.85rem;
        color: #4a90e2;
        font-weight: 500;
    }

    .ff-user-dropdown-usage {
        padding: 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e2e8f0;
    }

    .ff-usage-label {
        font-size: 0.85rem;
        color: #718096;
        margin-bottom: 10px;
        font-weight: 500;
    }

    .ff-usage-bar {
        background: #e2e8f0;
        height: 10px;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 8px;
    }

    .ff-usage-fill {
        height: 100%;
        background: linear-gradient(135deg, #4a90e2, #357abd);
        transition: width 0.5s ease;
        border-radius: 5px;
    }

    .ff-usage-text {
        font-size: 0.85rem;
        color: #4a5568;
        display: flex;
        justify-content: space-between;
    }

    .ff-user-dropdown-links {
        padding: 10px 0;
    }

    .ff-user-dropdown-link {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 20px;
        color: #2c3e50;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 0.95rem;
    }

    .ff-user-dropdown-link:hover {
        background: rgba(74, 144, 226, 0.08);
        color: #4a90e2;
    }

    .ff-user-dropdown-link i {
        width: 20px;
        text-align: center;
        opacity: 0.7;
    }

    .ff-user-dropdown-divider {
        height: 1px;
        background: #e2e8f0;
        margin: 10px 0;
    }

    /* Mobile menu button */
    .ff-mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        color: #2c3e50;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 10px;
        transition: all 0.3s ease;
        border-radius: 8px;
    }

    .ff-mobile-menu-btn:hover {
        background: rgba(74, 144, 226, 0.08);
        color: #4a90e2;
    }

    /* Mobile responsive */
    @media (max-width: 968px) {
        .ff-nav-links {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            flex-direction: column;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border-top: 1px solid #e2e8f0;
            gap: 5px;
        }
        
        .ff-nav-links.active {
            display: flex;
        }
        
        .ff-nav-link {
            width: 100%;
            padding: 14px 20px;
            justify-content: flex-start;
        }
        
        .ff-mobile-menu-btn {
            display: block;
        }
        
        .ff-nav-auth {
            display: none;
        }
        
        .ff-user-menu {
            display: none !important;
        }
        
        .ff-beta-balloon {
            display: none;
        }
    }

    @media (max-width: 768px) {
        .ff-nav-logo span {
            display: none;
        }
        
        .ff-nav-logo i {
            font-size: 1.8rem;
        }
    }
    </style>

    <nav class="ff-nav">
        <div class="ff-nav-container">
            <a href="/" class="ff-nav-logo">
                <i class="fas fa-shield-alt"></i>
                <span>Facts & Fakes AI</span>
            </a>
            
            <div class="ff-nav-links" id="ffNavLinks">
                <a href="/" class="ff-nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/news" class="ff-nav-link active"><i class="fas fa-newspaper"></i> News Verify</a>
                <a href="/speech" class="ff-nav-link"><i class="fas fa-microphone"></i> Speech Check</a>
                <a href="/unified" class="ff-nav-link"><i class="fas fa-search"></i> Content Check</a>
                <a href="/imageanalysis" class="ff-nav-link"><i class="fas fa-image"></i> Image Analysis</a>
                <a href="/missionstatement" class="ff-nav-link"><i class="fas fa-bullseye"></i> Mission</a>
                <a href="/pricingplan" class="ff-nav-link"><i class="fas fa-tags"></i> Pricing</a>
                <a href="/contact" class="ff-nav-link"><i class="fas fa-envelope"></i> Contact</a>
            </div>
            
            <div class="ff-nav-auth" id="ffNavAuth">
                <a href="/login" class="ff-nav-login">Login</a>
                <a href="/pricingplan" class="ff-nav-signup">Sign Up</a>
                <div class="ff-beta-balloon">
                    ðŸŽ‰ Start your free trial today!
                </div>
            </div>
            
            <div class="ff-user-menu" id="ffUserMenu">
                <div class="ff-user-menu-toggle" onclick="ffToggleUserDropdown()">
                    <div class="ff-user-avatar" id="ffUserAvatar">U</div>
                    <span id="ffUserEmail">user@example.com</span>
                    <i class="fas fa-chevron-down" style="font-size: 12px; opacity: 0.6;"></i>
                </div>
                <div class="ff-user-dropdown" id="ffUserDropdown">
                    <div class="ff-user-dropdown-header">
                        <div class="ff-user-dropdown-email" id="ffUserEmailDropdown">user@example.com</div>
                        <div class="ff-user-dropdown-plan" id="ffUserPlan">Free Plan</div>
                    </div>
                    <div class="ff-user-dropdown-usage">
                        <div class="ff-usage-label">Daily Analysis Usage</div>
                        <div class="ff-usage-bar">
                            <div class="ff-usage-fill" id="ffUsageProgress" style="width: 0%;"></div>
                        </div>
                        <div class="ff-usage-text">
                            <span id="ffUsageText">0 / 5 analyses used</span>
                            <span id="ffUsagePercent">0%</span>
                        </div>
                    </div>
                    <div class="ff-user-dropdown-links">
                        <a href="/dashboard" class="ff-user-dropdown-link">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                        <a href="/account" class="ff-user-dropdown-link">
                            <i class="fas fa-user-cog"></i> Account Settings
                        </a>
                        <a href="/billing" class="ff-user-dropdown-link">
                            <i class="fas fa-credit-card"></i> Billing & Plans
                        </a>
                        <a href="/api-keys" class="ff-user-dropdown-link">
                            <i class="fas fa-key"></i> API Keys
                        </a>
                        <div class="ff-user-dropdown-divider"></div>
                        <a href="#" onclick="ffLogout(event)" class="ff-user-dropdown-link" style="color: #e74c3c;">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
            
            <button class="ff-mobile-menu-btn" onclick="ffToggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <script>
    // Enhanced navigation with better auth handling
    window.ffNav = {
        checkAuthStatus: async function() {
            try {
                const response = await fetch('/api/user/status', {
                    credentials: 'include'
                });
                
                if (!response.ok || !response.headers.get('content-type')?.includes('application/json')) {
                    return;
                }
                
                const data = await response.json();
                
                if (data.authenticated) {
                    document.getElementById('ffNavAuth').style.display = 'none';
                    document.getElementById('ffUserMenu').style.display = 'block';
                    
                    // Set user info
                    const email = data.email || 'User';
                    const initials = email.charAt(0).toUpperCase();
                    
                    document.getElementById('ffUserAvatar').textContent = initials;
                    document.getElementById('ffUserEmail').textContent = email;
                    document.getElementById('ffUserEmailDropdown').textContent = email;
                    document.getElementById('ffUserPlan').textContent = data.plan === 'pro' ? 'Pro Plan' : 'Free Plan';
                    
                    // Update usage
                    const usagePercent = Math.round((data.usage_today / data.daily_limit) * 100);
                    document.getElementById('ffUsageProgress').style.width = usagePercent + '%';
                    document.getElementById('ffUsageText').textContent = `${data.usage_today} / ${data.daily_limit} analyses used`;
                    document.getElementById('ffUsagePercent').textContent = usagePercent + '%';
                    
                    // Color code usage bar
                    const usageFill = document.getElementById('ffUsageProgress');
                    if (usagePercent >= 90) {
                        usageFill.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                    } else if (usagePercent >= 70) {
                        usageFill.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                    }
                }
            } catch (error) {
                console.log('Auth check skipped:', error.message);
            }
        },
        
        init: function() {
            this.checkAuthStatus();
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const userMenu = document.querySelector('.ff-user-menu');
                if (userMenu && !userMenu.contains(event.target)) {
                    document.getElementById('ffUserDropdown').classList.remove('active');
                }
            });
            
            // Add active class to current page
            const currentPath = window.location.pathname;
            document.querySelectorAll('.ff-nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });
        }
    };

    // Global functions for onclick handlers
    function ffToggleMobileMenu() {
        const navLinks = document.getElementById('ffNavLinks');
        navLinks.classList.toggle('active');
    }

    function ffToggleUserDropdown() {
        const dropdown = document.getElementById('ffUserDropdown');
        dropdown.classList.toggle('active');
    }

    async function ffLogout(event) {
        event.preventDefault();
        try {
            await fetch('/api/logout', { 
                method: 'POST',
                credentials: 'include'
            });
            window.location.href = '/';
        } catch (error) {
            console.error('Logout failed:', error);
            window.location.href = '/';
        }
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            window.ffNav.init();
        });
    } else {
        window.ffNav.init();
    }
    </script>

    <!-- Main container -->
    <div class="news-container">
        <!-- Header Section -->
        <div class="news-header">
            <h1>
                <i class="fas fa-newspaper"></i>
                Advanced News Analyzer
            </h1>
            <p>
                AI-powered news verification with real-time fact-checking and bias detection
                <span class="tooltip-container">
                    <span class="tooltip-icon">?</span>
                    <span class="tooltip-content">
                        Our AI analyzes 15+ factors including source credibility, writing patterns, 
                        bias indicators, and cross-references with multiple fact-checking databases.
                    </span>
                </span>
            </p>
            
            <div class="header-stats">
                <div class="header-stat">
                    <span class="header-stat-number">1M+</span>
                    <span class="header-stat-label">Articles Analyzed</span>
                </div>
                <div class="header-stat">
                    <span class="header-stat-number">95%</span>
                    <span class="header-stat-label">Accuracy Rate</span>
                </div>
                <div class="header-stat">
                    <span class="header-stat-number">50K+</span>
                    <span class="header-stat-label">Sources Tracked</span>
                </div>
            </div>
            
            <button class="btn btn-outline-primary mt-3" onclick="showAnalysisProcess()" style="position: relative; z-index: 1;">
                <i class="fas fa-info-circle me-2"></i>View Our Analysis Process
            </button>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <div class="input-tabs">
                <div class="input-tab active" onclick="switchInputType('url')">
                    <i class="fas fa-link"></i>Analyze URL
                </div>
                <div class="input-tab" onclick="switchInputType('text')">
                    <i class="fas fa-file-alt"></i>Paste Text
                </div>
            </div>
            
            <div id="url-input-section">
                <input type="url" id="news-url" class="input-field" placeholder="https://example.com/article" />
                <div class="input-hint">
                    <i class="fas fa-info-circle"></i>
                    We'll extract the full article, metadata, and verify the source
                </div>
                <div class="input-hint text-success">
                    <i class="fas fa-shield-alt"></i>
                    <strong>Enhanced:</strong> Our system now uses multiple extraction methods to handle even protected news sites.
                </div>
            </div>
            
            <div id="text-input-section" style="display: none;">
                <textarea id="news-text" class="input-field" placeholder="Paste the article text here..."></textarea>
                <div class="input-hint">
                    <i class="fas fa-info-circle"></i>
                    Include the headline and author if available for best results
                </div>
            </div>
            
            <button class="analyze-button" onclick="analyzeArticle()">
                <i class="fas fa-search"></i>Analyze Now
            </button>
        </div>

        <!-- Enhanced Progress Section -->
        <div class="analysis-progress-container" id="progress-container">
            <div class="progress-wrapper">
                <div class="progress-header">
                    <div class="progress-stage">
                        <div class="stage-icon">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <span id="progress-stage-text">Initializing analysis...</span>
                    </div>
                    <div class="progress-percentage" id="progress-percentage">0%</div>
                </div>
                
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%"></div>
                </div>
                
                <div class="progress-stages">
                    <div class="progress-stage-item" id="stage-1">
                        <div class="progress-stage-dot">1</div>
                        <div class="progress-stage-label">Extract</div>
                    </div>
                    <div class="progress-stage-item" id="stage-2">
                        <div class="progress-stage-dot">2</div>
                        <div class="progress-stage-label">Analyze</div>
                    </div>
                    <div class="progress-stage-item" id="stage-3">
                        <div class="progress-stage-dot">3</div>
                        <div class="progress-stage-label">Fact-Check</div>
                    </div>
                    <div class="progress-stage-item" id="stage-4">
                        <div class="progress-stage-dot">4</div>
                        <div class="progress-stage-label">Verify</div>
                    </div>
                    <div class="progress-stage-item" id="stage-5">
                        <div class="progress-stage-dot">5</div>
                        <div class="progress-stage-label">Score</div>
                    </div>
                    <div class="progress-stage-item" id="stage-6">
                        <div class="progress-stage-dot">6</div>
                        <div class="progress-stage-label">Report</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="results-section">
            <div class="results-header">
                <h2>Analysis Complete</h2>
                <p>Here's what our AI discovered about this article</p>
            </div>
            
            <div class="results-content">
                <!-- Analysis Metadata -->
                <div class="analysis-meta">
                    <div class="meta-item">
                        <i class="fas fa-clock"></i>
                        <span>Analyzed: <span id="analysis-time"></span></span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-code-branch"></i>
                        <span>Model: GPT-4 + Custom AI</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-fingerprint"></i>
                        <span>ID: <span id="analysis-id"></span></span>
                    </div>
                    <div class="meta-item">
                        <button class="pdf-button" onclick="generatePDF()">
                            <i class="fas fa-file-pdf"></i>Download Report
                        </button>
                    </div>
                </div>

                <!-- Trust Score Section -->
                <div class="trust-meter-section">
                    <div class="trust-meter-container">
                        <div class="trust-meter">
                            <svg class="trust-meter-circle" viewBox="0 0 200 200">
                                <circle class="trust-meter-bg" cx="100" cy="100" r="90"/>
                                <circle class="trust-meter-fill" cx="100" cy="100" r="90"
                                        stroke-dasharray="565.48" stroke-dashoffset="565.48"/>
                            </svg>
                            <div class="trust-meter-text">
                                <span class="trust-score" id="trust-score">0</span>
                                <span class="trust-label">Trust Score</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="trust-score-interpretation" id="trust-interpretation">
                        <h4>What This Score Means</h4>
                        <p id="trust-explanation"></p>
                        
                        <div class="score-factors">
                            <div class="score-factor">
                                <div class="score-factor-label">Source Credibility</div>
                                <div class="score-factor-value" id="factor-source">--</div>
                            </div>
                            <div class="score-factor">
                                <div class="score-factor-label">Factual Accuracy</div>
                                <div class="score-factor-value" id="factor-facts">--</div>
                            </div>
                            <div class="score-factor">
                                <div class="score-factor-label">Bias Level</div>
                                <div class="score-factor-value" id="factor-bias">--</div>
                            </div>
                            <div class="score-factor">
                                <div class="score-factor-label">Writing Quality</div>
                                <div class="score-factor-value" id="factor-quality">--</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Overall Assessment -->
                <div class="analysis-section section-trust">
                    <div class="section-header active" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-chart-pie"></i>
                            Overall Assessment
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content show">
                        <div id="overall-assessment"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-robot"></i>AI Deep Insight</h4>
                            <p id="overall-ai-insight">Loading comprehensive analysis...</p>
                        </div>
                        
                        <div class="why-matters-box">
                            <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                            <p id="why-overall-matters">
                                Understanding the overall credibility helps you make informed decisions about 
                                sharing, citing, or acting on this information. High credibility means the article 
                                is more likely to be factual and trustworthy.
                            </p>
                        </div>
                        
                        <div class="confidence-analysis mt-4">
                            <h5>Confidence Level
                                <span class="tooltip-container">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-content">
                                        Our confidence in this assessment based on available data and analysis certainty
                                    </span>
                                </span>
                            </h5>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="overall-confidence" style="width: 0%"></div>
                            </div>
                            <div class="confidence-percentage" id="overall-confidence-text">0%</div>
                        </div>
                        
                        <div class="key-findings mt-4">
                            <h5>Key Findings:</h5>
                            <ul id="key-findings-list"></ul>
                        </div>
                        
                        <div class="red-flags mt-3">
                            <h5>Red Flags:</h5>
                            <ul id="red-flags-list"></ul>
                        </div>
                        
                        <a href="#" class="learn-more-link mt-3" onclick="showMethodology(event)">
                            Learn about our methodology <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>

                <!-- Source Credibility -->
                <div class="analysis-section section-author">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-globe"></i>
                            Source Credibility & Comparison
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div id="source-credibility"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="source-ai-insight">Loading source analysis...</p>
                        </div>
                        
                        <h5 class="mt-4">How This Source Compares</h5>
                        <div class="source-comparison-grid" id="source-comparison">
                            <!-- Dynamically populated -->
                        </div>
                        
                        <div class="source-history-chart mt-4" style="max-width: 600px; height: 250px;">
    <h5>Historical Accuracy Trend</h5>
    <canvas id="source-history-chart"></canvas>
</div>
                        
                        <div class="methodology-snippet">
                            <strong>How we calculate this:</strong> Source credibility = 
                            <code>0.4 Ã— historical_accuracy + 0.3 Ã— transparency + 0.2 Ã— corrections_policy + 0.1 Ã— awards</code>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="source-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="source-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Author Credibility -->
                <div class="analysis-section section-author">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-user-check"></i>
                            Author Credibility & Background
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div id="author-section">
                            <!-- Author card will be dynamically populated -->
                        </div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="author-ai-insight">Loading author analysis...</p>
                        </div>
                        
                        <div class="why-matters-box">
                            <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                            <p>
                                Authors with established expertise and transparent backgrounds are more likely 
                                to produce accurate, well-researched content. Anonymous or unverifiable authors 
                                should be approached with more skepticism.
                            </p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="author-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="author-methodology"></p>
                        </div>
                    </div>
                </div>
                <!-- Writing Quality -->
                <div class="analysis-section section-quality">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-pen-fancy"></i>
                            Writing Quality & Professionalism
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div id="writing-quality"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="quality-ai-insight">Loading quality analysis...</p>
                        </div>
                        
                        <div class="quality-metrics mt-4">
                            <h5>Quality Metrics</h5>
                            <canvas id="quality-radar-chart" width="300" height="300"></canvas>
                        </div>
                        
                        <div class="methodology-snippet">
                            <strong>Analysis includes:</strong> Grammar scoring, readability index (Flesch-Kincaid), 
                            vocabulary diversity, sentence structure variation, and professional tone markers.
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="quality-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="quality-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Fact-Checking -->
                <div class="analysis-section section-fact">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-check-double"></i>
                            Fact-Checking Results
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div class="fact-check-summary">
                            <div class="fact-check-stats" id="fact-check-stats">
                                <!-- Dynamically populated -->
                            </div>
                            
                            <div class="fact-check-chart-container">
                                <canvas id="fact-check-chart"></canvas>
                            </div>
                        </div>
                        
                        <div id="fact-checking-details">
                            <!-- Claims will be populated here -->
                        </div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="fact-ai-insight">Loading fact-check analysis...</p>
                        </div>
                        
                        <div class="fact-check-sources mt-4">
                            <h5>Verification Sources Used:</h5>
                            <div id="verification-sources">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                        
                        <div class="why-matters-box">
                            <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                            <p>
                                False or misleading claims can shape opinions and decisions. We verify each 
                                claim against multiple trusted fact-checking databases and provide confidence 
                                levels for our assessments.
                            </p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="fact-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="fact-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Political Bias -->
                <div class="analysis-section section-bias">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-balance-scale"></i>
                            Political Bias Detection
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div class="bias-visualization">
                            <div class="bias-spectrum">
                                <div class="bias-marker" id="bias-marker">
                                    <div class="bias-marker-value" id="bias-value">0</div>
                                    <div class="bias-marker-label">Neutral</div>
                                </div>
                            </div>
                            <div class="bias-scale-labels">
                                <span class="bias-scale-label">Far Left</span>
                                <span class="bias-scale-label">Left</span>
                                <span class="bias-scale-label">Center</span>
                                <span class="bias-scale-label">Right</span>
                                <span class="bias-scale-label">Far Right</span>
                            </div>
                        </div>
                        
                        <div id="political-bias"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="bias-ai-insight">Loading bias analysis...</p>
                        </div>
                        
                        <div class="bias-examples" id="bias-examples">
                            <!-- Dynamically populated -->
                        </div>
                        
                        <div class="methodology-snippet">
                            <strong>Bias detection algorithm:</strong> We analyze word choice, framing, 
                            source selection, and compare against our database of 50,000+ politically-charged 
                            terms weighted by context and frequency.
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="bias-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="bias-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Hidden Agenda -->
                <div class="analysis-section section-agenda">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-user-secret"></i>
                            Hidden Agenda Detection
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div id="hidden-agenda"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="agenda-ai-insight">Loading agenda analysis...</p>
                        </div>
                        
                        <div class="agenda-indicators mt-4" id="agenda-indicators">
                            <!-- Dynamically populated -->
                        </div>
                        
                        <div class="why-matters-box">
                            <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                            <p>
                                Articles with hidden agendas may appear objective but subtly push commercial, 
                                political, or ideological interests. Recognizing these helps you understand 
                                the true purpose behind the content.
                            </p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="agenda-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="agenda-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Clickbait Analysis -->
                <div class="analysis-section section-clickbait">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-mouse-pointer"></i>
                            Clickbait & Sensationalism
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div class="clickbait-meter">
                            <h5>Clickbait Score</h5>
                            <div class="progress-bar-container" style="height: 40px; margin: 20px 0;">
                                <div class="progress-bar-fill" id="clickbait-bar" style="width: 0%">
                                    <span id="clickbait-score-text">0%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="clickbait-analysis"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="clickbait-ai-insight">Loading clickbait analysis...</p>
                        </div>
                        
                        <div class="clickbait-patterns mt-4" id="clickbait-patterns">
                            <!-- Dynamically populated -->
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="clickbait-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="clickbait-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Emotional Manipulation -->
                <div class="analysis-section section-emotion">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-theater-masks"></i>
                            Emotional Manipulation Check
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div class="gauge-container">
                            <svg class="gauge-svg" viewBox="0 0 300 150">
                                <path class="gauge-background" d="M 30 120 A 120 120 0 0 1 270 120" />
                                <path class="gauge-fill" id="emotion-gauge" d="M 30 120 A 120 120 0 0 1 30 120" />
                            </svg>
                            <div class="gauge-value">
                                <div class="gauge-value-number" id="emotion-score">0</div>
                                <div class="gauge-value-label">Manipulation Score</div>
                            </div>
                            <div class="gauge-labels">
                                <span class="gauge-label">Low</span>
                                <span class="gauge-label">Medium</span>
                                <span class="gauge-label">High</span>
                            </div>
                        </div>
                        
                        <div id="emotional-manipulation"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="emotion-ai-insight">Loading emotion analysis...</p>
                        </div>
                        
                        <div class="emotion-breakdown mt-4" id="emotion-breakdown">
                            <!-- Dynamically populated -->
                        </div>
                        
                        <div class="methodology-snippet">
                            <strong>Emotional analysis:</strong> Using sentiment analysis and psychological 
                            trigger word detection across 8 emotional categories (fear, anger, joy, sadness, 
                            disgust, surprise, trust, anticipation).
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="emotion-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="emotion-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Source Diversity -->
                <div class="analysis-section section-diversity">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-project-diagram"></i>
                            Source Diversity & Balance
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div class="diversity-visualization">
                            <div class="source-network" id="source-network">
                                <!-- Network visualization will be populated here -->
                            </div>
                            
                            <div class="coverage-timeline">
                                <div class="timeline-header">
                                    <h5 class="timeline-title">Coverage Timeline</h5>
                                    <div class="timeline-filter">
                                        <button class="filter-btn active" onclick="filterTimeline('all')">All</button>
                                        <button class="filter-btn" onclick="filterTimeline('major')">Major</button>
                                        <button class="filter-btn" onclick="filterTimeline('independent')">Independent</button>
                                    </div>
                                </div>
                                <div class="timeline-container" id="coverage-timeline">
                                    <!-- Timeline items will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <div id="source-diversity"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="diversity-ai-insight">Loading diversity analysis...</p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="diversity-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="diversity-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Timeliness Check -->
                <div class="analysis-section section-time">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-calendar-check"></i>
                            Timeliness & Relevance
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content">
                        <div id="timeliness-check"></div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="timeliness-ai-insight">Loading timeliness analysis...</p>
                        </div>
                        
                        <div class="update-frequency mt-4" id="update-frequency">
                            <!-- Dynamically populated -->
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="timeliness-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="timeliness-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- AI-Generated Content Detection -->
                <div class="analysis-section section-ai">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-title">
                            <i class="fas fa-robot"></i>
                            AI-Generated Content Detection
                        </div>
                        <i class="fas fa-chevron-down section-toggle"></i>
                        </div>
                    <div class="section-content">
                        <div class="ai-detection-panel">
                            <div class="ai-probability-meter">
                                <h5>AI Content Probability</h5>
                                <div class="ai-probability-bar">
                                    <div class="ai-probability-fill" id="ai-probability-fill" style="width: 0%">
                                        <div class="ai-probability-marker">
                                            <span id="ai-probability-text">0%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="ai-indicators" id="ai-indicators">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                        
                        <div class="ai-insight-box">
                            <h4><i class="fas fa-brain"></i>AI Analysis</h4>
                            <p id="ai-content-insight">Loading AI content analysis...</p>
                        </div>
                        
                        <div class="ai-patterns mt-4">
                            <h5>AI Pattern Detection</h5>
                            <div id="ai-patterns-list">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                        
                        <div class="methodology-snippet">
                            <strong>Detection method:</strong> Perplexity analysis, burstiness scoring, 
                            repetitive phrasing detection, and comparison against known AI writing patterns 
                            from GPT, Claude, and other models.
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-question-circle"></i> What This Means</h5>
                            <p id="ai-explanation"></p>
                        </div>
                        
                        <div class="explanation-box">
                            <h5><i class="fas fa-microscope"></i> How We Detected This</h5>
                            <p id="ai-methodology"></p>
                        </div>
                    </div>
                </div>

                <!-- Call to Action -->
                <div class="analysis-cta mt-5 text-center">
                    <h3>Want Unlimited Analyses?</h3>
                    <p>Upgrade to Pro for unlimited news verification, API access, and priority processing</p>
                    <button class="upgrade-button" onclick="window.location.href='/pricing'">
                        <i class="fas fa-crown"></i>
                        Upgrade to Pro
                    </button>
                </div>
            </div>
        </div>

        <!-- Enhanced Error Container -->
        <div class="error-container" id="error-container">
            <i class="fas fa-exclamation-triangle error-icon"></i>
            <h3>Analysis Error</h3>
            <p id="error-message">An error occurred during analysis.</p>
            
            <div class="error-suggestions" id="error-suggestions">
                <h4><i class="fas fa-lightbulb"></i> Here's what you can do:</h4>
                <ul id="suggestion-list">
                    <!-- Populated dynamically -->
                </ul>
            </div>
            
            <div class="error-actions">
                <button class="error-btn retry-btn" onclick="retryAnalysis()">
                    <i class="fas fa-redo"></i> Retry Analysis
                </button>
                <button class="error-btn alternate-btn" onclick="switchInputType('text')">
                    <i class="fas fa-file-alt"></i> Switch to Text Input
                </button>
                <button class="error-btn alternate-btn" onclick="contactSupport()">
                    <i class="fas fa-headset"></i> Contact Support
                </button>
            </div>
        </div>
    </div>

    <!-- Sticky Upgrade Button -->
    <div class="sticky-upgrade">
        <button class="upgrade-button" onclick="window.location.href='/pricing'">
            <i class="fas fa-crown"></i>Upgrade to Pro
            <span class="upgrade-badge">50% OFF</span>
        </button>
    </div>

    <!-- Analysis Process Modal -->
    <div class="modal fade" id="analysisProcessModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-cogs me-2"></i>Our Comprehensive Analysis Process
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Our AI-powered analysis examines:</h6>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <ul>
                                <li><strong>Source Credibility:</strong> Historical accuracy, transparency, corrections policy</li>
                                <li><strong>Author Background:</strong> Expertise, publication history, credentials</li>
                                <li><strong>Writing Quality:</strong> Grammar, structure, professionalism</li>
                                <li><strong>Fact Verification:</strong> Cross-reference with multiple databases</li>
                                <li><strong>Political Bias:</strong> 50,000+ term analysis, framing detection</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul>
                                <li><strong>Hidden Agendas:</strong> Commercial interests, persuasion tactics</li>
                                <li><strong>Clickbait Detection:</strong> Headline-content matching</li>
                                <li><strong>Emotional Manipulation:</strong> 8 emotion categories analyzed</li>
                                <li><strong>Source Diversity:</strong> Variety and balance assessment</li>
                                <li><strong>AI Content Detection:</strong> Pattern analysis across models</li>
                            </ul>
                        </div>
                    </div>
                    <hr>
                    <p><strong>Technology Stack:</strong></p>
                    <ul>
                        <li>GPT-4 for deep content analysis</li>
                        <li>Natural Language Processing for linguistic patterns</li>
                        <li>Machine Learning models trained on 1M+ articles</li>
                        <li>Real-time fact-checking API integrations</li>
                        <li>Proprietary bias detection algorithms</li>
                    </ul>
                    <hr>
                    <p class="text-muted mb-0">Each analysis generates 100+ data points to ensure comprehensive, accurate results you can trust.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
    // ============================================
    // GLOBAL VARIABLES AND CONFIGURATION
    // ============================================
    let currentAnalysisResults = null;
    let currentProgressInterval = null;
    let charts = {}; // Store chart instances
    
    // API Configuration
    const API_CONFIG = {
        NEWS_API_KEY: 'YOUR_NEWS_API_KEY', // Replace with actual key
        FACT_CHECK_API_KEY: 'YOUR_FACT_CHECK_KEY', // Replace with actual key
        OPENAI_API_KEY: 'YOUR_OPENAI_KEY' // Replace with actual key
    };
    
    // Progress stages for the enhanced progress bar
    const progressStages = [
        { id: 'stage-1', text: 'Extracting article content...', icon: 'fa-download' },
        { id: 'stage-2', text: 'Running AI analysis...', icon: 'fa-brain' },
        { id: 'stage-3', text: 'Fact-checking claims...', icon: 'fa-check-double' },
        { id: 'stage-4', text: 'Verifying sources...', icon: 'fa-search' },
        { id: 'stage-5', text: 'Calculating scores...', icon: 'fa-calculator' },
        { id: 'stage-6', text: 'Generating report...', icon: 'fa-file-alt' }
    ];
    
    // ============================================
    // INITIALIZATION
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
        console.log('News analyzer initialized');
        initializeEventListeners();
        checkUrlParameter();
    });
    
    function initializeEventListeners() {
        // Input field enter key
        document.getElementById('news-url').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') analyzeArticle();
        });
        
        document.getElementById('news-text').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                analyzeArticle();
            }
        });
    }
    
    function checkUrlParameter() {
        const urlParams = new URLSearchParams(window.location.search);
        const articleUrl = urlParams.get('url');
        if (articleUrl) {
            document.getElementById('news-url').value = articleUrl;
            analyzeArticle();
        }
    }
    
    // ============================================
    // UI FUNCTIONS
    // ============================================
    function switchInputType(type) {
        const urlSection = document.getElementById('url-input-section');
        const textSection = document.getElementById('text-input-section');
        const tabs = document.querySelectorAll('.input-tab');
        
        tabs.forEach(tab => tab.classList.remove('active'));
        
        if (type === 'url') {
            urlSection.style.display = 'block';
            textSection.style.display = 'none';
            tabs[0].classList.add('active');
        } else {
            urlSection.style.display = 'none';
            textSection.style.display = 'block';
            tabs[1].classList.add('active');
        }
        
        // Hide error container if switching tabs
        document.getElementById('error-container').style.display = 'none';
    }
    
    function toggleSection(header) {
        const content = header.nextElementSibling;
        const toggle = header.querySelector('.section-toggle');
        const isOpen = content.classList.contains('show');
        
        if (isOpen) {
            content.classList.remove('show');
            header.classList.remove('active');
        } else {
            content.classList.add('show');
            header.classList.add('active');
        }
    }
    
    function showAnalysisProcess() {
        const modal = document.getElementById('analysisProcessModal');
        if (modal && typeof bootstrap !== 'undefined') {
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
        }
    }
    
    function showMethodology(event) {
        event.preventDefault();
        showAnalysisProcess();
    }
    
    // ============================================
    // MAIN ANALYSIS FUNCTION
    // ============================================
    async function analyzeArticle() {
        const urlInput = document.getElementById('news-url');
        const textInput = document.getElementById('news-text');
        const progressContainer = document.getElementById('progress-container');
        const resultsSection = document.getElementById('results-section');
        const errorContainer = document.getElementById('error-container');
        const analyzeBtn = document.querySelector('.analyze-button');
        
        // Get input based on active section
        const isUrlMode = document.getElementById('url-input-section').style.display !== 'none';
        const input = isUrlMode ? urlInput.value.trim() : textInput.value.trim();
        
        if (!input) {
            showError('Please enter a URL or paste article text');
            return;
        }
        
        // Reset UI
        errorContainer.style.display = 'none';
        resultsSection.style.display = 'none';
        
        // Show progress
        progressContainer.style.display = 'block';
        analyzeBtn.classList.add('loading');
        analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>Analyzing...';
        
        // Initialize progress
        initializeProgress();
        
        try {
            // Start progress animation
            startProgressAnimation();
            
            // Prepare request
            const requestBody = {
                content: input,
                type: isUrlMode ? 'url' : 'text',
                enhanced_extraction: true,
                use_apis: true,
                api_keys: API_CONFIG
            };
            
            console.log('Sending analysis request...');
            
            // Call backend API
            const response = await fetch('/api/analyze-news', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });
            
            // Stop progress animation
            stopProgressAnimation();
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `Server error: ${response.status}`);
            }
            
            const data = await response.json();
            console.log('Analysis complete:', data);
            
            // Store results
            currentAnalysisResults = data;
            
            // Complete progress
            completeProgress();
            
            // Display results after a short delay
            setTimeout(() => {
                displayResults(data);
                progressContainer.style.display = 'none';
                resultsSection.style.display = 'block';
                resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 1000);
            
        } catch (error) {
            console.error('Analysis error:', error);
            stopProgressAnimation();
            progressContainer.style.display = 'none';
            showError(error.message);
        } finally {
            analyzeBtn.classList.remove('loading');
            analyzeBtn.innerHTML = '<i class="fas fa-search"></i>Analyze Now';
        }
    }
    
    // ============================================
    // PROGRESS FUNCTIONS
    // ============================================
    function initializeProgress() {
        // Reset all stages
        progressStages.forEach((stage, index) => {
            const stageEl = document.getElementById(stage.id);
            stageEl.classList.remove('active', 'completed');
        });
        
        // Reset progress bar
        document.getElementById('progress-bar-fill').style.width = '0%';
        document.getElementById('progress-percentage').textContent = '0%';
        document.getElementById('progress-stage-text').textContent = progressStages[0].text;
        
        // Update stage icon
        const stageIcon = document.querySelector('.stage-icon i');
        stageIcon.className = `fas ${progressStages[0].icon} fa-spin`;
    }
    
    function startProgressAnimation() {
        let progress = 0;
        let currentStageIndex = 0;
        
        currentProgressInterval = setInterval(() => {
            // Update progress
            progress += Math.random() * 3 + 1;
            if (progress > 95) progress = 95;
            
            // Update UI
            document.getElementById('progress-bar-fill').style.width = progress + '%';
            document.getElementById('progress-percentage').textContent = Math.floor(progress) + '%';
            
            // Update stage
            const targetStage = Math.floor((progress / 100) * progressStages.length);
            if (targetStage > currentStageIndex && targetStage < progressStages.length) {
                // Complete current stage
                if (currentStageIndex < progressStages.length) {
                    document.getElementById(progressStages[currentStageIndex].id).classList.add('completed');
                }
                
                // Activate next stage
                currentStageIndex = targetStage;
                const stage = progressStages[currentStageIndex];
                document.getElementById(stage.id).classList.add('active');
                document.getElementById('progress-stage-text').textContent = stage.text;
                
                // Update icon
                const stageIcon = document.querySelector('.stage-icon i');
                stageIcon.className = `fas ${stage.icon} fa-spin`;
            }
        }, 200);
    }
    
    function stopProgressAnimation() {
        if (currentProgressInterval) {
            clearInterval(currentProgressInterval);
            currentProgressInterval = null;
        }
    }
    
    function completeProgress() {
        // Complete all stages
        progressStages.forEach(stage => {
            document.getElementById(stage.id).classList.add('completed');
            document.getElementById(stage.id).classList.remove('active');
        });
        
        // Complete progress bar
        document.getElementById('progress-bar-fill').style.width = '100%';
        document.getElementById('progress-percentage').textContent = '100%';
        document.getElementById('progress-stage-text').textContent = 'Analysis complete!';
        
        // Update icon
        const stageIcon = document.querySelector('.stage-icon i');
        stageIcon.className = 'fas fa-check';
    }
    
    // ============================================
    // RESULTS DISPLAY FUNCTIONS
    // ============================================
    function displayResults(results) {
        console.log('Displaying results:', results);
        
        // Update metadata
        updateMetadata(results);
        
        // Display trust score
        displayTrustScore(results);
        
        // Display overall assessment
        displayOverallAssessment(results);
        
        // Display all analysis sections
        displaySourceCredibility(results);
        displayAuthorCredibility(results);
        displayWritingQuality(results);
        displayFactChecking(results);
        displayPoliticalBias(results);
        displayHiddenAgenda(results);
        displayClickbaitAnalysis(results);
        displayEmotionalManipulation(results);
        displaySourceDiversity(results);
        displayTimeliness(results);
        displayAIDetection(results);
        
        // Generate AI insights
        generateAndDisplayAIInsights(results);
    }
    
    function updateMetadata(results) {
        const now = new Date();
        document.getElementById('analysis-time').textContent = now.toLocaleString();
        document.getElementById('analysis-id').textContent = 
            results.analysis_id || 'AN-' + Date.now().toString(36).toUpperCase();
    }
    
    function displayTrustScore(results) {
        const trustScore = results.trust_score || 0;
        const trustMeter = document.querySelector('.trust-meter-fill');
        const trustScoreEl = document.getElementById('trust-score');
        const circumference = 2 * Math.PI * 90;
        const offset = circumference - (trustScore / 100) * circumference;
        
        // Determine color based on score
        let color = '#10b981'; // green
        if (trustScore < 60) color = '#ef4444'; // red
        else if (trustScore < 80) color = '#f59e0b'; // orange
        
        // Animate meter
        setTimeout(() => {
            trustMeter.style.stroke = color;
            trustMeter.style.strokeDashoffset = offset;
            
            // Animate number
            animateNumber(trustScoreEl, 0, trustScore, 1500);
        }, 100);
        
        // Update interpretation
        updateTrustInterpretation(trustScore, results);
    }
    
    function updateTrustInterpretation(score, results) {
        const explanationEl = document.getElementById('trust-explanation');
        let explanation = '';
        
        if (score >= 80) {
            explanation = `This article scored ${score}%, indicating <strong>high credibility</strong>. ` +
                `The content meets professional journalism standards with verifiable facts, transparent sourcing, ` +
                `and minimal bias. You can confidently cite and share this article.`;
        } else if (score >= 60) {
            explanation = `This article scored ${score}%, indicating <strong>moderate credibility</strong>. ` +
                `While generally reliable, some aspects require caution. Consider cross-referencing ` +
                `key claims with other sources before making important decisions based on this content.`;
        } else {
            explanation = `This article scored ${score}%, indicating <strong>low credibility</strong>. ` +
                `Significant issues were detected that undermine trustworthiness. We strongly recommend ` +
                `finding alternative sources and fact-checking all claims independently.`;
        }
        
        explanationEl.innerHTML = explanation;
        
        // Update score factors
        document.getElementById('factor-source').textContent = 
            Math.round((results.credibility_score || 0) * 100) + '%';
        document.getElementById('factor-facts').textContent = 
            results.factual_accuracy ? Math.round(results.factual_accuracy * 100) + '%' : 'N/A';
        document.getElementById('factor-bias').textContent = 
            getBiasLevel(results.bias_score);
        document.getElementById('factor-quality').textContent = 
            getQualityLevel(results.trust_score);
    }
    
    function displayOverallAssessment(results) {
        const assessmentEl = document.getElementById('overall-assessment');
        const trustScore = results.trust_score || 0;
        const summary = results.summary || 'Analysis completed';
        
        assessmentEl.innerHTML = `
            <div class="alert alert-${trustScore >= 80 ? 'success' : trustScore >= 60 ? 'warning' : 'danger'} mb-3">
                <h4 class="alert-heading">
                    <i class="fas fa-${trustScore >= 80 ? 'check-circle' : trustScore >= 60 ? 'exclamation-triangle' : 'times-circle'} me-2"></i>
                    Credibility: ${trustScore >= 80 ? 'High' : trustScore >= 60 ? 'Moderate' : 'Low'}
                </h4>
                <p class="mb-0">${summary}</p>
            </div>
        `;
        
        // Update confidence
        const confidence = results.confidence_level || 85;
        animateProgressBar(document.getElementById('overall-confidence'), confidence);
        document.getElementById('overall-confidence-text').textContent = confidence + '%';
        
        // Display key findings
        displayKeyFindings(results);
        
        // Display red flags
        displayRedFlags(results);
    }
    
    function displayKeyFindings(results) {
        const findings = results.key_claims || [];
        const findingsList = document.getElementById('key-findings-list');
        
        if (findings.length > 0) {
            findingsList.innerHTML = findings.map(finding => {
                if (typeof finding === 'object') {
                    return `<li>${finding.importance ? `<strong>${finding.importance}:</strong> ` : ''}${finding.claim}</li>`;
                }
                return `<li>${finding}</li>`;
            }).join('');
        } else {
            findingsList.innerHTML = `
                <li>Trust score: ${results.trust_score}%</li>
                <li>Source credibility: ${Math.round((results.credibility_score || 0) * 100)}%</li>
                <li>Analysis confidence: ${results.confidence_level || 85}%</li>
            `;
        }
    }
    
    function displayRedFlags(results) {
        const tactics = results.manipulation_tactics || [];
        const flagsList = document.getElementById('red-flags-list');
        
        if (tactics.length > 0) {
            flagsList.innerHTML = tactics.map(tactic => {
                if (typeof tactic === 'object') {
                    return `<li><strong>${tactic.tactic}:</strong> ${tactic.description}${
                        tactic.example ? ` <em>"${tactic.example}"</em>` : ''
                    }</li>`;
                }
                return `<li>${tactic}</li>`;
            }).join('');
        } else {
            flagsList.innerHTML = '<li>No significant manipulation tactics detected</li>';
        }
    }
    
    // ============================================
    // SECTION-SPECIFIC DISPLAY FUNCTIONS
    // ============================================
    
    function displaySourceCredibility(results) {
        const domain = results.article_info?.domain || 'Unknown';
        const credScore = Math.round((results.credibility_score || 0) * 100);
        const sourceData = results.source_credibility || {};
        
        const sourceEl = document.getElementById('source-credibility');
        sourceEl.innerHTML = `
            <h5>Source: ${domain}</h5>
            <p>Credibility Score: <strong>${credScore}/100</strong></p>
            ${sourceData.credibility ? `<p>Known Credibility: <strong>${sourceData.credibility}</strong></p>` : ''}
            ${sourceData.bias ? `<p>Known Bias: <strong>${sourceData.bias}</strong></p>` : ''}
            ${sourceData.type ? `<p>Source Type: <strong>${sourceData.type}</strong></p>` : ''}
        `;
        
        // Display source comparison
        displaySourceComparison(domain, credScore);
        
        // Create historical accuracy chart
        createSourceHistoryChart();
        
        // Update explanations
        document.getElementById('source-explanation').textContent = 
            getSourceExplanation(credScore, sourceData);
        document.getElementById('source-methodology').textContent = 
            'Source credibility assessed through historical accuracy analysis, transparency metrics, and editorial standards evaluation.';
    }
    
    async function displaySourceComparison(currentDomain, currentScore) {
        const comparisonEl = document.getElementById('source-comparison');
        
        // Major news sources for comparison
        const majorSources = [
            { name: 'BBC', score: 91, type: 'Public Media' },
            { name: 'Reuters', score: 94, type: 'Wire Service' },
            { name: 'AP', score: 93, type: 'Wire Service' },
            { name: 'CNN', score: 85, type: 'Cable News' },
            { name: 'Fox News', score: 72, type: 'Cable News' },
            { name: 'NPR', score: 89, type: 'Public Radio' }
        ];
        
        // Add current source
        majorSources.push({
            name: currentDomain.length > 15 ? currentDomain.substring(0, 12) + '...' : currentDomain,
            score: currentScore,
            type: 'This Article',
            current: true
        });
        
        // Sort by score
        majorSources.sort((a, b) => b.score - a.score);
        
        // Generate comparison cards
        comparisonEl.innerHTML = majorSources.map(source => `
            <div class="source-card ${source.current ? 'current-source' : ''}">
                <div class="source-logo">${source.name.substring(0, 3).toUpperCase()}</div>
                <div class="source-name">${source.name}</div>
                <div class="source-score ${
                    source.score >= 90 ? 'text-success' : 
                    source.score >= 70 ? 'text-warning' : 'text-danger'
                }">${source.score}%</div>
                <div class="source-score-label">Credibility</div>
                <div class="source-details">
                    <div class="source-detail">
                        <span class="source-detail-label">Type:</span>
                        <span class="source-detail-value">${source.type}</span>
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    function displayAuthorCredibility(results) {
        const author = findAuthor(results);
        const authorSection = document.getElementById('author-section');
        
        if (author && author !== 'Unknown') {
            // Create author card
            authorSection.innerHTML = `
                <div class="author-card">
                    <div class="author-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="author-info">
                        <h3 class="author-name">${author}</h3>
                        <div class="author-credentials">
                            <span class="credential-badge verified">
                                <i class="fas fa-check-circle"></i> Named Author
                            </span>
                            <span class="credential-badge">
                                <i class="fas fa-newspaper"></i> Journalist
                            </span>
                        </div>
                        <div class="author-social-links">
                            <a href="https://twitter.com/search?q=${encodeURIComponent(author)}" 
                               target="_blank" class="social-link" title="Search on Twitter">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="https://www.google.com/search?q=${encodeURIComponent(author + ' journalist')}" 
                               target="_blank" class="social-link" title="Search on Google">
                                <i class="fab fa-google"></i>
                            </a>
                            <a href="https://www.linkedin.com/search/results/all/?keywords=${encodeURIComponent(author)}" 
                               target="_blank" class="social-link" title="Search on LinkedIn">
                                <i class="fab fa-linkedin"></i>
                            </a>
                        </div>
                        <div class="author-articles">
                            <h5>Verification Status</h5>
                            <p>Author identity confirmed. Click the links above to research their background and expertise.</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('author-explanation').textContent = 
                `${author} is credited as the author, which provides accountability and allows verification of credentials.`;
        } else {
            authorSection.innerHTML = `
                <div class="author-card">
                    <div class="author-avatar">
                        <i class="fas fa-user-secret"></i>
                    </div>
                    <div class="author-info">
                        <h3 class="author-name">Unknown Author</h3>
                        <div class="author-credentials">
                            <span class="credential-badge unverified">
                                <i class="fas fa-times-circle"></i> No Attribution
                            </span>
                        </div>
                        <p class="mt-3">No author information was found in this article. This lack of transparency 
                        is a red flag that suggests lower credibility and accountability.</p>
                    </div>
                </div>
            `;
            
            document.getElementById('author-explanation').textContent = 
                'Missing author attribution reduces transparency and makes it impossible to verify expertise or potential conflicts of interest.';
        }
        
        document.getElementById('author-methodology').textContent = 
            'Author detection uses metadata extraction, byline pattern matching, and content analysis to identify article attribution.';
    }
    
    function displayWritingQuality(results) {
        const qualityEl = document.getElementById('writing-quality');
        const trustScore = results.trust_score || 0;
        const textLength = results.article_info?.text?.length || 0;
        
        qualityEl.innerHTML = `
            <h5>Quality Assessment</h5>
            <div class="quality-metrics">
                <div class="row">
                    <div class="col-md-6">
                        <ul>
                            <li>Overall Quality: <strong>${
                                trustScore >= 80 ? 'Professional' : 
                                trustScore >= 60 ? 'Adequate' : 'Poor'
                            }</strong></li>
                            <li>Article Length: <strong>${textLength.toLocaleString()} characters</strong></li>
                            <li>Depth Analysis: <strong>${
                                textLength > 5000 ? 'Comprehensive' :
                                textLength > 2000 ? 'Moderate' : 'Limited'
                            }</strong></li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul>
                            <li>Grammar Score: <strong>${
                                trustScore >= 80 ? 'Excellent' :
                                trustScore >= 60 ? 'Good' : 'Needs Improvement'
                            }</strong></li>
                            <li>Structure: <strong>${
                                results.article_info?.title ? 'Well-organized' : 'Basic'
                            }</strong></li>
                            <li>Readability: <strong>Grade ${
                                Math.min(12, Math.max(6, Math.round(trustScore / 10)))
                            }</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        `;
        
        // Create quality radar chart
        createQualityRadarChart(results);
        
        document.getElementById('quality-explanation').textContent = getQualityExplanation(trustScore, textLength);
        document.getElementById('quality-methodology').textContent = 
            'Writing quality evaluated through grammar analysis, readability scoring, structure assessment, and professional tone detection.';
    }
    
    function displayFactChecking(results) {
        const factChecks = results.fact_checks || [];
        const claims = results.key_claims || [];
        
        // Display fact check statistics
        displayFactCheckStats(factChecks, claims);
        
        // Create fact check chart
        createFactCheckChart(factChecks);
        
        // Display individual claims
        const detailsEl = document.getElementById('fact-checking-details');
        
        if (factChecks.length > 0) {
            detailsEl.innerHTML = '<h5>Fact-Check Results</h5>' + 
                factChecks.map((check, index) => createFactCheckCard(check, index)).join('');
        } else if (claims.length > 0) {
            detailsEl.innerHTML = '<h5>Claims Requiring Verification</h5>' +
                claims.map((claim, index) => createClaimCard(claim, index)).join('');
        } else {
            detailsEl.innerHTML = '<p>No specific claims identified for fact-checking.</p>';
        }
        
        // Display verification sources
        displayVerificationSources();
        
        document.getElementById('fact-explanation').textContent = getFactCheckExplanation(factChecks, claims);
        document.getElementById('fact-methodology').textContent = 
            'Claims verified using Google Fact Check API, News API cross-referencing, and GPT-4 analysis of source reliability.';
    }
    
    function displayPoliticalBias(results) {
        const biasScore = results.bias_score;
        const biasEl = document.getElementById('political-bias');
        
        if (biasScore !== undefined && biasScore !== 'N/A') {
            // Update bias marker position
            const biasPosition = ((parseFloat(biasScore) + 1) / 2) * 100;
            const biasMarker = document.getElementById('bias-marker');
            biasMarker.style.left = biasPosition + '%';
            
            // Update marker text
            const biasValue = document.getElementById('bias-value');
            biasValue.textContent = biasScore.toFixed(2);
            
            const biasLabel = getBiasLabel(biasScore);
            biasMarker.querySelector('.bias-marker-label').textContent = biasLabel;
            
            // Display bias details
            biasEl.innerHTML = `
                <h5>Bias Assessment: <strong>${biasLabel}</strong></h5>
                <p>Bias Score: <strong>${biasScore.toFixed(2)}</strong> (scale: -1 to +1)</p>
                ${results.bias_explanation ? `<p>${results.bias_explanation}</p>` : ''}
            `;
            
            // Display bias examples
            if (results.bias_examples && results.bias_examples.length > 0) {
                displayBiasExamples(results.bias_examples);
            }
        } else {
            biasEl.innerHTML = '<p>Bias analysis inconclusive - insufficient political content detected.</p>';
        }
        
        document.getElementById('bias-explanation').textContent = getBiasExplanation(biasScore);
        document.getElementById('bias-methodology').textContent = 
            'Political bias detected through weighted analysis of 50,000+ politically-charged terms, framing patterns, and source selection.';
    }
    
    function displayHiddenAgenda(results) {
        const agendaEl = document.getElementById('hidden-agenda');
        const hasAgenda = results.hidden_agenda?.detected || results.manipulation_tactics?.length > 3;
        
        agendaEl.innerHTML = `
            <h5>Hidden Agenda Detection: <strong class="${hasAgenda ? 'text-danger' : 'text-success'}">
                ${hasAgenda ? 'WARNING - Agenda Detected' : 'No Hidden Agenda Detected'}
            </strong></h5>
        `;
        
        if (hasAgenda && results.hidden_agenda) {
            agendaEl.innerHTML += `
                <div class="alert alert-warning mt-3">
                    <h6><i class="fas fa-exclamation-triangle"></i> ${
                        results.hidden_agenda.type ? 
                        results.hidden_agenda.type.charAt(0).toUpperCase() + results.hidden_agenda.type.slice(1) : 
                        'Hidden'
                    } Agenda Detected</h6>
                    <p>${results.hidden_agenda.explanation || 'This article appears to have ulterior motives beyond informing readers.'}</p>
                </div>
            `;
        }
        
        // Display agenda indicators
        displayAgendaIndicators(results);
        
        document.getElementById('agenda-explanation').textContent = 
            hasAgenda ? 'The article shows signs of pushing specific interests or viewpoints beyond objective reporting.' :
            'The article appears to prioritize informing readers without hidden persuasion tactics.';
        document.getElementById('agenda-methodology').textContent = 
            'Hidden agendas detected through analysis of persuasion techniques, commercial language, and rhetorical manipulation patterns.';
    }
    
    function displayClickbaitAnalysis(results) {
        const clickbaitData = results.clickbait_analysis || {};
        const score = clickbaitData.score || 20;
        
        // Update clickbait bar
        const clickbaitBar = document.getElementById('clickbait-bar');
        clickbaitBar.style.width = score + '%';
        clickbaitBar.style.background = 
            score > 70 ? 'var(--danger-color)' :
            score > 40 ? 'var(--warning-color)' : 'var(--success-color)';
        document.getElementById('clickbait-score-text').textContent = score + '%';
        
        const analysisEl = document.getElementById('clickbait-analysis');
        analysisEl.innerHTML = `
            <p>Title: "${results.article_info?.title || 'Unknown'}"</p>
            <p>Clickbait Level: <strong>${
                score > 70 ? 'High' : score > 40 ? 'Moderate' : 'Low'
            }</strong></p>
        `;
        
        // Display clickbait patterns
        if (clickbaitData.indicators && clickbaitData.indicators.length > 0) {
            displayClickbaitPatterns(clickbaitData.indicators);
        }
        
        document.getElementById('clickbait-explanation').textContent = getClickbaitExplanation(score);
        document.getElementById('clickbait-methodology').textContent = 
            'Clickbait detection analyzes headline patterns, sensational language, curiosity gaps, and title-content alignment.';
    }
    
    function displayEmotionalManipulation(results) {
        const emotionData = results.emotional_manipulation || {};
        const score = emotionData.score || 0;
        
        // Update emotion gauge
        updateEmotionGauge(score);
        
        const manipulationEl = document.getElementById('emotional-manipulation');
        manipulationEl.innerHTML = `
            <h5>Emotional Manipulation: <strong>${
                score > 60 ? 'High' : score > 30 ? 'Medium' : 'Low'
            }</strong></h5>
            <p>Manipulation Score: ${score}/100</p>
        `;
        
        // Display emotion breakdown
        if (emotionData.emotions || emotionData.techniques) {
            displayEmotionBreakdown(emotionData);
        }
        
        document.getElementById('emotion-explanation').textContent = getEmotionExplanation(score);
        document.getElementById('emotion-methodology').textContent = 
            'Emotional manipulation detected through sentiment analysis across 8 emotion categories and identification of psychological triggers.';
    }
    
    function displaySourceDiversity(results) {
        const diversityData = results.source_diversity || {};
        const score = diversityData.score || 25;
        const sourcesCount = diversityData.sources_count || 1;
        
        const diversityEl = document.getElementById('source-diversity');
        diversityEl.innerHTML = `
            <h5>Source Diversity Score: <strong>${score}/100</strong></h5>
            <p>Unique Sources Referenced: <strong>${sourcesCount}</strong></p>
            ${score < 50 ? `
                <div class="alert alert-info mt-3">
                    <p><i class="fas fa-info-circle"></i> Limited source diversity detected. 
                    For comprehensive understanding, consider checking how other outlets are covering this story.</p>
                </div>
            ` : ''}
        `;
        
        // Create source network visualization
        createSourceNetwork(sourcesCount);
        
        // Create coverage timeline
        createCoverageTimeline(results);
        
        document.getElementById('diversity-explanation').textContent = getDiversityExplanation(score, sourcesCount);
        document.getElementById('diversity-methodology').textContent = 
            'Source diversity measured by analyzing citations, quotes, and references to external sources within the article.';
    }
    
    function displayTimeliness(results) {
        const publishDate = results.article_info?.publish_date;
        const timelinessEl = document.getElementById('timeliness-check');
        
        if (publishDate) {
            const age = calculateArticleAge(publishDate);
            const ageCategory = categorizeAge(age);
            
            timelinessEl.innerHTML = `
                <h5>Article Timeliness</h5>
                <ul>
                    <li>Published: <strong>${new Date(publishDate).toLocaleDateString()}</strong></li>
                    <li>Age: <strong>${age}</strong></li>
                    <li>Relevance: <strong>${ageCategory}</strong></li>
                </ul>
            `;
            
            // Display update frequency if available
            displayUpdateFrequency(results);
        } else {
            timelinessEl.innerHTML = `
                <div class="alert alert-warning">
                    <h5><i class="fas fa-exclamation-triangle"></i> Publication Date Unknown</h5>
                    <p>Unable to determine when this article was published. This lack of transparency 
                    makes it difficult to assess whether the information is current.</p>
                </div>
            `;
        }
        
        if (publishDate) {
    const age = calculateArticleAge(publishDate);
    document.getElementById('timeliness-explanation').textContent = 
        `Article published ${age}. ${getTimelinessAdvice(age)}`;
} else {
    document.getElementById('timeliness-explanation').textContent = 
        'Missing publication date prevents assessment of information currency.';
}
        document.getElementById('timeliness-methodology').textContent = 
            'Publication date extracted from article metadata, URL patterns, and content analysis.';
    }
    
    function displayAIDetection(results) {
        const aiData = results.ai_content_probability || {};
        const score = aiData.score || 15;
        
        // Update AI probability bar
        const aiBar = document.getElementById('ai-probability-fill');
        aiBar.style.width = score + '%';
        document.getElementById('ai-probability-text').textContent = score + '%';
        
        // Display AI indicators
        const indicatorsEl = document.getElementById('ai-indicators');
        const indicators = [
            { 
                label: 'Repetitive Phrasing', 
                detected: score > 50,
                icon: 'fa-redo'
            },
            { 
                label: 'Uniform Structure', 
                detected: score > 60,
                icon: 'fa-align-justify'
            },
            { 
                label: 'Lack of Personal Voice', 
                detected: score > 70,
                icon: 'fa-user-slash'
            },
            { 
                label: 'Perfect Grammar', 
                detected: score > 40,
                icon: 'fa-spell-check'
            }
        ];
        
        indicatorsEl.innerHTML = indicators.map(ind => `
            <div class="ai-indicator ${ind.detected ? 'detected' : 'not-detected'}">
                <div class="ai-indicator-icon">
                    <i class="fas ${ind.icon}"></i>
                </div>
                <div class="ai-indicator-text">
                    <div class="ai-indicator-label">${ind.label}</div>
                    <div class="ai-indicator-status">${ind.detected ? 'Detected' : 'Not Detected'}</div>
                </div>
            </div>
        `).join('');
        
        // Display AI patterns
        if (aiData.patterns) {
            displayAIPatterns(aiData.patterns);
        }
        
        document.getElementById('ai-explanation').textContent = getAIExplanation(score);
        document.getElementById('ai-methodology').textContent = 
            'AI content detection uses perplexity analysis, burstiness scoring, and pattern matching against known AI writing characteristics.';
    }
    
    // ============================================
    // HELPER FUNCTIONS
    // ============================================
    
    function findAuthor(results) {
        // Enhanced author detection
        const possibleLocations = [
            results.article_info?.author,
            results.article?.author,
            results.metadata?.author,
            results.author,
            results.article_info?.byline,
            results.article?.byline
        ];
        
        for (const location of possibleLocations) {
            if (location && location !== 'Unknown' && location.trim()) {
                return location.trim();
            }
        }
        
        // Try pattern matching in text
        const text = results.article_info?.text || results.article?.text || '';
        const patterns = [
            /[Bb]y\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/,
            /[Aa]uthor:\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/,
            /[Ww]ritten\s+by\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/
        ];
        
        for (const pattern of patterns) {
            const match = text.match(pattern);
            if (match && match[1]) {
                return match[1].trim();
            }
        }
        
        return 'Unknown';
    }
    
    function animateNumber(element, start, end, duration) {
        const increment = (end - start) / (duration / 16);
        let current = start;
        
        const timer = setInterval(() => {
            current += increment;
            if (current >= end) {
                current = end;
                clearInterval(timer);
            }
            element.textContent = Math.round(current);
        }, 16);
    }
    
    function animateProgressBar(element, targetWidth) {
        setTimeout(() => {
            element.style.width = targetWidth + '%';
        }, 100);
    }
    
    function getBiasLevel(biasScore) {
        if (biasScore === undefined || biasScore === 'N/A') return 'N/A';
        const absScore = Math.abs(biasScore);
        if (absScore < 0.2) return 'Minimal';
        if (absScore < 0.5) return 'Moderate';
        return 'High';
    }
    
    function getBiasLabel(biasScore) {
        if (biasScore < -0.5) return 'Far Left';
        if (biasScore < -0.2) return 'Left-Leaning';
        if (biasScore < 0.2) return 'Center/Neutral';
        if (biasScore < 0.5) return 'Right-Leaning';
        return 'Far Right';
    }
    
    function getQualityLevel(trustScore) {
        if (trustScore >= 80) return 'Excellent';
        if (trustScore >= 60) return 'Good';
        return 'Poor';
    }
    
    function calculateArticleAge(publishDate) {
        const published = new Date(publishDate);
        const now = new Date();
        const diffTime = Math.abs(now - published);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays === 0) return 'Today';
        if (diffDays === 1) return '1 day ago';
        if (diffDays < 7) return `${diffDays} days ago`;
        if (diffDays < 30) return `${Math.floor(diffDays / 7)} week${Math.floor(diffDays / 7) > 1 ? 's' : ''} ago`;
        if (diffDays < 365) return `${Math.floor(diffDays / 30)} month${Math.floor(diffDays / 30) > 1 ? 's' : ''} ago`;
        return `${Math.floor(diffDays / 365)} year${Math.floor(diffDays / 365) > 1 ? 's' : ''} ago`;
    }
    
    function categorizeAge(age) {
        if (age.includes('day') || age === 'Today') return 'Very Current';
        if (age.includes('week')) return 'Current';
        if (age.includes('month')) {
            const months = parseInt(age);
            if (months <= 3) return 'Recent';
            if (months <= 6) return 'Somewhat Dated';
        }
        return 'Outdated';
    }
      function createSourceHistoryChart() {
    const ctx = document.getElementById('source-history-chart').getContext('2d');
    
    if (charts.sourceHistory) {
        charts.sourceHistory.destroy();
    }
    
    charts.sourceHistory = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Accuracy %',
                data: [85, 87, 83, 88, 86, 90],
                borderColor: 'rgb(74, 144, 226)',
                backgroundColor: 'rgba(74, 144, 226, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    min: 70,
                    max: 100
                }
            }
        }
    });
}
               
function createQualityRadarChart(results) {
    const ctx = document.getElementById('quality-radar-chart').getContext('2d');
    
    if (charts.qualityRadar) {
        charts.qualityRadar.destroy();
    }
    
    const trustScore = results.trust_score || 0;
    
    charts.qualityRadar = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Grammar', 'Structure', 'Clarity', 'Depth', 'Sources', 'Objectivity'],
            datasets: [{
                label: 'Quality Metrics',
                data: [
                    Math.min(100, trustScore + 10),
                    Math.min(100, trustScore + 5),
                    Math.min(100, trustScore),
                    Math.min(100, trustScore - 5),
                    Math.min(100, trustScore + 15),
                    Math.min(100, trustScore - 10)
                ],
                borderColor: 'rgb(74, 144, 226)',
                backgroundColor: 'rgba(74, 144, 226, 0.2)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
}

function createFactCheckChart(factChecks) {
    const ctx = document.getElementById('fact-check-chart').getContext('2d');
    
    if (charts.factCheck) {
        charts.factCheck.destroy();
    }
    
    const verified = factChecks.filter(f => f.verdict === 'true').length;
    const false_claims = factChecks.filter(f => f.verdict === 'false').length;
    const unverified = factChecks.filter(f => f.verdict === 'unverified').length;
    
    charts.factCheck = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Verified', 'False', 'Unverified'],
            datasets: [{
                data: [verified, false_claims, unverified],
                backgroundColor: [
                    'rgba(39, 174, 96, 0.8)',
                    'rgba(231, 76, 60, 0.8)',
                    'rgba(243, 156, 18, 0.8)'
                ],
                borderColor: [
                    'rgb(39, 174, 96)',
                    'rgb(231, 76, 60)',
                    'rgb(243, 156, 18)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

function updateEmotionGauge(score) {
    const gauge = document.getElementById('emotion-gauge');
    const scoreEl = document.getElementById('emotion-score');
    
    // Calculate arc path
    const angle = (score / 100) * 180;
    const radians = (angle * Math.PI) / 180;
    const x = 150 + 120 * Math.cos(Math.PI - radians);
    const y = 120 - 120 * Math.sin(Math.PI - radians);
    
    const largeArcFlag = angle > 180 ? 1 : 0;
    const pathData = `M 30 120 A 120 120 0 ${largeArcFlag} 1 ${x} ${y}`;
    
    // Determine color
    let color = '#10b981'; // green
    if (score > 60) color = '#ef4444'; // red
    else if (score > 30) color = '#f59e0b'; // orange
    
    gauge.setAttribute('d', pathData);
    gauge.style.stroke = color;
    
    // Animate score
    animateNumber(scoreEl, 0, score, 1000);
}

function createSourceNetwork(sourcesCount) {
    const network = document.getElementById('source-network');
    network.innerHTML = '';
    
    // Create central node
    const centerX = network.offsetWidth / 2;
    const centerY = network.offsetHeight / 2;
    
    const centralNode = document.createElement('div');
    centralNode.className = 'source-node primary';
    centralNode.style.left = (centerX - 50) + 'px';
    centralNode.style.top = (centerY - 50) + 'px';
    centralNode.textContent = 'This Article';
    network.appendChild(centralNode);
    
    // Create surrounding nodes
    const radius = 120;
    const angleStep = (2 * Math.PI) / Math.max(sourcesCount - 1, 1);
    
    for (let i = 0; i < Math.min(sourcesCount - 1, 6); i++) {
        const angle = i * angleStep - Math.PI / 2;
        const x = centerX + radius * Math.cos(angle) - 40;
        const y = centerY + radius * Math.sin(angle) - 40;
        
        // Create connection
        const connection = document.createElement('div');
        connection.className = 'source-connection';
        const deltaX = x - centerX + 40;
        const deltaY = y - centerY + 40;
        const length = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
        const angleRad = Math.atan2(deltaY, deltaX);
        
        connection.style.width = length + 'px';
        connection.style.left = centerX + 'px';
        connection.style.top = centerY + 'px';
        connection.style.transform = `rotate(${angleRad}rad)`;
        network.appendChild(connection);
        
        // Create node
        const node = document.createElement('div');
        node.className = 'source-node';
        node.style.left = x + 'px';
        node.style.top = y + 'px';
        node.textContent = `Source ${i + 1}`;
        network.appendChild(node);
    }
}

function createCoverageTimeline(results) {
    const timeline = document.getElementById('coverage-timeline');
    timeline.innerHTML = '<div class="timeline-line"></div>';
    
    // Mock timeline data (would be real data from API)
    const timelineData = [
        { source: 'Original Article', time: '2 hours ago', type: 'major' },
        { source: 'Reuters', time: '3 hours ago', type: 'major' },
        { source: 'Local News', time: '5 hours ago', type: 'independent' },
        { source: 'BBC', time: '6 hours ago', type: 'major' }
    ];
    
    timelineData.forEach(item => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';
        timelineItem.innerHTML = `
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <div class="timeline-source">${item.source}</div>
                <div class="timeline-time">${item.time}</div>
            </div>
        `;
        timeline.appendChild(timelineItem);
    });
}

// ============================================
// DISPLAY HELPER FUNCTIONS
// ============================================

function displayFactCheckStats(factChecks, claims) {
    const statsEl = document.getElementById('fact-check-stats');
    
    if (factChecks.length > 0) {
        const verified = factChecks.filter(f => f.verdict === 'true').length;
        const false_claims = factChecks.filter(f => f.verdict === 'false').length;
        const unverified = factChecks.filter(f => f.verdict === 'unverified').length;
        
        statsEl.innerHTML = `
            <div class="fact-stat verified">
                <div class="fact-stat-icon"><i class="fas fa-check-circle"></i></div>
                <div class="fact-stat-number">${verified}</div>
                <div class="fact-stat-label">Verified</div>
            </div>
            <div class="fact-stat false">
                <div class="fact-stat-icon"><i class="fas fa-times-circle"></i></div>
                <div class="fact-stat-number">${false_claims}</div>
                <div class="fact-stat-label">False</div>
            </div>
            <div class="fact-stat unverified">
                <div class="fact-stat-icon"><i class="fas fa-question-circle"></i></div>
                <div class="fact-stat-number">${unverified}</div>
                <div class="fact-stat-label">Unverified</div>
            </div>
        `;
    } else {
        statsEl.innerHTML = `
            <div class="fact-stat unverified">
                <div class="fact-stat-icon"><i class="fas fa-info-circle"></i></div>
                <div class="fact-stat-number">${claims.length}</div>
                <div class="fact-stat-label">Claims to Verify</div>
            </div>
        `;
    }
}

function createFactCheckCard(check, index) {
    const verdictClass = {
        'true': 'verified',
        'false': 'false',
        'misleading': 'false',
        'unverified': 'unverified'
    }[check.verdict] || 'unverified';
    
    return `
        <div class="claim-card ${verdictClass}">
            <div class="claim-header">
                <div class="claim-text">"${check.claim}"</div>
                <span class="claim-verdict verdict-${verdictClass}">${check.verdict.toUpperCase()}</span>
            </div>
            <div class="claim-details">
                <p class="claim-explanation">${check.explanation}</p>
                ${check.sources && check.sources.length > 0 ? `
                    <div class="claim-sources">
                        ${check.sources.map(source => 
                            `<a href="#" class="claim-source">${source}</a>`
                        ).join('')}
                    </div>
                ` : ''}
                ${check.confidence ? `
                    <div class="claim-confidence">
                        <span class="confidence-label">Confidence:</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${check.confidence}%"></div>
                        </div>
                        <span class="confidence-percentage">${check.confidence}%</span>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

function createClaimCard(claim, index) {
    const claimText = typeof claim === 'object' ? claim.claim : claim;
    const importance = typeof claim === 'object' ? claim.importance : 'medium';
    
    return `
        <div class="claim-card unverified">
            <div class="claim-header">
                <div class="claim-text">"${claimText}"</div>
                <span class="claim-verdict verdict-unverified">NEEDS VERIFICATION</span>
            </div>
            <div class="claim-details">
                <p class="claim-explanation">This claim requires external fact-checking for verification.</p>
                <p><small>Importance: ${importance}</small></p>
            </div>
        </div>
    `;
}

function displayVerificationSources() {
    const sourcesEl = document.getElementById('verification-sources');
    sourcesEl.innerHTML = `
        <div class="verification-sources-grid">
            <div class="verification-source">
                <i class="fab fa-google"></i>
                <span>Google Fact Check</span>
            </div>
            <div class="verification-source">
                <i class="fas fa-newspaper"></i>
                <span>News API</span>
            </div>
            <div class="verification-source">
                <i class="fas fa-brain"></i>
                <span>GPT-4 Analysis</span>
            </div>
            <div class="verification-source">
                <i class="fas fa-database"></i>
                <span>Fact Databases</span>
            </div>
        </div>
    `;
}

function displayBiasExamples(examples) {
    const examplesEl = document.getElementById('bias-examples');
    examplesEl.innerHTML = '<h5>Bias Indicators Found:</h5>' +
        examples.map(example => `
            <div class="bias-example-card">
                <div class="bias-example-type">Language Pattern</div>
                <div class="bias-example-text">"${example}"</div>
                <div class="bias-example-explanation">
                    This phrasing suggests political bias through loaded language or framing.
                </div>
            </div>
        `).join('');
}

function displayAgendaIndicators(results) {
    const indicatorsEl = document.getElementById('agenda-indicators');
    const tactics = results.manipulation_tactics || [];
    
    if (tactics.length > 0) {
        indicatorsEl.innerHTML = '<h5>Manipulation Tactics Detected:</h5>' +
            '<div class="agenda-tactics-grid">' +
            tactics.map(tactic => `
                <div class="agenda-tactic">
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    <span>${typeof tactic === 'object' ? tactic.tactic : tactic}</span>
                </div>
            `).join('') +
            '</div>';
    }
}

function displayClickbaitPatterns(patterns) {
    const patternsEl = document.getElementById('clickbait-patterns');
    patternsEl.innerHTML = '<h5>Clickbait Patterns Detected:</h5>' +
        '<div class="clickbait-patterns-grid">' +
        patterns.map(pattern => `
            <div class="clickbait-pattern">
                <i class="fas fa-mouse-pointer text-warning"></i>
                <span>${pattern}</span>
            </div>
        `).join('') +
        '</div>';
}

function displayEmotionBreakdown(emotionData) {
    const breakdownEl = document.getElementById('emotion-breakdown');
    const emotions = emotionData.emotions || {
        fear: 20,
        anger: 15,
        joy: 10,
        sadness: 25,
        surprise: 5,
        trust: 15,
        disgust: 5,
        anticipation: 5
    };
    
    breakdownEl.innerHTML = '<h5>Emotional Content Breakdown:</h5>' +
        '<div class="emotion-grid">' +
        Object.entries(emotions).map(([emotion, value]) => `
            <div class="emotion-item">
                <div class="emotion-label">${emotion.charAt(0).toUpperCase() + emotion.slice(1)}</div>
                <div class="emotion-bar">
                    <div class="emotion-fill" style="width: ${value}%; background: ${getEmotionColor(emotion)}"></div>
                </div>
                <div class="emotion-value">${value}%</div>
            </div>
        `).join('') +
        '</div>';
}

function displayUpdateFrequency(results) {
    const freqEl = document.getElementById('update-frequency');
    freqEl.innerHTML = `
        <h5>Story Development</h5>
        <p>This story type typically updates: <strong>Daily</strong></p>
        <p>Last checked for updates: <strong>Just now</strong></p>
    `;
}

function displayAIPatterns(patterns) {
    const patternsEl = document.getElementById('ai-patterns-list');
    patternsEl.innerHTML = patterns.map(pattern => `
        <div class="ai-pattern-item">
            <i class="fas fa-robot text-warning"></i>
            <span>${pattern}</span>
        </div>
    `).join('');
}

// ============================================
// EXPLANATION GENERATORS
// ============================================

function getSourceExplanation(score, sourceData) {
    if (score >= 80) {
        return 'This source has an excellent track record of accurate reporting and maintains high journalistic standards.';
    } else if (score >= 60) {
        return 'This source is generally reliable but has shown occasional issues with accuracy or bias.';
    } else {
        return 'This source has significant credibility issues. Verify all information through more reliable channels.';
    }
}

function getQualityExplanation(score, length) {
    if (score >= 80) {
        return 'The writing quality meets professional standards with clear structure and proper sourcing.';
    } else if (score >= 60) {
        return 'The writing quality is acceptable but could benefit from better structure or more thorough sourcing.';
    } else {
        return 'Poor writing quality suggests lack of editorial oversight or professional standards.';
    }
}

function getFactCheckExplanation(factChecks, claims) {
    if (factChecks.length > 0) {
        const accuracy = factChecks.filter(f => f.verdict === 'true').length / factChecks.length;
        if (accuracy >= 0.8) {
            return 'High factual accuracy with most claims verified as true.';
        } else if (accuracy >= 0.5) {
            return 'Mixed factual accuracy - verify claims independently before accepting.';
        } else {
            return 'Low factual accuracy detected. This article contains multiple false or misleading claims.';
        }
    } else if (claims.length > 0) {
        return 'Claims identified but require manual verification against trusted sources.';
    } else {
        return 'No specific factual claims found to verify.';
    }
}

function getBiasExplanation(biasScore) {
    if (biasScore === undefined || biasScore === 'N/A') {
        return 'Unable to determine political bias - content may be apolitical or too brief for analysis.';
    }
    
    const absScore = Math.abs(biasScore);
    if (absScore < 0.2) {
        return 'Minimal bias detected. The article maintains political neutrality and balanced reporting.';
    } else if (absScore < 0.5) {
        return 'Moderate bias present. Be aware of how political framing may influence the presentation of facts.';
    } else {
        return 'Strong political bias detected. The article heavily favors one political perspective over others.';
    }
}

function getClickbaitExplanation(score) {
    if (score < 30) {
        return 'The headline accurately represents the article content without sensationalism.';
    } else if (score < 60) {
        return 'Some clickbait elements present. The headline may oversell or dramatize the actual content.';
    } else {
        return 'High clickbait score indicates manipulative headline tactics designed to generate clicks over informing readers.';
    }
}

function getEmotionExplanation(score) {
    if (score < 30) {
        return 'Appropriate emotional tone that informs without manipulation.';
    } else if (score < 60) {
        return 'Elevated emotional content may influence reader judgment. Consider the facts separately from emotional framing.';
    } else {
        return 'High emotional manipulation detected. The article appears designed to provoke strong emotional responses rather than inform.';
    }
}

function getDiversityExplanation(score, count) {
    if (score >= 70) {
        return `Excellent source diversity with ${count} different sources provides a well-rounded perspective.`;
    } else if (score >= 40) {
        return `Moderate diversity with ${count} sources. Consider seeking additional perspectives for a complete picture.`;
    } else {
        return `Limited to ${count} source${count > 1 ? 's' : ''} creates risk of bias or incomplete information.`;
    }
}

function getAIExplanation(score) {
    if (score < 30) {
        return 'Content appears to be written by a human author with natural language patterns.';
    } else if (score < 60) {
        return 'Mixed signals suggest possible AI assistance or heavy editing of automated content.';
    } else {
        return 'High probability of AI-generated content. May lack original reporting or human insight.';
    }
}

function getTimelinessAdvice(age) {
    if (age.includes('day') || age === 'Today') {
        return 'Current information but verify if story has developed further.';
    } else if (age.includes('week')) {
        return 'Recent enough for most topics but check for updates on rapidly changing stories.';
    } else if (age.includes('month')) {
        return 'Consider if newer information is available, especially for time-sensitive topics.';
    } else {
        return 'Significantly outdated. Seek current sources for up-to-date information.';
    }
}

function getEmotionColor(emotion) {
    const colors = {
        fear: '#e74c3c',
        anger: '#c0392b',
        joy: '#f39c12',
        sadness: '#3498db',
        surprise: '#9b59b6',
        trust: '#27ae60',
        disgust: '#95a5a6',
        anticipation: '#f39c12'
    };
    return colors[emotion] || '#95a5a6';
}

// ============================================
// ERROR HANDLING
// ============================================

function showError(message) {
    const errorContainer = document.getElementById('error-container');
    const errorMessage = document.getElementById('error-message');
    const suggestionList = document.getElementById('suggestion-list');
    
    errorMessage.textContent = message;
    
    // Generate suggestions based on error
    const suggestions = [];
    if (message.toLowerCase().includes('extract') || message.toLowerCase().includes('fetch')) {
        suggestions.push(
            'Try using the "Paste Text" option instead',
            'Check if the URL is correctly formatted',
            'Ensure the website is accessible',
            'Try a different news article'
        );
    } else if (message.toLowerCase().includes('network')) {
        suggestions.push(
            'Check your internet connection',
            'Try again in a few moments',
            'Refresh the page and retry'
        );
    } else {
        suggestions.push(
            'Try a different article',
            'Use the "Paste Text" option',
            'Contact support if the issue persists'
        );
    }
    
    suggestionList.innerHTML = suggestions.map(s => `<li>${s}</li>`).join('');
    
    errorContainer.style.display = 'block';
    errorContainer.scrollIntoView({ behavior: 'smooth' });
}

function retryAnalysis() {
    document.getElementById('error-container').style.display = 'none';
    analyzeArticle();
}

function contactSupport() {
    window.location.href = '/contact';
}

function filterTimeline(type) {
    const buttons = document.querySelectorAll('.filter-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // In real implementation, would filter timeline items
    console.log('Filtering timeline by:', type);
}

        // ============================================
// AI INSIGHTS GENERATION
// ============================================

function generateAndDisplayAIInsights(results) {
    // Generate insights for each section
    const insights = generateAIInsights(results);
    
    // Display insights in respective sections
    document.getElementById('overall-ai-insight').textContent = insights.overall || 'Comprehensive analysis shows mixed credibility signals.';
    document.getElementById('source-ai-insight').textContent = insights.source || 'Source credibility analysis pending.';
    document.getElementById('author-ai-insight').textContent = insights.author || 'Author verification in progress.';
    document.getElementById('quality-ai-insight').textContent = insights.quality || 'Writing quality assessment complete.';
    document.getElementById('fact-ai-insight').textContent = insights.facts || 'Fact-checking analysis complete.';
    document.getElementById('bias-ai-insight').textContent = insights.bias || 'Political bias assessment complete.';
    document.getElementById('agenda-ai-insight').textContent = insights.agenda || 'Hidden agenda analysis complete.';
    document.getElementById('clickbait-ai-insight').textContent = insights.clickbait || 'Clickbait patterns analyzed.';
    document.getElementById('emotion-ai-insight').textContent = insights.emotion || 'Emotional manipulation assessment complete.';
    document.getElementById('diversity-ai-insight').textContent = insights.diversity || 'Source diversity evaluated.';
    document.getElementById('timeliness-ai-insight').textContent = insights.timeliness || 'Timeliness factors assessed.';
    document.getElementById('ai-content-insight').textContent = insights.ai || 'AI content detection complete.';
}

function generateAIInsights(results) {
    return {
        overall: `This article scored ${results.trust_score}% in our credibility assessment. ${
            results.trust_score >= 80 ? 'The content demonstrates high journalistic standards.' :
            results.trust_score >= 60 ? 'The content shows moderate reliability with some concerns.' :
            'Significant credibility issues were detected.'
        }`,
        source: `The source ${results.article_info?.domain || 'unknown'} has a credibility score of ${
            Math.round((results.credibility_score || 0) * 100)
        }%.`,
        author: findAuthor(results) !== 'Unknown' ? 
            'Author attribution provides accountability.' : 
            'Missing author information reduces transparency.',
        quality: 'Writing quality analysis indicates professional standards.',
        facts: results.fact_checks?.length > 0 ? 
            'Multiple claims have been fact-checked with varying results.' : 
            'Limited factual claims available for verification.',
        bias: results.bias_score !== undefined ? 
            `Political bias detected at ${results.bias_score.toFixed(2)} on our scale.` : 
            'Political bias assessment inconclusive.',
        agenda: 'Analysis complete for hidden persuasion tactics.',
        clickbait: 'Headline-content alignment has been evaluated.',
        emotion: 'Emotional manipulation techniques have been assessed.',
        diversity: 'Source diversity and citation patterns analyzed.',
        timeliness: 'Publication date and relevance evaluated.',
        ai: 'AI-generated content probability calculated.'
    };
}
// ============================================
// PDF GENERATION
// ============================================

async function generatePDF() {
    if (!currentAnalysisResults) {
        alert('Please run an analysis first');
        return;
    }
    
    const btn = event.target.closest('button');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
    btn.disabled = true;
    
    try {
        // Generate comprehensive PDF
        generateComprehensivePDF();
    } catch (error) {
        console.error('PDF generation error:', error);
        alert('Error generating PDF. Please try again.');
    } finally {
        btn.innerHTML = originalHTML;
        btn.disabled = false;
    }
}

function generateComprehensivePDF() {
    const results = currentAnalysisResults;
    const insights = generateAIInsights(results);
    
    // Create print window
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>News Analysis Report - Facts & Fakes AI</title>
            <style>
                @page { margin: 1in; }
                body { 
                    font-family: Arial, sans-serif; 
                    line-height: 1.6;
                    color: #333;
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 20px;
                }
                h1, h2, h3 { color: #4a90e2; }
                .header { text-align: center; margin-bottom: 40px; }
                .score-box {
                    background: #f8f9fa;
                    border: 2px solid #4a90e2;
                    border-radius: 10px;
                    padding: 20px;
                    text-align: center;
                    margin: 20px 0;
                }
                .section {
                    margin-bottom: 30px;
                    page-break-inside: avoid;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 20px 0;
                }
                th, td {
                    border: 1px solid #ddd;
                    padding: 12px;
                    text-align: left;
                }
                th {
                    background: #f8f9fa;
                    font-weight: bold;
                }
                .footer {
                    margin-top: 50px;
                    text-align: center;
                    color: #666;
                    font-size: 12px;
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>News Analysis Report</h1>
                <p>Generated by Facts & Fakes AI</p>
                <p>${new Date().toLocaleString()}</p>
            </div>
            
            <div class="score-box">
                <h2>Trust Score: ${results.trust_score}%</h2>
                <p>${results.trust_score >= 80 ? 'HIGH' : results.trust_score >= 60 ? 'MODERATE' : 'LOW'} CREDIBILITY</p>
            </div>
            
            <div class="section">
                <h2>Executive Summary</h2>
                <p>${results.summary || 'Analysis completed successfully.'}</p>
                <p><strong>AI Insight:</strong> ${insights.overall}</p>
            </div>
            
            <div class="section">
                <h2>Article Information</h2>
                <table>
                    <tr><th>Title</th><td>${results.article_info?.title || 'Not available'}</td></tr>
                    <tr><th>Author</th><td>${findAuthor(results)}</td></tr>
                    <tr><th>Source</th><td>${results.article_info?.domain || 'Unknown'}</td></tr>
                    <tr><th>Published</th><td>${results.article_info?.publish_date || 'Unknown'}</td></tr>
                    <tr><th>URL</th><td>${results.article_info?.url || 'Not provided'}</td></tr>
                </table>
            </div>
            
            <div class="section">
                <h2>Analysis Results</h2>
                <table>
                    <tr><th>Metric</th><th>Score</th><th>Assessment</th></tr>
                    <tr>
                        <td>Trust Score</td>
                        <td>${results.trust_score}%</td>
                        <td>${results.trust_score >= 80 ? 'Excellent' : results.trust_score >= 60 ? 'Good' : 'Poor'}</td>
                    </tr>
                    <tr>
                        <td>Source Credibility</td>
                        <td>${Math.round((results.credibility_score || 0) * 100)}%</td>
                        <td>${results.credibility_score >= 0.8 ? 'High' : results.credibility_score >= 0.6 ? 'Moderate' : 'Low'}</td>
                    </tr>
                    <tr>
                        <td>Political Bias</td>
                        <td>${results.bias_score !== undefined ? results.bias_score.toFixed(2) : 'N/A'}</td>
                        <td>${getBiasLabel(results.bias_score)}</td>
                    </tr>
                    <tr>
                        <td>Clickbait Level</td>
                        <td>${results.clickbait_analysis?.score || 'N/A'}%</td>
                        <td>${(results.clickbait_analysis?.score || 0) < 30 ? 'Low' : (results.clickbait_analysis?.score || 0) < 60 ? 'Moderate' : 'High'}</td>
                    </tr>
                </table>
            </div>
            
            ${results.fact_checks && results.fact_checks.length > 0 ? `
                <div class="section">
                    <h2>Fact-Checking Results</h2>
                    <table>
                        <tr><th>Claim</th><th>Verdict</th><th>Confidence</th></tr>
                        ${results.fact_checks.map(check => `
                            <tr>
                                <td>${check.claim}</td>
                                <td>${check.verdict.toUpperCase()}</td>
                                <td>${check.confidence || 'N/A'}%</td>
                            </tr>
                        `).join('')}
                    </table>
                </div>
            ` : ''}
            
            ${results.manipulation_tactics && results.manipulation_tactics.length > 0 ? `
                <div class="section">
                    <h2>Manipulation Tactics Detected</h2>
                    <ul>
                        ${results.manipulation_tactics.map(tactic => 
                            `<li>${typeof tactic === 'object' ? tactic.tactic : tactic}</li>`
                        ).join('')}
                    </ul>
                </div>
            ` : ''}
            
            <div class="section">
                <h2>Recommendations</h2>
                ${results.recommendations && results.recommendations.length > 0 ? `
                    <ul>
                        ${results.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                ` : '<p>Based on the analysis, this article appears to meet acceptable standards for reliability.</p>'}
            </div>
            
            <div class="footer">
                <p>This report was generated by Facts & Fakes AI - Advanced News Verification</p>
                <p>For more information, visit factsandfakes.com</p>
            </div>
        </body>
        </html>
    `);
    
    printWindow.document.close();
    printWindow.onload = function() {
        printWindow.print();
    };
}
</script> 
    <!-- Analysis Process Modal -->
    <div class="modal fade" id="analysisProcessModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-cogs me-2"></i>Our Comprehensive Analysis Process
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Our AI-powered analysis examines:</h6>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <ul>
                                <li><strong>Source Credibility:</strong> Historical accuracy, transparency, corrections policy</li>
                                <li><strong>Author Background:</strong> Expertise, publication history, credentials</li>
                                <li><strong>Writing Quality:</strong> Grammar, structure, professionalism</li>
                                <li><strong>Fact Verification:</strong> Cross-reference with multiple databases</li>
                                <li><strong>Political Bias:</strong> 50,000+ term analysis, framing detection</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul>
                                <li><strong>Hidden Agendas:</strong> Commercial interests, persuasion tactics</li>
                                <li><strong>Clickbait Detection:</strong> Headline-content matching</li>
                                <li><strong>Emotional Manipulation:</strong> 8 emotion categories analyzed</li>
                                <li><strong>Source Diversity:</strong> Variety and balance assessment</li>
                                <li><strong>AI Content Detection:</strong> Pattern analysis across models</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    </body>
</html>
    
```
