{% extends "base.html" %}

{% block title %}Advanced News Analyzer - Facts & Fakes AI{% endblock %}
{% block description %}AI-powered news verification with bias detection, fact-checking, and credibility analysis. Detect fake news instantly with our advanced algorithms.{% endblock %}

{% block styles %}
<style>
    /* Enhanced Trust Meter - Larger and More Prominent */
    .trust-meter-container {
        position: relative;
        width: 250px;
        height: 250px;
        margin: 30px auto;
        background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
        border-radius: 50%;
        box-shadow: 0 10px 40px rgba(99, 102, 241, 0.2);
        padding: 20px;
        animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
    }
    
    .trust-meter {
        position: relative;
        width: 100%;
        height: 100%;
    }
    
    .trust-meter-circle {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
    }
    
    .trust-meter-bg {
        fill: none;
        stroke: #e5e7eb;
        stroke-width: 20;
    }
    
    .trust-meter-fill {
        fill: none;
        stroke-width: 20;
        stroke-linecap: round;
        transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        filter: drop-shadow(0 0 10px currentColor);
    }
    
    .trust-meter-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    
    .trust-score {
        font-size: 48px;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        display: block;
    }
    
    .trust-label {
        font-size: 14px;
        color: #6b7280;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Sticky Upgrade Button */
    .sticky-upgrade {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 1000;
        animation: pulse 2s infinite;
    }
    
    .sticky-upgrade button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
    }
    
    .sticky-upgrade button:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    /* Tooltips */
    .tooltip-container {
        position: relative;
        display: inline-block;
        cursor: help;
    }
    
    .tooltip-icon {
        width: 16px;
        height: 16px;
        background: #e5e7eb;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        color: #6b7280;
        margin-left: 5px;
        transition: all 0.2s ease;
    }
    
    .tooltip-icon:hover {
        background: #6366f1;
        color: white;
    }
    
    .tooltip-content {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #1f2937;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 14px;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        margin-bottom: 10px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        max-width: 300px;
        white-space: normal;
        z-index: 1000;
    }
    
    .tooltip-container:hover .tooltip-content {
        opacity: 1;
    }
    
    .tooltip-content::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: #1f2937;
    }

    /* Analysis Timestamp and Version */
    .analysis-meta {
        background: #f3f4f6;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 15px;
        margin: 20px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        font-size: 14px;
    }
    
    .meta-item i {
        color: #6366f1;
    }

    /* Confidence Intervals */
    .confidence-bar {
        position: relative;
        height: 30px;
        background: #f3f4f6;
        border-radius: 15px;
        overflow: hidden;
        margin: 10px 0;
    }
    
    .confidence-fill {
        height: 100%;
        background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
        transition: width 1s ease;
        position: relative;
    }
    
    .confidence-marker {
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 4px;
        height: 20px;
        background: #1f2937;
        border-radius: 2px;
    }
    
    .confidence-label {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: 600;
        font-size: 14px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    /* Pro Features Preview (Grayed Out) */
    .pro-feature-locked {
        position: relative;
        opacity: 0.6;
        filter: grayscale(100%);
        pointer-events: none;
    }
    
    .pro-feature-locked::after {
        content: 'PRO FEATURE';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-15deg);
        background: #6366f1;
        color: white;
        padding: 5px 20px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 12px;
        box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
    }

    /* Why This Matters Sections */
    .why-matters-box {
        background: #fef3c7;
        border: 1px solid #fcd34d;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
    }
    
    .why-matters-box h4 {
        color: #92400e;
        margin: 0 0 8px 0;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .why-matters-box p {
        color: #78350f;
        margin: 0;
        font-size: 14px;
        line-height: 1.6;
    }

    /* Methodology Snippets */
    .methodology-snippet {
        background: #ede9fe;
        border: 1px solid #c7d2fe;
        border-radius: 8px;
        padding: 12px;
        margin: 10px 0;
        font-size: 13px;
        color: #5b21b6;
    }
    
    .methodology-snippet code {
        background: #ddd6fe;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
    }

    /* Learn More Links */
    .learn-more-link {
        color: #6366f1;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        transition: all 0.2s ease;
    }
    
    .learn-more-link:hover {
        color: #4f46e5;
        gap: 8px;
    }

    /* Existing styles from original - Animated particles background */
    @keyframes float-particle {
        0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translate(100px, -100vh) rotate(720deg); opacity: 0; }
    }
    
    .particle {
        position: fixed;
        pointer-events: none;
        opacity: 0;
        animation: float-particle 10s infinite;
    }
    
    .particle:nth-child(odd) { animation-duration: 15s; }
    .particle:nth-child(even) { animation-duration: 20s; animation-delay: 5s; }

    /* Existing animated dropdowns with colorful borders */
    .analysis-dropdown {
        margin-bottom: 15px;
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    .analysis-dropdown:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }
    
    .dropdown-header {
        padding: 20px;
        cursor: pointer;
        background: white;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .dropdown-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
        transition: left 0.5s ease;
    }
    
    .dropdown-header:hover::before {
        left: 100%;
    }
    
    .dropdown-header h3 {
        margin: 0;
        font-size: 20px;
        display: flex;
        align-items: center;
        color: #1f2937;
    }
    
    .dropdown-header i {
        font-size: 24px;
        margin-right: 15px;
    }
    
    .dropdown-content {
        padding: 0;
        max-height: 0;
        overflow: hidden;
        transition: all 0.3s ease;
        background: #f9fafb;
    }
    
    .dropdown-content.show {
        max-height: 2000px;
        padding: 20px;
    }
    
    /* Colorful borders for different sections */
    .border-trust { border-left: 4px solid #10b981 !important; }
    .border-bias { border-left: 4px solid #f59e0b !important; }
    .border-fact { border-left: 4px solid #3b82f6 !important; }
    .border-author { border-left: 4px solid #8b5cf6 !important; }
    .border-quality { border-left: 4px solid #ec4899 !important; }
    .border-agenda { border-left: 4px solid #ef4444 !important; }
    .border-clickbait { border-left: 4px solid #f97316 !important; }
    .border-emotion { border-left: 4px solid #06b6d4 !important; }
    .border-diversity { border-left: 4px solid #84cc16 !important; }
    .border-time { border-left: 4px solid #6366f1 !important; }
    .border-ai { border-left: 4px solid #14b8a6 !important; }

    /* Existing gauge styles */
    .gauge-container {
        width: 200px;
        height: 100px;
        position: relative;
        margin: 20px auto;
    }
    
    .gauge {
        width: 100%;
        height: 200px;
        border-radius: 100px 100px 0 0;
        background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%);
        position: relative;
        overflow: hidden;
    }
    
    .gauge-mask {
        width: 160px;
        height: 160px;
        background: white;
        border-radius: 80px 80px 0 0;
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
    }
    
    .gauge-needle {
        width: 4px;
        height: 90px;
        background: #1f2937;
        position: absolute;
        bottom: 0;
        left: 50%;
        transform-origin: bottom center;
        transform: translateX(-50%) rotate(-90deg);
        transition: transform 1s ease-out;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    /* Progress bar for loading */
    .progress-container {
        background: #e5e7eb;
        border-radius: 10px;
        padding: 4px;
        margin: 20px 0;
    }
    
    .progress-bar {
        height: 30px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        width: 0%;
        transition: width 0.5s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
    }

    /* Claim cards */
    .claim-card {
        background: white;
        border-radius: 10px;
        padding: 15px;
        margin: 10px 0;
        border: 2px solid #e5e7eb;
        transition: all 0.3s ease;
    }
    
    .claim-card:hover {
        transform: translateX(5px);
        border-color: #6366f1;
        box-shadow: 0 5px 15px rgba(99, 102, 241, 0.2);
    }
    
    .claim-status {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        margin-top: 10px;
    }
    
    .status-verified {
        background: #d1fae5;
        color: #065f46;
    }
    
    .status-false {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .status-unverified {
        background: #fed7aa;
        color: #92400e;
    }

    /* Glowing effect for important elements */
    @keyframes glow {
        0% { box-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
        50% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.8), 0 0 30px rgba(99, 102, 241, 0.6); }
        100% { box-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
    }
    
    .glow-effect {
        animation: glow 2s ease-in-out infinite;
    }

    /* PDF button */
    .pdf-button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .pdf-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
    }

    /* Source comparison grid */
    .source-comparison {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .source-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .source-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .source-logo {
        width: 50px;
        height: 50px;
        margin: 0 auto 10px;
        background: #f3f4f6;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: #6b7280;
    }
    
    .source-score {
        font-size: 24px;
        font-weight: 700;
        margin: 5px 0;
    }

    /* Historical accuracy chart */
    .accuracy-chart {
        height: 200px;
        background: #f9fafb;
        border-radius: 8px;
        padding: 20px;
        position: relative;
        margin: 20px 0;
    }
    
    .chart-grid {
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        bottom: 40px;
        border-left: 2px solid #e5e7eb;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .chart-line {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: #6366f1;
    }

    /* Enhanced loading animation stages */
    .analysis-stage {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: white;
        border-radius: 8px;
        margin: 10px 0;
        opacity: 0.5;
        transition: all 0.3s ease;
    }
    
    .analysis-stage.active {
        opacity: 1;
        background: #eef2ff;
        transform: scale(1.02);
        box-shadow: 0 5px 15px rgba(99, 102, 241, 0.2);
    }
    
    .analysis-stage.complete {
        opacity: 1;
    }
    
    .stage-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .analysis-stage.active .stage-icon {
        background: #6366f1;
        color: white;
        animation: rotate 1s linear infinite;
    }
    
    .analysis-stage.complete .stage-icon {
        background: #10b981;
        color: white;
    }
    
    @keyframes rotate {
        to { transform: rotate(360deg); }
    }

    /* Pricing dropdown */
    .pricing-info {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border: 2px solid #fbbf24;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
    }
    
    .pricing-tier {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-radius: 8px;
    }
    
    .pricing-tier h4 {
        margin: 0;
        color: #92400e;
    }
    
    .pricing-tier .price {
        font-size: 24px;
        font-weight: 700;
        color: #dc2626;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
        .trust-meter-container {
            width: 200px;
            height: 200px;
        }
        
        .trust-score {
            font-size: 36px;
        }
        
        .analysis-dropdown {
            margin-bottom: 10px;
        }
        
        .dropdown-header {
            padding: 15px;
        }
        
        .dropdown-header h3 {
            font-size: 18px;
        }
        
        .source-comparison {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .sticky-upgrade {
            bottom: 20px;
            right: 20px;
        }
        
        .sticky-upgrade button {
            padding: 12px 20px;
            font-size: 14px;
        }
    }

    /* Input section styling */
    .input-section {
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    }
    
    .input-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .input-tab {
        flex: 1;
        padding: 12px;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        font-weight: 600;
    }
    
    .input-tab.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
    }
    
    .input-tab:hover:not(.active) {
        background: #f9fafb;
        border-color: #6366f1;
    }
    
    #news-url, #news-text {
        width: 100%;
        padding: 15px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    #news-url:focus, #news-text:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    #news-text {
        min-height: 150px;
        resize: vertical;
    }
    
    .analyze-button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
    }
    
    .analyze-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
    }
    
    .analyze-button:active {
        transform: translateY(0);
    }
</style>
{% endblock %}

{% block content %}
<!-- Floating particles for visual appeal -->
<div class="particle" style="left: 10%; top: 20%; width: 6px; height: 6px; background: #667eea; border-radius: 50%;"></div>
<div class="particle" style="left: 80%; top: 40%; width: 8px; height: 8px; background: #764ba2; border-radius: 50%;"></div>
<div class="particle" style="left: 60%; top: 60%; width: 5px; height: 5px; background: #10b981; border-radius: 50%;"></div>
<div class="particle" style="left: 30%; top: 80%; width: 7px; height: 7px; background: #f59e0b; border-radius: 50%;"></div>

<!-- Header -->
{% include 'includes/header.html' %}

<div class="container py-5">
    <!-- Header Section -->
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold mb-3">
            <i class="fas fa-newspaper text-primary me-3"></i>
            Advanced News Analyzer
        </h1>
        <p class="lead text-muted">
            Verify news authenticity with AI-powered analysis
            <span class="tooltip-container">
                <span class="tooltip-icon">?</span>
                <span class="tooltip-content">
                    Our AI analyzes 15+ factors including source credibility, writing patterns, 
                    bias indicators, and cross-references with fact-checking databases.
                </span>
            </span>
        </p>
        <!-- Overview Process Button -->
        <button class="btn btn-outline-primary mt-3" onclick="showAnalysisProcess()">
            <i class="fas fa-info-circle me-2"></i>View Our Analysis Process
        </button>
    </div>

    <!-- Input Section with animated gradient background -->
    <div class="input-section">
        <div class="input-tabs">
            <div class="input-tab active" onclick="switchInputType('url')">
                <i class="fas fa-link me-2"></i>Analyze URL
            </div>
            <div class="input-tab" onclick="switchInputType('text')">
                <i class="fas fa-file-alt me-2"></i>Paste Text
            </div>
        </div>
        
        <div id="url-input-section">
            <input type="url" id="news-url" placeholder="https://example.com/article" />
            <small class="text-muted d-block mt-2">
                <i class="fas fa-info-circle me-1"></i>
                We'll extract the full article, metadata, and verify the source
            </small>
        </div>
        
        <div id="text-input-section" style="display: none;">
            <textarea id="news-text" placeholder="Paste the article text here..."></textarea>
            <small class="text-muted d-block mt-2">
                <i class="fas fa-info-circle me-1"></i>
                Include the headline and author if available for best results
            </small>
        </div>
        
        <button class="analyze-button glow-effect" onclick="analyzeArticle()">
            <i class="fas fa-search me-2"></i>Analyze Now
        </button>
    </div>

    <!-- Loading Section with Enhanced Progress -->
    <div id="loading-section" style="display: none;">
        <!-- Compact Fixed Progress Bar -->
        <div style="position: fixed; top: 0; left: 0; right: 0; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; padding: 20px;">
            <div class="container">
                <h5 class="mb-2">
                    <i class="fas fa-brain fa-pulse me-2 text-primary"></i>
                    AI Analysis in Progress...
                </h5>
                <div class="progress-container" style="margin-bottom: 10px;">
                    <div class="progress-bar" id="analysis-progress">0%</div>
                </div>
                <p class="mb-0 text-muted" id="current-stage-text">Initializing analysis...</p>
            </div>
        </div>
        
        <!-- Stages (below fixed header) -->
        <div class="card shadow-lg border-0 mb-5" style="margin-top: 120px;">
            <div class="card-body p-4">
                <!-- Enhanced stages -->
                <div class="analysis-stage" id="stage-1">
                    <div class="stage-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="mb-1">Extracting Content</h5>
                        <small class="text-muted">Retrieving article text, metadata, and author information</small>
                    </div>
                </div>
                
                <div class="analysis-stage" id="stage-2">
                    <div class="stage-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="mb-1">AI Deep Analysis (GPT-4)</h5>
                        <small class="text-muted">Analyzing writing patterns, style, and authenticity markers</small>
                    </div>
                </div>
                
                <div class="analysis-stage" id="stage-3">
                    <div class="stage-icon">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="mb-1">Cross-Reference Fact Checking</h5>
                        <small class="text-muted">Verifying claims against multiple fact-checking databases</small>
                    </div>
                </div>
                
                <div class="analysis-stage" id="stage-4">
                    <div class="stage-icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="mb-1">Bias & Manipulation Detection</h5>
                        <small class="text-muted">Scanning for political bias, emotional manipulation, and agenda</small>
                    </div>
                </div>
                
                <div class="analysis-stage" id="stage-5">
                    <div class="stage-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="mb-1">Source Reliability Analysis</h5>
                        <small class="text-muted">Checking historical accuracy and credibility patterns</small>
                    </div>
                </div>
                
                <div class="analysis-stage" id="stage-6">
                    <div class="stage-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h5 class="mb-1">Generating Comprehensive Report</h5>
                        <small class="text-muted">Compiling findings with confidence intervals and recommendations</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div id="results-section" style="display: none;">
        <!-- Analysis Metadata -->
        <div class="analysis-meta">
            <div class="meta-item">
                <i class="fas fa-clock"></i>
                <span>Analyzed: <span id="analysis-time"></span></span>
            </div>
            <div class="meta-item">
                <i class="fas fa-code-branch"></i>
                <span>Model Version: GPT-4 v2.1</span>
            </div>
            <div class="meta-item">
                <i class="fas fa-server"></i>
                <span>Analysis ID: <span id="analysis-id"></span></span>
            </div>
            <div class="meta-item">
                <button class="pdf-button" onclick="generatePDF()">
                    <i class="fas fa-file-pdf"></i>Generate PDF Report
                </button>
            </div>
        </div>

        <!-- Enhanced Trust Meter (Larger) -->
        <div class="trust-meter-container">
            <div class="trust-meter">
                <svg class="trust-meter-circle" viewBox="0 0 200 200">
                    <circle class="trust-meter-bg" cx="100" cy="100" r="90"/>
                    <circle class="trust-meter-fill" cx="100" cy="100" r="90"
                            stroke-dasharray="565.48" stroke-dashoffset="565.48"/>
                </svg>
                <div class="trust-meter-text">
                    <span class="trust-score" id="trust-score">0</span>
                    <span class="trust-label">Trust Score</span>
                </div>
            </div>
        </div>

        <!-- Overall Assessment (Always Open) -->
        <div class="analysis-dropdown border-trust">
            <div class="dropdown-header">
                <h3><i class="fas fa-chart-pie"></i>Overall Assessment</h3>
            </div>
            <div class="dropdown-content show">
                <div id="overall-assessment"></div>
                
                <!-- Why This Matters -->
                <div class="why-matters-box">
                    <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                    <p id="why-overall-matters">
                        Understanding the overall credibility helps you make informed decisions about 
                        sharing, citing, or acting on this information. High credibility means the article 
                        is more likely to be factual and trustworthy.
                    </p>
                </div>
                
                <!-- Confidence Interval -->
                <div class="mt-3">
                    <h5>Confidence Level
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-content">
                                Our confidence in this assessment based on available data and analysis certainty
                            </span>
                        </span>
                    </h5>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="overall-confidence" style="width: 0%">
                            <div class="confidence-label">0%</div>
                        </div>
                    </div>
                </div>
                
                <div class="key-findings mt-4">
                    <h5>Key Findings:</h5>
                    <ul id="key-findings-list"></ul>
                </div>
                
                <div class="red-flags mt-3">
                    <h5>Red Flags:</h5>
                    <ul id="red-flags-list"></ul>
                </div>
                
                <a href="#" class="learn-more-link mt-3" onclick="showMethodology()">
                    Learn about our methodology <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>

        <!-- Source Credibility -->
        <div class="analysis-dropdown border-author">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-globe"></i>Source Credibility & Comparison</h3>
            </div>
            <div class="dropdown-content">
                <div id="source-credibility"></div>
                
                <!-- Source Comparison Grid -->
                <h5 class="mt-4">How This Source Compares</h5>
                <div class="source-comparison">
                    <div class="source-card">
                        <div class="source-logo">CNN</div>
                        <div class="source-score text-success">85%</div>
                        <small class="text-muted">Avg. Accuracy</small>
                    </div>
                    <div class="source-card">
                        <div class="source-logo">FOX</div>
                        <div class="source-score text-warning">72%</div>
                        <small class="text-muted">Avg. Accuracy</small>
                    </div>
                    <div class="source-card">
                        <div class="source-logo">BBC</div>
                        <div class="source-score text-success">91%</div>
                        <small class="text-muted">Avg. Accuracy</small>
                    </div>
                    <div class="source-card">
                        <div class="source-logo">THIS</div>
                        <div class="source-score" id="this-source-score">--</div>
                        <small class="text-muted">This Source</small>
                    </div>
                </div>
                
                <!-- Historical Accuracy (Pro Feature Preview) -->
                <div class="pro-feature-locked mt-4">
                    <h5>Historical Accuracy Trend</h5>
                    <div class="accuracy-chart">
                        <div class="chart-grid">
                            <div class="chart-line"></div>
                        </div>
                    </div>
                </div>
                
                <div class="methodology-snippet">
                    <strong>How we calculate this:</strong> Source credibility = 
                    <code>0.4 × historical_accuracy + 0.3 × transparency + 0.2 × corrections_policy + 0.1 × awards</code>
                </div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="source-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="source-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Author Credibility -->
        <div class="analysis-dropdown border-author">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-user-check"></i>Author Credibility & Background</h3>
            </div>
            <div class="dropdown-content">
                <div id="author-credibility"></div>
                
                <!-- Author Research Links -->
                <div class="mt-3">
                    <h5>Research This Author:</h5>
                    <div class="btn-group" role="group">
                        <a href="#" class="btn btn-outline-primary btn-sm" id="author-twitter" target="_blank">
                            <i class="fab fa-twitter me-1"></i>Twitter
                        </a>
                        <a href="#" class="btn btn-outline-primary btn-sm" id="author-google" target="_blank">
                            <i class="fab fa-google me-1"></i>Google
                        </a>
                        <a href="#" class="btn btn-outline-primary btn-sm" id="author-linkedin" target="_blank">
                            <i class="fab fa-linkedin me-1"></i>LinkedIn
                        </a>
                    </div>
                </div>
                
                <div class="why-matters-box mt-3">
                    <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                    <p>
                        Authors with established expertise and transparent backgrounds are more likely 
                        to produce accurate, well-researched content. Anonymous or unverifiable authors 
                        should be approached with more skepticism.
                    </p>
                </div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="author-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="author-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Writing Quality -->
        <div class="analysis-dropdown border-quality">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-pen-fancy"></i>Writing Quality & Professionalism</h3>
            </div>
            <div class="dropdown-content">
                <div id="writing-quality"></div>
                
                <div class="methodology-snippet">
                    <strong>Analysis includes:</strong> Grammar scoring, readability index (Flesch-Kincaid), 
                    vocabulary diversity, sentence structure variation, and professional tone markers.
                </div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="quality-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="quality-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Fact-Checking -->
        <div class="analysis-dropdown border-fact">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-check-double"></i>Fact-Checking Results</h3>
            </div>
            <div class="dropdown-content">
                <div id="fact-checking"></div>
                
                <!-- Confidence Intervals for Each Claim -->
                <div class="mt-4" id="claim-confidence-section">
                    <!-- Dynamically populated -->
                </div>
                
                <div class="why-matters-box mt-3">
                    <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                    <p>
                        False or misleading claims can shape opinions and decisions. We verify each 
                        claim against multiple trusted fact-checking databases and provide confidence 
                        levels for our assessments.
                    </p>
                </div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="fact-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="fact-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Political Bias -->
        <div class="analysis-dropdown border-bias">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-balance-scale"></i>Political Bias Detection</h3>
            </div>
            <div class="dropdown-content">
                <!-- Bias spectrum bar -->
                <div class="bias-spectrum mt-3 mb-4">
                    <div style="position: relative; height: 30px; background: linear-gradient(to right, #3b82f6 0%, #e5e7eb 50%, #ef4444 100%); border-radius: 15px;">
                        <div id="bias-marker" style="position: absolute; top: -5px; width: 40px; height: 40px; background: white; border: 3px solid #1f2937; border-radius: 50%; left: 50%; transform: translateX(-50%); box-shadow: 0 2px 10px rgba(0,0,0,0.3);"></div>
                    </div>
                    <div class="d-flex justify-content-between mt-2">
                        <small>Far Left</small>
                        <small>Center</small>
                        <small>Far Right</small>
                    </div>
                </div>
                
                <div id="political-bias"></div>
                
                <div class="methodology-snippet">
                    <strong>Bias detection algorithm:</strong> We analyze word choice, framing, 
                    source selection, and compare against our database of 50,000+ politically-charged 
                    terms weighted by context and frequency.
                </div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="bias-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="bias-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Hidden Agenda -->
        <div class="analysis-dropdown border-agenda">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-user-secret"></i>Hidden Agenda Detection</h3>
            </div>
            <div class="dropdown-content">
                <div id="hidden-agenda"></div>
                
                <div class="why-matters-box mt-3">
                    <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                    <p>
                        Articles with hidden agendas may appear objective but subtly push commercial, 
                        political, or ideological interests. Recognizing these helps you understand 
                        the true purpose behind the content.
                    </p>
                </div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="agenda-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="agenda-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Clickbait Analysis -->
        <div class="analysis-dropdown border-clickbait">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-mouse-pointer"></i>Clickbait & Sensationalism</h3>
            </div>
            <div class="dropdown-content">
                <div id="clickbait-analysis"></div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="clickbait-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="clickbait-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Emotional Manipulation -->
        <div class="analysis-dropdown border-emotion">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-theater-masks"></i>Emotional Manipulation Check</h3>
            </div>
            <div class="dropdown-content">
                <!-- Emotional gauge -->
                <div class="gauge-container">
                    <div class="gauge">
                        <div class="gauge-mask"></div>
                        <div class="gauge-needle" id="emotion-needle"></div>
                    </div>
                </div>
                
                <div id="emotional-manipulation"></div>
                
                <div class="methodology-snippet">
                    <strong>Emotional analysis:</strong> Using sentiment analysis and psychological 
                    trigger word detection across 8 emotional categories (fear, anger, joy, sadness, 
                    disgust, surprise, trust, anticipation).
                </div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="emotion-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="emotion-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Source Diversity -->
        <div class="analysis-dropdown border-diversity">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-project-diagram"></i>Source Diversity & Balance</h3>
            </div>
            <div class="dropdown-content">
                <!-- Progress bar for source diversity -->
                <div class="progress-container mb-3">
                    <div class="progress-bar" id="diversity-bar" style="width: 0%">0%</div>
                </div>
                
                <div id="source-diversity"></div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="diversity-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="diversity-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Timeliness Check -->
        <div class="analysis-dropdown border-time">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-calendar-check"></i>Timeliness & Relevance</h3>
            </div>
            <div class="dropdown-content">
                <div id="timeliness-check"></div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="timeliness-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="timeliness-methodology"></p>
                </div>
            </div>
        </div>

        <!-- AI-Generated Content Detection (New Feature) -->
        <div class="analysis-dropdown border-ai">
            <div class="dropdown-header" onclick="toggleDropdown(this)">
                <h3><i class="fas fa-robot"></i>AI-Generated Content Detection</h3>
            </div>
            <div class="dropdown-content">
                <h5>AI Content Probability</h5>
                <div class="confidence-bar mb-3">
                    <div class="confidence-fill" id="ai-probability" style="width: 0%">
                        <div class="confidence-label">0%</div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h6>AI Pattern Indicators:</h6>
                    <ul id="ai-patterns">
                        <!-- Dynamically populated -->
                    </ul>
                </div>
                
                <div class="methodology-snippet">
                    <strong>Detection method:</strong> Perplexity analysis, burstiness scoring, 
                    repetitive phrasing detection, and comparison against known AI writing patterns 
                    from GPT, Claude, and other models.
                </div>
                
                <div class="what-this-means mt-3">
                    <h5>What This Means:</h5>
                    <p id="ai-explanation"></p>
                </div>
                
                <div class="how-detected mt-3">
                    <h5>How We Detected This:</h5>
                    <p id="ai-methodology"></p>
                </div>
            </div>
        </div>

        <!-- Pricing Information -->
        <div class="pricing-info">
            <h4><i class="fas fa-crown me-2"></i>Upgrade for More Features</h4>
            <div class="pricing-tier">
                <div>
                    <h4>Free Tier</h4>
                    <p class="mb-0">1 analysis per day</p>
                </div>
                <div class="price">$0</div>
            </div>
            <div class="pricing-tier">
                <div>
                    <h4>Pro Tier</h4>
                    <p class="mb-0">Unlimited analyses + API access</p>
                </div>
                <div class="price">$29/mo</div>
            </div>
        </div>

        <!-- Pro Features Section -->
        <div class="card border-primary mt-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-crown me-2"></i>Unlock Pro Features
                </h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Additional Pro Features:</h5>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success me-2"></i>Historical source accuracy tracking</li>
                            <li><i class="fas fa-check text-success me-2"></i>Multi-article comparison</li>
                            <li><i class="fas fa-check text-success me-2"></i>Deep web verification</li>
                            <li><i class="fas fa-check text-success me-2"></i>Real-time fact updates</li>
                            <li><i class="fas fa-check text-success me-2"></i>API access for automation</li>
                            <li><i class="fas fa-check text-success me-2"></i>Bulk analysis capabilities</li>
                            <li><i class="fas fa-check text-success me-2"></i>Custom alerts for topics</li>
                        </ul>
                    </div>
                    <div class="col-md-6 text-center">
                        <h3 class="text-primary mb-3">$29/month</h3>
                        <p>Unlimited analyses • Priority processing</p>
                        <button class="btn btn-primary btn-lg glow-effect" onclick="upgradeToPro()">
                            <i class="fas fa-rocket me-2"></i>Upgrade to Pro
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Download Complete Report Button -->
        <div class="text-center mt-5">
            <button class="btn btn-success btn-lg" onclick="downloadFullReport()">
                <i class="fas fa-file-pdf me-2"></i>Download Complete Analysis Report (PDF)
            </button>
        </div>
    </div>
</div>

<!-- Sticky Upgrade Button (Shows for Free Users) -->
<div class="sticky-upgrade" id="sticky-upgrade" style="display: none;">
    <button onclick="upgradeToPro()">
        <i class="fas fa-rocket me-2"></i>Upgrade to Pro
    </button>
</div>

<!-- Analysis Process Modal -->
<div class="modal fade" id="analysisProcessModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-cogs me-2"></i>Our Comprehensive Analysis Process
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>Our AI-powered analysis examines:</h6>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <ul>
                            <li><strong>Source Credibility:</strong> Historical accuracy, transparency, corrections policy</li>
                            <li><strong>Author Background:</strong> Expertise, publication history, credentials</li>
                            <li><strong>Writing Quality:</strong> Grammar, structure, professionalism</li>
                            <li><strong>Fact Verification:</strong> Cross-reference with multiple databases</li>
                            <li><strong>Political Bias:</strong> 50,000+ term analysis, framing detection</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul>
                            <li><strong>Hidden Agendas:</strong> Commercial interests, persuasion tactics</li>
                            <li><strong>Clickbait Detection:</strong> Headline-content matching</li>
                            <li><strong>Emotional Manipulation:</strong> 8 emotion categories analyzed</li>
                            <li><strong>Source Diversity:</strong> Variety and balance assessment</li>
                            <li><strong>AI Content Detection:</strong> Pattern analysis across models</li>
                        </ul>
                    </div>
                </div>
                <hr>
                <p><strong>Technology Stack:</strong></p>
                <ul>
                    <li>GPT-4 for deep content analysis</li>
                    <li>Natural Language Processing for linguistic patterns</li>
                    <li>Machine Learning models trained on 1M+ articles</li>
                    <li>Real-time fact-checking API integrations</li>
                    <li>Proprietary bias detection algorithms</li>
                </ul>
                <hr>
                <p class="text-muted mb-0">Each analysis generates 100+ data points to ensure comprehensive, accurate results you can trust.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is free tier to show sticky upgrade button
    const userTier = localStorage.getItem('userTier') || 'free';
    if (userTier === 'free') {
        document.getElementById('sticky-upgrade').style.display = 'block';
    }
});

// Switch between URL and text input
function switchInputType(type) {
    const urlSection = document.getElementById('url-input-section');
    const textSection = document.getElementById('text-input-section');
    const tabs = document.querySelectorAll('.input-tab');
    
    tabs.forEach(tab => tab.classList.remove('active'));
    
    if (type === 'url') {
        urlSection.style.display = 'block';
        textSection.style.display = 'none';
        tabs[0].classList.add('active');
    } else {
        urlSection.style.display = 'none';
        textSection.style.display = 'block';
        tabs[1].classList.add('active');
    }
}

// Main analysis function
async function analyzeArticle() {
    const urlInput = document.getElementById('news-url');
    const textInput = document.getElementById('news-text');
    const loadingSection = document.getElementById('loading-section');
    const resultsSection = document.getElementById('results-section');
    
    // Get input based on active section
    const isUrlMode = document.getElementById('url-input-section').style.display !== 'none';
    const input = isUrlMode ? urlInput.value.trim() : textInput.value.trim();
    
    if (!input) {
        alert('Please enter a URL or paste article text');
        return;
    }
    
    // Show loading
    loadingSection.style.display = 'block';
    resultsSection.style.display = 'none';
    
    // Reset stages
    document.querySelectorAll('.analysis-stage').forEach(stage => {
        stage.classList.remove('active', 'complete');
    });
    
    // Animate progress
    let progress = 0;
    const progressBar = document.getElementById('analysis-progress');
    const stages = document.querySelectorAll('.analysis-stage');
    const stageTexts = [
        'Extracting article content...',
        'Running AI deep analysis...',
        'Cross-referencing facts...',
        'Detecting bias patterns...',
        'Analyzing source reliability...',
        'Generating comprehensive report...'
    ];
    let currentStage = 0;
    
    const progressInterval = setInterval(() => {
        progress += 2;
        progressBar.style.width = progress + '%';
        progressBar.textContent = progress + '%';
        
        // Update stage text
        const stageProgress = Math.floor((progress / 100) * stages.length);
        if (stageProgress > currentStage && stageProgress <= stages.length) {
            document.getElementById('current-stage-text').textContent = stageTexts[stageProgress - 1];
        }
        
        // Activate stages
        if (stageProgress > currentStage) {
            if (currentStage > 0) {
                stages[currentStage - 1].classList.remove('active');
                stages[currentStage - 1].classList.add('complete');
            }
            if (currentStage < stages.length) {
                stages[currentStage].classList.add('active');
            }
            currentStage = stageProgress;
        }
        
        if (progress >= 100) {
            clearInterval(progressInterval);
            
            // Complete last stage
            stages[stages.length - 1].classList.remove('active');
            stages[stages.length - 1].classList.add('complete');
            
            // Show results
            setTimeout(() => {
                displayResults();
                loadingSection.style.display = 'none';
                resultsSection.style.display = 'block';
            }, 500);
        }
    }, 100);
}

// Display results
function displayResults() {
    // Update timestamp
    const now = new Date();
    document.getElementById('analysis-time').textContent = now.toLocaleString();
    document.getElementById('analysis-id').textContent = 'AN-' + Date.now().toString(36).toUpperCase();
    
    // Animate trust meter
    const trustScore = 78; // Example score
    const trustMeter = document.querySelector('.trust-meter-fill');
    const trustScoreEl = document.getElementById('trust-score');
    const circumference = 2 * Math.PI * 90;
    const offset = circumference - (trustScore / 100) * circumference;
    
    // Set color based on score
    let color = '#10b981'; // green
    if (trustScore < 60) color = '#ef4444'; // red
    else if (trustScore < 80) color = '#f59e0b'; // orange
    
    setTimeout(() => {
        trustMeter.style.stroke = color;
        trustMeter.style.strokeDashoffset = offset;
        
        // Animate number
        let current = 0;
        const interval = setInterval(() => {
            if (current < trustScore) {
                current += 2;
                trustScoreEl.textContent = Math.min(current, trustScore);
            } else {
                clearInterval(interval);
            }
        }, 30);
    }, 100);
    
    // Update overall assessment
    document.getElementById('overall-assessment').innerHTML = `
        <div class="alert alert-${trustScore >= 80 ? 'success' : trustScore >= 60 ? 'warning' : 'danger'} mb-3">
            <h4 class="alert-heading">
                <i class="fas fa-${trustScore >= 80 ? 'check-circle' : trustScore >= 60 ? 'exclamation-triangle' : 'times-circle'} me-2"></i>
                Credibility: ${trustScore >= 80 ? 'High' : trustScore >= 60 ? 'Moderate' : 'Low'}
            </h4>
            <p class="mb-0">This article shows ${trustScore >= 80 ? 'strong' : trustScore >= 60 ? 'moderate' : 'weak'} indicators of credibility and factual accuracy.</p>
        </div>
    `;
    
    // Update confidence
    const confidence = 85;
    const confidenceBar = document.getElementById('overall-confidence');
    setTimeout(() => {
        confidenceBar.style.width = confidence + '%';
        confidenceBar.querySelector('.confidence-label').textContent = confidence + '%';
    }, 200);
    
    // Update key findings
    document.getElementById('key-findings-list').innerHTML = `
        <li>Source has established credibility track record</li>
        <li>Claims are supported by verifiable evidence</li>
        <li>Writing shows professional journalism standards</li>
    `;
    
    // Update red flags
    document.getElementById('red-flags-list').innerHTML = `
        <li>Some emotional language detected</li>
        <li>Limited source diversity</li>
    `;
    
    // Update source comparison
    document.getElementById('this-source-score').textContent = '75%';
    document.getElementById('this-source-score').className = 'source-score text-warning';
    
    // Update AI detection
    setTimeout(() => {
        const aiBar = document.getElementById('ai-probability');
        aiBar.style.width = '15%';
        aiBar.querySelector('.confidence-label').textContent = '15%';
    }, 300);
    
    // Update AI patterns
    document.getElementById('ai-patterns').innerHTML = `
        <li><i class="fas fa-check-circle text-success me-2"></i>Natural sentence variation detected</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Human-like typos present</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Colloquial expressions found</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Inconsistent formatting (human trait)</li>
    `;
    
    // Update author links
    const authorName = 'Jane Smith'; // Example
    document.getElementById('author-twitter').href = `https://twitter.com/search?q=${encodeURIComponent(authorName)}`;
    document.getElementById('author-google').href = `https://www.google.com/search?q=${encodeURIComponent(authorName + ' journalist')}`;
    document.getElementById('author-linkedin').href = `https://www.linkedin.com/search/results/all/?keywords=${encodeURIComponent(authorName)}`;
    
    // Update bias marker position
    const biasScore = -2; // -10 to +10 scale
    const biasMarker = document.getElementById('bias-marker');
    const biasPosition = 50 + (biasScore * 5); // Convert to percentage
    biasMarker.style.left = biasPosition + '%';
    
    // Update emotion gauge
    const emotionScore = 30; // 0-100 scale
    const emotionNeedle = document.getElementById('emotion-needle');
    const emotionAngle = -90 + (emotionScore * 1.8); // Convert to degrees
    setTimeout(() => {
        emotionNeedle.style.transform = `translateX(-50%) rotate(${emotionAngle}deg)`;
    }, 400);
    
    // Update diversity bar
    const diversityScore = 65;
    const diversityBar = document.getElementById('diversity-bar');
    setTimeout(() => {
        diversityBar.style.width = diversityScore + '%';
        diversityBar.textContent = diversityScore + '%';
    }, 500);
    
    // Populate all sections with example content
    populateSections();
}

// Populate all analysis sections
function populateSections() {
    // Source Credibility
    document.getElementById('source-credibility').innerHTML = `
        <h5>Source: Example News Network</h5>
        <p>Credibility Score: <strong>75/100</strong></p>
        <ul>
            <li>Established in 2010</li>
            <li>Mixed track record on fact-checking</li>
            <li>Transparent ownership structure</li>
            <li>Member of journalism ethics organizations</li>
        </ul>
    `;
    
    document.getElementById('source-explanation').textContent = 
        'This source has moderate credibility. While it maintains professional standards and transparency, ' +
        'it has had some instances of corrections and retractions in the past year.';
    
    document.getElementById('source-methodology').textContent = 
        'We analyzed the source\'s historical accuracy, compared it against our database of 10,000+ news sources, ' +
        'checked for transparency in ownership and funding, and reviewed their corrections policy.';
    
    // Author Credibility
    document.getElementById('author-credibility').innerHTML = `
        <h5>Author: Jane Smith</h5>
        <p>Credibility Score: <strong>82/100</strong></p>
        <ul>
            <li>10+ years journalism experience</li>
            <li>Award-winning investigative reporter</li>
            <li>Verified social media presence</li>
            <li>Published in multiple reputable outlets</li>
        </ul>
    `;
    
    document.getElementById('author-explanation').textContent = 
        'The author has strong credentials and a verifiable track record in journalism. Their expertise ' +
        'in this topic area adds credibility to the article.';
    
    document.getElementById('author-methodology').textContent = 
        'We searched public databases, verified social media accounts, checked journalism awards databases, ' +
        'and analyzed the author\'s publication history across multiple platforms.';
    
    // Writing Quality
    document.getElementById('writing-quality').innerHTML = `
        <h5>Quality Metrics:</h5>
        <ul>
            <li>Reading Level: College (Grade 14)</li>
            <li>Grammar Score: 94/100</li>
            <li>Clarity Score: 88/100</li>
            <li>Structure: Well-organized with clear sections</li>
            <li>Citations: 12 sources cited</li>
        </ul>
    `;
    
    document.getElementById('quality-explanation').textContent = 
        'The writing demonstrates professional journalism standards with clear structure, proper grammar, ' +
        'and appropriate complexity for the subject matter.';
    
    document.getElementById('quality-methodology').textContent = 
        'We used Natural Language Processing to analyze grammar, readability (Flesch-Kincaid), sentence variety, ' +
        'vocabulary richness, and structural coherence.';
    
    // Fact-Checking
    document.getElementById('fact-checking').innerHTML = `
        <h5>Claims Analyzed: 8</h5>
        <div class="claim-card">
            <p><strong>Claim:</strong> "Unemployment rate dropped to 3.5% last month"</p>
            <span class="claim-status status-verified">VERIFIED</span>
            <p class="mt-2"><small>Confidence: 95%</small></p>
        </div>
        <div class="claim-card">
            <p><strong>Claim:</strong> "New policy will affect 2 million workers"</p>
            <span class="claim-status status-unverified">UNVERIFIED</span>
            <p class="mt-2"><small>Confidence: 60%</small></p>
        </div>
    `;
    
    document.getElementById('fact-explanation').textContent = 
        'Most claims in this article are verifiable and accurate. The few unverified claims appear to be ' +
        'projections or estimates rather than established facts.';
    
    document.getElementById('fact-methodology').textContent = 
        'We extracted factual claims using NLP, then cross-referenced them with official sources, fact-checking ' +
        'databases (Snopes, FactCheck.org, PolitiFact), and primary source documents.';
    
    // Political Bias
    document.getElementById('political-bias').innerHTML = `
        <h5>Bias Assessment:</h5>
        <p>Political Lean: <strong>Slightly Left-Center</strong></p>
        <p>Objectivity Score: <strong>78/100</strong></p>
        <ul>
            <li>Balanced source selection</li>
            <li>Some opinion language detected</li>
            <li>Fair representation of opposing views</li>
        </ul>
    `;
    
    document.getElementById('bias-explanation').textContent = 
        'The article shows a slight left-center bias in word choice and framing, but maintains reasonable ' +
        'objectivity and presents multiple perspectives.';
    
    document.getElementById('bias-methodology').textContent = 
        'We analyzed word choice patterns, source selection, framing techniques, and compared against our ' +
        'database of politically-charged language weighted by context.';
    
    // Hidden Agenda
    document.getElementById('hidden-agenda').innerHTML = `
        <h5>Agenda Detection:</h5>
        <p>Likelihood of Hidden Agenda: <strong>Low (25%)</strong></p>
        <ul>
            <li>No commercial interests detected</li>
            <li>Minimal promotional language</li>
            <li>Transparent about limitations</li>
            <li>Some advocacy tone detected</li>
        </ul>
    `;
    
    document.getElementById('agenda-explanation').textContent = 
        'The article appears to be primarily informational with minimal hidden agenda. Some advocacy for ' +
        'policy changes is present but openly stated.';
    
    document.getElementById('agenda-methodology').textContent = 
        'We scanned for promotional keywords, analyzed link patterns, checked for undisclosed affiliations, ' +
        'and used machine learning to detect subtle persuasion techniques.';
    
    // Clickbait Analysis
    document.getElementById('clickbait-analysis').innerHTML = `
        <h5>Clickbait Score: <strong>Low (20/100)</strong></h5>
        <ul>
            <li>Headline matches content</li>
            <li>No sensationalist language</li>
            <li>Promises delivered in article</li>
            <li>Professional tone maintained</li>
        </ul>
    `;
    
    document.getElementById('clickbait-explanation').textContent = 
        'This is not clickbait. The headline accurately represents the content and avoids sensationalism.';
    
    document.getElementById('clickbait-methodology').textContent = 
        'We analyzed headline patterns, emotional trigger words, promise-delivery ratio, and compared against ' +
        'our database of 100,000+ clickbait examples.';
    
    // Emotional Manipulation
    document.getElementById('emotional-manipulation').innerHTML = `
        <h5>Emotional Manipulation Level: <strong>Low-Moderate</strong></h5>
        <p>Primary emotions detected:</p>
        <ul>
            <li>Concern (45%)</li>
            <li>Hope (30%)</li>
            <li>Urgency (25%)</li>
        </ul>
    `;
    
    document.getElementById('emotion-explanation').textContent = 
        'The article uses some emotional language to engage readers but stays within professional bounds. ' +
        'The emotional appeals are relevant to the topic.';
    
    document.getElementById('emotion-methodology').textContent = 
        'We used sentiment analysis and emotion detection AI to identify psychological triggers, fear-based ' +
        'language, and manipulative framing techniques.';
    
    // Source Diversity
    document.getElementById('source-diversity').innerHTML = `
        <h5>Source Diversity Score: <strong>65/100</strong></h5>
        <ul>
            <li>Total sources: 12</li>
            <li>Source types: 4 (Government, Academic, Media, Think Tank)</li>
            <li>Ideological diversity: Moderate</li>
            <li>Geographic diversity: Limited (mostly US)</li>
        </ul>
    `;
    
    document.getElementById('diversity-explanation').textContent = 
        'The article shows moderate source diversity but could benefit from more international perspectives ' +
        'and opposing viewpoints.';
    
    document.getElementById('diversity-methodology').textContent = 
        'We catalogued all sources, analyzed their types, political leanings, geographic origins, and ' +
        'calculated a diversity index based on variety and balance.';
    
    // Timeliness
    document.getElementById('timeliness-check').innerHTML = `
        <h5>Timeliness Assessment:</h5>
        <ul>
            <li>Article date: 2 days ago</li>
            <li>Information currency: Up-to-date</li>
            <li>Source dates: All within 30 days</li>
            <li>Breaking news: No</li>
            <li>Evergreen content: Partially</li>
        </ul>
    `;
    
    document.getElementById('timeliness-explanation').textContent = 
        'The article is current and uses recent sources. The information remains relevant and has not been ' +
        'superseded by newer developments.';
    
    document.getElementById('timeliness-methodology').textContent = 
        'We checked publication dates, analyzed source recency, monitored for updates or corrections, and ' +
        'verified that the information hasn\'t been outdated by recent events.';
    
    // AI Detection explanations
    document.getElementById('ai-explanation').textContent = 
        'This article shows low probability of being AI-generated. The writing exhibits human characteristics ' +
        'like natural variation and minor inconsistencies.';
    
    document.getElementById('ai-methodology').textContent = 
        'We analyzed perplexity scores, burstiness patterns, checked for AI-typical phrases, examined sentence ' +
        'variety, and compared against known AI writing patterns from multiple models.';
}

// Toggle dropdown
function toggleDropdown(header) {
    const content = header.nextElementSibling;
    const isOpen = content.classList.contains('show');
    
    if (isOpen) {
        content.classList.remove('show');
        header.style.borderColor = 'transparent';
    } else {
        content.classList.add('show');
        header.style.borderColor = '#6366f1';
    }
}

// Generate PDF
function generatePDF() {
    // Show loading state
    const btn = event.target;
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';
    btn.disabled = true;
    
    // Simulate PDF generation
    setTimeout(() => {
        btn.innerHTML = originalHTML;
        btn.disabled = false;
        alert('PDF report would be generated and downloaded here. This feature requires backend implementation.');
    }, 2000);
}

// Upgrade to Pro
function upgradeToPro() {
    window.location.href = '/pricing';
}

// Show methodology
function showAnalysisProcess() {
    // Using Bootstrap modal if available, otherwise fallback to alert
    if (typeof bootstrap !== 'undefined') {
        const modal = new bootstrap.Modal(document.getElementById('analysisProcessModal'));
        modal.show();
    } else {
        // Fallback for environments without Bootstrap JS
        document.getElementById('analysisProcessModal').style.display = 'block';
        document.getElementById('analysisProcessModal').classList.add('show');
        document.body.classList.add('modal-open');
        
        // Add backdrop
        const backdrop = document.createElement('div');
        backdrop.className = 'modal-backdrop fade show';
        document.body.appendChild(backdrop);
        
        // Close modal function
        const closeModal = () => {
            document.getElementById('analysisProcessModal').style.display = 'none';
            document.getElementById('analysisProcessModal').classList.remove('show');
            document.body.classList.remove('modal-open');
            backdrop.remove();
        };
        
        // Add close handlers
        document.querySelector('.modal .btn-close').onclick = closeModal;
        document.querySelector('.modal .btn-secondary').onclick = closeModal;
        backdrop.onclick = closeModal;
    }
}

// Download full report
function downloadFullReport() {
    // Show loading state
    const btn = event.target;
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating Complete Report...';
    btn.disabled = true;
    
    // Simulate PDF generation with complete findings
    setTimeout(() => {
        btn.innerHTML = originalHTML;
        btn.disabled = false;
        
        // In production, this would trigger actual PDF download
        alert('Complete PDF report with all findings, confidence intervals, methodology, and recommendations would be downloaded here.');
        
        // Simulate download
        const link = document.createElement('a');
        link.href = '#';
        link.download = 'news-analysis-report-' + Date.now() + '.pdf';
        link.click();
    }, 2000);
}

// Add smooth scrolling
document.addEventListener('DOMContentLoaded', function() {
    // Check if Bootstrap is loaded
    if (typeof bootstrap === 'undefined') {
        // Add basic Bootstrap modal CSS if not loaded
        const style = document.createElement('style');
        style.textContent = `
            .modal { display: none; position: fixed; z-index: 1050; top: 0; left: 0; width: 100%; height: 100%; overflow: auto; }
            .modal.show { display: block; }
            .modal-dialog { position: relative; width: auto; margin: 1.75rem auto; max-width: 800px; }
            .modal-content { position: relative; background-color: #fff; border: 1px solid rgba(0,0,0,.2); border-radius: .3rem; }
            .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid #dee2e6; }
            .modal-body { position: relative; padding: 1rem; }
            .modal-footer { display: flex; align-items: center; justify-content: flex-end; padding: 1rem; border-top: 1px solid #dee2e6; }
            .modal-backdrop { position: fixed; top: 0; left: 0; z-index: 1040; width: 100vw; height: 100vh; background-color: #000; opacity: .5; }
            .btn-close { background: transparent; border: 0; font-size: 1.5rem; cursor: pointer; }
        `;
        document.head.appendChild(style);
    }
    // Smooth scroll for internal links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
    
    // Add hover effects
    const dropdowns = document.querySelectorAll('.analysis-dropdown');
    dropdowns.forEach(dropdown => {
        dropdown.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        dropdown.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});

// Reset function for starting new analysis
function resetAnalysis() {
    document.getElementById('news-url').value = '';
    document.getElementById('news-text').value = '';
    document.getElementById('results-section').style.display = 'none';
    document.getElementById('loading-section').style.display = 'none';
    
    // Reset all animations
    document.querySelectorAll('.analysis-stage').forEach(stage => {
        stage.classList.remove('active', 'complete');
    });
    
    // Reset progress bar
    const progressBar = document.getElementById('analysis-progress');
    progressBar.style.width = '0%';
    progressBar.textContent = '0%';
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}
</script>
{% endblock %}
