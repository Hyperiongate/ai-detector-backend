{% extends "base.html" %}

{% block title %}AI News Intelligence System - Facts & Fakes{% endblock %}

{% block styles %}
<style>
    /* Vibrant color scheme */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        --warning-gradient: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);
        --danger-gradient: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        --info-gradient: linear-gradient(135deg, #2af598 0%, #009efd 100%);
        --purple-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --pink-gradient: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
        
        --card-bg: #ffffff;
        --section-bg: #f8f9ff;
        --accent-bg: #e8ecff;
        --hover-bg: #dce3ff;
        --border-strong: #c3cfff;
        --text-primary: #2d3561;
        --text-secondary: #5a6c95;
    }

    /* Animated background */
    .main-content {
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        min-height: 100vh;
        position: relative;
    }

    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Floating particles background */
    .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 1;
        pointer-events: none;
    }

    .particle {
        position: absolute;
        width: 10px;
        height: 10px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        animation: float 20s infinite;
    }

    @keyframes float {
        0% {
            transform: translateY(100vh) translateX(0);
            opacity: 0;
        }
        10% {
            opacity: 1;
        }
        90% {
            opacity: 1;
        }
        100% {
            transform: translateY(-100vh) translateX(100px);
            opacity: 0;
        }
    }

    /* Hero header with animation */
    .news-header {
        background: var(--purple-gradient);
        color: white;
        padding: 80px 0;
        margin-bottom: -40px;
        position: relative;
        overflow: hidden;
    }

    .news-header::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: repeating-linear-gradient(
            45deg,
            transparent,
            transparent 10px,
            rgba(255, 255, 255, 0.05) 10px,
            rgba(255, 255, 255, 0.05) 20px
        );
        animation: slide 20s linear infinite;
    }

    @keyframes slide {
        0% { transform: translate(0, 0); }
        100% { transform: translate(50px, 50px); }
    }

    .news-header h1 {
        font-size: 4em;
        font-weight: 900;
        margin-bottom: 15px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
        from { text-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
        to { text-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 0 0 30px rgba(255, 255, 255, 0.6); }
    }

    /* Content wrapper */
    .content-wrapper {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 30px 30px 0 0;
        box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
        margin-top: -40px;
        position: relative;
        z-index: 10;
        padding: 40px;
    }

    /* Animated pricing button */
    .pricing-info {
        background: var(--info-gradient);
        border: none;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 5px 15px rgba(42, 245, 152, 0.3);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.02); }
        100% { transform: scale(1); }
    }

    .pricing-info:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(42, 245, 152, 0.4);
    }

    /* Colorful input section */
    .input-section {
        background: white;
        border: 2px solid transparent;
        background-image: linear-gradient(white, white), var(--purple-gradient);
        background-origin: border-box;
        background-clip: padding-box, border-box;
        border-radius: 20px;
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    }

    /* Animated analyze button */
    .analyze-btn {
        padding: 20px 50px;
        background: var(--pink-gradient);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 20px;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 5px 20px rgba(238, 9, 121, 0.4);
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
    }

    .analyze-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }

    .analyze-btn:hover::before {
        left: 100%;
    }

    .analyze-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(238, 9, 121, 0.5);
    }

    /* Enhanced loading state */
    .loading {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 600px;
        padding: 40px;
        background: white;
        border-radius: 30px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        z-index: 1000;
    }

    .loading-spinner {
        width: 80px;
        height: 80px;
        margin: 0 auto;
        border: 4px solid transparent;
        border-radius: 50%;
        border-top: 4px solid;
        border-image: var(--purple-gradient) 1;
        animation: spin 1s linear infinite;
    }

    /* Overall summary with animations */
    .overall-summary {
        background: white;
        border: 2px solid transparent;
        background-image: linear-gradient(white, white), var(--purple-gradient);
        background-origin: border-box;
        background-clip: padding-box, border-box;
        border-radius: 25px;
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.2);
        animation: slideIn 0.8s ease-out;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Animated trust meter */
    .trust-meter {
        width: 280px;
        height: 280px;
        position: relative;
        margin: 0 auto;
    }

    .trust-meter svg {
        filter: drop-shadow(0 5px 20px rgba(0,0,0,0.15));
        animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .trust-meter-bg {
        fill: none;
        stroke: url(#bgGradient);
        stroke-width: 20;
        opacity: 0.3;
    }

    .trust-meter-fill {
        fill: none;
        stroke: url(#fillGradient);
        stroke-width: 20;
        stroke-linecap: round;
        transition: stroke-dashoffset 2s ease-in-out;
        filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5));
    }

    .trust-meter-center {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        animation: scaleIn 1s ease-out 0.5s both;
    }

    @keyframes scaleIn {
        from {
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
        }
        to {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
    }

    .trust-score-number {
        font-size: 72px;
        font-weight: 900;
        background: var(--purple-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: countUp 2s ease-out;
    }

    /* Dropdown animations */
    .analysis-dropdown {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 15px;
        margin-bottom: 15px;
        overflow: hidden;
        transition: all 0.3s;
        animation: slideIn 0.5s ease-out;
        animation-fill-mode: both;
    }

    .analysis-dropdown:nth-child(1) { animation-delay: 0.1s; }
    .analysis-dropdown:nth-child(2) { animation-delay: 0.2s; }
    .analysis-dropdown:nth-child(3) { animation-delay: 0.3s; }
    .analysis-dropdown:nth-child(4) { animation-delay: 0.4s; }
    .analysis-dropdown:nth-child(5) { animation-delay: 0.5s; }
    .analysis-dropdown:nth-child(6) { animation-delay: 0.6s; }

    .analysis-dropdown:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        border-color: #667eea;
    }

    /* Colorful dropdown icons */
    .dropdown-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: white;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    /* Author credibility animations */
    .author-avatar {
        width: 120px;
        height: 120px;
        margin: 0 auto 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 60px;
        color: white;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        animation: bounceIn 1s ease-out;
    }

    @keyframes bounceIn {
        0% { transform: scale(0); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }

    .trust-bar-fill {
        height: 100%;
        border-radius: 15px;
        transition: width 2s ease-out;
        position: relative;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
    }

    .trust-bar-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    /* Colorful action buttons */
    .btn-pdf {
        background: var(--success-gradient);
        animation: pulse 2s infinite;
    }

    .btn-secondary {
        background: var(--info-gradient);
    }

    /* Additional analysis cards */
    .extra-analysis {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }

    .analysis-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        transition: all 0.3s;
        border: 2px solid transparent;
    }

    .analysis-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    .card-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        color: white;
        margin-bottom: 15px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .news-header h1 {
            font-size: 2.5em;
        }
        
        .summary-grid {
            grid-template-columns: 1fr;
        }
        
        .extra-analysis {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Include header -->
{% include 'includes/header.html' %}

<!-- Floating particles -->
<div class="particles">
    <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
    <div class="particle" style="left: 30%; animation-delay: 4s;"></div>
    <div class="particle" style="left: 40%; animation-delay: 6s;"></div>
    <div class="particle" style="left: 50%; animation-delay: 8s;"></div>
    <div class="particle" style="left: 60%; animation-delay: 10s;"></div>
    <div class="particle" style="left: 70%; animation-delay: 12s;"></div>
    <div class="particle" style="left: 80%; animation-delay: 14s;"></div>
    <div class="particle" style="left: 90%; animation-delay: 16s;"></div>
</div>

<!-- Main content -->
<div class="main-content">
    <!-- Hero Header -->
    <div class="news-header">
        <div class="container" style="position: relative; z-index: 1;">
            <h1>AI News Intelligence System</h1>
            <p style="font-size: 1.5em; opacity: 0.95;">Discover the Truth with Advanced AI Analysis</p>
        </div>
    </div>

    <!-- Content wrapper -->
    <div class="container">
        <div class="content-wrapper">
            <!-- Pricing info -->
            <div class="pricing-info" onclick="togglePricing()">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="color: white; margin: 0;">✨ Analysis Tiers & Pricing</h3>
                    <span style="color: white; font-size: 20px;">▼</span>
                </div>
                <div class="pricing-content" id="pricingContent" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <div style="display: flex; justify-content: space-between; padding: 10px 0; color: white;">
                        <div>
                            <strong>Free Tier</strong><br>
                            <span style="font-size: 14px; opacity: 0.9;">Basic analysis • 1 article/day</span>
                        </div>
                        <span style="font-weight: 700;">$0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 10px 0; color: white;">
                        <div>
                            <strong>Pro Tier</strong><br>
                            <span style="font-size: 14px; opacity: 0.9;">Full analysis • Unlimited • Priority</span>
                        </div>
                        <span style="font-weight: 700;">$9.99/mo</span>
                    </div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-section">
                <div style="display: flex; gap: 15px; margin-bottom: 25px; justify-content: center;">
                    <button class="input-tab active" onclick="switchInputType('url')" 
                            style="padding: 12px 30px; border: 2px solid #667eea; background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-weight: 600; cursor: pointer; border-radius: 50px; font-size: 16px; transition: all 0.3s;">
                        🔗 URL Analysis
                    </button>
                    <button class="input-tab" onclick="switchInputType('text')"
                            style="padding: 12px 30px; border: 2px solid #e5e7eb; background: white; color: #5a6c95; font-weight: 600; cursor: pointer; border-radius: 50px; font-size: 16px; transition: all 0.3s;">
                        📝 Text Analysis
                    </button>
                </div>
                
                <div class="input-content active" id="urlInput">
                    <input type="url" 
                           id="articleUrl" 
                           placeholder="Enter news article URL to discover the truth..." 
                           style="width: 100%; padding: 20px 30px; border: 2px solid #e5e7eb; border-radius: 50px; font-size: 16px; transition: all 0.3s;">
                </div>
                
                <div class="input-content" id="textInput" style="display: none;">
                    <textarea id="articleText" 
                              placeholder="Paste article text here..."
                              style="width: 100%; min-height: 200px; padding: 20px 25px; border: 2px solid #e5e7eb; border-radius: 20px; font-size: 16px; resize: vertical;"></textarea>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="analyze-btn" onclick="analyzeArticle()">
                        🚀 ANALYZE WITH AI
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loading">
                <div style="text-align: center;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 20px; font-size: 20px; color: #667eea; font-weight: 600;">AI is analyzing your article...</p>
                    <p style="color: #5a6c95;">This usually takes 10-15 seconds</p>
                </div>
            </div>

            <!-- Results -->
            <div class="results" id="results" style="display: none;">
                <!-- Will be dynamically populated -->
            </div>
        </div>
    </div>
</div>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    // State management
    let currentInputType = 'url';
    let currentAnalysisData = null;

    // Toggle pricing
    window.togglePricing = function() {
        const content = document.getElementById('pricingContent');
        const icon = document.querySelector('.pricing-info span');
        
        if (content.style.display === 'none') {
            content.style.display = 'block';
            icon.textContent = '▲';
        } else {
            content.style.display = 'none';
            icon.textContent = '▼';
        }
    }

    // Switch input type
    window.switchInputType = function(type) {
        currentInputType = type;
        
        document.querySelectorAll('.input-tab').forEach(tab => {
            tab.style.background = 'white';
            tab.style.color = '#5a6c95';
            tab.style.border = '2px solid #e5e7eb';
        });
        
        event.target.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        event.target.style.color = 'white';
        event.target.style.border = '2px solid #667eea';
        
        document.querySelectorAll('.input-content').forEach(content => {
            content.style.display = 'none';
        });
        
        if (type === 'url') {
            document.getElementById('urlInput').style.display = 'block';
        } else {
            document.getElementById('textInput').style.display = 'block';
        }
    }

    // Main analysis function
    window.analyzeArticle = async function() {
        let content = '';
        
        if (currentInputType === 'url') {
            content = document.getElementById('articleUrl').value.trim();
            if (!content) {
                showMessage('Please enter a news article URL', 'error');
                return;
            }
        } else {
            content = document.getElementById('articleText').value.trim();
            if (!content) {
                showMessage('Please paste the article text', 'error');
                return;
            }
        }
        
        // Show loading
        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';
        document.querySelector('.analyze-btn').disabled = true;
        
        try {
            const response = await fetch('/api/analyze-news', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    content: content,
                    type: currentInputType,
                    is_pro: true
                })
            });
            
            const data = await response.json();
            
            if (!response.ok || !data.success) {
                throw new Error(data.error || 'Analysis failed');
            }
            
            currentAnalysisData = data;
            displayResults(data);
            
        } catch (error) {
            console.error('Analysis error:', error);
            showMessage(error.message, 'error');
        } finally {
            document.getElementById('loading').style.display = 'none';
            document.querySelector('.analyze-btn').disabled = false;
        }
    }

    // Display results with all enhancements
    function displayResults(data) {
        const results = data.results;
        const resultsDiv = document.getElementById('results');
        resultsDiv.style.display = 'block';
        
        // Create animated trust meter
        const trustMeterHTML = `
            <svg width="280" height="280" viewBox="0 0 280 280">
                <defs>
                    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#e0e7ff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#c3cfff;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="fillGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        ${results.credibility >= 80 ? 
                            '<stop offset="0%" style="stop-color:#11998e;stop-opacity:1" /><stop offset="100%" style="stop-color:#38ef7d;stop-opacity:1" />' :
                          results.credibility >= 60 ?
                            '<stop offset="0%" style="stop-color:#f2994a;stop-opacity:1" /><stop offset="100%" style="stop-color:#f2c94c;stop-opacity:1" />' :
                            '<stop offset="0%" style="stop-color:#eb3349;stop-opacity:1" /><stop offset="100%" style="stop-color:#f45c43;stop-opacity:1" />'}
                    </linearGradient>
                </defs>
                <circle cx="140" cy="140" r="120" class="trust-meter-bg"></circle>
                <circle cx="140" cy="140" r="120" class="trust-meter-fill" 
                        stroke-dasharray="754" 
                        stroke-dashoffset="754"
                        transform="rotate(-90 140 140)"></circle>
            </svg>
            <div class="trust-meter-center">
                <div class="trust-score-number">0</div>
                <div style="font-size: 20px; font-weight: 700; margin-top: 10px; color: ${
                    results.credibility >= 80 ? '#11998e' : 
                    results.credibility >= 60 ? '#f2994a' : '#eb3349'
                }">
                    ${results.credibility >= 80 ? 'RELIABLE' : 
                      results.credibility >= 60 ? 'MODERATE' : 'CAUTION'}
                </div>
            </div>
        `;
        
        // Overall Summary - Always Open
        const overallSummary = `
            <div class="overall-summary">
                <h2 style="text-align: center; font-size: 28px; margin-bottom: 30px; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    OVERALL ASSESSMENT
                </h2>
                <div class="summary-grid" style="display: grid; grid-template-columns: 300px 1fr; gap: 40px; align-items: start;">
                    <div class="trust-visual">
                        <div class="trust-meter">
                            ${trustMeterHTML}
                        </div>
                        <div style="text-align: center; margin-top: 20px; padding: 20px; background: #f8f9ff; border-radius: 15px;">
                            <p style="font-weight: 600; color: #2d3561; margin-bottom: 10px;">What this score means:</p>
                            <p style="color: #5a6c95; line-height: 1.6;">
                                ${results.credibility >= 80 ? 
                                    'This article comes from a highly trustworthy source with consistent accurate reporting. You can generally rely on this information.' :
                                  results.credibility >= 60 ?
                                    'This article has moderate reliability. While generally accurate, verify important claims with additional sources.' :
                                    'This article has low credibility. Be very cautious and seek multiple independent sources before accepting claims as fact.'}
                            </p>
                        </div>
                    </div>
                    <div class="summary-content">
                        <!-- Source and Author -->
                        <div style="background: linear-gradient(135deg, #f8f9ff, #e8ecff); padding: 25px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #667eea;">
                            <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px;">📰 Source & Author</h4>
                            <p style="margin: 8px 0;"><strong>News Source:</strong> ${results.sources?.name || 'Unknown'}</p>
                            <p style="margin: 8px 0;"><strong>Author:</strong> ${results.author && results.author !== 'Unknown' ? results.author : 'No author listed'}</p>
                            <p style="margin: 8px 0;"><strong>Domain:</strong> ${results.sources?.domain || 'Not available'}</p>
                        </div>
                        
                        <!-- Article Summary -->
                        <div style="background: linear-gradient(135deg, #f0f9ff, #dff4ff); padding: 25px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #2af598;">
                            <h4 style="color: #11998e; margin-bottom: 15px; font-size: 18px;">📋 Article Summary</h4>
                            <p style="line-height: 1.6; color: #2d3561;">${results.summary || 'This article discusses current events and news topics. Our AI has analyzed the content for bias, credibility, and factual accuracy. See detailed findings below.'}</p>
                        </div>
                        
                        <!-- Key Findings -->
                        <div style="background: linear-gradient(135deg, #fff5f5, #ffe0e0); padding: 25px; border-radius: 15px; border-left: 4px solid #ee0979;">
                            <h4 style="color: #ee0979; margin-bottom: 15px; font-size: 18px;">🔍 Key Findings</h4>
                            ${generateKeyFindings(results)}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Generate all dropdowns (closed by default)
        const dropdowns = generateAllDropdowns(results);
        
        // Extra analysis cards
        const extraAnalysis = `
            <div class="extra-analysis">
                <div class="analysis-card">
                    <div class="card-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">📊</div>
                    <h3 style="color: #2d3561; margin-bottom: 10px;">Emotional Manipulation Score</h3>
                    <p style="color: #5a6c95; line-height: 1.6;">Our AI detected ${results.emotional_manipulation || 'minimal'} use of emotional language designed to influence reader opinion.</p>
                </div>
                
                <div class="analysis-card">
                    <div class="card-icon" style="background: linear-gradient(135deg, #11998e, #38ef7d);">🔗</div>
                    <h3 style="color: #2d3561; margin-bottom: 10px;">Source Diversity</h3>
                    <p style="color: #5a6c95; line-height: 1.6;">This article quotes ${results.source_count || '2-3'} different sources, indicating ${results.source_count > 3 ? 'good' : 'limited'} perspective diversity.</p>
                </div>
                
                <div class="analysis-card">
                    <div class="card-icon" style="background: linear-gradient(135deg, #ee0979, #ff6a00);">⏰</div>
                    <h3 style="color: #2d3561; margin-bottom: 10px;">Timeliness Check</h3>
                    <p style="color: #5a6c95; line-height: 1.6;">Article appears to be ${results.timeliness || 'current'}. ${results.timeliness === 'current' ? 'Information is up-to-date.' : 'Some information may be outdated.'}</p>
                </div>
            </div>
        `;
        
        // Action buttons
        const actions = `
            <div style="text-align: center; margin-top: 50px; padding: 40px; background: linear-gradient(135deg, #f8f9ff, #e8ecff); border-radius: 20px;">
                <button class="btn-pdf" onclick="generatePDF()" style="padding: 20px 50px; background: linear-gradient(135deg, #11998e, #38ef7d); color: white; border: none; border-radius: 50px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4); margin-right: 20px;">
                    📄 Generate Full PDF Report
                </button>
                <button onclick="resetAnalysis()" style="padding: 20px 50px; background: linear-gradient(135deg, #2af598, #009efd); color: white; border: none; border-radius: 50px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 5px 20px rgba(42, 245, 152, 0.4);">
                    🔄 Analyze Another Article
                </button>
            </div>
        `;
        
        resultsDiv.innerHTML = overallSummary + dropdowns + extraAnalysis + actions;
        
        // Initialize interactions
        initializeInteractions();
        
        // Animate trust score
        setTimeout(() => {
            animateTrustScore(results.credibility || 0);
        }, 100);
    }

    function generateKeyFindings(results) {
        const findings = [];
        
        // Source credibility
        if (results.sources?.credibility >= 80) {
            findings.push('<span style="color: #11998e;">✅ Highly credible source with excellent track record</span>');
        } else if (results.sources?.credibility >= 60) {
            findings.push('<span style="color: #f2994a;">⚠️ Moderately credible source - verify key claims</span>');
        } else {
            findings.push('<span style="color: #eb3349;">❌ Low credibility source - seek additional verification</span>');
        }
        
        // Bias
        if (results.bias?.objectivity >= 80) {
            findings.push('<span style="color: #11998e;">✅ Highly objective reporting detected</span>');
        } else {
            findings.push(`<span style="color: #f2994a;">📊 ${results.bias?.label || 'Biased'} perspective detected</span>`);
        }
        
        // Author
        if (results.author && results.author !== 'Unknown') {
            findings.push('<span style="color: #11998e;">✅ Author properly attributed</span>');
        } else {
            findings.push('<span style="color: #eb3349;">❌ No author attribution found</span>');
        }
        
        return findings.map(f => `<p style="margin: 8px 0; font-weight: 500;">${f}</p>`).join('');
    }

    function generateAllDropdowns(results) {
        const dropdowns = [];
        
        // 1. Political Bias - NOT expanded by default
        if (results.bias) {
            dropdowns.push(`
                <div class="analysis-dropdown">
                    <div class="dropdown-header" style="padding: 25px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <div class="dropdown-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">⚖️</div>
                            <div>
                                <div style="font-size: 18px; font-weight: 700; color: #2d3561;">Political Bias & Perspective Analysis</div>
                                <div style="font-size: 14px; color: #5a6c95; margin-top: 5px;">${results.bias.label} - ${results.bias.objectivity}% objective reporting</div>
                            </div>
                        </div>
                        <div class="expand-icon" style="font-size: 24px; color: #5a6c95; transition: transform 0.3s;">▼</div>
                    </div>
                    <div class="dropdown-content" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease;">
                        <div style="padding: 30px; background: #f8f9ff;">
                            ${createBiasVisualization(results.bias)}
                        </div>
                    </div>
                </div>
            `);
        }
        
        // 2. Author Credibility
        if (results.author) {
            dropdowns.push(`
                <div class="analysis-dropdown">
                    <div class="dropdown-header" style="padding: 25px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <div class="dropdown-icon" style="background: linear-gradient(135deg, #11998e, #38ef7d);">👤</div>
                            <div>
                                <div style="font-size: 18px; font-weight: 700; color: #2d3561;">Author Credibility & Background</div>
                                <div style="font-size: 14px; color: #5a6c95; margin-top: 5px;">${results.author !== 'Unknown' ? results.author : 'Anonymous author'}</div>
                            </div>
                        </div>
                        <div class="expand-icon" style="font-size: 24px; color: #5a6c95;">▼</div>
                    </div>
                    <div class="dropdown-content" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease;">
                        <div style="padding: 30px; background: #f8f9ff;">
                            ${createAuthorAnalysis(results.author)}
                        </div>
                    </div>
                </div>
            `);
        }
        
        // 3. Writing Quality Analysis
        if (results.style) {
            dropdowns.push(`
                <div class="analysis-dropdown">
                    <div class="dropdown-header" style="padding: 25px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <div class="dropdown-icon" style="background: linear-gradient(135deg, #2af598, #009efd);">✍️</div>
                            <div>
                                <div style="font-size: 18px; font-weight: 700; color: #2d3561;">Writing Quality & Journalistic Standards</div>
                                <div style="font-size: 14px; color: #5a6c95; margin-top: 5px;">${results.style.quotes || 0} quotes, ${results.style.statistics || 0} statistics cited</div>
                            </div>
                        </div>
                        <div class="expand-icon" style="font-size: 24px; color: #5a6c95;">▼</div>
                    </div>
                    <div class="dropdown-content" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease;">
                        <div style="padding: 30px; background: #f8f9ff;">
                            ${createWritingAnalysis(results.style)}
                        </div>
                    </div>
                </div>
            `);
        }
        
        // 4. Fact-Checking Results
        if (results.claims && results.claims.length > 0) {
            dropdowns.push(`
                <div class="analysis-dropdown">
                    <div class="dropdown-header" style="padding: 25px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <div class="dropdown-icon" style="background: linear-gradient(135deg, #f2994a, #f2c94c);">✓</div>
                            <div>
                                <div style="font-size: 18px; font-weight: 700; color: #2d3561;">Fact-Checking Results</div>
                                <div style="font-size: 14px; color: #5a6c95; margin-top: 5px;">${results.claims.length} claims analyzed</div>
                            </div>
                        </div>
                        <div class="expand-icon" style="font-size: 24px; color: #5a6c95;">▼</div>
                    </div>
                    <div class="dropdown-content" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease;">
                        <div style="padding: 30px; background: #f8f9ff;">
                            ${createFactCheckAnalysis(results.claims)}
                        </div>
                    </div>
                </div>
            `);
        }
        
        // 5. Hidden Agenda Detection
        dropdowns.push(`
            <div class="analysis-dropdown">
                <div class="dropdown-header" style="padding: 25px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div class="dropdown-icon" style="background: linear-gradient(135deg, #ee0979, #ff6a00);">🎯</div>
                        <div>
                            <div style="font-size: 18px; font-weight: 700; color: #2d3561;">Hidden Agenda & Manipulation Detection</div>
                            <div style="font-size: 14px; color: #5a6c95; margin-top: 5px;">AI analysis of subtle influence tactics</div>
                        </div>
                    </div>
                    <div class="expand-icon" style="font-size: 24px; color: #5a6c95;">▼</div>
                </div>
                <div class="dropdown-content" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease;">
                    <div style="padding: 30px; background: #f8f9ff;">
                        ${createManipulationAnalysis(results)}
                    </div>
                </div>
            </div>
        `);
        
        // 6. Clickbait & Sensationalism Score
        dropdowns.push(`
            <div class="analysis-dropdown">
                <div class="dropdown-header" style="padding: 25px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div class="dropdown-icon" style="background: linear-gradient(135deg, #eb3349, #f45c43);">🎪</div>
                        <div>
                            <div style="font-size: 18px; font-weight: 700; color: #2d3561;">Clickbait & Sensationalism Analysis</div>
                            <div style="font-size: 14px; color: #5a6c95; margin-top: 5px;">Headline and content sensationalism check</div>
                        </div>
                    </div>
                    <div class="expand-icon" style="font-size: 24px; color: #5a6c95;">▼</div>
                </div>
                <div class="dropdown-content" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease;">
                    <div style="padding: 30px; background: #f8f9ff;">
                        ${createClickbaitAnalysis(results)}
                    </div>
                </div>
            </div>
        `);
        
        return dropdowns.join('');
    }

    // Create colorful bias visualization
    function createBiasVisualization(bias) {
        return `
            <div style="text-align: center;">
                <h4 style="font-size: 20px; color: #2d3561; margin-bottom: 20px;">Political Perspective Spectrum</h4>
                <div style="position: relative; height: 60px; background: linear-gradient(to right, #3b82f6 0%, #60a5fa 20%, #10b981 40%, #10b981 60%, #f59e0b 80%, #ef4444 100%); border-radius: 30px; margin: 30px 0; box-shadow: 0 5px 20px rgba(0,0,0,0.2);">
                    <div style="position: absolute; top: 50%; left: ${50 + (bias.score * 5)}%; transform: translate(-50%, -50%); width: 70px; height: 70px; background: white; border-radius: 50%; box-shadow: 0 5px 20px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; font-size: 30px; border: 3px solid #2d3561;">
                        ${bias.score < -3 ? '⬅️' : bias.score > 3 ? '➡️' : '⚖️'}
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <span style="font-weight: 600; color: #3b82f6;">Far Left</span>
                    <span style="font-weight: 600; color: #60a5fa;">Left</span>
                    <span style="font-weight: 600; color: #10b981;">Center</span>
                    <span style="font-weight: 600; color: #f59e0b;">Right</span>
                    <span style="font-weight: 600; color: #ef4444;">Far Right</span>
                </div>
                
                ${bias.reasoning ? `
                <div style="margin-top: 30px; padding: 25px; background: white; border-radius: 15px; text-align: left;">
                    <h5 style="color: #667eea; margin-bottom: 15px;">Evidence of Bias:</h5>
                    <p style="line-height: 1.8; color: #5a6c95;">${bias.reasoning}</p>
                </div>` : ''}
            </div>
        `;
    }

    // Create animated author analysis
    function createAuthorAnalysis(author) {
        const hasAuthor = author && author !== 'Unknown';
        const trustScore = hasAuthor ? 85 : 15;
        
        return `
            <div style="text-align: center;">
                <div class="author-avatar" style="background: ${hasAuthor ? 'linear-gradient(135deg, #11998e, #38ef7d)' : 'linear-gradient(135deg, #eb3349, #f45c43)'};">
                    ${hasAuthor ? '👤' : '❓'}
                </div>
                <h3 style="font-size: 28px; margin-bottom: 10px; color: #2d3561;">${hasAuthor ? author : 'Anonymous Author'}</h3>
                
                ${hasAuthor && author.includes('@') ? 
                    `<a href="https://twitter.com/${author.replace('@', '')}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">View Twitter Profile →</a>` : ''}
                
                ${hasAuthor && !author.includes('@') ? 
                    `<a href="https://www.google.com/search?q=${encodeURIComponent(author + ' journalist')}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">Search for Author →</a>` : ''}
                
                <div style="margin: 30px 0;">
                    <h5 style="margin-bottom: 15px; color: #2d3561;">Author Trust Score</h5>
                    <div style="background: #e0e7ff; height: 40px; border-radius: 20px; overflow: hidden; position: relative;">
                        <div class="trust-bar-fill" style="width: 0%; background: ${hasAuthor ? 'linear-gradient(135deg, #11998e, #38ef7d)' : 'linear-gradient(135deg, #eb3349, #f45c43)'};">
                            <span style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: white; font-weight: 700;">${trustScore}%</span>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px;">
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <div style="font-size: 30px; margin-bottom: 10px;">✍️</div>
                        <div style="font-weight: 700; color: #2d3561;">Attribution</div>
                        <div style="color: ${hasAuthor ? '#11998e' : '#eb3349'}; font-weight: 600;">${hasAuthor ? 'Verified' : 'Missing'}</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <div style="font-size: 30px; margin-bottom: 10px;">🎯</div>
                        <div style="font-weight: 700; color: #2d3561;">Accountability</div>
                        <div style="color: ${hasAuthor ? '#11998e' : '#eb3349'}; font-weight: 600;">${hasAuthor ? 'High' : 'None'}</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <div style="font-size: 30px; margin-bottom: 10px;">🔍</div>
                        <div style="font-weight: 700; color: #2d3561;">Verifiability</div>
                        <div style="color: ${hasAuthor ? '#11998e' : '#eb3349'}; font-weight: 600;">${hasAuthor ? 'Yes' : 'No'}</div>
                    </div>
                </div>
            </div>
        `;
    }

    // Other analysis functions
    function createWritingAnalysis(style) {
        return `
            <div>
                <h4 style="color: #2d3561; margin-bottom: 20px;">Journalistic Quality Metrics</h4>
                <div style="display: grid; gap: 20px;">
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="font-weight: 600;">Direct Quotes Used</span>
                            <span style="color: #667eea; font-weight: 700;">${style.quotes || 0}</span>
                        </div>
                        <div style="background: #e0e7ff; height: 10px; border-radius: 5px; overflow: hidden;">
                            <div style="width: ${Math.min(style.quotes * 20, 100)}%; height: 100%; background: linear-gradient(135deg, #2af598, #009efd);"></div>
                        </div>
                        <p style="font-size: 14px; color: #5a6c95; margin-top: 5px;">Good journalism uses 3+ direct quotes</p>
                    </div>
                    
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="font-weight: 600;">Statistics Cited</span>
                            <span style="color: #667eea; font-weight: 700;">${style.statistics || 0}</span>
                        </div>
                        <div style="background: #e0e7ff; height: 10px; border-radius: 5px; overflow: hidden;">
                            <div style="width: ${Math.min(style.statistics * 20, 100)}%; height: 100%; background: linear-gradient(135deg, #2af598, #009efd);"></div>
                        </div>
                        <p style="font-size: 14px; color: #5a6c95; margin-top: 5px;">Quality articles include 2+ statistics</p>
                    </div>
                </div>
            </div>
        `;
    }

    function createFactCheckAnalysis(claims) {
        const verified = claims.filter(c => c.status.toLowerCase().includes('verif')).length;
        const false_claims = claims.filter(c => c.status.toLowerCase().includes('false')).length;
        const unverified = claims.length - verified - false_claims;
        
        return `
            <div>
                <h4 style="color: #2d3561; margin-bottom: 20px;">Fact-Check Summary</h4>
                <div style="display: flex; justify-content: space-around; margin-bottom: 30px;">
                    <div style="text-align: center;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #11998e, #38ef7d); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; font-weight: 700; margin: 0 auto 10px; box-shadow: 0 5px 15px rgba(17, 153, 142, 0.3);">
                            ${verified}
                        </div>
                        <div style="font-weight: 600; color: #11998e;">Verified True</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #eb3349, #f45c43); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; font-weight: 700; margin: 0 auto 10px; box-shadow: 0 5px 15px rgba(235, 51, 73, 0.3);">
                            ${false_claims}
                        </div>
                        <div style="font-weight: 600; color: #eb3349;">False/Misleading</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #f2994a, #f2c94c); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; font-weight: 700; margin: 0 auto 10px; box-shadow: 0 5px 15px rgba(242, 153, 74, 0.3);">
                            ${unverified}
                        </div>
                        <div style="font-weight: 600; color: #f2994a;">Unverified</div>
                    </div>
                </div>
                
                <div>
                    <h5 style="color: #5a6c95; margin-bottom: 15px;">Individual Claims:</h5>
                    ${claims.map(claim => `
                        <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 24px;">${
                                claim.status.toLowerCase().includes('verif') ? '✅' :
                                claim.status.toLowerCase().includes('false') ? '❌' : '❓'
                            }</div>
                            <div style="flex: 1;">
                                <p style="font-weight: 600; margin-bottom: 5px;">"${claim.claim}"</p>
                                <p style="font-size: 14px; color: #5a6c95;">Status: ${claim.status} • Confidence: ${claim.confidence}%</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    function createManipulationAnalysis(results) {
        return `
            <div>
                <h4 style="color: #2d3561; margin-bottom: 20px;">Manipulation Tactics Detected</h4>
                <div style="background: linear-gradient(135deg, #fff5f5, #ffe0e0); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <h5 style="color: #ee0979; margin-bottom: 15px;">🎭 Emotional Manipulation</h5>
                    <p style="line-height: 1.8; color: #5a6c95;">
                        ${results.emotional_language ? 
                            `This article uses strong emotional language to influence reader opinion. Watch for words designed to trigger fear, anger, or outrage.` :
                            `Minimal emotional manipulation detected. The article maintains a relatively neutral tone.`}
                    </p>
                </div>
                
                <div style="background: linear-gradient(135deg, #f0f9ff, #dff4ff); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <h5 style="color: #2af598; margin-bottom: 15px;">📢 Selective Reporting</h5>
                    <p style="line-height: 1.8; color: #5a6c95;">
                        ${results.selective_reporting ? 
                            `The article appears to selectively report facts that support a particular narrative while omitting contradictory information.` :
                            `The article presents multiple perspectives and doesn't appear to cherry-pick facts.`}
                    </p>
                </div>
                
                <div style="background: linear-gradient(135deg, #f8f9ff, #e8ecff); padding: 25px; border-radius: 15px;">
                    <h5 style="color: #667eea; margin-bottom: 15px;">🎯 Hidden Agenda Indicators</h5>
                    <p style="line-height: 1.8; color: #5a6c95;">
                        Our AI detected ${results.agenda_score || 'low'} indicators of a hidden agenda. 
                        ${results.agenda_score === 'high' ? 
                            'This article may be promoting specific interests without disclosure.' :
                            'The article appears to be straightforward in its intentions.'}
                    </p>
                </div>
            </div>
        `;
    }

    function createClickbaitAnalysis(results) {
        const clickbaitScore = results.clickbait_score || 20;
        
        return `
            <div>
                <h4 style="color: #2d3561; margin-bottom: 20px;">Clickbait & Sensationalism Score</h4>
                <div style="text-align: center; margin: 30px 0;">
                    <div style="width: 150px; height: 150px; margin: 0 auto; position: relative;">
                        <svg width="150" height="150">
                            <circle cx="75" cy="75" r="70" fill="none" stroke="#e0e7ff" stroke-width="10"></circle>
                            <circle cx="75" cy="75" r="70" fill="none" 
                                    stroke="url(#clickbaitGradient)" 
                                    stroke-width="10"
                                    stroke-dasharray="${440 * clickbaitScore / 100} 440"
                                    transform="rotate(-90 75 75)"></circle>
                            <defs>
                                <linearGradient id="clickbaitGradient">
                                    <stop offset="0%" style="stop-color:#eb3349;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#f45c43;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                        </svg>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                            <div style="font-size: 36px; font-weight: 900; color: #eb3349;">${clickbaitScore}%</div>
                            <div style="font-size: 14px; color: #5a6c95;">Clickbait</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h5 style="color: #eb3349; margin-bottom: 10px;">Headline Analysis</h5>
                    <p style="color: #5a6c95; line-height: 1.6;">
                        ${clickbaitScore > 60 ? 
                            'The headline uses strong sensationalist language designed to generate clicks rather than inform.' :
                            'The headline is relatively straightforward and informative.'}
                    </p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 15px;">
                    <h5 style="color: #eb3349; margin-bottom: 10px;">Content Sensationalism</h5>
                    <p style="color: #5a6c95; line-height: 1.6;">
                        ${clickbaitScore > 60 ?
                            'The article content contains exaggerated claims and dramatic language to keep readers engaged.' :
                            'The content maintains a professional tone without excessive dramatization.'}
                    </p>
                </div>
            </div>
        `;
    }

    // Initialize interactions
    function initializeInteractions() {
        // Dropdown toggles
        document.querySelectorAll('.dropdown-header').forEach(header => {
            header.addEventListener('click', function() {
                const dropdown = this.closest('.analysis-dropdown');
                const content = dropdown.querySelector('.dropdown-content');
                const icon = this.querySelector('.expand-icon');
                
                if (content.style.maxHeight === '0px' || !content.style.maxHeight) {
                    content.style.maxHeight = '2000px';
                    icon.textContent = '▲';
                    dropdown.style.borderColor = '#667eea';
                } else {
                    content.style.maxHeight = '0px';
                    icon.textContent = '▼';
                    dropdown.style.borderColor = '#e5e7eb';
                }
            });
        });
        
        // Animate trust bars
        setTimeout(() => {
            document.querySelectorAll('.trust-bar-fill').forEach(bar => {
                const width = bar.querySelector('span').textContent.replace('%', '');
                bar.style.width = width + '%';
            });
        }, 500);
    }

    // Animate trust score with counting
    function animateTrustScore(targetScore) {
        const circle = document.querySelector('.trust-meter-fill');
        const scoreElement = document.querySelector('.trust-score-number');
        
        if (!circle || !scoreElement) return;
        
        // Animate circle
        const circumference = 754;
        const offset = circumference - (targetScore / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        
        // Animate number counting
        let currentScore = 0;
        const increment = targetScore / 50;
        const timer = setInterval(() => {
            currentScore += increment;
            if (currentScore >= targetScore) {
                currentScore = targetScore;
                clearInterval(timer);
            }
            scoreElement.textContent = Math.round(currentScore);
        }, 30);
    }

    // Enhanced PDF Generation
    window.generatePDF = function() {
        if (!currentAnalysisData) {
            showMessage('No analysis to save', 'error');
            return;
        }
        
        const button = event.target;
        button.disabled = true;
        button.textContent = 'Generating PDF...';
        
        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const results = currentAnalysisData.results;
            let yPos = 20;
            
            // Header with gradient effect
            doc.setFillColor(102, 126, 234);
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(24);
            doc.text('AI News Analysis Report', 105, 25, { align: 'center' });
            
            // Reset text color
            doc.setTextColor(0, 0, 0);
            
            // Date and URL
            yPos = 50;
            doc.setFontSize(10);
            doc.text(`Generated: ${new Date().toLocaleString()}`, 20, yPos);
            yPos += 10;
            doc.text(`Article URL: ${document.getElementById('articleUrl').value || 'Text Analysis'}`, 20, yPos);
            
            // Overall Assessment
            yPos += 15;
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('OVERALL ASSESSMENT', 20, yPos);
            
            // Trust Score with color
            yPos += 10;
            doc.setFontSize(14);
            const trustColor = results.credibility >= 80 ? [17, 153, 142] : 
                             results.credibility >= 60 ? [242, 153, 74] : [235, 51, 73];
            doc.setTextColor(...trustColor);
            doc.text(`Trust Score: ${results.credibility || 0}%`, 20, yPos);
            
            // Source and Author
            doc.setTextColor(0, 0, 0);
            yPos += 10;
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`Source: ${results.sources?.name || 'Unknown'}`, 20, yPos);
            yPos += 8;
            doc.text(`Author: ${results.author || 'Not specified'}`, 20, yPos);
            
            // Article Summary
            yPos += 15;
            doc.setFont(undefined, 'bold');
            doc.text('Article Summary:', 20, yPos);
            doc.setFont(undefined, 'normal');
            yPos += 8;
            doc.setFontSize(10);
            const summaryLines = doc.splitTextToSize(results.summary || 'No summary available', 170);
            doc.text(summaryLines, 20, yPos);
            yPos += summaryLines.length * 5 + 10;
            
            // Political Bias
            if (results.bias) {
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Political Bias Analysis:', 20, yPos);
                doc.setFont(undefined, 'normal');
                yPos += 8;
                doc.text(`Detected: ${results.bias.label}`, 20, yPos);
                yPos += 6;
                doc.text(`Objectivity: ${results.bias.objectivity}%`, 20, yPos);
                yPos += 6;
                doc.text(`Bias Score: ${results.bias.score > 0 ? '+' : ''}${results.bias.score}`, 20, yPos);
                yPos += 10;
            }
            
            // Key Findings
            if (results.key_findings && results.key_findings.length > 0) {
                doc.setFont(undefined, 'bold');
                doc.text('Key AI Insights:', 20, yPos);
                doc.setFont(undefined, 'normal');
                yPos += 8;
                doc.setFontSize(10);
                
                results.key_findings.forEach((finding, i) => {
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                    const findingLines = doc.splitTextToSize(`${i + 1}. ${finding}`, 170);
                    doc.text(findingLines, 20, yPos);
                    yPos += findingLines.length * 5 + 5;
                });
            }
            
            // Fact Check Results
            if (results.claims && results.claims.length > 0) {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Fact-Check Results:', 20, yPos);
                doc.setFont(undefined, 'normal');
                yPos += 8;
                
                const verified = results.claims.filter(c => c.status.toLowerCase().includes('verif')).length;
                const false_claims = results.claims.filter(c => c.status.toLowerCase().includes('false')).length;
                const unverified = results.claims.length - verified - false_claims;
                
                doc.text(`✓ Verified: ${verified}  ✗ False: ${false_claims}  ? Unverified: ${unverified}`, 20, yPos);
                yPos += 10;
                
                // List claims
                doc.setFontSize(10);
                results.claims.forEach(claim => {
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                    const claimLines = doc.splitTextToSize(`• "${claim.claim}" - ${claim.status}`, 170);
                    doc.text(claimLines, 20, yPos);
                    yPos += claimLines.length * 5 + 3;
                });
            }
            
            // Footer
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text('Generated by Facts & Fakes AI - Professional News Analysis', 105, 290, { align: 'center' });
            
            // Save
            doc.save(`news-analysis-${Date.now()}.pdf`);
            
            showMessage('PDF report generated successfully!', 'success');
            
        } catch (error) {
            console.error('PDF generation error:', error);
            showMessage('Failed to generate PDF. Please try again.', 'error');
        } finally {
            button.disabled = false;
            button.textContent = '📄 Generate Full PDF Report';
        }
    }

    // Reset analysis
    window.resetAnalysis = function() {
        document.getElementById('articleUrl').value = '';
        document.getElementById('articleText').value = '';
        document.getElementById('results').style.display = 'none';
        currentAnalysisData = null;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Show animated messages
    function showMessage(text, type) {
        const message = document.createElement('div');
        message.style.cssText = `
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 30px;
            background: ${type === 'error' ? 
                'linear-gradient(135deg, #eb3349, #f45c43)' : 
                'linear-gradient(135deg, #11998e, #38ef7d)'};
            color: white;
            border-radius: 50px;
            font-weight: 700;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideInRight 0.5s ease-out;
        `;
        message.textContent = text;
        document.body.appendChild(message);
        
        setTimeout(() => {
            message.style.animation = 'slideOutRight 0.5s ease-out';
            setTimeout(() => message.remove(), 500);
        }, 5000);
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
        console.log('AI News Intelligence System initialized');
        
        // Add input animations
        document.getElementById('articleUrl').addEventListener('focus', function() {
            this.style.borderColor = '#667eea';
            this.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.3)';
        });
        
        document.getElementById('articleUrl').addEventListener('blur', function() {
            this.style.borderColor = '#e5e7eb';
            this.style.boxShadow = 'none';
        });
    });
</script>

<style>
@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}
</style>
{% endblock %}
