<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced News Analyzer - Facts & Fakes AI</title>
    <meta name="description" content="AI-powered news verification with bias detection, fact-checking, and credibility analysis. Detect fake news instantly with our advanced algorithms.">
    
    <!-- Bootstrap CSS from cdnjs (CSP approved) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Professional Color Scheme */
        :root {
            --primary-blue: #4a90e2;
            --primary-blue-dark: #357abd;
            --primary-gradient: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #ecf0f1;
            --bg-light: #f8f9fa;
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 8px 30px rgba(74, 144, 226, 0.2);
        }

        /* Enhanced Trust Meter - Larger and More Prominent */
        .trust-score-section {
            display: flex;
            align-items: center;
            gap: 40px;
            padding: 40px;
            background: linear-gradient(135deg, #f8faff 0%, #eef2ff 100%);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(74, 144, 226, 0.15);
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }
        
        .trust-score-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(74, 144, 226, 0.1) 0%, transparent 70%);
            animation: pulse-slow 4s ease-in-out infinite;
        }
        
        @keyframes pulse-slow {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }
        
        .trust-meter-container {
            position: relative;
            width: 250px;
            height: 250px;
            background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 100%);
            border-radius: 50%;
            box-shadow: 
                0 10px 40px rgba(74, 144, 226, 0.2),
                inset 0 2px 10px rgba(255, 255, 255, 0.8);
            padding: 20px;
            animation: float 6s ease-in-out infinite;
            flex-shrink: 0;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .trust-meter {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .trust-meter-circle {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .trust-meter-bg {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 20;
        }
        
        .trust-meter-fill {
            fill: none;
            stroke-width: 20;
            stroke-linecap: round;
            transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 10px currentColor);
        }
        
        .trust-meter-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .trust-score {
            font-size: 48px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
        }
        
        .trust-label {
            font-size: 14px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .trust-resources {
            flex: 1;
            position: relative;
            z-index: 1;
        }
        
        .trust-resources h3 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--text-primary);
            font-weight: 700;
        }
        
        .resource-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 18px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .resource-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary-gradient);
            transition: width 0.3s ease;
        }
        
        .resource-item:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.15);
        }
        
        .resource-item:hover::before {
            width: 8px;
        }
        
        .resource-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .resource-icon.ai {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .resource-icon.fact {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .resource-icon.bias {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .resource-icon.source {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .resource-icon.pattern {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }
        
        .resource-content {
            flex: 1;
        }
        
        .resource-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 2px;
            color: var(--text-primary);
        }
        
        .resource-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .trust-score-section {
                flex-direction: column;
                padding: 30px 20px;
                gap: 30px;
            }
            
            .trust-meter-container {
                width: 200px;
                height: 200px;
            }
            
            .trust-score {
                font-size: 36px;
            }
            
            .trust-resources h3 {
                text-align: center;
            }
            
            .resource-item {
                padding: 12px;
            }
            
            .resource-item:hover {
                transform: translateX(5px);
            }
        }

        /* Sticky Upgrade Button */
        .sticky-upgrade {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            animation: pulse 2s infinite;
        }
        
        .sticky-upgrade button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.4);
            transition: all 0.3s ease;
        }
        
        .sticky-upgrade button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(74, 144, 226, 0.5);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Tooltips */
        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip-icon {
            width: 16px;
            height: 16px;
            background: #e5e7eb;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #6b7280;
            margin-left: 5px;
            transition: all 0.2s ease;
        }
        
        .tooltip-icon:hover {
            background: var(--primary-blue);
            color: white;
        }
        
        .tooltip-content {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            margin-bottom: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            max-width: 300px;
            white-space: normal;
            z-index: 1000;
        }
        
        .tooltip-container:hover .tooltip-content {
            opacity: 1;
        }
        
        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1f2937;
        }

        /* Analysis Timestamp and Version */
        .analysis-meta {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .meta-item i {
            color: var(--primary-blue);
        }

        /* Confidence Intervals */
        .confidence-bar {
            position: relative;
            height: 30px;
            background: var(--bg-light);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
            transition: width 1s ease;
            position: relative;
        }
        
        .confidence-marker {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 20px;
            background: #1f2937;
            border-radius: 2px;
        }
        
        .confidence-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 600;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Pro Features Preview (Grayed Out) */
        .pro-feature-locked {
            position: relative;
            opacity: 0.6;
            filter: grayscale(100%);
            pointer-events: none;
        }
        
        .pro-feature-locked::after {
            content: 'PRO FEATURE';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            background: var(--primary-blue);
            color: white;
            padding: 5px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
        }

        /* Why This Matters Sections */
        .why-matters-box {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .why-matters-box h4 {
            color: #92400e;
            margin: 0 0 8px 0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .why-matters-box p {
            color: #78350f;
            margin: 0;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Methodology Snippets */
        .methodology-snippet {
            background: #ede9fe;
            border: 1px solid #c7d2fe;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            font-size: 13px;
            color: #5b21b6;
        }
        
        .methodology-snippet code {
            background: #ddd6fe;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        /* Learn More Links */
        .learn-more-link {
            color: var(--primary-blue);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }
        
        .learn-more-link:hover {
            color: var(--primary-blue-dark);
            gap: 8px;
        }

        /* Floating particles background */
        @keyframes float-particle {
            0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translate(100px, -100vh) rotate(720deg); opacity: 0; }
        }
        
        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0;
            animation: float-particle 10s infinite;
        }
        
        .particle:nth-child(odd) { animation-duration: 15s; }
        .particle:nth-child(even) { animation-duration: 20s; animation-delay: 5s; }

        /* Animated dropdowns with colorful borders */
        .analysis-dropdown {
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .analysis-dropdown:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .dropdown-header {
            padding: 20px;
            cursor: pointer;
            background: white;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .dropdown-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 144, 226, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .dropdown-header:hover::before {
            left: 100%;
        }
        
        .dropdown-header h3 {
            margin: 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            color: var(--text-primary);
        }
        
        .dropdown-header i {
            font-size: 24px;
            margin-right: 15px;
        }
        
        .dropdown-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }
        
        .dropdown-content.show {
            max-height: 2000px;
            padding: 20px;
        }
        
        /* Colorful borders for different sections */
        .border-trust { border-left: 4px solid #10b981 !important; }
        .border-bias { border-left: 4px solid #f59e0b !important; }
        .border-fact { border-left: 4px solid #3b82f6 !important; }
        .border-author { border-left: 4px solid #8b5cf6 !important; }
        .border-quality { border-left: 4px solid #ec4899 !important; }
        .border-agenda { border-left: 4px solid #ef4444 !important; }
        .border-clickbait { border-left: 4px solid #f97316 !important; }
        .border-emotion { border-left: 4px solid #06b6d4 !important; }
        .border-diversity { border-left: 4px solid #84cc16 !important; }
        .border-time { border-left: 4px solid var(--primary-blue) !important; }
        .border-ai { border-left: 4px solid #14b8a6 !important; }

        /* Gauge styles */
        .gauge-container {
            width: 200px;
            height: 100px;
            position: relative;
            margin: 20px auto;
        }
        
        .gauge {
            width: 100%;
            height: 200px;
            border-radius: 100px 100px 0 0;
            background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            position: relative;
            overflow: hidden;
        }
        
        .gauge-mask {
            width: 160px;
            height: 160px;
            background: white;
            border-radius: 80px 80px 0 0;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .gauge-needle {
            width: 4px;
            height: 90px;
            background: #1f2937;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(-90deg);
            transition: transform 1s ease-out;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* Progress bar for loading */
        /* Enhanced Progress bar with WOW factor */
.progress-container {
    background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
    border-radius: 20px;
    padding: 6px;
    margin: 20px 0;
    position: relative;
    overflow: hidden;
    box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.5),
        0 5px 20px rgba(74, 144, 226, 0.3);
}

.progress-container::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe, #667eea);
    background-size: 400% 400%;
    border-radius: 20px;
    z-index: -1;
    animation: gradient-border 3s ease infinite;
    filter: blur(8px);
    opacity: 0.8;
}

@keyframes gradient-border {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.progress-bar {
    height: 40px;
    background: linear-gradient(90deg, 
        #667eea 0%, 
        #764ba2 15%, 
        #f093fb 30%, 
        #f5576c 45%, 
        #4facfe 60%, 
        #00f2fe 75%, 
        #43e97b 90%, 
        #38f9d7 100%);
    background-size: 200% 100%;
    animation: shimmer 2s linear infinite;
    border-radius: 15px;
    width: 0%;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 16px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
    box-shadow: 
        0 0 20px rgba(102, 126, 234, 0.6),
        inset 0 1px 0 rgba(255,255,255,0.3),
        inset 0 -1px 0 rgba(0,0,0,0.3);
}

@keyframes shimmer {
    0% { background-position: -100% 0; }
    100% { background-position: 200% 0; }
}

.progress-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent, 
        rgba(255,255,255,0.4) 20%, 
        rgba(255,255,255,0.6) 50%, 
        rgba(255,255,255,0.4) 80%, 
        transparent);
    animation: sweep 2s infinite;
}

@keyframes sweep {
    0% { left: -100%; }
    100% { left: 100%; }
}

.progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 50%;
    background: linear-gradient(to bottom, 
        rgba(255,255,255,0.3) 0%, 
        rgba(255,255,255,0.1) 50%, 
        transparent 100%);
    border-radius: 15px 15px 0 0;
}

/* Particle effects for the progress bar */
.progress-bar.active {
    animation: shimmer 2s linear infinite, pulse-glow 1.5s ease-in-out infinite;
}

@keyframes pulse-glow {
    0%, 100% { 
        box-shadow: 
            0 0 20px rgba(102, 126, 234, 0.6),
            0 0 40px rgba(102, 126, 234, 0.4),
            inset 0 1px 0 rgba(255,255,255,0.3),
            inset 0 -1px 0 rgba(0,0,0,0.3);
    }
    50% { 
        box-shadow: 
            0 0 30px rgba(102, 126, 234, 0.8),
            0 0 60px rgba(102, 126, 234, 0.6),
            inset 0 1px 0 rgba(255,255,255,0.4),
            inset 0 -1px 0 rgba(0,0,0,0.4);
    }
}

/* Loading section progress bar specific styling */
#loading-section .progress-container {
    margin: 0 0 10px 0;
    transform: scale(1);
    transition: transform 0.3s ease;
}

#loading-section .progress-container:hover {
    transform: scale(1.02);
}

/* Fixed header progress bar with extra effects */
.fixed-progress-header {
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(74, 144, 226, 0.2);
}

.fixed-progress-header .progress-container {
    box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.3),
        0 2px 10px rgba(74, 144, 226, 0.4);
}

/* Rainbow text animation for percentage */
.progress-bar.high-progress {
    background: linear-gradient(90deg, 
        #00ff88 0%, 
        #00f2fe 20%, 
        #4facfe 40%, 
        #667eea 60%, 
        #764ba2 80%, 
        #f093fb 100%);
    background-size: 200% 100%;
    animation: shimmer 1s linear infinite;
}

/* Completion animation */
.progress-bar.complete {
    animation: shimmer 0.5s linear infinite, complete-flash 0.5s ease;
    background: linear-gradient(90deg, #10b981 0%, #34d399 50%, #6ee7b7 100%);
}

@keyframes complete-flash {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

        /* Claim cards */
        .claim-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .claim-card:hover {
            transform: translateX(5px);
            border-color: var(--primary-blue);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.2);
        }
        
        .claim-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .status-verified {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-false {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-unverified {
            background: #fed7aa;
            color: #92400e;
        }

        /* Glowing effect for important elements */
        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(74, 144, 226, 0.5); }
            50% { box-shadow: 0 0 20px rgba(74, 144, 226, 0.8), 0 0 30px rgba(74, 144, 226, 0.6); }
            100% { box-shadow: 0 0 5px rgba(74, 144, 226, 0.5); }
        }
        
        .glow-effect {
            animation: glow 2s ease-in-out infinite;
        }

        /* PDF button */
        .pdf-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .pdf-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }

        /* Source comparison grid */
        .source-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .source-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .source-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .source-logo {
            width: 50px;
            height: 50px;
            margin: 0 auto 10px;
            background: var(--bg-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .source-score {
            font-size: 24px;
            font-weight: 700;
            margin: 5px 0;
        }

        /* Historical accuracy chart */
        .accuracy-chart {
            height: 200px;
            background: var(--bg-light);
            border-radius: 8px;
            padding: 20px;
            position: relative;
            margin: 20px 0;
        }
        
        .chart-grid {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 40px;
            border-left: 2px solid #e5e7eb;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .chart-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-blue);
        }

        /* Enhanced loading animation stages */
        .analysis-stage {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin: 10px 0;
            opacity: 0.5;
            transition: all 0.3s ease;
        }
        
        .analysis-stage.active {
            opacity: 1;
            background: #eef2ff;
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.2);
        }
        
        .analysis-stage.complete {
            opacity: 1;
        }
        
        .stage-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .analysis-stage.active .stage-icon {
            background: var(--primary-blue);
            color: white;
            animation: rotate 1s linear infinite;
        }
        
        .analysis-stage.complete .stage-icon {
            background: #10b981;
            color: white;
        }
        
        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        /* Pricing dropdown */
        .pricing-info {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #fbbf24;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .pricing-tier {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
        
        .pricing-tier h4 {
            margin: 0;
            color: #92400e;
        }
        
        .pricing-tier .price {
            font-size: 24px;
            font-weight: 700;
            color: #dc2626;
        }

        /* Author Input Section Styles */
        .author-input-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .manual-author-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .manual-author-form .form-control {
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .manual-author-form .form-control:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
        }

        .credibility-assessment {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .credibility-indicator {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .credibility-indicator:hover {
            background: #e9ecef;
        }

        .credibility-indicator i {
            font-size: 20px;
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }

        .credibility-indicator.positive i {
            color: #28a745;
        }

        .credibility-indicator.neutral i {
            color: #ffc107;
        }

        .credibility-indicator.negative i {
            color: #dc3545;
        }

        .author-info-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .author-info-card h5 {
            color: var(--primary-blue);
            margin-bottom: 15px;
        }

        .author-bio {
            font-style: italic;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .author-credentials {
            list-style: none;
            padding: 0;
        }

        .author-credentials li {
            padding: 5px 0;
            display: flex;
            align-items: center;
        }

        .author-credentials li i {
            color: var(--primary-blue);
            margin-right: 10px;
        }

        /* Spinner for Bootstrap 5 compatibility */
        .spinner-border {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            vertical-align: text-bottom;
            border: 0.25em solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spinner-border 0.75s linear infinite;
        }

        @keyframes spinner-border {
            to { transform: rotate(360deg); }
        }

        .visually-hidden {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        /* Overall Assessment Specific Styles - Compact Version */
.overall-assessment-container {
    background: linear-gradient(135deg, #f8faff 0%, #eef2ff 100%);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
}

/* Trust Score Card - Compact */
.trust-score-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    margin-bottom: 20px;
}

/* Trust Score Header - Compact */
.trust-score-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.trust-badge {
    display: flex;
    align-items: center;
    gap: 12px;
}

.trust-icon-wrapper {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.trust-icon-wrapper.high {
    background: rgba(16, 185, 129, 0.15);
    color: #059669;
}

.trust-icon-wrapper.medium {
    background: rgba(245, 158, 11, 0.15);
    color: #d97706;
}

.trust-icon-wrapper.low {
    background: rgba(239, 68, 68, 0.15);
    color: #dc2626;
}

.trust-details h3 {
    margin: 0;
    font-size: 20px;
    color: var(--text-primary);
}

.trust-details p {
    margin: 2px 0 0 0;
    color: var(--text-secondary);
    font-size: 14px;
}

/* Trust Score Display - Compact */
.trust-score-display {
    font-size: 36px;
    font-weight: 700;
    color: var(--text-primary);
}

.score-meaning {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: normal;
    display: block;
    margin-top: 2px;
}

/* Summary Box - Compact */
.summary-box {
    background: rgba(74, 144, 226, 0.08);
    border-left: 3px solid var(--primary-blue);
    border-radius: 6px;
    padding: 15px;
    margin-bottom: 20px;
}

.summary-box p {
    margin: 0;
    color: var(--text-primary);
    line-height: 1.6;
    font-size: 15px;
}

/* Key Metrics Grid - Compact 2x2 */
.key-metrics-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
}

@media (max-width: 576px) {
    .key-metrics-grid {
        grid-template-columns: 1fr;
    }
}

.metric-card {
    background: white;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    gap: 12px;
}

.metric-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
}

.metric-icon.credibility {
    background: rgba(59, 130, 246, 0.1);
    color: #3b82f6;
}

.metric-icon.accuracy {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
}

.metric-icon.bias {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}

.metric-icon.quality {
    background: rgba(139, 92, 246, 0.1);
    color: #8b5cf6;
}

.metric-content {
    flex: 1;
}

.metric-value {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary);
    display: flex;
    align-items: baseline;
    gap: 6px;
}

.metric-label {
    font-size: 13px;
    color: var(--text-secondary);
    margin-top: 2px;
}

.metric-explainer {
    font-size: 11px;
    color: var(--text-secondary);
    font-weight: normal;
}

/* Findings and Flags - Compact */
.findings-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

@media (max-width: 768px) {
    .findings-container {
        grid-template-columns: 1fr;
    }
}

.findings-card, .flags-card {
    background: white;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e5e7eb;
}

.findings-card {
    border-top: 2px solid #10b981;
}

.flags-card {
    border-top: 2px solid #ef4444;
}

.findings-card h5, .flags-card h5 {
    margin: 0 0 12px 0;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.findings-list, .flags-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.findings-list li, .flags-list li {
    padding: 8px 0;
    border-bottom: 1px solid #f3f4f6;
    display: flex;
    align-items: start;
    gap: 10px;
    font-size: 14px;
}

.findings-list li:last-child, .flags-list li:last-child {
    border-bottom: none;
}

.findings-list li i {
    color: #10b981;
    margin-top: 2px;
    flex-shrink: 0;
    font-size: 12px;
}

.flags-list li i {
    color: #ef4444;
    margin-top: 2px;
    flex-shrink: 0;
    font-size: 12px;
}

/* Score Legend - Compact */
.score-legend {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
}

.score-legend h5 {
    margin: 0 0 10px 0;
    font-size: 14px;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.legend-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}

@media (max-width: 576px) {
    .legend-grid {
        grid-template-columns: 1fr;
    }
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
}

.legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
}

.legend-dot.high { background: #10b981; }
.legend-dot.medium { background: #f59e0b; }
.legend-dot.low { background: #ef4444; }

/* Confidence Bar - Ultra Compact */
.confidence-section {
    background: white;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e5e7eb;
    margin-bottom: 20px;
}

.confidence-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

.confidence-header h5 {
    margin: 0;
    font-size: 14px;
    color: var(--text-primary);
}

.confidence-value {
    font-size: 18px;
    font-weight: 700;
    color: var(--primary-blue);
}

.confidence-bar-enhanced {
    position: relative;
    height: 24px;
    background: #f3f4f6;
    border-radius: 12px;
    overflow: hidden;
}

.confidence-fill-enhanced {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6 0%, #667eea 100%);
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    color: white;
    font-weight: 600;
    font-size: 12px;
}

/* Free Tier Notice */
.free-tier-notice {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border: 1px solid #fbbf24;
    border-radius: 8px;
    padding: 12px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 20px;
}

.free-tier-notice p {
    margin: 0;
    font-size: 13px;
    color: #92400e;
    display: flex;
    align-items: center;
    gap: 8px;
}

.free-tier-notice a {
    color: #92400e;
    font-weight: 600;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 13px;
}

.free-tier-notice a:hover {
    text-decoration: underline;
}
        /* Mobile responsive */
        @media (max-width: 768px) {
            .trust-meter-container {
                width: 200px;
                height: 200px;
            }
            
            .trust-score {
                font-size: 36px;
            }
            
            .analysis-dropdown {
                margin-bottom: 10px;
            }
            
            .dropdown-header {
                padding: 15px;
            }
            
            .dropdown-header h3 {
                font-size: 18px;
            }
            
            .source-comparison {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .sticky-upgrade {
                bottom: 20px;
                right: 20px;
            }
            
            .sticky-upgrade button {
                padding: 12px 20px;
                font-size: 14px;
            }
        }

        /* Input section styling */
        .input-section {
            background: linear-gradient(135deg, var(--bg-light) 0%, #e5e7eb 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-light);
        }
        
        .input-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .input-tab {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .input-tab.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
        }
        
        .input-tab:hover:not(.active) {
            background: var(--bg-light);
            border-color: var(--primary-blue);
        }
        
        #news-url, #news-text {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        #news-url:focus, #news-text:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        #news-text {
            min-height: 150px;
            resize: vertical;
        }
        
        .analyze-button {
            width: 100%;
            padding: 15px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .analyze-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(74, 144, 226, 0.3);
        }
        
        .analyze-button:active {
            transform: translateY(0);
        }

        /* News container styling */
        .news-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header styling */
        .news-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
        }

        .news-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-gradient);
        }

        .news-header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .news-header p {
            font-size: 1.2em;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Loading overlay styles */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 9999;
            backdrop-filter: blur(10px);
            justify-content: center;
            align-items: center;
        }

        .loading-content {
            text-align: center;
            max-width: 500px;
            width: 90%;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .loading-subtext {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        /* Results section styling */
        .results-section {
            display: none;
            margin-top: 40px;
        }

        .results-header {
            background: var(--primary-gradient);
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            text-align: center;
        }

        .results-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .results-content {
            background: white;
            border-radius: 0 0 15px 15px;
            box-shadow: var(--shadow-light);
            overflow: hidden;
        }

        /* Error container styling */
        .error-container {
            display: none;
            background: #fef2f2;
            border: 1px solid #fed7d7;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }

        .error-container i {
            font-size: 3em;
            color: var(--danger-color);
            margin-bottom: 20px;
        }

        .error-container h3 {
            color: var(--danger-color);
            margin-bottom: 10px;
        }

        .error-container p {
            color: #742a2a;
            margin-bottom: 20px;
        }

        .retry-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .retry-btn:hover {
            background: #c53030;
        }
     /* ========== NEW STYLES FOR PRE-ANALYSIS VIEW ========== */

/* Enhanced Input Section with Colorful Borders */
.input-section {
    background: linear-gradient(135deg, #ffffff 0%, #f8faff 100%);
    border-radius: 20px;
    padding: 35px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
    border: 3px solid transparent;
    background-clip: padding-box;
}

.input-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 20px;
    padding: 3px;
    background: linear-gradient(135deg, #4a90e2 0%, #8b5cf6 50%, #ec4899 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0.8;
}

/* Input Method Selector */
.input-selector {
    background: rgba(74, 144, 226, 0.1);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 25px;
    border: 2px dashed #4a90e2;
    position: relative;
}

.input-selector-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
}

.input-selector-header i {
    color: #4a90e2;
    font-size: 24px;
    animation: pulse 2s infinite;
}

.input-selector-header h5 {
    margin: 0;
    color: #2c3e50;
    font-weight: 600;
}

/* Enhanced Input Tabs */
.input-tab i {
    font-size: 20px;
    display: block;
    margin-bottom: 8px;
}

/* Button Container */
.button-container {
    display: flex;
    gap: 15px;
    margin-top: 25px;
}

.reset-button {
    padding: 18px 30px;
    background: white;
    color: #2c3e50;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.reset-button:hover {
    background: #f8f9fa;
    border-color: #4a90e2;
    transform: translateY(-2px);
}

/* Feature Preview Section */
.feature-preview-section {
    margin: 40px 0;
}

.feature-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.feature-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
}

.feature-card.free {
    border-color: #27ae60;
}

.feature-card.pro {
    border-color: #8b5cf6;
    background: linear-gradient(135deg, #ffffff 0%, #faf5ff 100%);
}

.feature-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
    opacity: 0.1;
    border-radius: 0 0 0 100%;
}

.feature-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.feature-badge {
    display: inline-block;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.badge-free {
    background: rgba(39, 174, 96, 0.1);
    color: #27ae60;
}

.badge-pro {
    background: rgba(139, 92, 246, 0.1);
    color: #8b5cf6;
}

.feature-card h4 {
    font-size: 20px;
    margin-bottom: 15px;
    color: #2c3e50;
}

.feature-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.feature-list li {
    padding: 8px 0;
    display: flex;
    align-items: start;
    gap: 10px;
    color: #7f8c8d;
}

.feature-list li i {
    color: #27ae60;
    margin-top: 3px;
    flex-shrink: 0;
}

.pro .feature-list li i {
    color: #8b5cf6;
}

/* Resources Dropdown */
.resources-dropdown {
    background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%);
    border-radius: 15px;
    margin: 30px 0;
    overflow: hidden;
    border: 2px solid rgba(74, 144, 226, 0.2);
}

.resources-header {
    padding: 20px 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.3s ease;
}

.resources-header:hover {
    background: rgba(74, 144, 226, 0.05);
}

.resources-header h5 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
    color: #2c3e50;
}

.resources-header i.icon {
    font-size: 24px;
    color: #4a90e2;
}

.resources-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: white;
}

.resources-content.show {
    max-height: 500px;
}

.resources-grid {
    padding: 25px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.resource-item {
    display: flex;
    align-items: center;
    gap: 15px;
}

.resource-logo {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
}

.resource-logo.openai {
    background: linear-gradient(135deg, #74aa9c 0%, #53816f 100%);
    color: white;
}

.resource-logo.factcheck {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
}

.resource-logo.bias {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
}

.resource-logo.ml {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    color: white;
}

.resource-info h6 {
    margin: 0 0 5px 0;
    font-size: 16px;
    color: #2c3e50;
}

.resource-info p {
    margin: 0;
    font-size: 13px;
    color: #7f8c8d;
}

/* Info boxes with colorful borders */
.info-box {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin: 15px 0;
    border-left: 4px solid #4a90e2;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.info-box:hover {
    transform: translateX(5px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.info-box.tip {
    border-left-color: #14b8a6;
    background: linear-gradient(135deg, #ffffff 0%, #f0fdfa 100%);
}

.info-box.warning {
    border-left-color: #f39c12;
    background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%);
}

/* Chevron animation */
.chevron-icon {
    transition: transform 0.3s ease;
}

.resources-header.active .chevron-icon {
    transform: rotate(180deg);
}

/* Remove sticky upgrade button */
.sticky-upgrade {
    display: none !important;
}
/* Feature Preview Dropdown with Side-by-Side Layout */
.feature-preview-dropdown {
    background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
    border-radius: 15px;
    margin: 30px 0;
    overflow: hidden;
    border: 2px solid rgba(139, 92, 246, 0.2);
}

.feature-preview-header {
    padding: 20px 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.3s ease;
}

.feature-preview-header:hover {
    background: rgba(139, 92, 246, 0.05);
}

.feature-preview-header h5 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
    color: #2c3e50;
}

.feature-preview-header i.icon {
    font-size: 24px;
    color: #8b5cf6;
}

.feature-preview-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: white;
}

.feature-preview-content.show {
    max-height: 600px;
}

.feature-comparison {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 0;
    padding: 25px;
}

.feature-column {
    padding: 20px;
}

.feature-column.free {
    background: #f8f9fa;
    border-radius: 12px 0 0 12px;
}

.feature-column.pro {
    background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
    border-radius: 0 12px 12px 0;
}

.feature-divider {
    width: 2px;
    background: linear-gradient(to bottom, #e5e7eb 0%, #8b5cf6 50%, #e5e7eb 100%);
}

.feature-header {
    text-align: center;
    margin-bottom: 20px;
}

.feature-column .feature-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.feature-column .feature-list li {
    padding: 10px 0;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
}

.feature-list li.disabled {
    opacity: 0.5;
    text-decoration: line-through;
}

.feature-list li.disabled i {
    color: #dc3545;
}

.feature-list li.limit {
    color: #f59e0b;
    font-weight: 500;
}

.feature-list li.highlight {
    color: #8b5cf6;
    font-weight: 600;
}

@media (max-width: 768px) {
    .feature-comparison {
/* ========== END NEW STYLES ========== */   
    </style>
</head>
<body>
    <!-- Floating particles for visual appeal -->
    <div class="particle" style="left: 10%; top: 20%; width: 6px; height: 6px; background: var(--primary-blue); border-radius: 50%;"></div>
    <div class="particle" style="left: 80%; top: 40%; width: 8px; height: 8px; background: var(--primary-blue-dark); border-radius: 50%;"></div>
    <div class="particle" style="left: 60%; top: 60%; width: 5px; height: 5px; background: #10b981; border-radius: 50%;"></div>
    <div class="particle" style="left: 30%; top: 80%; width: 7px; height: 7px; background: #f59e0b; border-radius: 50%;"></div>

    <!-- Facts & Fakes AI Navigation Header --> 
    <style>
    /* Reset any conflicting styles */
    .ff-nav * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    /* Main navigation bar */
    .ff-nav {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 9999;
        height: 60px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .ff-nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
    }

    /* Logo */
    .ff-nav-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        color: #667eea;
        font-weight: 700;
        font-size: 1.1rem;
        transition: transform 0.3s ease;
    }

    .ff-nav-logo:hover {
        transform: scale(1.05);
    }

    .ff-nav-logo i {
        font-size: 1.4rem;
    }

    /* Navigation links */
    .ff-nav-links {
        display: flex;
        gap: 5px;
        align-items: center;
    }

    .ff-nav-link {
        color: #4a5568;
        text-decoration: none;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-weight: 500;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .ff-nav-link:hover {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        transform: translateY(-2px);
    }

    .ff-nav-link.active {
        background: rgba(102, 126, 234, 0.15);
        color: #667eea;
        font-weight: 600;
    }

    .ff-nav-link i {
        font-size: 0.9rem;
    }

    /* Auth buttons */
    .ff-nav-auth {
        display: flex;
        gap: 10px;
        align-items: center;
        position: relative;
    }

    .ff-nav-login, .ff-nav-signup {
        padding: 8px 20px;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .ff-nav-login {
        color: #667eea;
        border: 2px solid #667eea;
    }

    .ff-nav-login:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }

    .ff-nav-signup {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: 2px solid transparent;
    }

    .ff-nav-signup:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    /* Beta balloon */
    .ff-beta-balloon {
        position: absolute;
        top: -35px;
        right: 50px;
        background: linear-gradient(135deg, #ff6b35, #f7931e);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        white-space: nowrap;
        animation: ff-bounce 2s infinite;
        box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
    }

    .ff-beta-balloon::after {
        content: '';
        position: absolute;
        bottom: -6px;
        right: 20px;
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-top: 6px solid #f7931e;
    }

    @keyframes ff-bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    /* User menu */
    .ff-user-menu {
        position: relative;
        display: none;
    }

    .ff-user-menu-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #4a5568;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .ff-user-menu-toggle:hover {
        background: rgba(102, 126, 234, 0.2);
    }

    .ff-user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 10px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.1);
        min-width: 280px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
    }

    .ff-user-dropdown.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    /* Mobile menu button */
    .ff-mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        color: #4a5568;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 8px;
        transition: all 0.3s ease;
    }

    .ff-mobile-menu-btn:hover {
        color: #667eea;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
        .ff-nav-links {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            flex-direction: column;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border-top: 1px solid #e2e8f0;
        }
        
        .ff-nav-links.active {
            display: flex;
        }
        
        .ff-nav-link {
            width: 100%;
            padding: 12px 20px;
        }
        
        .ff-mobile-menu-btn {
            display: block;
        }
        
        .ff-nav-auth {
            display: none;
        }
        
        .ff-user-menu {
            display: none !important;
        }
        
        .ff-beta-balloon {
            display: none;
        }
    }
    </style>

    <nav class="ff-nav">
        <div class="ff-nav-container">
            <a href="/" class="ff-nav-logo">
                <i class="fas fa-shield-alt"></i>
                <span>Facts & Fakes AI</span>
            </a>
            
            <div class="ff-nav-links" id="ffNavLinks">
                <a href="/" class="ff-nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/news" class="ff-nav-link"><i class="fas fa-newspaper"></i> News Verify</a>
                <a href="/speech" class="ff-nav-link"><i class="fas fa-microphone"></i> Speech Check</a>
                <a href="/unified" class="ff-nav-link"><i class="fas fa-search"></i> Content Check</a>
                <a href="/imageanalysis" class="ff-nav-link"><i class="fas fa-image"></i> Image Analysis</a>
                <a href="/missionstatement" class="ff-nav-link"><i class="fas fa-bullseye"></i> Mission</a>
                <a href="/pricingplan" class="ff-nav-link"><i class="fas fa-tags"></i> Pricing</a>
                <a href="/contact" class="ff-nav-link"><i class="fas fa-envelope"></i> Contact</a>
            </div>
            
            <div class="ff-nav-auth" id="ffNavAuth">
                <a href="/login" class="ff-nav-login">Login</a>
                <a href="/pricingplan" class="ff-nav-signup">Sign Up</a>
                <div class="ff-beta-balloon">
                    sign up now to start your free trial
                </div>
            </div>
            
            <div class="ff-user-menu" id="ffUserMenu">
                <div class="ff-user-menu-toggle" onclick="ffToggleUserDropdown()">
                    <span id="ffUserEmail">user@example.com</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="ff-user-dropdown" id="ffUserDropdown">
                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 4px;" id="ffUserEmailDropdown">user@example.com</div>
                        <div style="font-size: 0.85rem; color: #667eea; font-weight: 500;" id="ffUserPlan">Free Plan</div>
                    </div>
                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-size: 0.85rem; color: #718096; margin-bottom: 8px; font-weight: 500;">Daily Usage</div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 8px;">
                            <div id="ffUsageProgress" style="height: 100%; background: linear-gradient(135deg, #667eea, #764ba2); width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                        <div style="font-size: 0.8rem; color: #4a5568;" id="ffUsageText">0 / 5 analyses used</div>
                    </div>
                    <div style="padding: 10px 0;">
                        <a href="/account" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: #4a5568; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem;"><i class="fas fa-user"></i> Account Settings</a>
                        <a href="/billing" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: #4a5568; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem;"><i class="fas fa-credit-card"></i> Billing</a>
                        <a href="/api-keys" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: #4a5568; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem;"><i class="fas fa-key"></i> API Keys</a>
                        <a href="#" onclick="ffLogout()" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: #4a5568; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
            
            <button class="ff-mobile-menu-btn" onclick="ffToggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <script>
    // Namespace all functions to avoid conflicts
    window.ffNav = {
        checkAuthStatus: async function() {
            try {
                const response = await fetch('/api/user/status');
                
                // Check if response is OK and content type is JSON
                if (!response.ok || !response.headers.get('content-type')?.includes('application/json')) {
                    console.log('Auth endpoint not available or not returning JSON');
                    return;
                }
                
                const data = await response.json();
                
                if (data.authenticated) {
                    document.getElementById('ffNavAuth').style.display = 'none';
                    document.getElementById('ffUserMenu').style.display = 'block';
                    
                    document.getElementById('ffUserEmail').textContent = data.email || 'User';
                    document.getElementById('ffUserEmailDropdown').textContent = data.email || 'User';
                    document.getElementById('ffUserPlan').textContent = data.plan === 'pro' ? 'Pro Plan' : 'Free Plan';
                    
                    const usagePercent = (data.usage_today / data.daily_limit) * 100;
                    document.getElementById('ffUsageProgress').style.width = usagePercent + '%';
                    document.getElementById('ffUsageText').textContent = `${data.usage_today} / ${data.daily_limit} analyses used`;
                }
            } catch (error) {
                // Silently fail - user is not authenticated or endpoint doesn't exist
                console.log('Auth check skipped:', error.message);
            }
        },
        
        init: function() {
            this.checkAuthStatus();
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const userMenu = document.querySelector('.ff-user-menu');
                if (userMenu && !userMenu.contains(event.target)) {
                    document.getElementById('ffUserDropdown').classList.remove('active');
                }
            });
            
            // Add active class to current page
            const currentPath = window.location.pathname;
            document.querySelectorAll('.ff-nav-link').forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });
        }
    };

    // Global functions for onclick handlers
    function ffToggleMobileMenu() {
        const navLinks = document.getElementById('ffNavLinks');
        navLinks.classList.toggle('active');
    }

    function ffToggleUserDropdown() {
        const dropdown = document.getElementById('ffUserDropdown');
        dropdown.classList.toggle('active');
    }

    async function ffLogout() {
        try {
            await fetch('/api/logout', { method: 'POST' });
            window.location.href = '/';
        } catch (error) {
            console.error('Logout failed:', error);
        }
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            window.ffNav.init();
        });
    } else {
        window.ffNav.init();
    }
    </script>

    <!-- Add spacing after fixed header -->
    <div style="height: 60px;"></div>

    <div class="news-container">
        <!-- Header Section -->
        <div class="news-header">
            <h1>
                <i class="fas fa-newspaper text-primary me-3"></i>
                Advanced News Analyzer
            </h1>
            <p>
                Verify news authenticity with AI-powered analysis
                <span class="tooltip-container">
                    <span class="tooltip-icon">?</span>
                    <span class="tooltip-content">
                        Our AI analyzes 15+ factors including source credibility, writing patterns, 
                        bias indicators, and cross-references with fact-checking databases.
                    </span>
                </span>
            </p>
            <!-- Overview Process Button -->
            <button class="btn btn-outline-primary mt-3" onclick="showAnalysisProcess()">
                <i class="fas fa-info-circle me-2"></i>View Our Analysis Process
            </button>
        </div>

       <!-- Enhanced Input Section with Colorful Borders -->
<div class="input-section">
    <!-- Input Method Selector -->
    <div class="input-selector">
        <div class="input-selector-header">
            <i class="fas fa-hand-pointer"></i>
            <h5>Choose Your Input Method</h5>
        </div>
        <div class="input-tabs">
            <div class="input-tab active" onclick="switchInputType('url')">
                <i class="fas fa-link"></i>
                <span>Analyze URL</span>
            </div>
            <div class="input-tab" onclick="switchInputType('text')">
                <i class="fas fa-file-alt"></i>
                <span>Paste Text</span>
            </div>
        </div>
    </div>
    <!-- Feature Preview Dropdown -->
<div class="feature-preview-dropdown">
    <div class="feature-preview-header" onclick="toggleFeaturePreview()">
        <h5>
            <i class="fas fa-sparkles icon"></i>
            What to Expect from Your Analysis
        </h5>
        <i class="fas fa-chevron-down chevron-icon"></i>
    </div>
    <div class="feature-preview-content" id="feature-preview-content">
        <div class="feature-comparison">
            <div class="feature-column free">
                <div class="feature-header">
                    <span class="feature-badge badge-free">Free Version</span>
                    <h4><i class="fas fa-chart-line me-2"></i>Basic Analysis</h4>
                </div>
                <ul class="feature-list">
                    <li><i class="fas fa-check"></i>Trust Score (0-100%)</li>
                    <li><i class="fas fa-check"></i>Key findings summary</li>
                    <li class="disabled"><i class="fas fa-times"></i>Source credibility check</li>
                    <li class="disabled"><i class="fas fa-times"></i>Fact verification</li>
                    <li class="disabled"><i class="fas fa-times"></i>Political bias detection</li>
                    <li class="disabled"><i class="fas fa-times"></i>Manipulation tactics</li>
                    <li class="limit"><i class="fas fa-info-circle"></i>1 analysis per day</li>
                </ul>
            </div>
            
            <div class="feature-divider"></div>
            
            <div class="feature-column pro">
                <div class="feature-header">
                    <span class="feature-badge badge-pro">Pro Version</span>
                    <h4><i class="fas fa-crown me-2"></i>Advanced Analysis</h4>
                </div>
                <ul class="feature-list">
                    <li><i class="fas fa-check"></i>Everything in Free</li>
                    <li><i class="fas fa-check"></i>Full source credibility analysis</li>
                    <li><i class="fas fa-check"></i>Detailed fact-checking</li>
                    <li><i class="fas fa-check"></i>Political bias detection</li>
                    <li><i class="fas fa-check"></i>Manipulation tactics alert</li>
                    <li><i class="fas fa-check"></i>Author background research</li>
                    <li><i class="fas fa-check"></i>AI content detection</li>
                    <li><i class="fas fa-check"></i>PDF report generation</li>
                    <li class="highlight"><i class="fas fa-infinity"></i>Unlimited analyses</li>
                </ul>
                <div class="text-center mt-3">
                    <a href="/pricing" class="btn btn-primary btn-sm">
                        <i class="fas fa-rocket me-2"></i>Upgrade to Pro
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
        
        <div class="feature-card pro">
            <span class="feature-badge badge-pro">Pro Version</span>
            <h4><i class="fas fa-crown me-2"></i>Advanced Analysis</h4>
            <ul class="feature-list">
                <li><i class="fas fa-check"></i>Everything in Free, plus:</li>
                <li><i class="fas fa-check"></i>Detailed claim-by-claim verification</li>
                <li><i class="fas fa-check"></i>Author background research</li>
                <li><i class="fas fa-check"></i>Historical accuracy tracking</li>
                <li><i class="fas fa-check"></i>AI-generated content detection</li>
                <li><i class="fas fa-check"></i>PDF report generation</li>
                <li><i class="fas fa-check"></i>API access & unlimited analyses</li>
            </ul>
            <div class="text-center mt-3">
                <a href="/pricing" class="btn btn-primary btn-sm">
                    <i class="fas fa-rocket me-2"></i>Upgrade to Pro
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Resources Dropdown -->
<div class="resources-dropdown">
    <div class="resources-header" onclick="toggleResources()">
        <h5>
            <i class="fas fa-microchip icon"></i>
            Powered by Advanced AI & Trusted Resources
        </h5>
        <i class="fas fa-chevron-down chevron-icon"></i>
    </div>
    <div class="resources-content" id="resources-content">
        <div class="resources-grid">
            <div class="resource-item">
                <div class="resource-logo openai">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="resource-info">
                    <h6>OpenAI GPT-4</h6>
                    <p>Deep content analysis & pattern recognition</p>
                </div>
            </div>
            
            <div class="resource-item">
                <div class="resource-logo factcheck">
                    <i class="fas fa-check-double"></i>
                </div>
                <div class="resource-info">
                    <h6>Fact-Check APIs</h6>
                    <p>5+ trusted verification databases</p>
                </div>
            </div>
            
            <div class="resource-item">
                <div class="resource-logo bias">
                    <i class="fas fa-balance-scale"></i>
                </div>
                <div class="resource-info">
                    <h6>Bias Detection</h6>
                    <p>50,000+ political term database</p>
                </div>
            </div>
            
            <div class="resource-item">
                <div class="resource-logo ml">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="resource-info">
                    <h6>Machine Learning</h6>
                    <p>Trained on 1M+ verified articles</p>
                </div>
            </div>
        </div>
    </div>
</div>
    <div id="url-input-section">
    <input type="url" id="news-url" placeholder="https://example.com/article" 
           style="width: 100%; padding: 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s ease;" />
    <div class="info-box tip mt-3" id="pro-tip-box" style="display: none;">
        <i class="fas fa-lightbulb me-2"></i>
        <strong>Pro Tip:</strong> This site appears to block automated access. Try using the "Paste Text" option instead.
    </div>
</div>
    
    <div id="text-input-section" style="display: none;">
        <textarea id="news-text" placeholder="Paste the article text here..." 
                  style="width: 100%; padding: 18px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; min-height: 200px; transition: all 0.3s ease;"></textarea>
        <div class="info-box tip mt-3">
            <i class="fas fa-info-circle me-2"></i>
            Include the headline and author name if available for best results.
        </div>
    </div>
    
    <div class="button-container">
        <button class="analyze-button" onclick="analyzeArticle()">
            <i class="fas fa-search me-2"></i>Analyze Now
        </button>
        <button class="reset-button" onclick="resetForm()">
            <i class="fas fa-redo me-2"></i>Reset
        </button>
    </div>
</div>

        <!-- Loading Section with Enhanced Progress -->
        <div id="loading-section" style="display: none;">
            <!-- Compact Fixed Progress Bar -->
            <div style="position: fixed; top: 60px; left: 0; right: 0; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px); box-shadow: 0 2px 20px rgba(74, 144, 226, 0.3); z-index: 998; padding: 20px; border-bottom: 2px solid rgba(74, 144, 226, 0.2);" class="fixed-progress-header">
                <div class="container">
                    <h5 class="mb-2">
                        <i class="fas fa-brain fa-pulse me-2 text-primary"></i>
                        AI Analysis in Progress...
                    </h5>
                    <div class="progress-container" style="margin-bottom: 10px;">
                        <div class="progress-bar" id="analysis-progress">0%</div>
                    </div>
                    <p class="mb-0 text-muted" id="current-stage-text">Initializing analysis...</p>
                </div>
            </div>
            
            <!-- Stages (below fixed header) -->
            <div class="card shadow-lg border-0 mb-5" style="margin-top: 180px;">
                <div class="card-body p-4">
                    <!-- Enhanced stages -->
                    <div class="analysis-stage" id="stage-1">
                        <div class="stage-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-1">Extracting Content</h5>
                            <small class="text-muted">Retrieving article text, metadata, and author information</small>
                        </div>
                    </div>
                    
                    <div class="analysis-stage" id="stage-2">
                        <div class="stage-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-1">AI Deep Analysis (GPT-4)</h5>
                            <small class="text-muted">Analyzing writing patterns, style, and authenticity markers</small>
                        </div>
                    </div>
                    
                    <div class="analysis-stage" id="stage-3">
                        <div class="stage-icon">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-1">Cross-Reference Fact Checking</h5>
                            <small class="text-muted">Verifying claims against multiple fact-checking databases</small>
                        </div>
                    </div>
                    
                    <div class="analysis-stage" id="stage-4">
                        <div class="stage-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-1">Bias & Manipulation Detection</h5>
                            <small class="text-muted">Scanning for political bias, emotional manipulation, and agenda</small>
                        </div>
                    </div>
                    
                    <div class="analysis-stage" id="stage-5">
                        <div class="stage-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-1">Source Reliability Analysis</h5>
                            <small class="text-muted">Checking historical accuracy and credibility patterns</small>
                        </div>
                    </div>
                    
                    <div class="analysis-stage" id="stage-6">
                        <div class="stage-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-1">Generating Comprehensive Report</h5>
                            <small class="text-muted">Compiling findings with confidence intervals and recommendations</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" style="display: none;">
            <!-- Analysis Metadata -->
            <div class="analysis-meta">
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>Analyzed: <span id="analysis-time"></span></span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-code-branch"></i>
                    <span>Model Version: GPT-4 v2.1</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-server"></i>
                    <span>Analysis ID: <span id="analysis-id"></span></span>
                </div>
                <div class="meta-item">
                    <button class="pdf-button" onclick="generatePDF()">
                        <i class="fas fa-file-pdf"></i>Generate PDF Report
                    </button>
                </div>
            </div>

            <!-- Enhanced Trust Meter with Resources -->
            <div class="trust-score-section">
                <div class="trust-meter-container">
                    <div class="trust-meter">
                        <svg class="trust-meter-circle" viewBox="0 0 200 200">
                            <circle class="trust-meter-bg" cx="100" cy="100" r="90"/>
                            <circle class="trust-meter-fill" cx="100" cy="100" r="90"
                                    stroke-dasharray="565.48" stroke-dashoffset="565.48"/>
                        </svg>
                        <div class="trust-meter-text">
                            <span class="trust-score" id="trust-score">0</span>
                            <span class="trust-label">Trust Score</span>
                        </div>
                    </div>
                </div>
                
                <div class="trust-resources">
                    <h3>Analysis Resources Applied</h3>
                    
                    <div class="resource-item">
                        <div class="resource-icon ai">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="resource-content">
                            <div class="resource-title">GPT-4 Deep Analysis</div>
                            <div class="resource-description">Advanced AI language model analyzing writing patterns and authenticity</div>
                        </div>
                    </div>
                    
                    <div class="resource-item">
                        <div class="resource-icon fact">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <div class="resource-content">
                            <div class="resource-title">Multi-Database Fact Checking</div>
                            <div class="resource-description">Cross-referenced against 5+ trusted fact-checking databases</div>
                        </div>
                    </div>
                    
                    <div class="resource-item">
                        <div class="resource-icon bias">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <div class="resource-content">
                            <div class="resource-title">50,000+ Bias Indicators</div>
                            <div class="resource-description">Political bias detection using comprehensive term analysis</div>
                        </div>
                    </div>
                    
                    <div class="resource-item">
                        <div class="resource-icon source">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="resource-content">
                            <div class="resource-title">Source Credibility Database</div>
                            <div class="resource-description">Historical accuracy tracking of 10,000+ news sources</div>
                        </div>
                    </div>
                    
                    <div class="resource-item">
                        <div class="resource-icon pattern">
                            <i class="fas fa-fingerprint"></i>
                        </div>
                        <div class="resource-content">
                            <div class="resource-title">Pattern Recognition AI</div>
                            <div class="resource-description">Machine learning models trained on 1M+ verified articles</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overall Assessment (Always Open) -->

            <!-- Source Credibility -->
            <div class="analysis-dropdown border-author">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-globe"></i>Source Credibility & Comparison</h3>
                </div>
                <div class="dropdown-content">
                    <div id="source-credibility"></div>
                    
                    <!-- Source Comparison Grid -->
                    <h5 class="mt-4">How This Source Compares</h5>
                    <div class="source-comparison">
                        <div class="source-card">
                            <div class="source-logo">CNN</div>
                            <div class="source-score text-success">85%</div>
                            <small class="text-muted">Avg. Accuracy</small>
                        </div>
                        <div class="source-card">
                            <div class="source-logo">FOX</div>
                            <div class="source-score text-warning">72%</div>
                            <small class="text-muted">Avg. Accuracy</small>
                        </div>
                        <div class="source-card">
                            <div class="source-logo">BBC</div>
                            <div class="source-score text-success">91%</div>
                            <small class="text-muted">Avg. Accuracy</small>
                        </div>
                        <div class="source-card">
                            <div class="source-logo">THIS</div>
                            <div class="source-score" id="this-source-score">--</div>
                            <small class="text-muted">This Source</small>
                        </div>
                    </div>
                    
                    <!-- Historical Accuracy (Pro Feature Preview) -->
                    <div class="pro-feature-locked mt-4">
                        <h5>Historical Accuracy Trend</h5>
                        <div class="accuracy-chart">
                            <div class="chart-grid">
                                <div class="chart-line"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="methodology-snippet">
                        <strong>How we calculate this:</strong> Source credibility = 
                        <code>0.4  historical_accuracy + 0.3  transparency + 0.2  corrections_policy + 0.1  awards</code>
                    </div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="source-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="source-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Author Credibility -->
            <div class="analysis-dropdown border-author">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-user-check"></i>Author Credibility & Background</h3>
                </div>
                <div class="dropdown-content">
                    <div id="author-credibility"></div>
                    
                    <div class="why-matters-box mt-3">
                        <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                        <p>
                            Authors with established expertise and transparent backgrounds are more likely 
                            to produce accurate, well-researched content. Anonymous or unverifiable authors 
                            should be approached with more skepticism.
                        </p>
                    </div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="author-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="author-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Writing Quality -->
            <div class="analysis-dropdown border-quality">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-pen-fancy"></i>Writing Quality & Professionalism</h3>
                </div>
                <div class="dropdown-content">
                    <div id="writing-quality"></div>
                    
                    <div class="methodology-snippet">
                        <strong>Analysis includes:</strong> Grammar scoring, readability index (Flesch-Kincaid), 
                        vocabulary diversity, sentence structure variation, and professional tone markers.
                    </div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="quality-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="quality-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Fact-Checking -->
            <div class="analysis-dropdown border-fact">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-check-double"></i>Fact-Checking Results</h3>
                </div>
                <div class="dropdown-content">
                    <div id="fact-checking"></div>
                    
                    <!-- Confidence Intervals for Each Claim -->
                    <div class="mt-4" id="claim-confidence-section">
                        <!-- Dynamically populated -->
                    </div>
                    
                    <div class="why-matters-box mt-3">
                        <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                        <p>
                            False or misleading claims can shape opinions and decisions. We verify each 
                            claim against multiple trusted fact-checking databases and provide confidence 
                            levels for our assessments.
                        </p>
                    </div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="fact-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="fact-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Political Bias -->
            <div class="analysis-dropdown border-bias">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-balance-scale"></i>Political Bias Detection</h3>
                </div>
                <div class="dropdown-content">
                    <!-- Bias spectrum bar -->
                    <div class="bias-spectrum mt-3 mb-4">
                        <div style="position: relative; height: 30px; background: linear-gradient(to right, #3b82f6 0%, #e5e7eb 50%, #ef4444 100%); border-radius: 15px;">
                            <div id="bias-marker" style="position: absolute; top: -5px; width: 40px; height: 40px; background: white; border: 3px solid #1f2937; border-radius: 50%; left: 50%; transform: translateX(-50%); box-shadow: 0 2px 10px rgba(0,0,0,0.3);"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <small>Far Left</small>
                            <small>Center</small>
                            <small>Far Right</small>
                        </div>
                    </div>
                    
                    <div id="political-bias"></div>
                    
                    <div class="methodology-snippet">
                        <strong>Bias detection algorithm:</strong> We analyze word choice, framing, 
                        source selection, and compare against our database of 50,000+ politically-charged 
                        terms weighted by context and frequency.
                    </div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="bias-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="bias-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Hidden Agenda -->
            <div class="analysis-dropdown border-agenda">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-user-secret"></i>Hidden Agenda Detection</h3>
                </div>
                <div class="dropdown-content">
                    <div id="hidden-agenda"></div>
                    
                    <div class="why-matters-box mt-3">
                        <h4><i class="fas fa-lightbulb"></i>Why This Matters</h4>
                        <p>
                            Articles with hidden agendas may appear objective but subtly push commercial, 
                            political, or ideological interests. Recognizing these helps you understand 
                            the true purpose behind the content.
                        </p>
                    </div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="agenda-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="agenda-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Clickbait Analysis -->
            <div class="analysis-dropdown border-clickbait">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-mouse-pointer"></i>Clickbait & Sensationalism</h3>
                </div>
                <div class="dropdown-content">
                    <div id="clickbait-analysis"></div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="clickbait-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="clickbait-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Emotional Manipulation -->
            <div class="analysis-dropdown border-emotion">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-theater-masks"></i>Emotional Manipulation Check</h3>
                </div>
                <div class="dropdown-content">
                    <!-- Emotional gauge -->
                    <div class="gauge-container">
                        <div class="gauge">
                            <div class="gauge-mask"></div>
                            <div class="gauge-needle" id="emotion-needle"></div>
                        </div>
                    </div>
                    
                    <div id="emotional-manipulation"></div>
                    
                    <div class="methodology-snippet">
                        <strong>Emotional analysis:</strong> Using sentiment analysis and psychological 
                        trigger word detection across 8 emotional categories (fear, anger, joy, sadness, 
                        disgust, surprise, trust, anticipation).
                    </div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="emotion-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="emotion-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Source Diversity -->
            <div class="analysis-dropdown border-diversity">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-project-diagram"></i>Source Diversity & Balance</h3>
                </div>
                <div class="dropdown-content">
                    <!-- Progress bar for source diversity -->
                    <div class="progress-container mb-3">
                        <div class="progress-bar" id="diversity-bar" style="width: 0%">0%</div>
                    </div>
                    
                    <div id="source-diversity"></div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="diversity-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="diversity-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Timeliness Check -->
            <div class="analysis-dropdown border-time">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-calendar-check"></i>Timeliness & Relevance</h3>
                </div>
                <div class="dropdown-content">
                    <div id="timeliness-check"></div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="timeliness-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="timeliness-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- AI-Generated Content Detection (New Feature) -->
            <div class="analysis-dropdown border-ai">
                <div class="dropdown-header" onclick="toggleDropdown(this)">
                    <h3><i class="fas fa-robot"></i>AI-Generated Content Detection</h3>
                </div>
                <div class="dropdown-content">
                    <h5>AI Content Probability</h5>
                    <div class="confidence-bar mb-3">
                        <div class="confidence-fill" id="ai-probability" style="width: 0%">
                            <div class="confidence-label">0%</div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <h6>AI Pattern Indicators:</h6>
                        <ul id="ai-patterns">
                            <!-- Dynamically populated -->
                        </ul>
                    </div>
                    
                    <div class="methodology-snippet">
                        <strong>Detection method:</strong> Perplexity analysis, burstiness scoring, 
                        repetitive phrasing detection, and comparison against known AI writing patterns 
                        from GPT, Claude, and other models.
                    </div>
                    
                    <div class="what-this-means mt-3">
                        <h5>What This Means:</h5>
                        <p id="ai-explanation"></p>
                    </div>
                    
                    <div class="how-detected mt-3">
                        <h5>How We Detected This:</h5>
                        <p id="ai-methodology"></p>
                    </div>
                </div>
            </div>

            <!-- Pricing Information -->
            <div class="pricing-info">
                <h4><i class="fas fa-crown me-2"></i>Upgrade for More Features</h4>
                <div class="pricing-tier">
                    <div>
                        <h4>Free Tier</h4>
                        <p class="mb-0">1 analysis per day</p>
                    </div>
                    <div class="price">$0</div>
                </div>
                <div class="pricing-tier">
                    <div>
                        <h4>Pro Tier</h4>
                        <p class="mb-0">Unlimited analyses + API access</p>
                    </div>
                    <div class="price">$19/mo</div>
                </div>
            </div>

            <!-- Download Complete Report Button -->
            <div class="text-center mt-5">
                <button class="btn btn-success btn-lg" onclick="downloadFullReport()">
                    <i class="fas fa-file-pdf me-2"></i>Download Complete Analysis Report (PDF)
                </button>
            </div>
        </div>

        <!-- Error Container -->
        <div class="error-container" id="error-container">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Analysis Error</h3>
            <p id="error-message">An error occurred during analysis.</p>
            <button class="retry-btn" onclick="retryAnalysis()">
                <i class="fas fa-redo"></i> Retry Analysis
            </button>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">Initializing Analysis...</div>
            <div class="loading-subtext" id="loading-subtext">Please wait while we process your content</div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-fill" style="width: 0%"></div>
            </div>
        </div>
    </div>

    
    <!-- Analysis Process Modal -->
    <div class="modal fade" id="analysisProcessModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-cogs me-2"></i>Our Comprehensive Analysis Process
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Our AI-powered analysis examines:</h6>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <ul>
                                <li><strong>Source Credibility:</strong> Historical accuracy, transparency, corrections policy</li>
                                <li><strong>Author Background:</strong> Expertise, publication history, credentials</li>
                                <li><strong>Writing Quality:</strong> Grammar, structure, professionalism</li>
                                <li><strong>Fact Verification:</strong> Cross-reference with multiple databases</li>
                                <li><strong>Political Bias:</strong> 50,000+ term analysis, framing detection</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul>
                                <li><strong>Hidden Agendas:</strong> Commercial interests, persuasion tactics</li>
                                <li><strong>Clickbait Detection:</strong> Headline-content matching</li>
                                <li><strong>Emotional Manipulation:</strong> 8 emotion categories analyzed</li>
                                <li><strong>Source Diversity:</strong> Variety and balance assessment</li>
                                <li><strong>AI Content Detection:</strong> Pattern analysis across models</li>
                            </ul>
                        </div>
                    </div>
                    <hr>
                    <p><strong>Technology Stack:</strong></p>
                    <ul>
                        <li>GPT-4 for deep content analysis</li>
                        <li>Natural Language Processing for linguistic patterns</li>
                        <li>Machine Learning models trained on 1M+ articles</li>
                        <li>Real-time fact-checking API integrations</li>
                        <li>Proprietary bias detection algorithms</li>
                    </ul>
                    <hr>
                    <p class="text-muted mb-0">Each analysis generates 100+ data points to ensure comprehensive, accurate results you can trust.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS from cdnjs (CSP approved) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        // Reset form function
function resetForm() {
    document.getElementById('news-url').value = '';
    document.getElementById('news-text').value = '';
    
    // Reset to URL tab
    switchInputType('url');
    
    // Hide any error messages
    const errorContainer = document.getElementById('error-container');
    if (errorContainer) {
        errorContainer.style.display = 'none';
    }
    
    // Hide results if shown
    const resultsSection = document.getElementById('results-section');
    if (resultsSection) {
        resultsSection.style.display = 'none';
    }
    
    // Scroll to top of input section
    document.querySelector('.input-section').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center' 
    });
}

// Toggle resources dropdown
function toggleResources() {
    const content = document.getElementById('resources-content');
    const header = document.querySelector('.resources-header');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        header.classList.remove('active');
    } else {
        content.classList.add('show');
        header.classList.add('active');
    }
}

// Enhanced input field focus effects
document.getElementById('news-url').addEventListener('focus', function() {
    this.style.borderColor = '#4a90e2';
    this.style.boxShadow = '0 0 0 3px rgba(74, 144, 226, 0.1)';
});

document.getElementById('news-url').addEventListener('blur', function() {
    this.style.borderColor = '#e5e7eb';
    this.style.boxShadow = 'none';
});

document.getElementById('news-text').addEventListener('focus', function() {
    this.style.borderColor = '#4a90e2';
    this.style.boxShadow = '0 0 0 3px rgba(74, 144, 226, 0.1)';
});

document.getElementById('news-text').addEventListener('blur', function() {
    this.style.borderColor = '#e5e7eb';
    this.style.boxShadow = 'none';
});
        // Initialize any needed components
        console.log('News analyzer ready');
    });
// Toggle resources dropdown
function toggleResources() {
    const content = document.getElementById('resources-content');
    const header = document.querySelector('.resources-header');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        header.classList.remove('active');
    } else {
        content.classList.add('show');
        header.classList.add('active');
    }
}

// Toggle feature preview dropdown
function toggleFeaturePreview() {
    const content = document.getElementById('feature-preview-content');
    const header = document.querySelector('.feature-preview-header');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        header.classList.remove('active');
    } else {
        content.classList.add('show');
        header.classList.add('active');
    }
}
    // Global variable to store current analysis results
    let currentAnalysisResults = null;

    // Switch between URL and text input
    function switchInputType(type) {
        const urlSection = document.getElementById('url-input-section');
        const textSection = document.getElementById('text-input-section');
        const tabs = document.querySelectorAll('.input-tab');
        
        tabs.forEach(tab => tab.classList.remove('active'));
        
        if (type === 'url') {
            urlSection.style.display = 'block';
            textSection.style.display = 'none';
            tabs[0].classList.add('active');
        } else {
            urlSection.style.display = 'none';
            textSection.style.display = 'block';
            tabs[1].classList.add('active');
        }
    }

    // FIXED analysis function that matches YOUR API response structure
    async function analyzeArticle() {
        const urlInput = document.getElementById('news-url');
        const textInput = document.getElementById('news-text');
        const loadingSection = document.getElementById('loading-section');
        const resultsSection = document.getElementById('results-section');
        const errorContainer = document.getElementById('error-container');
        
        // Get input based on active section
        const isUrlMode = document.getElementById('url-input-section').style.display !== 'none';
        const input = isUrlMode ? urlInput.value.trim() : textInput.value.trim();
        
        if (!input) {
            alert('Please enter a URL or paste article text');
            return;
        }
        
        // Hide any previous errors
        errorContainer.style.display = 'none';
        
        // Show loading
        loadingSection.style.display = 'block';
        resultsSection.style.display = 'none';
        
        // Reset stages
        document.querySelectorAll('.analysis-stage').forEach(stage => {
            stage.classList.remove('active', 'complete');
        });
        
        // Initialize progress tracking
        let progress = 0;
        const progressBar = document.getElementById('analysis-progress');
        const stages = document.querySelectorAll('.analysis-stage');
        let currentStage = 0;
        
        try {
           // Start progress animation
const progressInterval = setInterval(() => {
    if (progress < 90) {
        progress += 5;
        progressBar.style.width = progress + '%';
        progressBar.textContent = progress + '%';
        
        // Add active class for enhanced animations
        progressBar.classList.add('active');
        
        // Change to high-progress gradient at 60%
        if (progress >= 60 && !progressBar.classList.contains('high-progress')) {
            progressBar.classList.add('high-progress');
        }
        
        // Update stages
        const stageProgress = Math.floor((progress / 100) * stages.length);
        if (stageProgress > currentStage && currentStage < stages.length) {
            if (currentStage > 0) {
                stages[currentStage - 1].classList.remove('active');
                stages[currentStage - 1].classList.add('complete');
            }
            stages[currentStage].classList.add('active');
            currentStage = stageProgress;
            
            // Update stage text with emojis
            const stageTexts = [
                ' Extracting content and metadata...',
                ' Running deep AI analysis with GPT-4...',
                ' Cross-referencing fact databases...',
                ' Detecting bias and manipulation...',
                ' Analyzing source reliability...',
                ' Compiling comprehensive report...'
            ];
            
            if (currentStage - 1 < stageTexts.length) {
                document.getElementById('current-stage-text').textContent = stageTexts[currentStage - 1];
            }
        }
    }
}, 200);
            
            // Prepare request body
            const requestBody = {
                content: input,
                type: isUrlMode ? 'url' : 'text',
                is_pro: true
            };
            
            console.log('Sending analysis request:', requestBody);
            
            // CALL YOUR ACTUAL BACKEND
            const response = await fetch('/api/analyze-news', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });
            
            clearInterval(progressInterval);
            
            // Check response
            if (!response.ok) {
                let errorMessage = `Server error: ${response.status}`;
                try {
                    const errorData = await response.json();
                    errorMessage = errorData.error || errorData.message || errorMessage;
                } catch (e) {
                    console.error('Error parsing error response:', e);
                }
                throw new Error(errorMessage);
            }
            
            const data = await response.json();
            console.log('Analysis response:', data);
            
            // Complete progress
            progressBar.style.width = '100%';
            progressBar.textContent = '100%';
            progressBar.classList.remove('active', 'high-progress');
            progressBar.classList.add('complete');
            stages.forEach(stage => {
                stage.classList.remove('active');
                stage.classList.add('complete');
    });
            
            // FIXED: Check for success - handle both success flag and presence of results
            if (data.success === true || (data.trust_score !== undefined && !data.error)) {
                // Store results globally for PDF generation - data is at root level
                currentAnalysisResults = data;
                
                // Display REAL results from YOUR backend - pass data directly
                setTimeout(() => {
                    displayRealResults(data);
                    loadingSection.style.display = 'none';
                    resultsSection.style.display = 'block';
                    
                    // Scroll to results
                    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 500);
            } else {
                // Log the full response for debugging
                console.error('Analysis failed. Server response:', data);
                
                // Extract the actual error message from the server
                let errorMessage = data.error || data.message || 'Could not extract article content';
                
                // Check if the error is the generic extraction error and enhance it
                if (errorMessage === 'Could not extract article content' || 
                    errorMessage.toLowerCase().includes('could not extract')) {
                    errorMessage = 'Unable to extract content from this URL. This often happens with major news sites like Washington Post, CNN, or NYTimes that block automated access.\n\nPlease try:\n Copy and paste the article text using the "Paste Text" tab\n Try a different news source\n Use a direct link to the article (not the homepage)';
                }
                // Make timeout errors more user-friendly
                else if (errorMessage.includes('timed out') || errorMessage.includes('timeout')) {
                    errorMessage = 'The website took too long to respond. This can happen with some news sites.\n\nPlease try:\n Copy and paste the article text using the "Paste Text" tab\n Try a different article\n Wait a moment and try again';
                } 
                // URL extraction errors
                else if (errorMessage.includes('extraction error') || errorMessage.includes('URL extraction')) {
                    errorMessage = 'Unable to extract content from this URL. Some websites block automated access.\n\nPlease copy and paste the article text directly using the "Paste Text" tab.';
                }
                
                throw new Error(errorMessage);
            }
            
        } catch (error) {
    console.error('Analysis error:', error);
    loadingSection.style.display = 'none';
    
    // Clear any running intervals
    if (typeof progressInterval !== 'undefined') {
        clearInterval(progressInterval);
    }
    
    // Show pro tip for extraction errors
    if (error.message.includes('extract') || 
        error.message.includes('block') || 
        error.message.includes('Unable to extract') ||
        error.message.includes('CNN') ||
        error.message.includes('NYTimes') ||
        error.message.includes('major news sites')) {
        document.getElementById('pro-tip-box').style.display = 'block';
    }
    
    // Show user-friendly error message
    let userMessage = error.message;
    
    // Make error messages more user-friendly
    if (userMessage.includes('fetch')) {
        userMessage = 'Unable to connect to the analysis service. Please check your internet connection and try again.';
    } else if (userMessage.includes('404')) {
        userMessage = 'Analysis service not found. Please contact support.';
    } else if (userMessage.includes('500')) {
        userMessage = 'Server error occurred. Please try again later.';
    } else if (userMessage.includes('extract')) {
        userMessage = 'Unable to extract article content. Please ensure the URL is valid or try pasting the article text directly.';
    }
    
    showError(userMessage);
}
    }

    // FIXED display function to match YOUR API response structure
    function displayRealResults(results) {
        // Update timestamp
        const now = new Date();
        document.getElementById('analysis-time').textContent = now.toLocaleString();
        document.getElementById('analysis-id').textContent = results.analysis_id || 'AN-' + Date.now().toString(36).toUpperCase();
        
        // FIXED: Use trust_score directly from root
        const trustScore = results.trust_score || 0;
        animateTrustMeter(trustScore);
        
        // Update Overall Assessment with new enhanced version
updateOverallAssessment(results);
        
          
        
        // Populate all sections with REAL data
        populateRealSections(results);
    }

    // Animate trust meter with REAL score
    function animateTrustMeter(trustScore) {
        const trustMeter = document.querySelector('.trust-meter-fill');
        const trustScoreEl = document.getElementById('trust-score');
        const circumference = 2 * Math.PI * 90;
        const offset = circumference - (trustScore / 100) * circumference;
        
        // Set color based on REAL score
        let color = '#10b981'; // green
        if (trustScore < 60) color = '#ef4444'; // red
        else if (trustScore < 80) color = '#f59e0b'; // orange
        
        setTimeout(() => {
            trustMeter.style.stroke = color;
            trustMeter.style.strokeDashoffset = offset;
            
            // Animate number
            let current = 0;
            const interval = setInterval(() => {
                if (current < trustScore) {
                    current += 2;
                    trustScoreEl.textContent = Math.min(current, trustScore);
                } else {
                    clearInterval(interval);
                }
            }, 30);
        }, 100);
    }

    // FIXED function to populate sections with YOUR API's actual data structure
    function populateRealSections(results) {
        // Source Credibility - using source_credibility from root
        const sourceData = results.source_credibility || {};
        if (sourceData && results.article_info) {
            const domain = results.article_info.domain || 'Unknown';
            const credScore = results.credibility_score || 0;
            
            document.getElementById('source-credibility').innerHTML = `
                <h5>Source: ${domain}</h5>
                <p>Credibility Score: <strong>${credScore}/100</strong></p>
                <ul>
                    <li>Trust Score: ${results.trust_score || 0}</li>
                    <li>Article Title: ${results.article_info.title || 'N/A'}</li>
                    ${results.article_info.publish_date ? `<li>Published: ${results.article_info.publish_date}</li>` : ''}
                </ul>
            `;
            
            document.getElementById('this-source-score').textContent = `${Math.round(credScore)}%`;
            document.getElementById('source-explanation').textContent = 'Source credibility assessed based on trust score and analysis results';
            document.getElementById('source-methodology').textContent = 'Analysis based on content quality, claims verification, and bias detection';
        }
        
        // Author Credibility - extract from article_info or other fields
        const authorName = results.article_info?.author || results.author || 'Unknown';
        const hasAuthor = authorName && authorName !== 'Unknown';
        
        if (hasAuthor) {
            // Clean author name (remove "By" prefix if present)
            const cleanAuthorName = authorName.replace(/^by\s+/i, '').trim();
            
            document.getElementById('author-credibility').innerHTML = `
                <h5>Author: ${cleanAuthorName}</h5>
                <p>Author detected from article metadata</p>
                <ul>
                    <li>Name: <strong>${cleanAuthorName}</strong></li>
                    <li>Verification Status: Pending manual verification</li>
                    <li>Expertise: Research author's background for subject matter expertise</li>
                    <li>Publication History: Check author's previous work for consistency</li>
                </ul>
                ${results.author_info ? `
                    <div class="mt-3">
                        <h6>Additional Author Information:</h6>
                        <ul>
                            ${results.author_info.bio ? `<li>Bio: ${results.author_info.bio}</li>` : ''}
                            ${results.author_info.credentials ? `<li>Credentials: ${results.author_info.credentials}</li>` : ''}
                            ${results.author_info.website ? `<li>Website: <a href="${results.author_info.website}" target="_blank" rel="noopener">${results.author_info.website}</a></li>` : ''}
                        </ul>
                    </div>
                ` : ''}
                
                <!-- Author Research Links -->
                <div class="mt-3">
                    <h5>Research This Author:</h5>
                    <div class="btn-group" role="group">
                        <a href="https://twitter.com/search?q=${encodeURIComponent(cleanAuthorName)}" class="btn btn-outline-primary btn-sm" target="_blank">
                            <i class="fab fa-twitter me-1"></i>Twitter
                        </a>
                        <a href="https://www.google.com/search?q=${encodeURIComponent(cleanAuthorName + ' journalist')}" class="btn btn-outline-primary btn-sm" target="_blank">
                            <i class="fab fa-google me-1"></i>Google
                        </a>
                        <a href="https://www.linkedin.com/search/results/all/?keywords=${encodeURIComponent(cleanAuthorName)}" class="btn btn-outline-primary btn-sm" target="_blank">
                            <i class="fab fa-linkedin me-1"></i>LinkedIn
                        </a>
                        ${results.author_info?.website ? `
                            <a href="${results.author_info.website}" class="btn btn-outline-primary btn-sm" target="_blank">
                                <i class="fas fa-globe me-1"></i>Website
                            </a>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('author-explanation').textContent = `Author "${cleanAuthorName}" has been identified. Established journalists with verifiable credentials and consistent publication history are generally more trustworthy sources. Research this author's background to assess their expertise in the subject matter.`;
            document.getElementById('author-methodology').textContent = `We detected the author through metadata extraction from the article. For comprehensive credibility assessment, we recommend verifying the author's credentials, checking their publication history, and confirming their expertise in the topic area. Professional journalists typically have a digital footprint that includes social media profiles, previous articles, and professional affiliations.`;
            
        } else {
            // No author detected - show manual input component
            document.getElementById('author-credibility').innerHTML = `
                <h5>Author: Not Detected</h5>
                <p>No author information found in article metadata</p>
                <ul>
                    <li>Articles without clear authorship should be approached with caution</li>
                    <li>Check the original source for author attribution</li>
                    <li>Anonymous or missing authorship may indicate lower credibility</li>
                    <li>Some reputable sources use editorial boards instead of individual authors</li>
                </ul>
                
                <!-- Insert the author input component here -->
                <div id="author-manual-input" class="author-input-section mt-4">
                    <div class="alert alert-info mb-4">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>No author detected.</strong> You can manually enter the author's name to research their background and credibility.
                    </div>
                    
                    <div class="manual-author-form">
                        <h6 class="mb-3">Enter Author Information:</h6>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="manual-author-name" class="form-label">Author Name</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="manual-author-name" 
                                       placeholder="e.g., John Smith or Jane Doe"
                                       autocomplete="off">
                                <small class="text-muted">Enter the full name of the article's author</small>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="manual-author-affiliation" class="form-label">Affiliation (Optional)</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="manual-author-affiliation" 
                                       placeholder="e.g., New York Times, CNN"
                                       autocomplete="off">
                                <small class="text-muted">Publication or organization they work for</small>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary mt-3" onclick="researchManualAuthor()">
                            <i class="fas fa-search me-2"></i>Research Author
                        </button>
                    </div>
                    
                    <!-- Loading state for author research -->
                    <div id="author-research-loading" class="text-center py-4" style="display: none;">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Researching...</span>
                        </div>
                        <p class="text-muted">Researching author background and credibility...</p>
                    </div>
                    
                    <!-- Results container for manual author research -->
                    <div id="manual-author-results" style="display: none;">
                        <hr class="my-4">
                        
                        <h6 class="mb-3">
                            <i class="fas fa-user-check me-2"></i>Author Research Results
                        </h6>
                        
                        <div id="author-research-content">
                            <!-- Dynamically populated with research results -->
                        </div>
                        
                        <!-- Author Research Links (dynamically updated) -->
                        <div class="mt-3">
                            <h6>Additional Research Links:</h6>
                            <div class="btn-group" role="group">
                                <a href="#" class="btn btn-outline-primary btn-sm" id="manual-author-twitter" target="_blank">
                                    <i class="fab fa-twitter me-1"></i>Twitter
                                </a>
                                <a href="#" class="btn btn-outline-primary btn-sm" id="manual-author-google" target="_blank">
                                    <i class="fab fa-google me-1"></i>Google
                                </a>
                                <a href="#" class="btn btn-outline-primary btn-sm" id="manual-author-linkedin" target="_blank">
                                    <i class="fab fa-linkedin me-1"></i>LinkedIn
                                </a>
                                <a href="#" class="btn btn-outline-primary btn-sm" id="manual-author-website" target="_blank" style="display: none;">
                                    <i class="fas fa-globe me-1"></i>Website
                                </a>
                            </div>
                        </div>
                        
                        <!-- Credibility Assessment -->
                        <div class="credibility-assessment mt-4">
                            <h6>Credibility Indicators:</h6>
                            <div id="author-credibility-indicators">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('author-explanation').textContent = 'No author information was detected in this article. You can manually enter the author\'s name above to research their background and credibility. Articles without clear authorship attribution should be evaluated more carefully.';
            document.getElementById('author-methodology').textContent = 'Author detection relies on metadata extraction from the article source. When no author is found, you can use the manual research tool above to investigate the author\'s credentials and credibility.';
        }
        
        // Writing Quality - derive from available data
        document.getElementById('writing-quality').innerHTML = `
            <h5>Quality Metrics:</h5>
            <ul>
                <li>Overall Trust Score: ${results.trust_score || 0}/100</li>
                <li>Credibility Score: ${results.credibility_score || 0}/100</li>
                <li>Content Length: ${results.article_info?.text ? results.article_info.text.length + ' characters' : 'N/A'}</li>
                <li>Key Claims Identified: ${results.key_claims?.length || 0}</li>
                <li>Fact Checks Performed: ${results.fact_checks?.length || 0}</li>
            </ul>
        `;
        
        document.getElementById('quality-explanation').textContent = 'Writing quality assessed through credibility and trust scoring';
        document.getElementById('quality-methodology').textContent = 'Analysis based on content structure and claim verification';
        
        // Fact-Checking - using fact_checks and key_claims
        const claims = results.key_claims || [];
        const factChecks = results.fact_checks || [];
        
        document.getElementById('fact-checking').innerHTML = `
            <h5>Claims Analyzed: ${claims.length}</h5>
            ${claims.map((claim, index) => `
                <div class="claim-card">
                    <p><strong>Claim ${index + 1}:</strong> "${claim}"</p>
                    <span class="claim-status status-unverified">REQUIRES VERIFICATION</span>
                    <p class="mt-2"><small>Confidence: Pending fact-check</small></p>
                </div>
            `).join('')}
            ${factChecks.length > 0 ? `
                <h5 class="mt-4">Fact Check Results:</h5>
                ${factChecks.map(check => `<p>${check}</p>`).join('')}
            ` : ''}
        `;
        
        document.getElementById('fact-explanation').textContent = claims.length > 0 ? 
            'Key claims have been identified for verification' : 
            'No specific claims were identified for fact-checking';
        document.getElementById('fact-methodology').textContent = 'Claims extracted using natural language processing';
        
        // Political Bias - handle "N/A" string value
        const biasScore = results.bias_score;
        const biasMarker = document.getElementById('bias-marker');
        
        if (biasScore !== 'N/A' && !isNaN(biasScore)) {
            // Assuming bias_score is on a scale, adjust as needed
            const biasPosition = 50; // Center by default, adjust based on your scale
            biasMarker.style.left = biasPosition + '%';
            
            document.getElementById('political-bias').innerHTML = `
                <h5>Bias Assessment:</h5>
                <p>Bias Score: <strong>${biasScore}</strong></p>
                <p>Political Lean: <strong>Analysis in progress</strong></p>
                <ul>
                    <li>Bias detection requires deeper content analysis</li>
                </ul>
            `;
        } else {
            biasMarker.style.left = '50%'; // Center for N/A
            
            document.getElementById('political-bias').innerHTML = `
                <h5>Bias Assessment:</h5>
                <p>Bias Score: <strong>Not Available</strong></p>
                <p>Insufficient data to determine political bias</p>
                <ul>
                    <li>Content may be too short or neutral for bias detection</li>
                </ul>
            `;
        }
        
        document.getElementById('bias-explanation').textContent = biasScore !== 'N/A' ? 
            'Bias analysis completed' : 
            'Insufficient content for bias detection';
        document.getElementById('bias-methodology').textContent = 'Word choice and framing analysis';
        
        // Hidden Agenda - using manipulation_tactics
        const manipulationTactics = results.manipulation_tactics || [];
        document.getElementById('hidden-agenda').innerHTML = `
            <h5>Agenda Detection:</h5>
            <p>Manipulation Tactics Found: <strong>${manipulationTactics.length}</strong></p>
            ${manipulationTactics.length > 0 ? `
                <ul>
                    ${manipulationTactics.map(tactic => `<li>${tactic}</li>`).join('')}
                </ul>
            ` : '<p>No manipulation tactics detected</p>'}
        `;
        
        document.getElementById('agenda-explanation').textContent = manipulationTactics.length > 0 ?
            'Potential manipulation tactics were identified' :
            'No hidden agenda detected';
        document.getElementById('agenda-methodology').textContent = 'Pattern recognition and persuasion technique analysis';
        
        // Clickbait Analysis - derive from title if available
        const title = results.article_info?.title || '';
        const hasClickbaitIndicators = title.includes('!') || title.includes('?') || 
                                      title.toLowerCase().includes('shocking') || 
                                      title.toLowerCase().includes('you won\'t believe');
        
        document.getElementById('clickbait-analysis').innerHTML = `
            <h5>Clickbait Score: <strong>${hasClickbaitIndicators ? 'Medium' : 'Low'}</strong></h5>
            <ul>
                <li>Title: "${title || 'No title provided'}"</li>
                ${hasClickbaitIndicators ? '<li>Contains potential clickbait indicators</li>' : '<li>Title appears straightforward</li>'}
            </ul>
        `;
        
        document.getElementById('clickbait-explanation').textContent = hasClickbaitIndicators ?
            'Title may contain clickbait elements' :
            'Title appears to be straightforward';
        document.getElementById('clickbait-methodology').textContent = 'Headline pattern analysis';
        
        // Emotional Manipulation - basic analysis
        const emotionScore = manipulationTactics.length * 20; // Simple scoring
        const emotionNeedle = document.getElementById('emotion-needle');
        const emotionAngle = -90 + Math.min(emotionScore * 1.8, 180);
        emotionNeedle.style.transform = `translateX(-50%) rotate(${emotionAngle}deg)`;
        
        document.getElementById('emotional-manipulation').innerHTML = `
            <h5>Emotional Manipulation Level: <strong>${emotionScore > 60 ? 'High' : emotionScore > 30 ? 'Medium' : 'Low'}</strong></h5>
            <p>Based on identified manipulation tactics</p>
            <ul>
                <li>Manipulation tactics found: ${manipulationTactics.length}</li>
                <li>Emotional appeal level: ${emotionScore > 60 ? 'Significant' : emotionScore > 30 ? 'Moderate' : 'Minimal'}</li>
            </ul>
        `;
        
        document.getElementById('emotion-explanation').textContent = 'Emotional manipulation assessed based on rhetoric analysis';
        document.getElementById('emotion-methodology').textContent = 'Sentiment and persuasion technique detection';
        
        // Source Diversity - basic implementation
        const diversityScore = 50; // Default middle score
        const diversityBar = document.getElementById('diversity-bar');
        diversityBar.style.width = diversityScore + '%';
        diversityBar.textContent = diversityScore + '%';
        
        document.getElementById('source-diversity').innerHTML = `
            <h5>Source Diversity Score: <strong>${diversityScore}/100</strong></h5>
            <ul>
                <li>Single source analysis</li>
                <li>Additional sources needed for comprehensive verification</li>
                <li>Consider cross-referencing with multiple sources</li>
            </ul>
        `;
        
        document.getElementById('diversity-explanation').textContent = 'Source diversity analysis requires multiple sources';
        document.getElementById('diversity-methodology').textContent = 'Single source provided for this analysis';
        
        // Timeliness - using publish_date if available
        const publishDate = results.article_info?.publish_date;
        document.getElementById('timeliness-check').innerHTML = `
            <h5>Timeliness Assessment:</h5>
            <ul>
                <li>Article date: ${publishDate || 'Unknown'}</li>
                <li>Analysis date: ${new Date().toLocaleDateString()}</li>
                <li>URL provided: ${results.article_info?.url ? 'Yes' : 'No'}</li>
                <li>Content type: ${results.article_info?.url ? 'Web article' : 'Direct text'}</li>
            </ul>
        `;
        
        document.getElementById('timeliness-explanation').textContent = publishDate ? 
            'Article date information available' : 
            'Publication date not available';
        document.getElementById('timeliness-methodology').textContent = 'Metadata extraction from source';
        
        // AI Detection - basic implementation
        const aiProbability = 25; // Default low probability
        setTimeout(() => {
            const aiBar = document.getElementById('ai-probability');
            aiBar.style.width = aiProbability + '%';
            aiBar.querySelector('.confidence-label').textContent = aiProbability + '%';
        }, 300);
        
        document.getElementById('ai-patterns').innerHTML = `
            <li><i class="fas fa-check-circle text-success me-2"></i>Natural language variations detected</li>
            <li><i class="fas fa-check-circle text-success me-2"></i>Human-like writing patterns</li>
            <li><i class="fas fa-info-circle text-primary me-2"></i>Further analysis needed for definitive assessment</li>
        `;
        
        document.getElementById('ai-explanation').textContent = 'Low probability of AI-generated content';
        document.getElementById('ai-methodology').textContent = 'Pattern analysis and writing style assessment';
    }

    // Show error
    function showError(message) {
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        
        // Convert newlines to <br> and bullet points to proper HTML
        let formattedMessage = message
            .replace(/\n/g, '<br>')
            .replace(//g, '<br>');
        
        errorMessage.innerHTML = formattedMessage;
        errorContainer.style.display = 'block';
        
        // Hide results
        document.getElementById('results-section').style.display = 'none';
        
        // Scroll to error
        errorContainer.scrollIntoView({ behavior: 'smooth' });
    }

    // Retry analysis
    function retryAnalysis() {
        document.getElementById('error-container').style.display = 'none';
        analyzeArticle();
    }

    // Toggle dropdown
    function toggleDropdown(header) {
        const content = header.nextElementSibling;
        const isOpen = content.classList.contains('show');
        
        if (isOpen) {
            content.classList.remove('show');
            header.style.borderColor = 'transparent';
        } else {
            content.classList.add('show');
            header.style.borderColor = 'var(--primary-blue)';
        }
    }

    // Generate REAL PDF from actual results
    async function generatePDF() {
        if (!currentAnalysisResults) {
            alert('Please run an analysis first');
            return;
        }
        
        const btn = event.target;
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';
        btn.disabled = true;
        
        try {
            // Call your backend to generate PDF
            const response = await fetch('/api/generate-pdf', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    analysis_type: 'news',
                    results: currentAnalysisResults
                })
            });
            
            if (!response.ok) {
                throw new Error('PDF generation failed');
            }
            
            // If backend returns PDF blob
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `news-analysis-${Date.now()}.pdf`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            
        } catch (error) {
            console.error('PDF generation error:', error);
            // Fallback: Generate client-side PDF with results
            generateClientSidePDF();
        } finally {
            btn.innerHTML = originalHTML;
            btn.disabled = false;
        }
    }

    // Fallback client-side PDF generation
    function generateClientSidePDF() {
        // Create a new window with the results formatted for printing
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>News Analysis Report</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    h1 { color: #333; }
                    .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; }
                    .score { font-size: 24px; font-weight: bold; color: #4CAF50; }
                </style>
            </head>
            <body>
                <h1>News Analysis Report</h1>
                <p>Generated: ${new Date().toLocaleString()}</p>
                <div class="section">
                    <h2>Overall Trust Score</h2>
                    <p class="score">${currentAnalysisResults.trust_score || 0}%</p>
                </div>
                <div class="section">
                    <h2>Summary</h2>
                    <p>${currentAnalysisResults.summary || 'Analysis completed'}</p>
                </div>
                <div class="section">
                    <h2>Key Claims</h2>
                    <ul>
                        ${(currentAnalysisResults.key_claims || []).map(c => `<li>${c}</li>`).join('')}
                    </ul>
                </div>
                <div class="section">
                    <h2>Manipulation Tactics</h2>
                    <ul>
                        ${(currentAnalysisResults.manipulation_tactics || []).map(t => `<li>${t}</li>`).join('')}
                    </ul>
                </div>
                <div class="section">
                    <h2>Article Information</h2>
                    <p><strong>Title:</strong> ${currentAnalysisResults.article_info?.title || 'N/A'}</p>
                    <p><strong>Domain:</strong> ${currentAnalysisResults.article_info?.domain || 'N/A'}</p>
                    <p><strong>Published:</strong> ${currentAnalysisResults.article_info?.publish_date || 'N/A'}</p>
                </div>
                <div class="section">
                    <h2>Scores</h2>
                    <p><strong>Trust Score:</strong> ${currentAnalysisResults.trust_score || 0}/100</p>
                    <p><strong>Credibility Score:</strong> ${currentAnalysisResults.credibility_score || 0}/100</p>
                    <p><strong>Bias Score:</strong> ${currentAnalysisResults.bias_score || 'N/A'}</p>
                </div>
            </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }

    // Show analysis process modal
    function showAnalysisProcess() {
        const modal = document.getElementById('analysisProcessModal');
        if (modal) {
            // If Bootstrap is available
            if (typeof bootstrap !== 'undefined') {
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
            } else {
                // Fallback
                modal.style.display = 'block';
                modal.classList.add('show');
            }
        }
    }

    // Show methodology
    function showMethodology() {
        showAnalysisProcess();
    }

    // Download full report
    async function downloadFullReport() {
        if (!currentAnalysisResults) {
            alert('Please run an analysis first');
            return;
        }
        
        // Same as generatePDF but with more comprehensive data
        generatePDF();
    }

    // Author Research Functions
    async function researchManualAuthor() {
        const authorName = document.getElementById('manual-author-name').value.trim();
        const affiliation = document.getElementById('manual-author-affiliation').value.trim();
        
        if (!authorName) {
            alert('Please enter an author name');
            return;
        }
        
        // Show loading state
        document.querySelector('.manual-author-form').style.display = 'none';
        document.getElementById('author-research-loading').style.display = 'block';
        document.getElementById('manual-author-results').style.display = 'none';
        
        try {
            // Call your backend API to research the author
            const response = await fetch('/api/research-author', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    author_name: authorName,
                    affiliation: affiliation,
                    article_url: currentAnalysisResults?.article_info?.url || '',
                    article_title: currentAnalysisResults?.article_info?.title || ''
                })
            });
            
            if (!response.ok) {
                throw new Error('Author research failed');
            }
            
            const authorData = await response.json();
            
            // Display results
            displayAuthorResearchResults(authorData);
            
        } catch (error) {
            console.error('Author research error:', error);
            
            // Fallback: Show basic research links
            displayBasicAuthorResearch(authorName, affiliation);
        } finally {
            document.getElementById('author-research-loading').style.display = 'none';
            document.getElementById('manual-author-results').style.display = 'block';
        }
    }

    // Function to display author research results
    function displayAuthorResearchResults(authorData) {
        const resultsContainer = document.getElementById('author-research-content');
        
        // If we have comprehensive data from the API
        if (authorData.success && authorData.author_info) {
            const info = authorData.author_info;
            
            resultsContainer.innerHTML = `
                <div class="author-info-card">
                    <h5>${info.name}</h5>
                    ${info.bio ? `<p class="author-bio">${info.bio}</p>` : ''}
                    
                    ${info.credentials && info.credentials.length > 0 ? `
                        <h6 class="mt-3">Credentials & Background:</h6>
                        <ul class="author-credentials">
                            ${info.credentials.map(cred => `
                                <li><i class="fas fa-check-circle"></i> ${cred}</li>
                            `).join('')}
                        </ul>
                    ` : ''}
                    
                    ${info.expertise && info.expertise.length > 0 ? `
                        <h6 class="mt-3">Areas of Expertise:</h6>
                        <div class="mb-3">
                            ${info.expertise.map(exp => `
                                <span class="badge bg-primary me-2">${exp}</span>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${info.publications ? `
                        <p><strong>Publications:</strong> ${info.publications}</p>
                    ` : ''}
                    
                    ${info.verification_status ? `
                        <div class="alert alert-${info.verified ? 'success' : 'warning'} mt-3">
                            <i class="fas fa-${info.verified ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                            ${info.verification_status}
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Update research links
            updateAuthorResearchLinks(info.name, info.website);
            
            // Display credibility indicators
            displayCredibilityIndicators(authorData.credibility_indicators || []);
            
        } else {
            // Basic display without API data
            displayBasicAuthorResearch(authorData.author_name || 'Unknown', authorData.affiliation);
        }
    }

    // Function to display basic author research (fallback)
    function displayBasicAuthorResearch(authorName, affiliation) {
        const resultsContainer = document.getElementById('author-research-content');
        
        resultsContainer.innerHTML = `
            <div class="author-info-card">
                <h5>${authorName}</h5>
                ${affiliation ? `<p><strong>Affiliation:</strong> ${affiliation}</p>` : ''}
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle me-2"></i>
                    Use the research links below to verify this author's credentials and background.
                </div>
            </div>
        `;
        
        // Update research links
        updateAuthorResearchLinks(authorName, null);
        
        // Show basic credibility checklist
        displayCredibilityIndicators([
            {
                type: 'neutral',
                icon: 'fa-search',
                text: 'Search for author\'s professional profile'
            },
            {
                type: 'neutral',
                icon: 'fa-newspaper',
                text: 'Look for previous articles by this author'
            },
            {
                type: 'neutral',
                icon: 'fa-university',
                text: 'Verify educational credentials if claimed'
            },
            {
                type: 'neutral',
                icon: 'fa-award',
                text: 'Check for journalism awards or recognition'
            }
        ]);
    }

    // Function to update author research links
    function updateAuthorResearchLinks(authorName, website) {
        const searchQuery = encodeURIComponent(authorName);
        
        document.getElementById('manual-author-twitter').href = 
            `https://twitter.com/search?q=${searchQuery}`;
        document.getElementById('manual-author-google').href = 
            `https://www.google.com/search?q=${searchQuery}+journalist`;
        document.getElementById('manual-author-linkedin').href = 
            `https://www.linkedin.com/search/results/all/?keywords=${searchQuery}`;
        
        if (website) {
            const websiteBtn = document.getElementById('manual-author-website');
            websiteBtn.href = website;
            websiteBtn.style.display = 'inline-flex';
        }
    }

    // Function to display credibility indicators
    function displayCredibilityIndicators(indicators) {
        const container = document.getElementById('author-credibility-indicators');
        
        if (indicators.length === 0) {
            // Default indicators if none provided
            indicators = [
                {
                    type: 'positive',
                    icon: 'fa-check-circle',
                    text: 'Author name provided for verification'
                },
                {
                    type: 'neutral',
                    icon: 'fa-question-circle',
                    text: 'Manual verification recommended'
                }
            ];
        }
        
        container.innerHTML = indicators.map(indicator => `
            <div class="credibility-indicator ${indicator.type}">
                <i class="fas ${indicator.icon}"></i>
                <span>${indicator.text}</span>
            </div>
        `).join('');
    }

    // Function to reset author input form
    function resetAuthorInput() {
        document.getElementById('manual-author-name').value = '';
        document.getElementById('manual-author-affiliation').value = '';
        document.querySelector('.manual-author-form').style.display = 'block';
        document.getElementById('author-research-loading').style.display = 'none';
        document.getElementById('manual-author-results').style.display = 'none';
    }
      // Enhanced JavaScript for Overall Assessment - Factual Version
function updateOverallAssessment(results) {
    const trustScore = results.trust_score || 0;
    
    // Update trust score display
    document.getElementById('trust-score-display').innerHTML = `
        ${trustScore}%
        <span class="score-meaning" id="score-meaning">${getScoreMeaning(trustScore)}</span>
    `;
    
    // Update icon and label based on score
    const iconWrapper = document.getElementById('trust-icon-wrapper');
    const credibilityLabel = document.getElementById('credibility-label');
    
    if (trustScore >= 80) {
        iconWrapper.className = 'trust-icon-wrapper high';
        iconWrapper.innerHTML = '<i class="fas fa-shield-alt"></i>';
        credibilityLabel.textContent = 'Generally Reliable (80%+ score)';
    } else if (trustScore >= 60) {
        iconWrapper.className = 'trust-icon-wrapper medium';
        iconWrapper.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
        credibilityLabel.textContent = 'Moderate Reliability (60-79% score)';
    } else {
        iconWrapper.className = 'trust-icon-wrapper low';
        iconWrapper.innerHTML = '<i class="fas fa-times-circle"></i>';
        credibilityLabel.textContent = 'Low Reliability (Below 60% score)';
    }
    
    // Update summary - use actual analysis summary
    document.getElementById('overall-summary').textContent = results.summary || 
        `This article scored ${trustScore}% in our trust analysis. ${getScoreContext(trustScore)}`;
    
    // Update metrics with clear explanations
    const sourceScore = results.credibility_score || 0;
    document.getElementById('source-metric').textContent = sourceScore + '%';
    document.getElementById('source-explainer').textContent = 
        sourceScore >= 80 ? '(High)' : sourceScore >= 60 ? '(Medium)' : '(Low)';
    
    // Claim verification - show actual numbers
    const totalClaims = results.key_claims?.length || 0;
    const verifiedClaims = results.fact_checks?.filter(f => f.verdict === 'true').length || 0;
    document.getElementById('accuracy-metric').textContent = 
        totalClaims > 0 ? `${verifiedClaims}/${totalClaims}` : 'No claims';
    document.getElementById('accuracy-explainer').textContent = 
        totalClaims > 0 ? 'verified' : 'to check';
    
    // Political bias - be specific
    const biasScore = results.bias_score;
    const biasMetric = document.getElementById('bias-metric');
    if (biasScore !== 'N/A' && !isNaN(biasScore)) {
        if (biasScore < -0.3) biasMetric.textContent = 'Left-leaning';
        else if (biasScore > 0.3) biasMetric.textContent = 'Right-leaning';
        else biasMetric.textContent = 'Center/Neutral';
    } else {
        biasMetric.textContent = 'Not detected';
    }
    
    // Red flags - show actual count
    const manipulationCount = results.manipulation_tactics?.length || 0;
    document.getElementById('manipulation-metric').textContent = manipulationCount;
    
    // Update findings - use actual data
    const keyFindings = [];
    if (results.article_info?.author && results.article_info.author !== 'Unknown') {
        keyFindings.push(`Author identified: ${results.article_info.author}`);
    }
    if (results.article_info?.domain) {
        keyFindings.push(`Source: ${results.article_info.domain}`);
    }
    if (results.key_claims?.length > 0) {
        keyFindings.push(`${results.key_claims.length} claims detected`);
    }
    if (trustScore >= 80) {
        keyFindings.push('Meets reliability threshold');
    }
    
    if (keyFindings.length > 0) {
        document.getElementById('key-findings-list').innerHTML = keyFindings
            .map(finding => `<li><i class="fas fa-check"></i>${finding}</li>`)
            .join('');
    } else {
        document.getElementById('key-findings-list').innerHTML = 
            '<li><i class="fas fa-info"></i>Limited data available</li>';
    }
    
    // Update red flags - use actual manipulation tactics
    const redFlags = results.manipulation_tactics || [];
    if (redFlags.length > 0) {
        document.getElementById('red-flags-list').innerHTML = redFlags
            .slice(0, 4) // Limit to 4 for space
            .map(flag => `<li><i class="fas fa-times"></i>${flag}</li>`)
            .join('');
    } else {
        document.getElementById('red-flags-list').innerHTML = 
            '<li><i class="fas fa-check"></i>No manipulation tactics detected</li>';
    }
    
    // Update confidence
    const confidence = calculateConfidence(results);
    document.getElementById('confidence-percentage').textContent = confidence + '%';
    document.getElementById('overall-confidence').style.width = confidence + '%';
    
    // Update confidence explanation
    document.getElementById('confidence-explanation').textContent = 
        `Based on ${getConfidenceFactors(results).join(', ')}`;
}

// Helper function to get score meaning
function getScoreMeaning(score) {
    if (score >= 90) return 'Very High Reliability';
    if (score >= 80) return 'High Reliability';
    if (score >= 70) return 'Moderate-High';
    if (score >= 60) return 'Moderate';
    if (score >= 50) return 'Moderate-Low';
    if (score >= 40) return 'Low Reliability';
    return 'Very Low Reliability';
}

// Helper function to get score context
function getScoreContext(score) {
    if (score >= 80) return 'Articles scoring 80% or higher are generally reliable for citations and sharing.';
    if (score >= 60) return 'Articles scoring 60-79% should be cross-referenced with other sources.';
    return 'Articles scoring below 60% require significant verification before use.';
}

// Calculate confidence based on available data
function calculateConfidence(results) {
    let confidence = 50; // Base confidence
    
    // Add confidence based on available data
    if (results.article_info?.author && results.article_info.author !== 'Unknown') confidence += 10;
    if (results.article_info?.domain) confidence += 10;
    if (results.article_info?.publish_date) confidence += 5;
    if (results.key_claims?.length > 0) confidence += 10;
    if (results.fact_checks?.length > 0) confidence += 10;
    if (results.source_credibility) confidence += 5;
    
    return Math.min(confidence, 95); // Cap at 95%
}

// Get confidence factors
function getConfidenceFactors(results) {
    const factors = [];
    
    if (results.article_info?.author && results.article_info.author !== 'Unknown') {
        factors.push('author identified');
    }
    if (results.key_claims?.length > 0) {
        factors.push(`${results.key_claims.length} claims analyzed`);
    }
    if (results.source_credibility) {
        factors.push('source verified');
    }
    
    if (factors.length === 0) {
        factors.push('limited data available');
    }
    
    return factors;
}  
    </script>
</body>
</html>
