<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsVerify Pro - Enterprise News Verification Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .enterprise-badge {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            border-radius: 25px;
            display: inline-block;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tool-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .tool-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .tool-header h2 {
            font-size: 2.8rem;
            color: #4a5568;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .backend-status {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
            border: 2px solid rgba(16, 185, 129, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .backend-status.connected {
            border-color: rgba(16, 185, 129, 0.3);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.08));
        }

        .backend-status.disconnected {
            border-color: rgba(239, 68, 68, 0.3);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
        }

        .status-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .status-text {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .status-details {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .tier-selector {
            display: flex;
            gap: 40px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .tier-btn {
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            color: #4a5568;
            border: 3px solid #e2e8f0;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            border-radius: 20px;
            padding: 20px 40px;
            font-size: 1.1rem;
            position: relative;
            min-width: 200px;
            text-align: center;
        }

        .tier-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .tier-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            transform: translateY(-3px);
        }

        .input-section {
            margin-bottom: 40px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #4a5568;
            font-size: 1.1rem;
        }

        .input-group textarea {
            width: 100%;
            padding: 18px;
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
            min-height: 140px;
            resize: vertical;
            line-height: 1.6;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .sample-buttons {
            margin-bottom: 20px;
            text-align: center;
        }

        .sample-btn {
            background: linear-gradient(145deg, rgba(102, 126, 234, 0.1), rgba(102, 126, 234, 0.2));
            border: 1px solid #667eea;
            color: #667eea;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin: 4px;
            transition: all 0.3s ease;
        }

        .sample-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            border-radius: 20px;
            font-size: 1.3rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s ease;
            width: 100%;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-container {
            display: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px 30px;
            border-radius: 15px;
            margin: 20px 0;
            color: white;
            text-align: center;
        }

        .progress-text {
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #ffaa00, #ff0066);
            border-radius: 15px;
            transition: width 1.5s ease;
            width: 0%;
        }

        .progress-details {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .results {
            display: none;
            margin-top: 40px;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }

        .score-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 900;
            color: white;
            margin: 0 auto 20px;
        }

        .score-high { background: linear-gradient(135deg, #10b981, #059669); }
        .score-medium { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .score-low { background: linear-gradient(135deg, #ef4444, #dc2626); }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .metric-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 900;
            color: #667eea;
            margin-bottom: 8px;
        }

        .metric-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .metric-description {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .error-message {
            background: linear-gradient(145deg, rgba(255, 68, 68, 0.1), rgba(255, 68, 68, 0.05));
            border: 2px solid rgba(255, 68, 68, 0.3);
            color: #ff4444;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-weight: 600;
            text-align: center;
        }

        .reset-btn {
            background: linear-gradient(145deg, #6b7280, #4b5563);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .reset-btn:hover {
            background: linear-gradient(145deg, #4b5563, #374151);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .tool-container {
                padding: 30px;
            }
            .tier-selector {
                flex-direction: column;
                align-items: center;
            }
            .tier-btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> NewsVerify Pro</h1>
            <p>Enterprise News Verification Platform - Backend Integrated</p>
            <div class="enterprise-badge">
                <i class="fas fa-certificate"></i> Professional Analysis
            </div>
        </div>

        <div class="tool-container">
            <div class="tool-header">
                <h2><i class="fas fa-newspaper"></i> NewsVerify Pro</h2>
                <p>Real-time verification using secure Flask backend</p>
            </div>

            <!-- Backend Status Indicator -->
            <div class="backend-status" id="backendStatus">
                <div class="status-icon" id="statusIcon">üîÑ</div>
                <div class="status-text" id="statusText">Checking backend connection...</div>
                <div class="status-details" id="statusDetails">Establishing connection to analysis server</div>
            </div>

            <div class="tier-selector">
                <button class="tier-btn active" id="freeBtn" onclick="selectTier('free')">
                    üÜì Standard Analysis
                </button>
                <button class="tier-btn" id="premiumBtn" onclick="selectTier('premium')">
                    ‚≠ê Premium Analysis
                </button>
            </div>

            <div class="input-section">
                <div class="sample-buttons">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600;">üìö Try Demo Content:</label>
                    <button class="sample-btn" onclick="loadSample('reliable')">üì∞ Reliable News</button>
                    <button class="sample-btn" onclick="loadSample('biased')">‚öñÔ∏è Biased Content</button>
                    <button class="sample-btn" onclick="loadSample('fake')">‚ùå Misinformation</button>
                </div>
                
                <div class="input-group">
                    <label for="news-text"><i class="fas fa-file-text"></i> News Article Content</label>
                    <textarea id="news-text" placeholder="Enter news article content for comprehensive verification analysis. Our backend will assess credibility, detect bias patterns, verify sources, and provide professional insights..."></textarea>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="analyze-btn" onclick="analyzeNews()" id="analyzeButton">
                    <i class="fas fa-search"></i> Start Analysis
                </button>
                
                <div class="progress-container" id="progressContainer">
                    <div class="progress-text" id="progressText">Connecting to backend...</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-details" id="progressDetails">Establishing secure connection...</div>
                </div>
                
                <button class="reset-btn" onclick="resetForm()">
                    <i class="fas fa-undo"></i> Reset
                </button>
            </div>

            <div class="results" id="results">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    <script>
        console.log('NewsVerify Pro - VERIFIED VERSION LOADED');
        
        let currentTier = 'free';
        let backendConnected = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkBackendConnection();
        });

        // Check backend connection
        async function checkBackendConnection() {
            try {
                console.log('Checking backend connection...');
                const response = await fetch('/api/health');
                
                if (response.ok) {
                    const healthData = await response.json();
                    backendConnected = true;
                    updateBackendStatus('connected', healthData);
                } else {
                    throw new Error(`Backend returned ${response.status}`);
                }
            } catch (error) {
                console.error('Backend connection failed:', error);
                backendConnected = false;
                updateBackendStatus('disconnected', null);
            }
        }

        // Update backend status display
        function updateBackendStatus(status, healthData) {
            const statusElement = document.getElementById('backendStatus');
            const iconElement = document.getElementById('statusIcon');
            const textElement = document.getElementById('statusText');
            const detailsElement = document.getElementById('statusDetails');
            
            if (status === 'connected') {
                statusElement.className = 'backend-status connected';
                iconElement.textContent = '‚úÖ';
                textElement.textContent = 'Backend Connected & Ready';
                detailsElement.textContent = `Analysis server online | OpenAI: ${healthData?.openai_api === 'connected' ? 'Available' : 'Not configured'}`;
            } else {
                statusElement.className = 'backend-status disconnected';
                iconElement.textContent = '‚ùå';
                textElement.textContent = 'Backend Connection Failed';
                detailsElement.textContent = 'Please check that your Flask server is running';
            }
        }

        // MAIN ANALYSIS FUNCTION - FIXED
        async function analyzeNews() {
            const newsText = document.getElementById('news-text').value.trim();
            
            if (!newsText) {
                alert('Please provide content to analyze');
                return;
            }

            if (!backendConnected) {
                alert('Backend connection failed. Please ensure your Flask server is running.');
                return;
            }

            showProgress();
            document.getElementById('results').style.display = 'none';

            try {
                updateProgress(25, 'üîó Connecting to Backend...', 'Establishing secure connection...');
                await new Promise(resolve => setTimeout(resolve, 800));
                
                updateProgress(60, 'üéØ Backend Processing...', `Running ${currentTier} analysis...`);
                
                // FIXED: Call backend API with proper error handling
                const analysisResult = await callBackendAPI(newsText);
                
                updateProgress(90, 'üìä Finalizing Results...', 'Generating report...');
                await new Promise(resolve => setTimeout(resolve, 500));

                updateProgress(100, '‚úÖ Analysis Complete!', 'Results ready...');
                
                setTimeout(() => {
                    hideProgress();
                    displayResults(analysisResult);
                }, 800);

            } catch (error) {
                console.error('Analysis failed:', error);
                hideProgress();
                showError(`Analysis failed: ${error.message}`);
            }
        }

        // FIXED: Backend API call with robust error handling
        async function callBackendAPI(content) {
            try {
                const requestData = {
                    content: content,
                    tier: currentTier
                };

                console.log('Calling backend with:', requestData);

                const response = await fetch('/api/analyze-news', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                // FIXED: Better error handling
                if (!response.ok) {
                    throw new Error(`Backend error: ${response.status} ${response.statusText}`);
                }

                // FIXED: Check for empty response
                const responseText = await response.text();
                console.log('Backend response text:', responseText);
                
                if (!responseText || responseText.trim() === '') {
                    throw new Error('Empty response from backend');
                }

                // FIXED: Safe JSON parsing
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    console.error('Response was:', responseText);
                    throw new Error(`Invalid JSON response: ${parseError.message}`);
                }

                console.log('Parsed backend data:', data);
                return data;
            } catch (error) {
                console.error('Backend API call failed:', error);
                throw error;
            }
        }

        // Display results
        function displayResults(analysisData) {
            const results = document.getElementById('results');
            results.style.display = 'block';

            const credibilityScore = analysisData.credibility_score || 75;
            const grade = analysisData.credibility_grade || 'B+';
            const assessment = analysisData.credibility_assessment || 'Analysis completed';
            
            const scoreClass = credibilityScore >= 80 ? 'score-high' : credibilityScore >= 60 ? 'score-medium' : 'score-low';

            results.innerHTML = `
                <div class="result-card">
                    <div class="score-display">
                        <div class="score-circle ${scoreClass}">
                            ${credibilityScore}
                        </div>
                        <h3>${assessment}</h3>
                        <p><strong>Grade: ${grade}</strong> | Tier: ${currentTier.toUpperCase()}</p>
                    </div>
                    
                    <div class="analysis-grid">
                        <div class="metric-card">
                            <div class="metric-value">${analysisData.ai_detection?.ai_probability || 20}%</div>
                            <div class="metric-label">AI Probability</div>
                            <div class="metric-description">Likelihood of AI generation</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${Math.abs(analysisData.bias_analysis?.bias_score || 0)}</div>
                            <div class="metric-label">Bias Score</div>
                            <div class="metric-description">${analysisData.bias_analysis?.bias_direction || 'Center'}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${analysisData.source_analysis?.source_credibility || 70}</div>
                            <div class="metric-label">Source Score</div>
                            <div class="metric-description">Publication credibility</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${analysisData.fact_check?.factual_accuracy || 75}</div>
                            <div class="metric-label">Fact Score</div>
                            <div class="metric-description">Factual accuracy</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 15px;">
                            <i class="fas fa-server"></i> Backend Analysis Summary
                        </h4>
                        <p style="line-height: 1.6;">
                            ${analysisData.executive_summary?.summary_text || 
                                `Analysis completed using ${analysisData.analysis_method || 'backend'} method. ` +
                                `Overall credibility: ${credibilityScore}/100 with ${currentTier} tier processing.`
                            }
                        </p>
                    </div>
                </div>
            `;
        }

        // Utility functions
        function selectTier(tier) {
            currentTier = tier;
            
            document.querySelectorAll('.tier-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tier === 'free' ? 'freeBtn' : 'premiumBtn').classList.add('active');

            const analyzeBtn = document.getElementById('analyzeButton');
            analyzeBtn.innerHTML = tier === 'free' ? 
                '<i class="fas fa-search"></i> Start Standard Analysis' : 
                '<i class="fas fa-star"></i> Start Premium Analysis';
        }

        function loadSample(type) {
            const samples = {
                reliable: `WASHINGTON (Reuters) ‚Äî The Federal Reserve raised its benchmark interest rate by 0.25 percentage points Wednesday, bringing it to a 22-year high of 5.25%-5.5% as the central bank continues its efforts to combat inflation. The decision was unanimous among voting members of the Federal Open Market Committee.

Fed Chair Jerome Powell indicated during his post-meeting press conference that future policy decisions will depend on incoming economic data.`,
                
                biased: `Federal Reserve's DEVASTATING Rate Hike Crushes American Families

The Federal Reserve announced another SHOCKING quarter-point interest rate increase Wednesday, raising SERIOUS concerns among economists about the cumulative impact on struggling household budgets. This DEVASTATING decision brings rates to their highest level since 2001.`,
                
                fake: `BREAKING: Secret Federal Reserve Documents Reveal Market Manipulation Conspiracy

Leaked internal documents obtained exclusively by this reporter show coordinated efforts between Fed officials and Wall Street banks to manipulate interest rate decisions for profit, according to unnamed sources familiar with the matter.`
            };
            
            document.getElementById('news-text').value = samples[type];
        }

        function resetForm() {
            document.getElementById('news-text').value = '';
            document.getElementById('results').style.display = 'none';
            hideProgress();
        }

        function updateProgress(percentage, text, detail = '') {
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = text;
            document.getElementById('progressDetails').textContent = detail;
        }

        function showProgress() {
            document.getElementById('progressContainer').style.display = 'block';
            updateProgress(0, 'Initializing...', 'Preparing analysis...');
        }

        function hideProgress() {
            document.getElementById('progressContainer').style.display = 'none';
        }

        function showError(message) {
            const results = document.getElementById('results');
            results.style.display = 'block';
            results.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Analysis Error</h3>
                    <p>${message}</p>
                    <p style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                        Please check your backend configuration and try again.
                    </p>
                </div>
            `;
        }
    </script>
</body>
</html>
