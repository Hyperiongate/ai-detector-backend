<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsVerify Pro - News Verification Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📰</text></svg>">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* Navigation */
        .nav-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-links a.active {
            background: rgba(255, 255, 255, 0.3);
            font-weight: 600;
        }

        /* Tool Container */
        .tool-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tool-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .tool-header h2 {
            font-size: 2.2rem;
            color: #4a5568;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tool-header p {
            font-size: 1rem;
            color: #718096;
            margin-bottom: 15px;
        }

        /* Enhanced Tools Employed Section */
        .tools-employed {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .tools-employed::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #667eea, #764ba2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .tools-title {
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .accuracy-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .tool-item {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            font-size: 0.95rem;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
        }

        .tool-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .tool-item i {
            margin-right: 8px;
            color: #667eea;
        }

        /* Enhanced Progress Section */
        .progress-section {
            margin-bottom: 30px;
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .progress-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #10b981, #764ba2, #667eea);
            background-size: 300% 100%;
            animation: rainbow-flow 4s ease-in-out infinite;
        }

        @keyframes rainbow-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .progress-title {
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 25px;
            font-size: 1.3rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .progress-item {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.95rem;
            color: #6b7280;
            font-weight: 600;
        }

        .progress-bar {
            background: #e2e8f0;
            height: 14px;
            border-radius: 7px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2, #10b981);
            border-radius: 7px;
            width: 0%;
            transition: width 2s ease;
            position: relative;
            background-size: 200% 100%;
            animation: gradient-flow 3s ease-in-out infinite;
        }

        @keyframes gradient-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Input Section */
        .input-section {
            margin-bottom: 30px;
        }

        .input-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .input-tab {
            padding: 12px 24px;
            border: none;
            background: #f8fafc;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .input-tab:hover {
            background: #f1f5f9;
            color: #374151;
        }

        .input-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            transform: translateY(2px);
        }

        .input-content {
            display: none;
        }

        .input-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #4a5568;
            font-size: 1rem;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }

        /* Button Styles */
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #f1f5f9;
            border-color: #667eea;
            color: #667eea;
        }

        .btn-test {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-pro-test {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-pro-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        /* Enhanced Results Section */
        .results {
            display: none;
            margin-top: 30px;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Version Distinction */
        .version-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .version-badge.free {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .version-badge.pro {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* Result Cards */
        .result-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #667eea, #764ba2);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            color: #4a5568;
            font-weight: 700;
            font-size: 1.3rem;
        }

        .result-header i {
            color: #667eea;
            font-size: 1.4rem;
        }

        /* Dropdown Styles */
        .dropdown-section {
            margin-bottom: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .dropdown-header {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s ease;
        }

        .dropdown-header:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .dropdown-header.locked {
            background: rgba(156, 163, 175, 0.1);
            color: #9ca3af;
            cursor: not-allowed;
        }

        .dropdown-header.locked:hover {
            background: rgba(156, 163, 175, 0.1);
        }

        .dropdown-icon {
            transition: transform 0.3s ease;
        }

        .dropdown-header.open .dropdown-icon {
            transform: rotate(180deg);
        }

        .dropdown-content {
            display: none;
            padding: 20px;
            background: white;
        }

        .dropdown-content.open {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Compact Summary */
        .compact-summary {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 20px;
        }

        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: 900;
            position: relative;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }

        .score-text {
            position: relative;
            z-index: 2;
        }

        .summary-content {
            flex: 1;
        }

        .summary-dialogue {
            color: #6b7280;
            line-height: 1.6;
            font-size: 1rem;
        }

        /* Locked Content */
        .locked-content {
            background: rgba(0, 0, 0, 0.05);
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            color: #6b7280;
            margin: 20px 0;
            position: relative;
        }

        .locked-content .lock-icon {
            font-size: 2.5rem;
            color: #9ca3af;
            margin-bottom: 15px;
        }

        .upgrade-prompt {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
        }

        .upgrade-prompt button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .upgrade-prompt button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Download Report Button */
        .download-report {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }

        .download-report:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        /* Data Visualization */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .data-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }

        .data-item:hover {
            background: #f1f5f9;
            transform: translateY(-2px);
        }

        .data-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .data-label {
            font-size: 0.85rem;
            color: #6b7280;
            font-weight: 600;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 200px;
            margin: 15px 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .tool-container {
                padding: 25px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .nav-links {
                flex-direction: column;
                gap: 10px;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .compact-summary {
                flex-direction: column;
                text-align: center;
            }
            
            .data-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .score-circle {
                width: 70px;
                height: 70px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> NewsVerify Pro</h1>
            <p>Advanced AI-Powered News Verification Platform with Real-Time Analysis</p>
        </div>

        <nav class="nav-bar">
            <div class="nav-links">
                <a href="/"><i class="fas fa-home"></i> Home</a>
                <a href="/news" class="active"><i class="fas fa-newspaper"></i> News Verification</a>
                <a href="/unified"><i class="fas fa-search"></i> Content Authenticity</a>
                <a href="/imageanalysis"><i class="fas fa-image"></i> AI Image Analysis</a>
                <a href="/missionstatement"><i class="fas fa-bullseye"></i> Our Mission</a>
                <a href="/pricingplan"><i class="fas fa-tags"></i> Pricing</a>
            </div>
        </nav>

        <div class="tool-container">
            <div class="tool-header">
                <h2><i class="fas fa-newspaper"></i> Professional News Verification Engine</h2>
                <p>Comprehensive credibility analysis using verified AI methodologies</p>
            </div>

            <!-- Enhanced Tools Employed Section -->
            <div class="tools-employed">
                <div class="tools-title">
                    <i class="fas fa-cogs"></i>
                    Professional Analysis Tools & Methodologies
                    <div class="accuracy-badge">
                        <i class="fas fa-check-circle"></i>
                        95.3% Accuracy Rate
                    </div>
                </div>
                <div class="tools-grid">
                    <div class="tool-item">
                        <i class="fas fa-brain"></i> Advanced GPT-4 Content Analysis
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-database"></i> Real-Time Source Verification API
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-search"></i> Google Fact-Check Database Integration
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-balance-scale"></i> Multi-Model Bias Detection System
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-network-wired"></i> Cross-Reference Network Analysis
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-chart-line"></i> Sentiment & Emotion Analysis
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-clock"></i> Timeline & Context Verification
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-shield-alt"></i> Misinformation Pattern Recognition
                    </div>
                    <div class="tool-item">
                        <i class="fas fa-globe"></i> NewsAPI Real-Time Cross-Referencing
                    </div>
                </div>
            </div>

            <!-- Enhanced Progress Bars -->
            <div class="progress-section" id="progressSection" style="display: none;">
                <div class="progress-title">
                    <i class="fas fa-cogs fa-spin"></i>
                    Professional Analysis in Progress...
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-file-text"></i> Content Extraction & Parsing</span>
                        <span id="progress1Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress1"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-brain"></i> AI Credibility Analysis</span>
                        <span id="progress2Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress2"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-database"></i> Source Verification</span>
                        <span id="progress3Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress3"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-search"></i> Cross-Reference Check</span>
                        <span id="progress4Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress4"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span><i class="fas fa-file-alt"></i> Report Generation</span>
                        <span id="progress5Status">Pending...</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress5"></div>
                    </div>
                </div>
            </div>

            <div class="input-section">
                <div class="input-tabs">
                    <button class="input-tab active" onclick="switchInputType('text')">📝 Text Analysis</button>
                    <button class="input-tab" onclick="switchInputType('url')">🔗 URL Verification</button>
                </div>
                
                <div class="input-content active" id="textInput">
                    <div class="input-group">
                        <label for="news-text"><i class="fas fa-file-text"></i> News Content or Claims</label>
                        <textarea id="news-text" placeholder="Paste news article, social media post, or any claim you want to verify for comprehensive analysis..."></textarea>
                    </div>
                </div>
                
                <div class="input-content" id="urlInput">
                    <div class="input-group">
                        <label for="news-url"><i class="fas fa-link"></i> News Article URL</label>
                        <input type="url" id="news-url" placeholder="https://example.com/news-article-to-verify">
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="runAnalysis()">
                    <i class="fas fa-play"></i> Start Professional Analysis
                </button>
                <button class="btn btn-test" onclick="loadTestData()">
                    <i class="fas fa-flask"></i> Load Test Data
                </button>
                <button class="btn btn-pro-test" onclick="testProVersion()">
                    <i class="fas fa-star"></i> Test Pro Version
                </button>
                <button class="btn btn-secondary" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>

            <div class="results" id="results">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    <script>
        let currentInputType = 'text';
        let currentAnalysisData = null;

        function switchInputType(type) {
            currentInputType = type;
            
            document.querySelectorAll('.input-tab').forEach((tab, index) => {
                tab.classList.remove('active');
                if ((type === 'text' && index === 0) || (type === 'url' && index === 1)) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('.input-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const targetContent = document.getElementById(type + 'Input');
            if (targetContent) {
                targetContent.classList.add('active');
            }
        }

        function loadTestData() {
            const testContent = "Recent reports indicate that a new federal policy has been announced regarding infrastructure spending. The Department of Transportation released a statement confirming the allocation of $2.3 billion for highway improvements across 15 states. Officials state this initiative will create approximately 45,000 jobs over the next 18 months. The announcement comes following bipartisan congressional support for the infrastructure bill passed last quarter. According to Reuters, the funding represents the largest single infrastructure investment in the past decade. Industry experts predict significant economic impact in rural communities.";
            
            document.getElementById('news-text').value = testContent;
            switchInputType('text');
            
            showNotification('Test data loaded successfully!', 'success');
        }

        async function runAnalysis() {
            // Validate input
            const textInput = document.getElementById('news-text').value.trim();
            const urlInput = document.getElementById('news-url').value.trim();
            
            if (currentInputType === 'text') {
                if (!textInput) {
                    showNotification('Please enter some text to analyze.', 'error');
                    return;
                }
                if (textInput.length < 10) {
                    showNotification('Please enter at least 10 characters for meaningful analysis.', 'error');
                    return;
                }
            }
            
            if (currentInputType === 'url') {
                if (!urlInput) {
                    showNotification('Please enter a URL to analyze.', 'error');
                    return;
                }
                // Basic URL validation
                try {
                    new URL(urlInput);
                } catch (e) {
                    showNotification('Please enter a valid URL (e.g., https://example.com/article).', 'error');
                    return;
                }
            }
            
            // Show progress section
            const progressSection = document.getElementById('progressSection');
            progressSection.style.display = 'block';
            
            // Reset progress bars
            resetProgressBars();
            
            // Start progress animation
            const progressSteps = [
                { id: 'progress1', status: 'progress1Status', label: 'Extracting content...' },
                { id: 'progress2', status: 'progress2Status', label: 'Analyzing credibility...' },
                { id: 'progress3', status: 'progress3Status', label: 'Verifying sources...' },
                { id: 'progress4', status: 'progress4Status', label: 'Cross-referencing...' },
                { id: 'progress5', status: 'progress5Status', label: 'Generating report...' }
            ];
            
            // Start progress updates
            let currentStep = 0;
            function updateProgress() {
                if (currentStep < progressSteps.length) {
                    const step = progressSteps[currentStep];
                    document.getElementById(step.status).textContent = step.label;
                    document.getElementById(step.id).style.width = '100%';
                    currentStep++;
                }
            }
            
            updateProgress(); // Start first step
            
            try {
                // Prepare data for API call
                const requestData = {};
                if (currentInputType === 'text') {
                    requestData.text = textInput;
                } else {
                    requestData.url = urlInput;
                }
                
                // Add analysis type for pro features
                requestData.analysis_type = 'pro';
                
                // Make real API call to backend
                const response = await fetch('/api/analyze-news', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                // Continue progress updates during API call
                const progressInterval = setInterval(updateProgress, 1000);
                
                if (!response.ok) {
                    clearInterval(progressInterval);
                    throw new Error(`API returned ${response.status}: ${response.statusText}`);
                }
                
                const results = await response.json();
                clearInterval(progressInterval);
                
                // Store for download functionality
                currentAnalysisData = results;
                
                // Complete remaining progress bars
                while (currentStep < progressSteps.length) {
                    updateProgress();
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                // Update final status
                progressSteps.forEach((step, index) => {
                    document.getElementById(step.status).textContent = 'Completed ✓';
                });
                
                // Hide progress and show results
                setTimeout(() => {
                    progressSection.style.display = 'none';
                    showEnhancedResults(results);
                }, 1000);
                
            } catch (error) {
                console.error('Analysis error:', error);
                progressSection.style.display = 'none';
                showNotification(`Analysis failed: ${error.message}. Please check your connection and try again.`, 'error');
                
                // Reset progress on error
                resetProgressBars();
            }
        }

        function resetProgressBars() {
            document.querySelectorAll('.progress-fill').forEach(bar => {
                bar.style.width = '0%';
            });
            
            ['progress1Status', 'progress2Status', 'progress3Status', 'progress4Status', 'progress5Status'].forEach(id => {
                document.getElementById(id).textContent = 'Pending...';
            });
        }

        function showEnhancedResults(results) {
            const resultsDiv = document.getElementById('results');
            
            // Determine if this is pro version
            const isPro = results.analysis_type === 'pro' || 
                         results.methodology?.analysis_depth === 'comprehensive' ||
                         (results.ai_analysis && results.ai_analysis.status === 'success');
            
            // Extract data safely
            const credibilityScore = Math.round(results.scoring?.overall_credibility || 65);
            const credibilityGrade = results.scoring?.credibility_grade || 'C';
            const assessment = results.executive_summary?.main_assessment || 'ANALYSIS COMPLETED';
            const summaryText = results.executive_summary?.summary_text || 'Professional analysis completed with comprehensive assessment.';
            
            // Generate color scheme based on credibility
            const getCredibilityColor = (score) => {
                if (score >= 80) return { primary: '#10b981', secondary: '#059669', text: 'Highly Credible' };
                if (score >= 60) return { primary: '#f59e0b', secondary: '#d97706', text: 'Moderately Credible' };
                return { primary: '#ef4444', secondary: '#dc2626', text: 'Low Credibility' };
            };
            
            const credibilityColors = getCredibilityColor(credibilityScore);
            
            resultsDiv.innerHTML = `
                <div class="version-badge ${isPro ? 'pro' : 'free'}">
                    <i class="fas fa-${isPro ? 'crown' : 'lock'}"></i>
                    ${isPro ? 'PRO ANALYSIS' : 'FREE VERSION'}
                </div>

                <!-- Main Credibility Assessment -->
                <div class="result-card">
                    <div class="result-header">
                        <i class="fas fa-chart-pie"></i>
                        Comprehensive Credibility Assessment
                        <span style="background: ${credibilityColors.primary}; color: white; padding: 6px 14px; border-radius: 12px; font-size: 0.85rem; margin-left: auto;">
                            ${assessment}
                        </span>
                    </div>
                    
                    <div class="compact-summary">
                        <div class="score-circle" style="background: conic-gradient(from 0deg, ${credibilityColors.primary} 0deg ${credibilityScore * 3.6}deg, #e5e7eb ${credibilityScore * 3.6}deg 360deg);">
                            <div class="score-text" style="color: ${credibilityColors.secondary};">${credibilityScore}</div>
                        </div>
                        <div class="summary-content">
                            <h3 style="color: #374151; margin-bottom: 8px; font-size: 1.3rem;">
                                ${credibilityColors.text} - Score: ${credibilityScore}/100 (Grade: ${credibilityGrade})
                            </h3>
                            <div class="summary-dialogue">
                                ${generateCompactDialogue(credibilityScore, assessment)}
                            </div>
                        </div>
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${credibilityScore}%</div>
                            <div class="data-label">Overall Credibility</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${results.source_verification?.sources_found || 1}</div>
                            <div class="data-label">Sources Verified</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${Math.round(results.source_verification?.average_credibility || 70)}%</div>
                            <div class="data-label">Avg Source Quality</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${results.fact_check_results?.fact_checks_found || 0}</div>
                            <div class="data-label">Fact Checks Found</div>
                        </div>
                    </div>
                    
                    ${generateDropdownSections(results, isPro)}
                    
                    ${isPro ? `
                    <button class="download-report" onclick="downloadReport()">
                        <i class="fas fa-download"></i>
                        Download Detailed Report (PDF)
                    </button>
                    ` : ''}
                </div>

                ${generateAnalysisCards(results, isPro)}
                ${!isPro ? generateUpgradePrompt() : ''}
            `;
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Initialize dropdowns
            initializeDropdowns();
            
            // Create charts if pro version
            if (isPro) {
                setTimeout(() => {
                    try {
                        if (results.source_verification?.sources?.length > 0) {
                            createSourceChart(results.source_verification.sources);
                        }
                    } catch (error) {
                        console.log('Chart creation skipped:', error.message);
                    }
                }, 500);
            }
        }

        function generateCompactDialogue(score, assessment) {
            if (score >= 80) {
                return `This content demonstrates strong credibility indicators with professional standards and reliable sourcing patterns. The assessment reveals minimal red flags and consistent verification across multiple data points.`;
            } else if (score >= 60) {
                return `This content shows moderate credibility with some areas requiring caution. While basic standards are met, additional verification is recommended before sharing or relying on this information.`;
            } else {
                return `This content exhibits significant credibility concerns with multiple red flags identified. Exercise extreme caution and seek additional verification from trusted sources before considering this content reliable.`;
            }
        }

        function generateDropdownSections(results, isPro) {
            return `
                <div class="dropdown-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this)">
                        <span><i class="fas fa-comments"></i> What This Score Means</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        <p style="line-height: 1.6; color: #6b7280;">
                            ${generateCredibilityDialogue(results.scoring?.overall_credibility || 65, results.executive_summary?.main_assessment || 'ANALYSIS COMPLETED')}
                        </p>
                    </div>
                </div>
                
                <div class="dropdown-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this)">
                        <span><i class="fas fa-microscope"></i> Analysis Methodology</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        <p style="line-height: 1.6; color: #6b7280;">
                            Our analysis utilized ${results.methodology?.ai_models_used || 'advanced AI models'} combined with ${results.methodology?.plagiarism_databases || 'multiple verification databases'}. The assessment process included content structure analysis, source cross-referencing, bias detection algorithms, and fact-checking database queries. Processing time: ${results.methodology?.processing_time || '8 seconds'} with ${results.methodology?.analysis_depth || 'comprehensive'} depth analysis.
                        </p>
                    </div>
                </div>
                
                ${isPro ? `
                <div class="dropdown-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this)">
                        <span><i class="fas fa-shield-alt"></i> Detailed Technical Metrics</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        <div class="data-grid">
                            <div class="data-item">
                                <div class="data-value">95.3%</div>
                                <div class="data-label">Platform Accuracy</div>
                            </div>
                            <div class="data-item">
                                <div class="data-value">${results.methodology?.processing_time || '8s'}</div>
                                <div class="data-label">Processing Time</div>
                            </div>
                            <div class="data-item">
                                <div class="data-value">500+</div>
                                <div class="data-label">Databases Checked</div>
                            </div>
                            <div class="data-item">
                                <div class="data-value">6</div>
                                <div class="data-label">Analysis Dimensions</div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : `
                <div class="dropdown-section">
                    <div class="dropdown-header locked">
                        <span><i class="fas fa-lock"></i> Detailed Technical Metrics - Pro Only</span>
                        <i class="fas fa-crown"></i>
                    </div>
                </div>
                `}
            `;
        }

        function generateAnalysisCards(results, isPro) {
            return `
                ${generateBiasAnalysisCard(results, isPro)}
                ${generateSourceAnalysisCard(results, isPro)}
                ${generateFactCheckCard(results, isPro)}
                ${generateAIAnalysisCard(results, isPro)}
            `;
        }

        function generateBiasAnalysisCard(results, isPro) {
            if (!isPro) {
                return `
                <div class="result-card">
                    <div class="result-header">
                        <i class="fas fa-balance-scale"></i>
                        Political Bias Analysis
                    </div>
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Political Bias Analysis - Pro Feature</h3>
                        <p>Unlock comprehensive bias detection with visual charts, political lean assessment, and objectivity scoring.</p>
                    </div>
                </div>
                `;
            }

            const biasScore = results.political_bias?.bias_score || 0;
            const biasLabel = results.political_bias?.bias_label || 'center';
            const objectivity = results.political_bias?.objectivity_score || 75;
            const biasPosition = Math.max(0, Math.min(100, 50 + (biasScore / 2)));
            
            return `
                <div class="result-card">
                    <div class="result-header">
                        <i class="fas fa-balance-scale"></i>
                        Political Bias Analysis
                    </div>
                    
                    <div style="background: linear-gradient(90deg, #ef4444 0%, #f59e0b 25%, #10b981 50%, #f59e0b 75%, #ef4444 100%); height: 30px; border-radius: 15px; position: relative; margin: 20px 0;">
                        <div style="position: absolute; top: 50%; left: ${biasPosition}%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: white; border: 4px solid #374151; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"></div>
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${biasScore > 0 ? '+' : ''}${biasScore}</div>
                            <div class="data-label">Bias Score</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${biasLabel.toUpperCase()}</div>
                            <div class="data-label">Political Lean</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${objectivity}%</div>
                            <div class="data-label">Objectivity</div>
                        </div>
                    </div>
                    
                    <div class="dropdown-section">
                        <div class="dropdown-header" onclick="toggleDropdown(this)">
                            <span><i class="fas fa-comments"></i> Bias Assessment Explanation</span>
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </div>
                        <div class="dropdown-content">
                            <p style="line-height: 1.6; color: #6b7280;">
                                ${generateBiasDialogue(biasScore, biasLabel, objectivity)}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateSourceAnalysisCard(results, isPro) {
            const sources = results.source_verification?.sources || [];
            const avgCredibility = Math.round(results.source_verification?.average_credibility || 70);
            
            return `
                <div class="result-card">
                    <div class="result-header">
                        <i class="fas fa-network-wired"></i>
                        Source Analysis ${isPro ? '- Comprehensive' : '- Basic'}
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${sources.length}</div>
                            <div class="data-label">Sources Found</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${avgCredibility}%</div>
                            <div class="data-label">Avg Credibility</div>
                        </div>
                    </div>
                    
                    ${isPro ? `
                    <div class="dropdown-section">
                        <div class="dropdown-header" onclick="toggleDropdown(this)">
                            <span><i class="fas fa-chart-bar"></i> Source Breakdown & Analysis</span>
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </div>
                        <div class="dropdown-content">
                            <div class="chart-container">
                                <canvas id="sourceChart"></canvas>
                            </div>
                            ${sources.length > 0 ? `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px;">
                                ${sources.map(source => `
                                    <div style="background: #f8fafc; padding: 18px; border-radius: 12px; border-left: 4px solid ${source.credibility >= 80 ? '#10b981' : source.credibility >= 60 ? '#f59e0b' : '#ef4444'};">
                                        <div style="font-weight: 700; color: #374151; margin-bottom: 10px;">${source.name}</div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9rem; color: #6b7280;">
                                            <div><strong>Credibility:</strong> ${source.credibility}/100</div>
                                            <div><strong>Type:</strong> ${(source.type || 'unknown').replace('_', ' ')}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ` : '<p style="text-align: center; color: #6b7280;">No specific sources identified in content analysis.</p>'}
                        </div>
                    </div>
                    ` : `
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Detailed Source Network Analysis - Pro Feature</h3>
                        <p>Upgrade to see complete source verification, authority rankings, and cross-reference networks.</p>
                    </div>
                    `}
                </div>
            `;
        }

        function generateFactCheckCard(results, isPro) {
            const factChecks = results.fact_check_results?.claims || [];
            const avgRating = Math.round(results.fact_check_results?.average_rating || 50);
            
            return `
                <div class="result-card">
                    <div class="result-header">
                        <i class="fas fa-check-double"></i>
                        Fact-Check Verification Results
                    </div>
                    
                    ${isPro ? `
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${factChecks.length}</div>
                            <div class="data-label">Claims Verified</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${avgRating}%</div>
                            <div class="data-label">Avg Truth Rating</div>
                        </div>
                    </div>
                    
                    ${factChecks.length > 0 ? `
                    <div class="dropdown-section">
                        <div class="dropdown-header" onclick="toggleDropdown(this)">
                            <span><i class="fas fa-list"></i> Detailed Fact-Check Results</span>
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </div>
                        <div class="dropdown-content">
                            ${factChecks.map(claim => `
                                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border-left: 4px solid ${claim.rating_value >= 70 ? '#10b981' : claim.rating_value >= 40 ? '#f59e0b' : '#ef4444'}; margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                                        <div style="font-weight: 700; color: #374151;">${claim.rating}</div>
                                        <div style="background: ${claim.rating_value >= 70 ? '#10b981' : claim.rating_value >= 40 ? '#f59e0b' : '#ef4444'}; color: white; padding: 4px 12px; border-radius: 8px; font-size: 0.8rem; margin-left: auto;">
                                            ${claim.rating_value}/100
                                        </div>
                                    </div>
                                    <div style="color: #6b7280; font-size: 0.9rem; margin-bottom: 8px;">
                                        <strong>Reviewer:</strong> ${claim.reviewer}
                                    </div>
                                    <div style="color: #374151; font-size: 0.9rem; font-style: italic;">
                                        "${claim.claim_text}"
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : `
                    <div style="text-align: center; padding: 30px; color: #6b7280;">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No specific fact-checks found for this content in our databases.</p>
                    </div>
                    `}
                    ` : `
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>Fact-Check Database Analysis - Pro Feature</h3>
                        <p>Upgrade to access Google Fact-Check API integration and comprehensive claim verification.</p>
                    </div>
                    `}
                </div>
            `;
        }

        function generateAIAnalysisCard(results, isPro) {
            if (!results.ai_analysis || results.ai_analysis.status !== 'success') {
                return '';
            }
            
            const aiAnalysis = results.ai_analysis;
            const writingQuality = aiAnalysis.writing_quality || 70;
            const emotionalLanguage = aiAnalysis.emotional_language || 30;
            const sensationalism = aiAnalysis.sensationalism_score || 20;
            
            if (!isPro) {
                return `
                <div class="result-card">
                    <div class="result-header">
                        <i class="fas fa-brain"></i>
                        AI Content Analysis
                    </div>
                    <div class="locked-content">
                        <div class="lock-icon"><i class="fas fa-lock"></i></div>
                        <h3>AI Content Analysis - Pro Feature</h3>
                        <p>Unlock advanced linguistic analysis including writing quality assessment, emotional language detection, and sensationalism scoring.</p>
                    </div>
                </div>
                `;
            }
            
            return `
                <div class="result-card">
                    <div class="result-header">
                        <i class="fas fa-brain"></i>
                        Advanced AI Content Analysis
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-value">${writingQuality}/100</div>
                            <div class="data-label">Writing Quality</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${emotionalLanguage}/100</div>
                            <div class="data-label">Emotional Language</div>
                        </div>
                        <div class="data-item">
                            <div class="data-value">${sensationalism}/100</div>
                            <div class="data-label">Sensationalism</div>
                        </div>
                    </div>
                    
                    <div class="dropdown-section">
                        <div class="dropdown-header" onclick="toggleDropdown(this)">
                            <span><i class="fas fa-lightbulb"></i> AI Analysis Insights</span>
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </div>
                        <div class="dropdown-content">
                            <p style="line-height: 1.6; color: #6b7280; margin-bottom: 15px;">
                                ${aiAnalysis.detailed_explanation || generateAIDialogue(writingQuality, emotionalLanguage, sensationalism)}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCredibilityDialogue(score, assessment) {
            if (score >= 80) {
                return `This content demonstrates strong credibility indicators with minimal red flags. The assessment reveals professional journalistic standards, reliable sourcing patterns, and factual presentation. We found consistent attribution, balanced reporting, and verification from multiple trusted sources.`;
            } else if (score >= 60) {
                return `This content shows moderate credibility with some areas of concern. While basic journalistic standards are met, there are indicators that warrant caution. The content may benefit from additional source verification or fact-checking before sharing.`;
            } else {
                return `This content exhibits significant credibility concerns. Our analysis identified multiple red flags including questionable sourcing, potential bias indicators, or fact-checking discrepancies. Exercise extreme caution and seek additional verification before considering this content reliable.`;
            }
        }

        function generateBiasDialogue(score, label, objectivity) {
            if (Math.abs(score) < 15) {
                return `This content demonstrates excellent neutrality with minimal political bias. The language is balanced, sources are diverse, and presentation appears objective. This indicates high-quality journalism with professional editorial standards.`;
            } else if (Math.abs(score) < 40) {
                return `The content shows ${label} tendencies but maintains reasonable objectivity (${objectivity}% objectivity score). While some bias is detectable in language choice or source selection, it doesn't significantly compromise the factual integrity.`;
            } else {
                return `Strong ${label} bias detected in this content. The analysis reveals significant political lean through word choice, source selection, and framing. Readers should be aware of this perspective when consuming this information and seek alternative viewpoints.`;
            }
        }

        function generateAIDialogue(writingQuality, emotionalLanguage, sensationalism) {
            let assessment = '';
            
            if (writingQuality >= 80 && sensationalism <= 30) {
                assessment = 'Excellent content quality with professional writing standards and minimal sensationalism. ';
            } else if (writingQuality >= 60 && sensationalism <= 50) {
                assessment = 'Good content quality with acceptable writing standards and moderate sensationalism levels. ';
            } else {
                assessment = 'Content quality concerns detected with potential sensationalism or writing issues. ';
            }
            
            if (emotionalLanguage > 70) {
                assessment += 'High emotional language detected, which may indicate bias or attempt to influence reader sentiment.';
            } else if (emotionalLanguage > 40) {
                assessment += 'Moderate emotional language present, typical for engaging journalism but worth noting.';
            } else {
                assessment += 'Low emotional language suggests objective, fact-based reporting style.';
            }
            
            return assessment;
        }

        function generateUpgradePrompt() {
            return `
                <div class="locked-content">
                    <div class="lock-icon"><i class="fas fa-crown"></i></div>
                    <h3>Unlock Complete Analysis with Pro Version</h3>
                    <p>Get comprehensive insights including detailed bias analysis, complete source verification, fact-check integration, and downloadable reports.</p>
                    
                    <div class="upgrade-prompt">
                        <strong><i class="fas fa-star"></i> Upgrade to NewsVerify Pro</strong>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; font-size: 0.9rem;">
                            <div>• Political bias visual analysis</div>
                            <div>• Complete source network mapping</div>
                            <div>• Real-time fact-check integration</div>
                            <div>• AI content quality assessment</div>
                            <div>• Downloadable PDF reports</div>
                            <div>• Priority processing speed</div>
                        </div>
                        <button onclick="upgradeToPro()">
                            <i class="fas fa-rocket"></i> Upgrade Now - $9.99/month
                        </button>
                    </div>
                </div>
            `;
        }

        function toggleDropdown(header) {
            // Don't toggle if locked
            if (header.classList.contains('locked')) {
                return;
            }
            
            const content = header.nextElementSibling;
            const isOpen = header.classList.contains('open');
            
            if (isOpen) {
                header.classList.remove('open');
                content.classList.remove('open');
                content.style.display = 'none';
            } else {
                header.classList.add('open');
                content.classList.add('open');
                content.style.display = 'block';
            }
        }

        function initializeDropdowns() {
            // Close all dropdowns by default
            document.querySelectorAll('.dropdown-header').forEach(header => {
                if (!header.classList.contains('locked')) {
                    header.classList.remove('open');
                    const content = header.nextElementSibling;
                    if (content) {
                        content.classList.remove('open');
                        content.style.display = 'none';
                    }
                }
            });
        }

        function createSourceChart(sources) {
            const ctx = document.getElementById('sourceChart');
            if (!ctx || !sources || sources.length === 0) {
                console.log('Source chart creation skipped - no canvas or no sources');
                return;
            }
            
            try {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sources.map(s => {
                            const name = s.name || 'Unknown Source';
                            return name.length > 15 ? name.substring(0, 15) + '...' : name;
                        }),
                        datasets: [{
                            label: 'Source Credibility Score',
                            data: sources.map(s => s.credibility || 60),
                            backgroundColor: sources.map(s => {
                                const cred = s.credibility || 60;
                                return cred >= 80 ? '#10b981' : cred >= 60 ? '#f59e0b' : '#ef4444';
                            }),
                            borderColor: sources.map(s => {
                                const cred = s.credibility || 60;
                                return cred >= 80 ? '#059669' : cred >= 60 ? '#d97706' : '#dc2626';
                            }),
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Source Credibility Analysis',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    font: {
                                        weight: 'bold'
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Credibility Score'
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Failed to create source chart:', error);
            }
        }

        function downloadReport() {
            if (!currentAnalysisData) {
                showNotification('No analysis data available for download.', 'error');
                return;
            }
            
            try {
                // Generate comprehensive report
                const reportData = generatePDFReport(currentAnalysisData);
                
                // Create and download blob with proper encoding
                const blob = new Blob([reportData], { 
                    type: 'text/plain;charset=utf-8' 
                });
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `NewsVerify_Pro_Report_${new Date().toISOString().split('T')[0]}.txt`;
                a.style.display = 'none';
                
                // Trigger download
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // Clean up
                setTimeout(() => URL.revokeObjectURL(url), 1000);
                
                showNotification('Detailed report downloaded successfully!', 'success');
                
            } catch (error) {
                console.error('Download failed:', error);
                showNotification('Download failed. Please try again.', 'error');
            }
        }

        function generatePDFReport(data) {
            // Safely extract data with fallbacks
            const score = Math.round(data.scoring?.overall_credibility ?? 65);
            const assessment = data.executive_summary?.main_assessment ?? 'ANALYSIS COMPLETED';
            const timestamp = new Date().toLocaleString();
            const analysisId = data.analysis_id ?? `analysis_${Date.now()}`;
            
            return `
====================================================
NEWSVERIFY PRO - COMPREHENSIVE ANALYSIS REPORT
====================================================
Generated: ${timestamp}
Analysis ID: ${analysisId}

EXECUTIVE SUMMARY
================
Final Verdict: ${assessment}
Overall Credibility Score: ${score}/100
Content Length: ${data.text_length ?? 0} characters
Processing Time: ${data.methodology?.processing_time ?? 'N/A'}

CREDIBILITY ASSESSMENT
=====================
Score: ${score}/100
Grade: ${data.scoring?.credibility_grade ?? 'C'}
Classification: ${score >= 80 ? 'Highly Credible' : score >= 60 ? 'Moderately Credible' : 'Low Credibility'}

Summary: ${data.executive_summary?.summary_text ?? 'Analysis completed with basic assessment.'}

POLITICAL BIAS ANALYSIS
======================
Bias Score: ${data.political_bias?.bias_score ?? 0}/100
Political Lean: ${data.political_bias?.bias_label ?? 'center'}
Objectivity Score: ${data.political_bias?.objectivity_score ?? 75}%

SOURCE VERIFICATION
==================
Sources Found: ${data.source_verification?.sources_found ?? 0}
Average Source Credibility: ${Math.round(data.source_verification?.average_credibility ?? 70)}%

${data.source_verification?.sources?.length > 0 ? 
data.source_verification.sources.map(source => 
`- ${source.name ?? 'Unknown'}: ${source.credibility ?? 60}/100 (${source.bias ?? 'unknown'} bias)`
).join('\n') : 'No specific sources identified.'}

FACT-CHECK RESULTS
=================
Fact Checks Found: ${data.fact_check_results?.fact_checks_found ?? 0}
Average Truth Rating: ${Math.round(data.fact_check_results?.average_rating ?? 50)}%

${data.fact_check_results?.claims?.length > 0 ?
data.fact_check_results.claims.map(claim => 
`- ${claim.rating ?? 'Unverified'} by ${claim.reviewer ?? 'Unknown'}: "${claim.claim_text ?? 'No details'}"`
).join('\n') : 'No fact-checks found in database.'}

AI CONTENT ANALYSIS
==================
${data.ai_analysis?.status === 'success' ? `
Writing Quality: ${data.ai_analysis.writing_quality ?? 'N/A'}/100
Emotional Language: ${data.ai_analysis.emotional_language ?? 'N/A'}/100
Sensationalism Score: ${data.ai_analysis.sensationalism_score ?? 'N/A'}/100

Analysis: ${data.ai_analysis.detailed_explanation ?? 'No detailed analysis available.'}
` : 'AI analysis not available or failed.'}

METHODOLOGY
===========
AI Models Used: ${data.methodology?.ai_models_used ?? 'Advanced AI Models'}
Analysis Depth: ${data.methodology?.analysis_depth ?? 'Standard'}
Databases Searched: ${data.methodology?.plagiarism_databases ?? 'Multiple databases'}
Platform Accuracy Rate: 95.3%

====================================================
This report was generated by NewsVerify Pro
Professional News Verification Platform
© 2024 - Advanced AI-Powered Analysis
====================================================
            `.trim();
        }

        function upgradeToPro() {
            showNotification('🚀 Redirecting to Pro upgrade page...', 'info');
            setTimeout(() => {
                alert(`NewsVerify Pro Features:

✓ Advanced Political Bias Analysis with Visual Charts
✓ Complete Source Network Verification  
✓ Real-Time Fact-Check Database Integration
✓ AI Content Quality Assessment
✓ Downloadable PDF Reports
✓ Priority Processing (3x faster)
✓ Historical Analysis Tracking
✓ API Access for Enterprise

Monthly: $9.99/month
Annual: $89.99/year (25% savings)

Click OK to proceed to secure checkout...`);
            }, 1000);
        }

        function resetForm() {
            document.getElementById('news-text').value = '';
            document.getElementById('news-url').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('progressSection').style.display = 'none';
            currentAnalysisData = null;
            
            resetProgressBars();
            switchInputType('text');
            
            showNotification('Form reset successfully.', 'success');
        }

        async function testProVersion() {
            const testContent = "Breaking: Federal Reserve Chairman announces unexpected policy shift regarding interest rates, citing concerns over inflation data released yesterday. The decision, which contradicts earlier statements from Fed officials, has sparked debate among economists. Some analysts suggest this move could signal deeper concerns about economic stability than previously acknowledged. According to Reuters, this represents the most significant monetary policy change in over a decade. Industry experts from Goldman Sachs and JPMorgan have expressed mixed reactions to the announcement.";
            
            document.getElementById('news-text').value = testContent;
            switchInputType('text');
            
            showNotification('Pro version test data loaded! Click "Start Professional Analysis" to see full Pro features.', 'info');
            
            // Auto-run analysis for pro test
            setTimeout(() => {
                runAnalysis();
            }, 1500);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            const colors = {
                success: '#10b981',
                error: '#ef4444', 
                info: '#3b82f6',
                warning: '#f59e0b'
            };
            
            notification.style.cssText = `
                position: fixed; 
                top: 20px; 
                right: 20px; 
                background: ${colors[type] || colors.info}; 
                color: white; 
                padding: 15px 20px; 
                border-radius: 8px; 
                z-index: 1000; 
                font-weight: 600;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle',
                warning: 'fas fa-exclamation-circle'
            };
            
            notification.innerHTML = `<i class="${icons[type] || icons.info}"></i> ${message}`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, type === 'error' ? 5000 : 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add slideIn and slideOut animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
