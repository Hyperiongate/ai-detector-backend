<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Fact-Checker - Real-Time Verification Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Header Styles -->
    <style>
    /* Reset any conflicting styles */
    .ff-nav * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    /* Main navigation bar */
    .ff-nav {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 9999;
        height: 60px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .ff-nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
    }

    /* Logo */
    .ff-nav-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        color: #667eea;
        font-weight: 700;
        font-size: 1.1rem;
        transition: transform 0.3s ease;
    }

    .ff-nav-logo:hover {
        transform: scale(1.05);
    }

    .ff-nav-logo i {
        font-size: 1.4rem;
    }

    /* Navigation links */
    .ff-nav-links {
        display: flex;
        gap: 5px;
        align-items: center;
    }

    .ff-nav-link {
        color: #4a5568;
        text-decoration: none;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-weight: 500;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .ff-nav-link:hover {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        transform: translateY(-2px);
    }

    .ff-nav-link.active {
        background: rgba(102, 126, 234, 0.15);
        color: #667eea;
        font-weight: 600;
    }

    .ff-nav-link i {
        font-size: 0.9rem;
    }

    /* Auth buttons */
    .ff-nav-auth {
        display: flex;
        gap: 10px;
        align-items: center;
        position: relative;
    }

    .ff-nav-login, .ff-nav-signup {
        padding: 8px 20px;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .ff-nav-login {
        color: #667eea;
        border: 2px solid #667eea;
    }

    .ff-nav-login:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }

    .ff-nav-signup {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: 2px solid transparent;
    }

    .ff-nav-signup:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    /* Beta balloon */
    .ff-beta-balloon {
        position: absolute;
        top: -35px;
        right: 50px;
        background: linear-gradient(135deg, #ff6b35, #f7931e);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        white-space: nowrap;
        animation: ff-bounce 2s infinite;
        box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
    }

    .ff-beta-balloon::after {
        content: '';
        position: absolute;
        bottom: -6px;
        right: 20px;
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-top: 6px solid #f7931e;
    }

    @keyframes ff-bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    /* User menu */
    .ff-user-menu {
        position: relative;
        display: none;
    }

    .ff-user-menu-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #4a5568;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .ff-user-menu-toggle:hover {
        background: rgba(102, 126, 234, 0.2);
    }

    .ff-user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 10px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.1);
        min-width: 280px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
    }

    .ff-user-dropdown.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    /* Mobile menu button */
    .ff-mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        color: #4a5568;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 8px;
        transition: all 0.3s ease;
    }

    .ff-mobile-menu-btn:hover {
        color: #667eea;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
        .ff-nav-links {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            flex-direction: column;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border-top: 1px solid #e2e8f0;
        }
        
        .ff-nav-links.active {
            display: flex;
        }
        
        .ff-nav-link {
            width: 100%;
            padding: 12px 20px;
        }
        
        .ff-mobile-menu-btn {
            display: block;
        }
        
        .ff-nav-auth {
            display: none;
        }
        
        .ff-user-menu {
            display: none !important;
        }
        
        .ff-beta-balloon {
            display: none;
        }
    }
    </style>
    
    <!-- Page Styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            padding-top: 60px;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(255,255,255,0.3); }
            to { text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.5); }
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* Tool Container */
        .tool-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .control-btn {
            background: transparent;
            border: 2px solid #e2e8f0;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #4a5568;
            font-size: 1.2rem;
        }

        .control-btn:hover {
            border-color: #667eea;
            color: #667eea;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Language Selector */
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .language-selector label {
            font-weight: 600;
            color: #4a5568;
        }

        .language-selector select {
            padding: 5px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-selector select:hover {
            border-color: #667eea;
        }

        /* Compact Mode Tabs */
        .compact-tab {
            padding: 15px 25px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            min-width: 140px;
            position: relative;
            overflow: hidden;
        }

        .compact-tab::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            transition: all 0.5s ease;
            transform: translate(-50%, -50%);
        }

        .compact-tab:hover::before {
            width: 200px;
            height: 200px;
        }

        .compact-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .compact-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .compact-tab.active::after {
            content: 'âœ“';
            position: absolute;
            top: 5px;
            right: 5px;
            background: white;
            color: #667eea;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Active Mode Banner */
        .active-mode-banner {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .active-mode-banner i {
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .mode-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Audio Visualizer */
        .audio-visualizer {
            height: 60px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            position: relative;
            overflow: hidden;
        }

        .audio-visualizer.active {
            display: flex;
        }

        .audio-bar {
            width: 4px;
            background: #667eea;
            margin: 0 2px;
            border-radius: 2px;
            transition: height 0.1s ease;
            animation: audioWave 1s ease-in-out infinite;
        }

        @keyframes audioWave {
            0%, 100% { height: 10px; }
            50% { height: 30px; }
        }

        .audio-bar:nth-child(2) { animation-delay: 0.1s; }
        .audio-bar:nth-child(3) { animation-delay: 0.2s; }
        .audio-bar:nth-child(4) { animation-delay: 0.3s; }
        .audio-bar:nth-child(5) { animation-delay: 0.4s; }
        .audio-bar:nth-child(6) { animation-delay: 0.5s; }
        .audio-bar:nth-child(7) { animation-delay: 0.6s; }
        .audio-bar:nth-child(8) { animation-delay: 0.7s; }
        .audio-bar:nth-child(9) { animation-delay: 0.8s; }
        .audio-bar:nth-child(10) { animation-delay: 0.9s; }

        /* Instructions Alert */
        .instructions-alert {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(99, 102, 241, 0.1));
            border: 2px solid #6366f1;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .instructions-alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: #6366f1;
        }

        .instructions-alert h3 {
            color: #4f46e5;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .instructions-list {
            display: grid;
            gap: 12px;
            margin-left: 10px;
        }

        .instruction-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .instruction-item:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateX(5px);
        }

        .instruction-number {
            background: #6366f1;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        /* Input Section */
        .input-section {
            margin-bottom: 30px;
        }

        /* Live Fact-Check Panel */
        .live-factcheck-panel {
            position: fixed;
            right: 20px;
            top: 200px;
            width: 350px;
            max-height: 60vh;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: none;
            flex-direction: column;
            z-index: 999;
            transition: all 0.3s ease;
        }

        .live-factcheck-panel.active {
            display: flex;
        }

        .live-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .live-panel-title {
            font-weight: 700;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .live-indicator {
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            animation: blink 1s ease-in-out infinite;
        }

        .live-claims-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .live-claim-item {
            background: rgba(102, 126, 234, 0.05);
            padding: 12px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            animation: slideInRight 0.5s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .live-claim-item.checking {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .live-claim-item.verified {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .live-claim-item.false {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .live-claim-text {
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .live-claim-status {
            font-size: 0.8rem;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Transcript Container */
        .transcript-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            margin-bottom: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .transcript-container.recording-mode {
            border-color: #ef4444;
            animation: recordingPulse 2s ease-in-out infinite;
        }

        @keyframes recordingPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }

        .transcript-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .transcript-info {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .transcript-metric {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #transcript {
            background: rgba(249, 250, 251, 0.8);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 1rem;
            line-height: 1.8;
            transition: all 0.3s ease;
            color: #333;
            position: relative;
        }

        #transcript:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        #transcript:empty::before {
            content: attr(data-placeholder);
            color: #9ca3af;
            font-style: italic;
        }

        /* Highlighted claims in transcript */
        .claim-highlight {
            background: rgba(102, 126, 234, 0.2);
            padding: 2px 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .claim-highlight:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        .claim-highlight.verified {
            background: rgba(16, 185, 129, 0.2);
        }

        .claim-highlight.false {
            background: rgba(239, 68, 68, 0.2);
        }

        .claim-highlight.unverified {
            background: rgba(245, 158, 11, 0.2);
        }

        /* Recording Status */
        .recording-status {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ef4444;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.3s ease;
        }

        .recording-status.active {
            display: flex;
        }

        .recording-status::before {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: blink 1s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Speech Confidence Indicator */
        .speech-confidence {
            position: absolute;
            bottom: 15px;
            right: 15px;
            display: none;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .speech-confidence.active {
            display: flex;
        }

        .confidence-bar {
            width: 100px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: #10b981;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-group-hint {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #6b7280;
            font-style: italic;
        }

        /* URL Input Section */
        .url-input-section {
            display: none;
            margin-bottom: 20px;
        }

        .url-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .url-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* File Upload Section */
        .file-upload-section {
            display: none;
            margin-bottom: 20px;
        }

        .file-upload-zone {
            border: 3px dashed #e2e8f0;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(249, 250, 251, 0.5);
        }

        .file-upload-zone:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .file-upload-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        /* Feature Controls Section */
        .feature-controls-section {
            background: rgba(249, 250, 251, 0.5);
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .feature-controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .feature-control-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .feature-control-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .feature-control-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .feature-control-header i {
            font-size: 1.2rem;
            color: #667eea;
            margin-right: 10px;
        }

        .feature-control-header h4 {
            margin: 0;
            color: #4a5568;
            font-size: 1.1rem;
            flex: 1;
        }

        .feature-toggle-btn {
            background: transparent;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            color: #6b7280;
            font-weight: 500;
        }

        .feature-toggle-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .feature-toggle-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .feature-toggle-btn.active i {
            transform: rotate(180deg);
        }

        .feature-description {
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .feature-benefits {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .benefit-chip {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Info Sections Grid */
        .info-sections-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        /* Dropdown Sections */
        .dropdown-section {
            border: 2px solid;
            border-radius: 12px;
            overflow: hidden;
            background: rgba(249, 250, 251, 0.5);
            transition: all 0.3s ease;
        }

        .dropdown-header {
            padding: 15px 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .dropdown-header:hover {
            background: rgba(255, 255, 255, 0.8);
        }

        .dropdown-header.open {
            border-bottom: 2px solid;
        }

        .dropdown-header-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-header-content i {
            font-size: 1.3rem;
        }

        .dropdown-header-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .dropdown-title {
            font-weight: 700;
            color: #4a5568;
            font-size: 1rem;
        }

        .dropdown-subtitle {
            font-size: 0.85rem;
            color: #6b7280;
            font-weight: 400;
        }

        .dropdown-header .dropdown-icon {
            font-size: 1rem;
            color: #6b7280;
            transition: transform 0.3s ease;
        }

        .dropdown-header.open .dropdown-icon {
            transform: rotate(180deg);
            color: #667eea;
        }

        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            padding: 0;
            background: white;
            transition: all 0.5s ease;
        }

        .dropdown-content.open {
            max-height: 600px;
            padding: 25px;
        }

        /* Section specific colors */
        #how-it-works-section {
            border-color: rgba(99, 102, 241, 0.3);
        }

        #how-it-works-section .dropdown-header {
            background: rgba(99, 102, 241, 0.08);
        }

        #how-it-works-section .dropdown-header-content i {
            color: #6366f1;
        }

        #sources-section {
            border-color: rgba(16, 185, 129, 0.3);
        }

        #sources-section .dropdown-header {
            background: rgba(16, 185, 129, 0.08);
        }

        #sources-section .dropdown-header-content i {
            color: #10b981;
        }

        #features-section {
            border-color: rgba(245, 158, 11, 0.3);
        }

        #features-section .dropdown-header {
            background: rgba(245, 158, 11, 0.08);
        }

        #features-section .dropdown-header-content i {
            color: #f59e0b;
        }

        #tips-section {
            border-color: rgba(236, 72, 153, 0.3);
        }

        #tips-section .dropdown-header {
            background: rgba(236, 72, 153, 0.08);
        }

        #tips-section .dropdown-header-content i {
            color: #ec4899;
        }

        /* Timeline View */
        .timeline-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .timeline-container.active {
            display: block;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .timeline-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .timeline-item:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .timeline-time {
            font-weight: 600;
            color: #667eea;
            min-width: 60px;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-claim {
            font-size: 0.95rem;
            margin-bottom: 5px;
        }

        .timeline-status {
            font-size: 0.85rem;
            color: #6b7280;
        }

        /* Results Grid */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        /* Statistics Card */
        .stats-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            animation: fadeInUp 0.5s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(124, 58, 237, 0.05));
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
        }

        /* Claim Density Indicator */
        .claim-density {
            margin-top: 20px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
        }

        .density-label {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .density-bar {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .density-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
            width: 0%;
            transition: width 1s ease;
        }

        /* Fact Check Results */
        .fact-check-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.5s ease 0.2s;
            animation-fill-mode: both;
        }

        .fact-check-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #667eea, #764ba2, #f59e0b);
            background-size: 300% 100%;
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { background-position: -300% 0; }
            100% { background-position: 300% 0; }
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            color: #6b7280;
        }

        .filter-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .fact-check-item {
            background: rgba(249, 250, 251, 0.8);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.5s ease;
            animation-fill-mode: both;
        }

        .fact-check-item::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            transition: all 0.5s ease;
            transform: translate(-50%, -50%);
        }

        .fact-check-item:hover::before {
            width: 300px;
            height: 300px;
        }

        .fact-check-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .fact-check-item.flagged {
            border-left: 5px solid #f59e0b;
        }

        .verdict-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .verdict-true {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid #10b981;
        }

        .verdict-false {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid #ef4444;
        }

        .verdict-unverified {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid #f59e0b;
        }

        /* Flag Button */
        .flag-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .flag-btn:hover {
            color: #f59e0b;
            transform: scale(1.2);
        }

        .flag-btn.active {
            color: #f59e0b;
        }

        /* Source Details */
        .source-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .source-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .source-card {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .source-name {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .source-info {
            font-size: 0.85rem;
            color: #6b7280;
        }

        .source-credibility {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
        }

        .credibility-stars {
            color: #f59e0b;
        }

        /* Summary Section */
        .summary-card {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            margin-top: 20px;
            grid-column: 1 / -1;
            animation: fadeInUp 0.5s ease 0.4s;
            animation-fill-mode: both;
        }

        /* Accuracy Gauge */
        .accuracy-gauge {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }

        .gauge-circle {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .gauge-bg {
            fill: none;
            stroke: #e2e8f0;
            stroke-width: 20;
        }

        .gauge-fill {
            fill: none;
            stroke: url(#gaugeGradient);
            stroke-width: 20;
            stroke-linecap: round;
            stroke-dasharray: 0 440;
            transition: stroke-dasharray 1.5s ease;
        }

        .gauge-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .gauge-number {
            font-size: 3rem;
            font-weight: 800;
            color: #4a5568;
        }

        .gauge-label {
            font-size: 1rem;
            color: #6b7280;
        }

        /* Export Options */
        .export-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Loading */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Processing animation */
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .processing-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease;
        }

        .processing-content h3 {
            margin-bottom: 20px;
            color: #4a5568;
        }

        .ai-animation {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            position: relative;
        }

        .ai-animation::before,
        .ai-animation::after {
            content: '';
            position: absolute;
            border: 3px solid #667eea;
            border-radius: 50%;
            opacity: 0;
            animation: ripple 2s infinite;
        }

        .ai-animation::after {
            animation-delay: 1s;
        }

        @keyframes ripple {
            0% {
                width: 20px;
                height: 20px;
                top: 40px;
                left: 40px;
                opacity: 1;
            }
            100% {
                width: 100px;
                height: 100px;
                top: 0;
                left: 0;
                opacity: 0;
            }
        }

        /* Enhanced Visual Effects */
        .tool-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .tool-container:hover::before {
            opacity: 0.3;
        }

        /* Enhanced Claim Highlighting */
        .claim-highlight {
            display: inline-block;
            position: relative;
            padding: 3px 8px;
            margin: 0 2px;
            border-radius: 6px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(124, 58, 237, 0.2));
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .claim-highlight:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(124, 58, 237, 0.3));
        }

        .claim-highlight::after {
            content: attr(data-confidence);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .claim-highlight:hover::after {
            opacity: 1;
        }

        /* Enhanced Audio Visualizer */
        .audio-visualizer {
            position: relative;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(124, 58, 237, 0.1));
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .audio-visualizer::before {
            content: 'Recording Audio';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9rem;
            color: #667eea;
            font-weight: 600;
            opacity: 0.7;
        }

        /* Enhanced Results Cards */
        .stats-card,
        .fact-check-card,
        .summary-card {
            position: relative;
            overflow: hidden;
        }

        .stats-card::before,
        .fact-check-card::before,
        .summary-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            transform: rotate(45deg);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .stats-card:hover::before,
        .fact-check-card:hover::before,
        .summary-card:hover::before {
            opacity: 1;
        }

        /* Real-time Claim Counter */
        .real-time-counter {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        .real-time-counter.active {
            opacity: 1;
            transform: translateY(0);
        }

        .real-time-counter .counter-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .real-time-counter .counter-label {
            color: #6b7280;
            font-size: 0.9rem;
        }

        /* Improved Responsive Design */
        @media (max-width: 1024px) {
            .live-factcheck-panel {
                width: 300px;
                right: 10px;
                top: 100px;
            }
            
            .feature-controls-grid {
                grid-template-columns: 1fr;
            }

            .real-time-counter {
                bottom: 20px;
                left: 20px;
                padding: 12px 20px;
            }
        }

        @media (max-width: 768px) {
            .info-sections-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .filter-controls {
                justify-content: center;
            }
            
            .export-options {
                flex-direction: column;
                align-items: stretch;
            }
            
            .transcript-info {
                flex-direction: column;
                gap: 10px;
            }

            .live-factcheck-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }

            .compact-tab {
                min-width: 100px;
                padding: 12px 15px;
            }

            .real-time-counter {
                left: 50%;
                transform: translateX(-50%);
                bottom: 80px;
            }

            .real-time-counter.active {
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Print Styles */
        @media print {
            .ff-nav,
            .button-group,
            .feature-controls-section,
            .export-options,
            .live-factcheck-panel,
            .real-time-counter {
                display: none !important;
            }

            body {
                background: white;
                color: black;
            }

            .tool-container {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* Accessibility Improvements */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus Styles */
        *:focus {
            outline: 3px solid rgba(102, 126, 234, 0.5);
            outline-offset: 2px;
        }

        button:focus,
        a:focus {
            outline: 3px solid rgba(102, 126, 234, 0.5);
            outline-offset: 2px;
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            .claim-highlight {
                border: 2px solid currentColor;
            }

            .btn {
                border: 2px solid currentColor;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <nav class="ff-nav">
        <div class="ff-nav-container">
            <a href="/" class="ff-nav-logo">
                <i class="fas fa-shield-alt"></i>
                <span>Facts & Fakes AI</span>
            </a>
            
            <div class="ff-nav-links" id="ffNavLinks">
                <a href="/" class="ff-nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/news" class="ff-nav-link"><i class="fas fa-newspaper"></i> News Verify</a>
                <a href="/speech" class="ff-nav-link active"><i class="fas fa-microphone"></i> Speech Check</a>
                <a href="/unified" class="ff-nav-link"><i class="fas fa-search"></i> Content Check</a>
                <a href="/imageanalysis" class="ff-nav-link"><i class="fas fa-image"></i> Image Analysis</a>
                <a href="/missionstatement" class="ff-nav-link"><i class="fas fa-bullseye"></i> Mission</a>
                <a href="/pricingplan" class="ff-nav-link"><i class="fas fa-tags"></i> Pricing</a>
                <a href="/contact" class="ff-nav-link"><i class="fas fa-envelope"></i> Contact</a>
            </div>
            
            <div class="ff-nav-auth" id="ffNavAuth">
                <a href="/login" class="ff-nav-login">Login</a>
                <a href="/pricingplan" class="ff-nav-signup">Sign Up</a>
                <div class="ff-beta-balloon">
                    sign up now to start your free trial
                </div>
            </div>
            
            <div class="ff-user-menu" id="ffUserMenu">
                <div class="ff-user-menu-toggle" onclick="ffToggleUserDropdown()">
                    <span id="ffUserEmail">user@example.com</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="ff-user-dropdown" id="ffUserDropdown">
                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 4px;" id="ffUserEmailDropdown">user@example.com</div>
                        <div style="font-size: 0.85rem; color: #667eea; font-weight: 500;" id="ffUserPlan">Free Plan</div>
                    </div>
                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-size: 0.85rem; color: #718096; margin-bottom: 8px; font-weight: 500;">Daily Usage</div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 8px;">
                            <div id="ffUsageProgress" style="height: 100%; background: linear-gradient(135deg, #667eea, #764ba2); width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                        <div style="font-size: 0.8rem; color: #4a5568;" id="ffUsageText">0 / 5 analyses used</div>
                    </div>
                    <div style="padding: 10px 0;">
                        <a href="/account" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: #4a5568; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem;"><i class="fas fa-user"></i> Account Settings</a>
                        <a href="/billing" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: #4a5568; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem;"><i class="fas fa-credit-card"></i> Billing</a>
                        <a href="/api-keys" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: #4a5568; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem;"><i class="fas fa-key"></i> API Keys</a>
                        <a href="#" onclick="ffLogout()" style="display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: #4a5568; text-decoration: none; transition: all 0.3s ease; font-size: 0.9rem;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
            
            <button class="ff-mobile-menu-btn" onclick="ffToggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Live Fact-Check Panel -->
    <div class="live-factcheck-panel" id="livePanel">
        <div class="live-panel-header">
            <div class="live-panel-title">
                <div class="live-indicator"></div>
                Live Fact-Checking
            </div>
            <button class="control-btn" onclick="toggleLivePanel()" style="padding: 5px;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="live-claims-list" id="liveClaims">
            <p style="text-align: center; color: #6b7280; font-style: italic;">Claims will appear here as they're detected...</p>
        </div>
    </div>

    <!-- Real-time Counter -->
    <div class="real-time-counter" id="realtimeCounter">
        <div>
            <div class="counter-value" id="liveClaimCount">0</div>
            <div class="counter-label">Claims Detected</div>
        </div>
        <div class="loading-spinner" id="counterSpinner" style="display: none;"></div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-microphone-alt"></i> Speech Fact-Checker</h1>
            <p>Real-time fact verification for speeches, presentations, and conversations</p>
            <p style="font-size: 0.95rem; opacity: 0.8;">Powered by AI â€¢ Cross-references 12+ verification methods â€¢ Export detailed reports</p>
        </div>

        <div class="tool-container">
            <!-- Language Selector -->
            <div class="language-selector">
                <label for="languageSelect">Language:</label>
                <select id="languageSelect" onchange="changeLanguage()">
                    <option value="en-US">English (US)</option>
                    <option value="en-GB">English (UK)</option>
                    <option value="es-ES">Spanish</option>
                    <option value="fr-FR">French</option>
                    <option value="de-DE">German</option>
                    <option value="it-IT">Italian</option>
                    <option value="pt-BR">Portuguese</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                    <option value="ja-JP">Japanese</option>
                    <option value="ko-KR">Korean</option>
                </select>
            </div>

            <!-- Mode Selection Header -->
            <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(124, 58, 237, 0.1)); border: 2px solid #667eea; border-radius: 15px; padding: 20px; margin-bottom: 25px; text-align: center;">
                <h2 style="color: #4f46e5; margin-bottom: 10px; font-size: 1.5rem;">
                    <i class="fas fa-hand-point-down"></i> Step 1: Choose Your Input Method
                </h2>
                <p style="color: #6b7280; margin-bottom: 20px;">Select how you want to provide the speech content</p>
                
                <!-- Compact Input Tabs -->
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button class="compact-tab active" onclick="selectSource('microphone')" data-mode="microphone">
                        <i class="fas fa-microphone" style="font-size: 1.5rem; margin-bottom: 5px;"></i>
                        <div style="font-weight: 600;">Live Recording</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Speak into mic</div>
                    </button>
                    <button class="compact-tab" onclick="selectSource('text')" data-mode="text">
                        <i class="fas fa-keyboard" style="font-size: 1.5rem; margin-bottom: 5px;"></i>
                        <div style="font-weight: 600;">Text Input</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Type or paste</div>
                    </button>
                    <button class="compact-tab" onclick="selectSource('audio')" data-mode="audio">
                        <i class="fas fa-file-audio" style="font-size: 1.5rem; margin-bottom: 5px;"></i>
                        <div style="font-weight: 600;">Audio File</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Upload file</div>
                    </button>
                    <button class="compact-tab" onclick="selectSource('stream')" data-mode="stream">
                        <i class="fas fa-broadcast-tower" style="font-size: 1.5rem; margin-bottom: 5px;"></i>
                        <div style="font-weight: 600;">Live Stream</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Stream URL</div>
                    </button>
                    <button class="compact-tab" onclick="selectSource('demo')" data-mode="demo">
                        <i class="fas fa-play-circle" style="font-size: 1.5rem; margin-bottom: 5px;"></i>
                        <div style="font-weight: 600;">Try Demo</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">See example</div>
                    </button>
                </div>
            </div>

            <!-- Active Mode Banner -->
            <div class="active-mode-banner" id="modeBanner" style="margin-bottom: 20px;">
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-microphone" id="modeIcon"></i>
                    <span id="modeText">Live Recording Mode - Ready to record your speech</span>
                </div>
                <div class="mode-status">
                    <span class="status-dot"></span>
                    <span id="modeStatus">Active</span>
                </div>
            </div>

            <!-- Feature Controls Section -->
            <div class="feature-controls-section">
                <h3 style="text-align: center; color: #4a5568; margin-bottom: 20px;">
                    <i class="fas fa-tools"></i> Advanced Features
                </h3>
                
                <div class="feature-controls-grid">
                    <!-- Live Panel Control -->
                    <div class="feature-control-card">
                        <div class="feature-control-header">
                            <i class="fas fa-chart-line"></i>
                            <h4>Live Fact-Checking Panel</h4>
                            <button class="feature-toggle-btn" onclick="toggleLivePanel()" id="livePanelToggle">
                                <span class="toggle-text">Enable</span>
                                <i class="fas fa-toggle-off"></i>
                            </button>
                        </div>
                        <p class="feature-description">
                            See claims being fact-checked in real-time as you speak. The live panel shows instant verification results alongside your speech, perfect for real-time analysis during presentations or debates.
                        </p>
                        <div class="feature-benefits">
                            <span class="benefit-chip"><i class="fas fa-bolt"></i> Real-time results</span>
                            <span class="benefit-chip"><i class="fas fa-eye"></i> Visual feedback</span>
                            <span class="benefit-chip"><i class="fas fa-tachometer-alt"></i> Instant verification</span>
                        </div>
                    </div>

                    <!-- Timeline Control -->
                    <div class="feature-control-card">
                        <div class="feature-control-header">
                            <i class="fas fa-clock"></i>
                            <h4>Claim Timeline View</h4>
                            <button class="feature-toggle-btn" onclick="toggleTimeline()" id="timelineToggle">
                                <span class="toggle-text">Enable</span>
                                <i class="fas fa-toggle-off"></i>
                            </button>
                        </div>
                        <p class="feature-description">
                            Track when each claim was made during your speech. The timeline provides a chronological view of all detected claims with timestamps, making it easy to navigate and review specific moments.
                        </p>
                        <div class="feature-benefits">
                            <span class="benefit-chip"><i class="fas fa-history"></i> Chronological view</span>
                            <span class="benefit-chip"><i class="fas fa-search"></i> Easy navigation</span>
                            <span class="benefit-chip"><i class="fas fa-bookmark"></i> Timestamp tracking</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions Alert -->
            <div class="instructions-alert" id="instructionsAlert">
                <h3><i class="fas fa-info-circle"></i> How to Use <span id="modeNameInstructions">Live Recording</span></h3>
                <div class="instructions-list" id="instructionsList">
                    <div class="instruction-item">
                        <div class="instruction-number">1</div>
                        <div>
                            <strong>Start Recording:</strong> Click the "Start Recording" button below (microphone access required)
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">2</div>
                        <div>
                            <strong>Speak Clearly:</strong> Your words will appear in real-time in the transcript box
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">3</div>
                        <div>
                            <strong>Stop Recording:</strong> Click "Stop Recording" when you're finished speaking
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">4</div>
                        <div>
                            <strong>Check Facts:</strong> Click "Check Facts" to analyze all claims in your speech
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-section">
                <!-- Audio Visualizer -->
                <div class="audio-visualizer" id="audioVisualizer">
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                </div>

                <!-- URL Input Section -->
                <div class="url-input-section" id="urlInputSection">
                    <div class="url-input-group">
                        <input type="text" class="url-input" id="urlInput" placeholder="Enter Stream URL...">
                        <button class="btn btn-primary" onclick="loadFromURL()">
                            <i class="fas fa-download"></i> Load
                        </button>
                    </div>
                </div>

                <!-- File Upload Section -->
                <div class="file-upload-section" id="fileUploadSection">
                    <div class="file-upload-zone" id="fileUploadZone" onclick="triggerFileUpload()">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #667eea; margin-bottom: 15px;"></i>
                        <h3 style="color: #4a5568; margin-bottom: 10px;">Drop audio file here</h3>
                        <p style="color: #6b7280;">or click to browse</p>
                        <p style="color: #9ca3af; font-size: 0.9rem; margin-top: 10px;">Supported: MP3, WAV, M4A, OGG (Max 100MB)</p>
                    </div>
                    <input type="file" id="audioFileInput" accept="audio/*" style="display: none;" onchange="handleFileUpload(event)">
                </div>

                <!-- Timeline Container -->
                <div class="timeline-container" id="timelineContainer">
                    <div class="timeline-header">
                        <h3 style="color: #4a5568; margin: 0;">
                            <i class="fas fa-clock"></i> Claim Timeline
                        </h3>
                        <button class="control-btn" onclick="toggleTimeline()" style="padding: 5px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="timelineContent">
                        <p style="text-align: center; color: #6b7280; font-style: italic;">Timeline will populate as claims are detected...</p>
                    </div>
                </div>

                <!-- Transcript Area -->
                <div class="transcript-container" id="transcriptContainer">
                    <div class="recording-status" id="recordingStatus">
                        RECORDING
                    </div>
                    <div class="speech-confidence" id="speechConfidence">
                        <span>Confidence:</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceFill"></div>
                        </div>
                        <span id="confidencePercent">0%</span>
                    </div>
                    <div class="transcript-header">
                        <h3 style="color: #4a5568; margin: 0;">
                            <i class="fas fa-file-alt"></i> Transcript
                        </h3>
                        <div class="transcript-info">
                            <div class="transcript-metric">
                                <i class="fas fa-font"></i>
                                <span id="wordCountDisplay">0</span> words
                            </div>
                            <div class="transcript-metric">
                                <i class="fas fa-clock"></i>
                                <span id="durationDisplay">00:00</span>
                            </div>
                            <div class="transcript-metric">
                                <i class="fas fa-chart-line"></i>
                                <span id="claimCountDisplay">0</span> claims
                            </div>
                        </div>
                    </div>
                    <div id="transcript" 
                         contenteditable="false" 
                         spellcheck="false"
                         data-placeholder="Your speech will appear here as you speak, or paste/type text to analyze..."></div>
                    
                    <div class="button-group">
                        <button id="startBtn" class="btn btn-primary" onclick="startRecording()">
                            <i class="fas fa-microphone"></i> Start Recording
                        </button>
                        <button id="stopBtn" class="btn btn-danger" onclick="stopRecording()" style="display: none;">
                            <i class="fas fa-stop"></i> Stop Recording
                        </button>
                        <button id="pauseBtn" class="btn btn-warning" onclick="pauseRecording()" style="display: none;">
                            <i class="fas fa-pause"></i> Pause
                        </button>
                        <button id="resumeBtn" class="btn btn-success" onclick="resumeRecording()" style="display: none;">
                            <i class="fas fa-play"></i> Resume
                        </button>
                        <button id="checkFactsBtn" class="btn btn-success" onclick="checkFacts()">
                            <i class="fas fa-search"></i> Check Facts
                        </button>
                        <button class="btn btn-secondary" onclick="clearAll()">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>
                    <div class="btn-group-hint" id="buttonHint">
                        <span id="hintText">Click "Start Recording" to begin capturing speech</span>
                    </div>
                </div>
            </div>

            <!-- Info Sections -->
            <div class="info-sections-grid">
                <div class="dropdown-section" id="how-it-works-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this)">
                        <div class="dropdown-header-content">
                            <i class="fas fa-info-circle"></i>
                            <div class="dropdown-header-text">
                                <span class="dropdown-title">How It Works</span>
                                <span class="dropdown-subtitle">4 simple steps</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        <div style="display: grid; gap: 15px;">
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <div style="background: #6366f1; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">1</div>
                                <div>
                                    <strong>Choose Your Input:</strong><br>
                                    <span style="color: #6b7280;">Record live speech, paste text, or load from various sources</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <div style="background: #6366f1; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">2</div>
                                <div>
                                    <strong>Speech Recognition:</strong><br>
                                    <span style="color: #6b7280;">AI converts speech to text in real-time with confidence scoring</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <div style="background: #6366f1; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">3</div>
                                <div>
                                    <strong>Claim Detection:</strong><br>
                                    <span style="color: #6b7280;">Identifies factual claims, statistics, and verifiable statements</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <div style="background: #6366f1; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">4</div>
                                <div>
                                    <strong>Verification:</strong><br>
                                    <span style="color: #6b7280;">Cross-references claims with multiple sources in real-time</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dropdown-section" id="sources-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this)">
                        <div class="dropdown-header-content">
                            <i class="fas fa-database"></i>
                            <div class="dropdown-header-text">
                                <span class="dropdown-title">Input Sources</span>
                                <span class="dropdown-subtitle">Multiple options</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div style="padding: 15px; background: rgba(16, 185, 129, 0.05); border-radius: 10px;">
                                <i class="fas fa-microphone" style="color: #10b981; font-size: 1.5rem; margin-bottom: 10px;"></i>
                                <h4 style="margin-bottom: 5px;">Live Recording</h4>
                                <p style="font-size: 0.9rem; color: #6b7280;">Real-time speech capture</p>
                            </div>
                            <div style="padding: 15px; background: rgba(16, 185, 129, 0.05); border-radius: 10px;">
                                <i class="fas fa-keyboard" style="color: #10b981; font-size: 1.5rem; margin-bottom: 10px;"></i>
                                <h4 style="margin-bottom: 5px;">Text Input</h4>
                                <p style="font-size: 0.9rem; color: #6b7280;">Paste or type content</p>
                            </div>
                            <div style="padding: 15px; background: rgba(16, 185, 129, 0.05); border-radius: 10px;">
                                <i class="fas fa-file-audio" style="color: #10b981; font-size: 1.5rem; margin-bottom: 10px;"></i>
                                <h4 style="margin-bottom: 5px;">Audio Files</h4>
                                <p style="font-size: 0.9rem; color: #6b7280;">Upload & analyze</p>
                            </div>
                            <div style="padding: 15px; background: rgba(16, 185, 129, 0.05); border-radius: 10px;">
                                <i class="fas fa-broadcast-tower" style="color: #10b981; font-size: 1.5rem; margin-bottom: 10px;"></i>
                                <h4 style="margin-bottom: 5px;">Live Streams</h4>
                                <p style="font-size: 0.9rem; color: #6b7280;">Real-time stream analysis</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dropdown-section" id="features-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this)">
                        <div class="dropdown-header-content">
                            <i class="fas fa-star"></i>
                            <div class="dropdown-header-text">
                                <span class="dropdown-title">AI-Powered Features</span>
                                <span class="dropdown-subtitle">12 verification methods</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(236, 72, 153, 0.1)); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #f59e0b; margin-bottom: 10px;">ðŸ¤– AI Technologies Used:</h4>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="margin-bottom: 8px;"><strong>AI Language Model:</strong> Advanced claim extraction & context understanding</li>
                                <li style="margin-bottom: 8px;"><strong>Neural Pattern Recognition:</strong> Identifies statistical claims & factual statements</li>
                                <li style="margin-bottom: 8px;"><strong>WebKit Speech Recognition:</strong> Real-time speech-to-text with confidence scoring</li>
                                <li><strong>Multi-Model Consensus:</strong> Cross-validates results for accuracy</li>
                            </ul>
                        </div>
                        <h4 style="margin-bottom: 15px; color: #4a5568;">Verification Methods:</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            <div style="padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 8px; font-size: 0.9rem;">
                                <i class="fas fa-database" style="color: #667eea;"></i> News Database Cross-Reference
                            </div>
                            <div style="padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 8px; font-size: 0.9rem;">
                                <i class="fas fa-brain" style="color: #667eea;"></i> AI Credibility Scoring
                            </div>
                            <div style="padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 8px; font-size: 0.9rem;">
                                <i class="fas fa-chart-line" style="color: #667eea;"></i> Statistical Validation
                            </div>
                            <div style="padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 8px; font-size: 0.9rem;">
                                <i class="fas fa-history" style="color: #667eea;"></i> Historical Data Comparison
                            </div>
                            <div style="padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 8px; font-size: 0.9rem;">
                                <i class="fas fa-globe" style="color: #667eea;"></i> Real-time Web Verification
                            </div>
                            <div style="padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 8px; font-size: 0.9rem;">
                                <i class="fas fa-balance-scale" style="color: #667eea;"></i> Bias Detection Algorithm
                            </div>
                            <div style="padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 8px; font-size: 0.9rem;">
                                <i class="fas fa-search" style="color: #667eea;"></i> Semantic Context Analysis
                            </div>
                            <div style="padding: 12px; background: rgba(102, 126, 234, 0.05); border-radius: 8px; font-size: 0.9rem;">
                                <i class="fas fa-shield-alt" style="color: #667eea;"></i> Misinformation Detection
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 10px;">
                            <p style="color: #059669; font-weight: 600; margin: 0;">
                                <i class="fas fa-info-circle"></i> Each claim is processed through multiple verification layers for maximum accuracy
                            </p>
                        </div>
                    </div>
                </div>

                <div class="dropdown-section" id="tips-section">
                    <div class="dropdown-header" onclick="toggleDropdown(this)">
                        <div class="dropdown-header-content">
                            <i class="fas fa-lightbulb"></i>
                            <div class="dropdown-header-text">
                                <span class="dropdown-title">Best Practices</span>
                                <span class="dropdown-subtitle">Get better results</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-content">
                        <div style="background: rgba(236, 72, 153, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                            <h4 style="color: #ec4899; margin-bottom: 15px;">For Best Results:</h4>
                            <ul style="color: #6b7280; margin-left: 20px;">
                                <li>Speak clearly and at a moderate pace</li>
                                <li>Use Chrome or Edge browsers for best speech recognition</li>
                                <li>Ensure good microphone quality and minimal background noise</li>
                                <li>For text input, include full context of claims</li>
                                <li>Wait for fact-checking to complete before adding more content</li>
                            </ul>
                        </div>
                        <div style="background: rgba(102, 126, 234, 0.05); padding: 20px; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 15px;">Keyboard Shortcuts:</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                <div><kbd>Space</kbd> Start/Stop Recording</div>
                                <div><kbd>P</kbd> Pause/Resume</div>
                                <div><kbd>C</kbd> Check Facts</div>
                                <div><kbd>R</kbd> Clear All</div>
                                <div><kbd>L</kbd> Live Panel</div>
                                <div><kbd>T</kbd> Timeline</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-grid" id="resultsSection" style="display: none;">
                <!-- Statistics -->
                <div class="stats-card">
                    <h3 style="margin-bottom: 20px; color: #4a5568;">
                        <i class="fas fa-chart-bar"></i> Statistics
                    </h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="wordCount">0</div>
                            <div class="stat-label">Words</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="claimsCount">0</div>
                            <div class="stat-label">Claims Checked</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="trueCount">0</div>
                            <div class="stat-label">True</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="falseCount">0</div>
                            <div class="stat-label">False</div>
                        </div>
                    </div>
                    <div class="claim-density">
                        <div class="density-label">Claim Density (claims per 100 words)</div>
                        <div class="density-bar">
                            <div class="density-fill" id="densityFill"></div>
                        </div>
                    </div>
                </div>

                <!-- Fact Check Results -->
                <div class="fact-check-card">
                    <h3 style="margin-bottom: 20px; color: #4a5568;">
                        <i class="fas fa-check-circle"></i> Fact Check Results
                    </h3>
                    <div class="filter-controls">
                        <button class="filter-btn active" onclick="filterResults('all')">All</button>
                        <button class="filter-btn" onclick="filterResults('true')">True</button>
                        <button class="filter-btn" onclick="filterResults('false')">False</button>
                        <button class="filter-btn" onclick="filterResults('unverified')">Unverified</button>
                        <button class="filter-btn" onclick="filterResults('flagged')">Flagged</button>
                    </div>
                    <div id="factCheckResults">
                        <p style="text-align: center; color: #6b7280;">
                            <span class="loading-spinner"></span> Analyzing claims...
                        </p>
                    </div>
                </div>

                <!-- Summary -->
                <div class="summary-card" id="summaryCard" style="display: none;">
                    <h3 style="margin-bottom: 20px; color: #4a5568;">
                        <i class="fas fa-clipboard-check"></i> Summary Report
                    </h3>
                    <div class="accuracy-gauge">
                        <svg class="gauge-circle" viewBox="0 0 150 150">
                            <defs>
                                <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#ef4444" />
                                    <stop offset="50%" style="stop-color:#f59e0b" />
                                    <stop offset="100%" style="stop-color:#10b981" />
                                </linearGradient>
                            </defs>
                            <circle cx="75" cy="75" r="70" class="gauge-bg" />
                            <circle cx="75" cy="75" r="70" class="gauge-fill" id="gaugeFill" />
                        </svg>
                        <div class="gauge-text">
                            <div class="gauge-number" id="accuracyPercent">0</div>
                            <div class="gauge-label">% Accuracy</div>
                        </div>
                    </div>
                    <div class="export-options">
                        <button class="btn btn-primary" onclick="downloadReport('txt')">
                            <i class="fas fa-file-alt"></i> Download TXT
                        </button>
                        <button class="btn btn-primary" onclick="downloadReport('pdf')">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </button>
                        <button class="btn btn-primary" onclick="downloadReport('json')">
                            <i class="fas fa-code"></i> Download JSON
                        </button>
                        <button class="btn btn-primary" onclick="downloadReport('csv')">
                            <i class="fas fa-file-csv"></i> Download CSV
                        </button>
                        <button class="btn btn-secondary" onclick="shareReport()">
                            <i class="fas fa-share"></i> Share Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div class="processing-overlay" id="processingOverlay">
        <div class="processing-content">
            <div class="ai-animation"></div>
            <h3>AI Processing Your Speech...</h3>
            <p style="color: #6b7280; margin-bottom: 10px;">Running 12 verification algorithms</p>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <script>
        // Header Navigation Functions
        window.ffNav = {
            checkAuthStatus: async function() {
                try {
                    // Skip auth check if running locally or in preview
                    if (window.location.protocol === 'file:' || window.location.hostname === 'localhost' || !window.location.hostname) {
                        return;
                    }
                    
                    const response = await fetch('/api/user/status');
                    if (!response.ok) {
                        return;
                    }
                    
                    const data = await response.json();
                    
                    if (data.authenticated) {
                        document.getElementById('ffNavAuth').style.display = 'none';
                        document.getElementById('ffUserMenu').style.display = 'block';
                        
                        document.getElementById('ffUserEmail').textContent = data.email || 'User';
                        document.getElementById('ffUserEmailDropdown').textContent = data.email || 'User';
                        document.getElementById('ffUserPlan').textContent = data.plan === 'pro' ? 'Pro Plan' : 'Free Plan';
                        
                        const usagePercent = (data.usage_today / data.daily_limit) * 100;
                        document.getElementById('ffUsageProgress').style.width = usagePercent + '%';
                        document.getElementById('ffUsageText').textContent = `${data.usage_today} / ${data.daily_limit} analyses used`;
                    }
                } catch (error) {
                    // Silently fail in preview mode
                    return;
                }
            },
            
            init: function() {
                this.checkAuthStatus();
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(event) {
                    const userMenu = document.querySelector('.ff-user-menu');
                    if (userMenu && !userMenu.contains(event.target)) {
                        document.getElementById('ffUserDropdown').classList.remove('active');
                    }
                });
                
                // Add active class to current page
                const currentPath = window.location.pathname;
                document.querySelectorAll('.ff-nav-link').forEach(link => {
                    if (link.getAttribute('href') === currentPath) {
                        link.classList.add('active');
                    }
                });
            }
        };

        // Global functions for onclick handlers
        function ffToggleMobileMenu() {
            const navLinks = document.getElementById('ffNavLinks');
            navLinks.classList.toggle('active');
        }

        function ffToggleUserDropdown() {
            const dropdown = document.getElementById('ffUserDropdown');
            dropdown.classList.toggle('active');
        }

        async function ffLogout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.href = '/';
            } catch (error) {
                console.error('Logout failed:', error);
            }
        }

        // Speech Fact-Checker Enhanced Functions
        let recognition;
        let isRecording = false;
        let isPaused = false;
        let factCheckResults = [];
        let selectedSource = 'microphone';
        let currentLanguage = 'en-US';
        let startTime = null;
        let duration = 0;
        let durationInterval = null;
        let claims = [];
        let timeline = [];
        let liveCheckInterval = null;
        let flaggedClaims = new Set();
        let currentFilter = 'all';
        let audioContext = null;
        let analyser = null;
        let microphone = null;
        let animationFrame = null;
        
        // Initialize speech recognition with enhanced features
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = currentLanguage;
                recognition.maxAlternatives = 3;
                
                let finalTranscript = '';
                let lastResultIndex = 0;
                
                recognition.onstart = () => {
                    isRecording = true;
                    startTime = Date.now();
                    document.getElementById('startBtn').style.display = 'none';
                    document.getElementById('stopBtn').style.display = 'inline-flex';
                    document.getElementById('pauseBtn').style.display = 'inline-flex';
                    document.getElementById('transcriptContainer').classList.add('recording-mode');
                    document.getElementById('recordingStatus').classList.add('active');
                    document.getElementById('audioVisualizer').classList.add('active');
                    document.getElementById('speechConfidence').classList.add('active');
                    document.getElementById('hintText').textContent = 'Recording in progress... Speak clearly into your microphone';
                    
                    // Show real-time counter
                    document.getElementById('realtimeCounter').classList.add('active');
                    
                    // Start audio visualization
                    startAudioVisualization();
                    
                    // Start duration timer
                    durationInterval = setInterval(updateDuration, 1000);
                    
                    // Start live fact-checking
                    if (document.getElementById('livePanel').classList.contains('active')) {
                        startLiveFactChecking();
                    }
                };
                
                recognition.onend = () => {
                    isRecording = false;
                    document.getElementById('startBtn').style.display = 'inline-flex';
                    document.getElementById('stopBtn').style.display = 'none';
                    document.getElementById('pauseBtn').style.display = 'none';
                    document.getElementById('resumeBtn').style.display = 'none';
                    document.getElementById('transcriptContainer').classList.remove('recording-mode');
                    document.getElementById('recordingStatus').classList.remove('active');
                    document.getElementById('audioVisualizer').classList.remove('active');
                    document.getElementById('speechConfidence').classList.remove('active');
                    document.getElementById('hintText').textContent = 'Recording stopped. Click "Check Facts" to analyze';
                    
                    // Stop audio visualization
                    stopAudioVisualization();
                    
                    // Stop timers
                    if (durationInterval) {
                        clearInterval(durationInterval);
                        durationInterval = null;
                    }
                    if (liveCheckInterval) {
                        clearInterval(liveCheckInterval);
                        liveCheckInterval = null;
                    }
                };
                
                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let confidenceSum = 0;
                    let confidenceCount = 0;
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const result = event.results[i];
                        if (result.isFinal) {
                            finalTranscript += result[0].transcript + ' ';
                            
                            // Add to timeline
                            const timestamp = formatDuration(duration);
                            timeline.push({
                                time: timestamp,
                                text: result[0].transcript,
                                confidence: result[0].confidence
                            });
                            
                            // Check for claims in real-time
                            detectClaimsInText(result[0].transcript);
                        } else {
                            interimTranscript += result[0].transcript;
                        }
                        
                        // Calculate average confidence
                        if (result[0].confidence) {
                            confidenceSum += result[0].confidence;
                            confidenceCount++;
                        }
                    }
                    
                    // Update transcript with highlighted claims
                    const transcript = document.getElementById('transcript');
                    transcript.innerHTML = highlightClaimsInTranscript(finalTranscript + interimTranscript);
                    
                    // Update confidence indicator
                    if (confidenceCount > 0) {
                        const avgConfidence = (confidenceSum / confidenceCount) * 100;
                        updateConfidenceIndicator(avgConfidence);
                    }
                    
                    updateWordCount();
                    updateClaimCount();
                };
                
                recognition.onerror = (event) => {
                    if (event.error === 'no-speech') {
                        // Ignore no-speech errors
                        return;
                    }
                    console.error('Speech recognition error:', event.error);
                    if (event.error === 'not-allowed') {
                        alert('Microphone access denied. Please allow microphone access in your browser settings.');
                    } else {
                        alert('Speech recognition error: ' + event.error);
                    }
                };
            } else {
                alert('Speech recognition is not supported in your browser. Please use Chrome or Edge.');
            }
        }

        // Start audio visualization
        function startAudioVisualization() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        microphone = audioContext.createMediaStreamSource(stream);
                        microphone.connect(analyser);
                        visualize();
                    })
                    .catch(err => console.error('Error accessing microphone for visualization:', err));
            }
        }

        // Stop audio visualization
        function stopAudioVisualization() {
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
                animationFrame = null;
            }
            if (microphone) {
                microphone.disconnect();
                microphone = null;
            }
        }

        // Visualize audio
        function visualize() {
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            function draw() {
                animationFrame = requestAnimationFrame(draw);
                analyser.getByteFrequencyData(dataArray);
                
                const bars = document.querySelectorAll('.audio-bar');
                bars.forEach((bar, index) => {
                    const barIndex = Math.floor((index / bars.length) * bufferLength);
                    const height = Math.max(10, (dataArray[barIndex] / 255) * 40);
                    bar.style.height = height + 'px';
                });
            }
            
            draw();
        }

        // Enhanced claim detection
        function detectClaimsInText(text) {
            const patterns = [
                /\d+\.?\d*\s*(percent|%)/gi,
                /\d+\.?\d*\s*(million|billion|trillion)/gi,
                /(is|are|was|were)\s+(now\s+)?\d+/gi,
                /currently\s+stands?\s+at/gi,
                /increased\s+by\s+\d+/gi,
                /decreased\s+by\s+\d+/gi,
                /has\s+(now\s+)?exceeded\s+\d+/gi,
                /remains?\s+at\s+\d+/gi,
                /account\s+for\s+(over\s+)?\d+/gi,
                /since\s+\d{4}/gi,
                /in\s+\d{4}/gi,
                /historic\s+(low|high)/gi,
                /unchanged\s+since/gi,
                /according\s+to\s+[\w\s]+/gi,
                /studies?\s+show/gi,
                /research\s+indicates?/gi,
                /experts?\s+say/gi,
                /data\s+(shows?|reveals?|suggests?)/gi,
                /statistics\s+(show|indicate)/gi,
                /survey\s+(found|showed|revealed)/gi
            ];
            
            let newClaimsCount = 0;
            patterns.forEach(pattern => {
                const matches = text.match(pattern);
                if (matches) {
                    matches.forEach(match => {
                        // Check if claim already exists
                        const existingClaim = claims.find(c => c.text === match);
                        if (!existingClaim) {
                            const claim = {
                                id: Date.now() + Math.random(),
                                text: match,
                                context: text,
                                timestamp: formatDuration(duration),
                                status: 'detected'
                            };
                            claims.push(claim);
                            newClaimsCount++;
                            
                            // Add to live panel if active
                            if (document.getElementById('livePanel').classList.contains('active')) {
                                addToLivePanel(claim);
                            }
                        }
                    });
                }
            });
            
            // Animate claim counter if new claims detected
            if (newClaimsCount > 0 && isRecording) {
                animateClaimCounter();
            }
        }

        // Animate claim counter
        function animateClaimCounter() {
            const counter = document.getElementById('liveClaimCount');
            const spinner = document.getElementById('counterSpinner');
            
            spinner.style.display = 'inline-block';
            counter.style.transform = 'scale(1.2)';
            counter.style.color = '#667eea';
            
            setTimeout(() => {
                spinner.style.display = 'none';
                counter.style.transform = 'scale(1)';
                counter.style.color = '';
            }, 500);
        }

        // Highlight claims in transcript
        function highlightClaimsInTranscript(text) {
            let highlightedText = text;
            claims.forEach(claim => {
                const regex = new RegExp(`(${escapeRegex(claim.text)})`, 'gi');
                const confidence = claim.confidence ? Math.round(claim.confidence * 100) + '% confidence' : 'Pending verification';
                highlightedText = highlightedText.replace(
                    regex, 
                    `<span class="claim-highlight ${claim.verdict || ''}" data-claim-id="${claim.id}" data-confidence="${confidence}">$1</span>`
                );
            });
            return highlightedText;
        }

        // Add claim to live panel
        function addToLivePanel(claim) {
            const liveClaims = document.getElementById('liveClaims');
            if (liveClaims.querySelector('p')) {
                liveClaims.innerHTML = '';
            }
            
            const claimElement = document.createElement('div');
            claimElement.className = 'live-claim-item checking';
            claimElement.dataset.claimId = claim.id;
            claimElement.innerHTML = `
                <div class="live-claim-text">${claim.text}</div>
                <div class="live-claim-status">
                    <span class="loading-spinner" style="width: 12px; height: 12px;"></span>
                    Checking...
                </div>
            `;
            liveClaims.appendChild(claimElement);
            
            // Start checking this claim
            setTimeout(() => checkSingleClaim(claim), 1000);
        }

        // Check single claim
        async function checkSingleClaim(claim) {
            try {
                // Mock response for preview mode
                if (window.location.protocol === 'file:' || window.location.hostname === 'localhost' || !window.location.hostname) {
                    // Simulate API delay
                    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
                    
                    // Generate mock result
                    const mockVerdicts = ['true', 'false', 'unverified'];
                    const mockVerdict = mockVerdicts[Math.floor(Math.random() * mockVerdicts.length)];
                    const mockConfidence = 0.6 + Math.random() * 0.4;
                    
                    const result = {
                        verdict: mockVerdict,
                        confidence: mockConfidence,
                        sources: ['News Database', 'Fact-Check API', 'Government Data'],
                        credibility_score: Math.floor(70 + Math.random() * 30),
                        bias: Math.random() > 0.7 ? 'Slight political bias detected' : null
                    };
                    
                    // Update claim object
                    if (claim.id) {
                        Object.assign(claim, result);
                    }
                    
                    // Update UI elements
                    updateClaimUI(claim, result);
                    return result;
                }
                
                // Real API call
                const response = await fetch('/api/batch-factcheck', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        claims: [claim.text || claim],
                        priority: 'balanced'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Fact-check request failed');
                }
                
                const data = await response.json();
                if (data.success && data.results && data.results.length > 0) {
                    const result = data.results[0];
                    
                    // Update claim object if it exists
                    if (claim.id) {
                        Object.assign(claim, result);
                    }
                    
                    // Update UI elements
                    updateClaimUI(claim, result);
                    return result;
                }
            } catch (error) {
                console.error('Error checking claim:', error);
                // Return a default result on error
                return {
                    verdict: 'unverified',
                    confidence: 0.5,
                    sources: ['Error during verification'],
                    error: true
                };
            }
        }
        
        // Update claim UI elements
        function updateClaimUI(claim, result) {
            // Update live panel
            const claimElement = document.querySelector(`[data-claim-id="${claim.id}"]`);
            if (claimElement) {
                claimElement.classList.remove('checking');
                claimElement.classList.add(result.verdict);
                
                const statusElement = claimElement.querySelector('.live-claim-status');
                if (statusElement) {
                    const icon = result.verdict === 'true' ? 'âœ“' : result.verdict === 'false' ? 'âœ—' : '?';
                    const verdictText = result.verdict.charAt(0).toUpperCase() + result.verdict.slice(1);
                    statusElement.innerHTML = `${icon} ${verdictText} (${Math.round(result.confidence * 100)}%)`;
                }
            }
            
            // Update transcript highlight
            const transcript = document.getElementById('transcript');
            transcript.innerHTML = highlightClaimsInTranscript(transcript.textContent);
        }

        // Update confidence indicator
        function updateConfidenceIndicator(confidence) {
            document.getElementById('confidenceFill').style.width = confidence + '%';
            document.getElementById('confidencePercent').textContent = Math.round(confidence) + '%';
        }

        // Update duration display
        function updateDuration() {
            duration++;
            document.getElementById('durationDisplay').textContent = formatDuration(duration);
        }

        // Format duration
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Escape regex special characters
        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\                <a href="/speech" class="ff-nav-link active"><i class="fas fa-microphone">');
        }

        // Toggle live panel
        function toggleLivePanel() {
            const panel = document.getElementById('livePanel');
            const toggleBtn = document.getElementById('livePanelToggle');
            
            panel.classList.toggle('active');
            toggleBtn.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                toggleBtn.querySelector('.toggle-text').textContent = 'Disable';
                toggleBtn.querySelector('i').className = 'fas fa-toggle-on';
                
                if (isRecording) {
                    startLiveFactChecking();
                }
            } else {
                toggleBtn.querySelector('.toggle-text').textContent = 'Enable';
                toggleBtn.querySelector('i').className = 'fas fa-toggle-off';
                
                if (liveCheckInterval) {
                    clearInterval(liveCheckInterval);
                    liveCheckInterval = null;
                }
            }
        }

        // Start live fact-checking
        function startLiveFactChecking() {
            if (liveCheckInterval) clearInterval(liveCheckInterval);
            
            liveCheckInterval = setInterval(() => {
                // Check for new unchecked claims
                const uncheckedClaims = claims.filter(c => c.status === 'detected');
                uncheckedClaims.forEach(claim => {
                    claim.status = 'checking';
                    checkSingleClaim(claim);
                });
            }, 5000); // Check every 5 seconds
        }

        // Toggle timeline
        function toggleTimeline() {
            const container = document.getElementById('timelineContainer');
            const toggleBtn = document.getElementById('timelineToggle');
            
            container.classList.toggle('active');
            toggleBtn.classList.toggle('active');
            
            if (container.classList.contains('active')) {
                toggleBtn.querySelector('.toggle-text').textContent = 'Disable';
                toggleBtn.querySelector('i').className = 'fas fa-toggle-on';
                updateTimeline();
            } else {
                toggleBtn.querySelector('.toggle-text').textContent = 'Enable';
                toggleBtn.querySelector('i').className = 'fas fa-toggle-off';
            }
        }

        // Update timeline
        function updateTimeline() {
            const content = document.getElementById('timelineContent');
            if (timeline.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #6b7280; font-style: italic;">Timeline will populate as claims are detected...</p>';
                return;
            }
            
            let html = '';
            timeline.forEach((item, index) => {
                html += `
                    <div class="timeline-item" onclick="jumpToTime(${index})">
                        <div class="timeline-time">${item.time}</div>
                        <div class="timeline-content">
                            <div class="timeline-claim">${item.text}</div>
                            <div class="timeline-status">Confidence: ${Math.round(item.confidence * 100)}%</div>
                        </div>
                    </div>
                `;
            });
            content.innerHTML = html;
        }

        // Jump to timeline position
        function jumpToTime(index) {
            const item = timeline[index];
            // Scroll to the claim in transcript
            const transcript = document.getElementById('transcript');
            const text = item.text;
            // Implementation would highlight and scroll to the specific text
            alert(`Jump to: ${item.time} - ${text}`);
        }

        // Change language
        function changeLanguage() {
            currentLanguage = document.getElementById('languageSelect').value;
            if (recognition) {
                recognition.lang = currentLanguage;
            }
        }

        // Toggle dropdown
        function toggleDropdown(header) {
            const content = header.nextElementSibling;
            header.classList.toggle('open');
            content.classList.toggle('open');
        }

        // Select source
        function selectSource(source) {
            selectedSource = source;
            
            // Update tabs
            document.querySelectorAll('.compact-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-mode="${source}"]`).classList.add('active');
            
            // Hide all input sections
            document.getElementById('urlInputSection').style.display = 'none';
            document.getElementById('fileUploadSection').style.display = 'none';
            
            // Update UI elements
            const modeBanner = document.getElementById('modeBanner');
            const modeIcon = document.getElementById('modeIcon');
            const modeText = document.getElementById('modeText');
            const instructionsList = document.getElementById('instructionsList');
            const modeNameInstructions = document.getElementById('modeNameInstructions');
            const startBtn = document.getElementById('startBtn');
            const transcript = document.getElementById('transcript');
            const hintText = document.getElementById('hintText');
            
            if (source === 'microphone') {
                modeIcon.className = 'fas fa-microphone';
                modeText.textContent = 'Live Recording Mode - Ready to record your speech';
                modeNameInstructions.textContent = 'Live Recording';
                startBtn.style.display = 'inline-flex';
                transcript.setAttribute('data-placeholder', 'Your speech will appear here as you speak...');
                transcript.contentEditable = 'false';
                hintText.textContent = 'Click "Start Recording" to begin capturing speech';
                modeBanner.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                
                instructionsList.innerHTML = `
                    <div class="instruction-item">
                        <div class="instruction-number">1</div>
                        <div>
                            <strong>Start Recording:</strong> Click the "Start Recording" button below (microphone access required)
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">2</div>
                        <div>
                            <strong>Speak Clearly:</strong> Your words will appear in real-time with confidence scoring
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">3</div>
                        <div>
                            <strong>Live Fact-Check:</strong> Enable live panel to see claims verified as you speak
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">4</div>
                        <div>
                            <strong>Review Results:</strong> Check comprehensive analysis after recording
                        </div>
                    </div>
                `;
            } else if (source === 'text') {
                modeIcon.className = 'fas fa-keyboard';
                modeText.textContent = 'Text Input Mode - Type or paste your text';
                modeNameInstructions.textContent = 'Text Input';
                startBtn.style.display = 'none';
                transcript.setAttribute('data-placeholder', 'Type or paste your text here...');
                transcript.contentEditable = 'true';
                transcript.focus();
                hintText.textContent = 'Type or paste text, then click "Check Facts" to analyze';
                modeBanner.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
                
                instructionsList.innerHTML = `
                    <div class="instruction-item">
                        <div class="instruction-number">1</div>
                        <div>
                            <strong>Enter Text:</strong> Click in the transcript box below
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">2</div>
                        <div>
                            <strong>Type or Paste:</strong> Enter your text manually or paste from clipboard (Ctrl+V)
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">3</div>
                        <div>
                            <strong>Auto-Analysis:</strong> For pasted text, fact-checking starts automatically
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">4</div>
                        <div>
                            <strong>Manual Check:</strong> Or click "Check Facts" when ready to analyze
                        </div>
                    </div>
                `;
            } else if (source === 'audio') {
                modeIcon.className = 'fas fa-file-audio';
                modeText.textContent = 'Audio File Mode - Upload and analyze audio';
                modeNameInstructions.textContent = 'Audio File';
                startBtn.style.display = 'none';
                transcript.contentEditable = 'false';
                hintText.textContent = 'Upload an audio file to analyze';
                modeBanner.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
                document.getElementById('fileUploadSection').style.display = 'block';
                
                instructionsList.innerHTML = `
                    <div class="instruction-item">
                        <div class="instruction-number">1</div>
                        <div>
                            <strong>Select File:</strong> Click the upload area or drag & drop audio file
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">2</div>
                        <div>
                            <strong>Processing:</strong> AI transcribes audio to text automatically
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">3</div>
                        <div>
                            <strong>Analysis:</strong> Claims are extracted and fact-checked
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">4</div>
                        <div>
                            <strong>Results:</strong> View detailed report with timestamps
                        </div>
                    </div>
                `;
            } else if (source === 'stream') {
                modeIcon.className = 'fas fa-broadcast-tower';
                modeText.textContent = 'Live Stream Mode - Analyze streaming content';
                modeNameInstructions.textContent = 'Live Stream';
                startBtn.style.display = 'none';
                transcript.contentEditable = 'false';
                hintText.textContent = 'Enter stream URL above and click "Load"';
                modeBanner.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                document.getElementById('urlInputSection').style.display = 'block';
                document.getElementById('urlInput').placeholder = 'Enter live stream URL...';
                
                instructionsList.innerHTML = `
                    <div class="instruction-item">
                        <div class="instruction-number">1</div>
                        <div>
                            <strong>Stream URL:</strong> Enter the URL of a live stream
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">2</div>
                        <div>
                            <strong>Connect:</strong> Click "Load" to connect to stream
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">3</div>
                        <div>
                            <strong>Real-time:</strong> Facts are checked as stream progresses
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">4</div>
                        <div>
                            <strong>Live Updates:</strong> Results update continuously
                        </div>
                    </div>
                `;
            } else if (source === 'demo') {
                modeIcon.className = 'fas fa-play-circle';
                modeText.textContent = 'Demo Mode - Sample speech loaded';
                modeNameInstructions.textContent = 'Demo';
                startBtn.style.display = 'none';
                transcript.contentEditable = 'false';
                hintText.textContent = 'Demo text loaded. Click "Check Facts" to see results';
                modeBanner.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                
                instructionsList.innerHTML = `
                    <div class="instruction-item">
                        <div class="instruction-number">âœ¨</div>
                        <div>
                            <strong>Demo Loaded:</strong> Sample speech with factual claims has been loaded
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">ðŸ‘€</div>
                        <div>
                            <strong>Review Text:</strong> See the example speech in the transcript box
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">ðŸš€</div>
                        <div>
                            <strong>Run Analysis:</strong> Click "Check Facts" to see how verification works
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">ðŸ’¡</div>
                        <div>
                            <strong>Try Your Own:</strong> Switch to Recording or Text mode for custom content
                        </div>
                    </div>
                `;
                
                loadDemo();
            }
        }

        // Start recording
        function startRecording() {
            if (!recognition) initSpeechRecognition();
            if (recognition) {
                recognition.start();
            }
        }

        // Stop recording
        function stopRecording() {
            if (recognition) recognition.stop();
        }

        // Pause recording
        function pauseRecording() {
            if (recognition && isRecording) {
                isPaused = true;
                recognition.stop();
                document.getElementById('pauseBtn').style.display = 'none';
                document.getElementById('resumeBtn').style.display = 'inline-flex';
                document.getElementById('hintText').textContent = 'Recording paused. Click "Resume" to continue';
            }
        }

        // Resume recording
        function resumeRecording() {
            if (recognition && isPaused) {
                isPaused = false;
                recognition.start();
                document.getElementById('pauseBtn').style.display = 'inline-flex';
                document.getElementById('resumeBtn').style.display = 'none';
                document.getElementById('hintText').textContent = 'Recording resumed...';
            }
        }

        // Load from URL
        async function loadFromURL() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                alert('Please enter a URL');
                return;
            }
            
            // Show processing overlay
            document.getElementById('processingOverlay').style.display = 'flex';
            
            try {
                // Check if it's a YouTube URL
                if (url.includes('youtube.com') || url.includes('youtu.be')) {
                    // Call the YouTube transcript API
                    const response = await fetch('/api/youtube-transcript', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            url: url,
                            language: currentLanguage 
                        })
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Failed to fetch transcript');
                    }
                    
                    const data = await response.json();
                    
                    // Update transcript with YouTube content
                    document.getElementById('transcript').textContent = data.transcript;
                    updateWordCount();
                    
                    // Extract claims from the transcript
                    detectClaimsInText(data.transcript);
                    updateClaimCount();
                    
                    // Hide processing overlay
                    document.getElementById('processingOverlay').style.display = 'none';
                    
                    // Show success message with video info
                    alert(`YouTube transcript loaded successfully!\n\nVideo: ${data.video_url}\nLanguage: ${data.language}\nWord count: ${data.word_count}\nDuration: ~${Math.floor(data.duration_estimate / 60)} minutes`);
                    
                    // Update hint text
                    document.getElementById('hintText').textContent = 'YouTube transcript loaded. Click "Check Facts" to analyze';
                    
                } else {
                    // Handle other stream URLs
                    const response = await fetch('/api/stream-transcript', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ stream_url: url })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        document.getElementById('processingOverlay').style.display = 'none';
                        alert('Stream processing started. Real-time transcription will begin shortly.');
                    } else {
                        throw new Error(data.error || 'Failed to process stream');
                    }
                }
            } catch (error) {
                console.error('Load URL error:', error);
                document.getElementById('processingOverlay').style.display = 'none';
                
                // Provide helpful error messages
                let errorMessage = 'Failed to load content. ';
                if (error.message.includes('No transcript')) {
                    errorMessage = 'No transcript available for this video. The video may not have captions enabled.';
                } else if (error.message.includes('Invalid YouTube URL')) {
                    errorMessage = 'Invalid YouTube URL. Please enter a valid YouTube video URL.';
                } else if (error.message.includes('disabled')) {
                    errorMessage = 'Transcripts are disabled for this video by the video owner.';
                } else if (error.message.includes('unavailable')) {
                    errorMessage = 'Video is unavailable. It may be private, deleted, or region-restricted.';
                } else if (error.message.includes('404')) {
                    errorMessage = 'Service not found. Please ensure the server is running.';
                } else if (error.message.includes('network')) {
                    errorMessage = 'Network error. Please check your connection.';
                } else {
                    errorMessage += error.message || 'Please try again.';
                }
                
                alert(errorMessage);
            }
        }

        // Trigger file upload
        function triggerFileUpload() {
            document.getElementById('audioFileInput').click();
        }

        // Handle file upload
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size
            if (file.size > 100 * 1024 * 1024) {
                alert('File size exceeds 100MB limit');
                return;
            }
            
            // Check file type
            const allowedTypes = ['audio/mp3', 'audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/m4a', 'audio/x-m4a'];
            if (!allowedTypes.includes(file.type) && !file.name.match(/\.(mp3|wav|ogg|m4a)$/i)) {
                alert('Please upload a valid audio file (MP3, WAV, OGG, or M4A)');
                return;
            }
            
            // Show processing
            document.getElementById('processingOverlay').style.display = 'flex';
            
            try {
                // Create FormData for file upload
                const formData = new FormData();
                formData.append('audio', file);
                formData.append('language', currentLanguage);
                
                // Upload and process audio file
                const response = await fetch('/api/speech-to-text', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to process audio');
                }
                
                const data = await response.json();
                
                // Hide processing overlay
                document.getElementById('processingOverlay').style.display = 'none';
                
                // Update transcript
                document.getElementById('transcript').textContent = data.transcript;
                updateWordCount();
                
                // Extract claims
                detectClaimsInText(data.transcript);
                updateClaimCount();
                
                // Show success message
                alert(`Audio file "${file.name}" processed successfully!\n\nConfidence: ${Math.round((data.confidence || 0.9) * 100)}%\nLanguage: ${data.language || currentLanguage}`);
                
                // Update hint text
                document.getElementById('hintText').textContent = 'Audio transcribed. Click "Check Facts" to analyze';
                
            } catch (error) {
                console.error('Audio processing error:', error);
                document.getElementById('processingOverlay').style.display = 'none';
                
                let errorMessage = 'Failed to process audio file. ';
                if (error.message.includes('understand')) {
                    errorMessage = 'Could not understand the audio. Please ensure the audio is clear and in the selected language.';
                } else if (error.message.includes('Invalid file')) {
                    errorMessage = 'Invalid audio file format. Please use MP3, WAV, OGG, or M4A.';
                } else {
                    errorMessage += error.message || 'Please try again with a different file.';
                }
                
                alert(errorMessage);
            }
        }

        // Handle file drag and drop
        const fileUploadZone = document.getElementById('fileUploadZone');
        
        fileUploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadZone.classList.add('dragover');
        });
        
        fileUploadZone.addEventListener('dragleave', () => {
            fileUploadZone.classList.remove('dragover');
        });
        
        fileUploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('audioFileInput').files = files;
                handleFileUpload({ target: { files: [files[0]] } });
            }
        });

        // Check facts with enhanced features
        async function checkFacts() {
            const text = document.getElementById('transcript').textContent;
            if (!text.trim()) {
                alert('Please enter or record some text to fact-check');
                return;
            }
            
            // Show processing overlay
            document.getElementById('processingOverlay').style.display = 'flex';
            
            // Show results section
            document.getElementById('resultsSection').style.display = 'grid';
            
            // Extract claims
            const claimsToCheck = extractClaims(text);
            
            // Update word count in results
            const words = text.trim().split(/\s+/).filter(w => w.length > 0);
            document.getElementById('wordCount').textContent = words.length;
            
            if (claimsToCheck.length === 0) {
                document.getElementById('processingOverlay').style.display = 'none';
                document.getElementById('factCheckResults').innerHTML = 
                    '<p style="text-align: center; color: #6b7280;">No factual claims detected in the text.</p>';
                return;
            }
            
            try {
                let results;
                
                // Mock response for preview mode
                if (window.location.protocol === 'file:' || window.location.hostname === 'localhost' || !window.location.hostname) {
                    // Simulate processing delay
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Generate mock results
                    results = claimsToCheck.map(claim => {
                        const verdicts = ['true', 'false', 'unverified'];
                        const verdict = verdicts[Math.floor(Math.random() * verdicts.length)];
                        return {
                            claim: claim,
                            verdict: verdict,
                            confidence: 0.6 + Math.random() * 0.4,
                            sources: [
                                { source: 'News Database' },
                                { source: 'Fact-Check API' },
                                { source: 'Government Data' }
                            ],
                            credibility_score: Math.floor(70 + Math.random() * 30),
                            bias: Math.random() > 0.7 ? 'Slight political bias detected' : null
                        };
                    });
                } else {
                    // Real API call
                    const response = await fetch('/api/batch-factcheck', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ claims: claimsToCheck })
                    });
                    
                    const data = await response.json();
                    results = data.results;
                }
                
                // Hide processing overlay
                setTimeout(() => {
                    document.getElementById('processingOverlay').style.display = 'none';
                    
                    if (results) {
                        displayResults(results);
                    }
                }, 1500); // Show processing for at least 1.5 seconds for effect
                
            } catch (error) {
                console.error('Fact-checking error:', error);
                document.getElementById('processingOverlay').style.display = 'none';
                document.getElementById('factCheckResults').innerHTML = 
                    '<p style="color: #ef4444;">Error during fact-checking. Please try again.</p>';
            }
        }

        // Extract claims
        function extractClaims(text) {
            const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
            const extractedClaims = [];
            
            const patterns = [
                /\d+\.?\d*\s*(percent|%)/i,
                /\d+\.?\d*\s*(million|billion|trillion)/i,
                /(is|are|was|were)\s+(now\s+)?\d+/i,
                /currently\s+stands?\s+at/i,
                /increased\s+by\s+\d+/i,
                /decreased\s+by\s+\d+/i,
                /has\s+(now\s+)?exceeded\s+\d+/i,
                /remains?\s+at\s+\d+/i,
                /account\s+for\s+(over\s+)?\d+/i,
                /since\s+\d{4}/i,
                /in\s+\d{4}/i,
                /historic\s+(low|high)/i,
                /unchanged\s+since/i,
                /record\s+(high|low|number|amount)/i,
                /highest\s+since/i,
                /lowest\s+since/i,
                /first\s+time\s+in/i,
                /never\s+before/i,
                /all-time\s+(high|low)/i
            ];
            
            sentences.forEach(sentence => {
                const trimmed = sentence.trim();
                for (const pattern of patterns) {
                    if (pattern.test(trimmed)) {
                        extractedClaims.push(trimmed);
                        break;
                    }
                }
            });
            
            return extractedClaims.slice(0, 20); // Limit to 20 claims
        }

        // Display results with enhanced features
        function displayResults(results) {
            factCheckResults = results;
            
            // Update stats with animation
            animateNumber('claimsCount', 0, results.length);
            animateNumber('trueCount', 0, results.filter(r => r.verdict === 'true').length);
            animateNumber('falseCount', 0, results.filter(r => r.verdict === 'false').length);
            
            // Calculate claim density
            const wordCount = parseInt(document.getElementById('wordCount').textContent);
            const claimDensity = (results.length / wordCount) * 100;
            document.getElementById('densityFill').style.width = Math.min(100, claimDensity * 10) + '%';
            
            // Display fact checks with staggered animation
            displayFilteredResults(results);
            
            // Show summary
            showSummary(results);
        }

        // Filter results
        function filterResults(filter) {
            currentFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Filter results
            let filtered = factCheckResults;
            if (filter === 'true') {
                filtered = factCheckResults.filter(r => r.verdict === 'true');
            } else if (filter === 'false') {
                filtered = factCheckResults.filter(r => r.verdict === 'false');
            } else if (filter === 'unverified') {
                filtered = factCheckResults.filter(r => r.verdict === 'unverified');
            } else if (filter === 'flagged') {
                filtered = factCheckResults.filter(r => flaggedClaims.has(r.claim));
            }
            
            displayFilteredResults(filtered);
        }

        // Display filtered results
        function displayFilteredResults(results) {
            let html = '';
            results.forEach((result, index) => {
                const confidence = Math.round(result.confidence * 100);
                const verdictIcon = result.verdict === 'true' ? 'âœ“' : result.verdict === 'false' ? 'âœ—' : '?';
                const isFlagged = flaggedClaims.has(result.claim);
                
                html += `
                    <div class="fact-check-item ${isFlagged ? 'flagged' : ''}" onclick="toggleSources(${index})" style="animation: fadeInUp 0.5s ease ${index * 0.1}s forwards; opacity: 0;">
                        <button class="flag-btn ${isFlagged ? 'active' : ''}" onclick="event.stopPropagation(); toggleFlag('${result.claim}')" title="Flag for follow-up">
                            <i class="fas fa-flag"></i>
                        </button>
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <span class="verdict-badge verdict-${result.verdict}">
                                ${verdictIcon} ${result.verdict.toUpperCase()}
                            </span>
                            <div style="text-align: right;">
                                <div style="color: #6b7280; font-size: 0.9rem;">Confidence</div>
                                <div style="font-weight: 600; color: #4a5568;">${confidence}%</div>
                            </div>
                        </div>
                        <p style="margin-bottom: 10px; font-size: 1.05rem; line-height: 1.6;">${highlightClaim(result.claim)}</p>
                        <div class="source-details" id="sources-${index}">
                            <strong style="color: #4a5568;">Verification Details:</strong>
                            <div class="source-grid">
                                ${generateSourceCards(result)}
                            </div>
                            ${result.credibility_score ? `
                                <div style="margin-top: 15px; padding: 15px; background: rgba(102, 126, 234, 0.05); border-radius: 10px;">
                                    <strong>AI Analysis:</strong>
                                    <div style="margin-top: 10px; display: grid; gap: 8px;">
                                        <div><strong>Credibility Score:</strong> ${result.credibility_score}/100</div>
                                        ${result.bias ? `<div><strong>Bias Detected:</strong> ${result.bias}</div>` : ''}
                                        <div><strong>Verification Method:</strong> Cross-reference analysis</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('factCheckResults').innerHTML = html || '<p style="text-align: center; color: #6b7280;">No results match the selected filter.</p>';
        }

        // Generate source cards
        function generateSourceCards(result) {
            const sources = result.sources || [];
            const sourceTypes = {
                'News Database': { icon: 'fa-newspaper', credibility: 4 },
                'Academic Database': { icon: 'fa-graduation-cap', credibility: 5 },
                'Government Data': { icon: 'fa-landmark', credibility: 5 },
                'Fact-Check API': { icon: 'fa-check-double', credibility: 4 },
                'Historical Records': { icon: 'fa-history', credibility: 4 },
                'Statistical Bureau': { icon: 'fa-chart-bar', credibility: 5 }
            };
            
            return sources.map(source => {
                const sourceName = source.source || source;
                const sourceInfo = sourceTypes[sourceName] || { icon: 'fa-globe', credibility: 3 };
                
                return `
                    <div class="source-card">
                        <div class="source-name">
                            <i class="fas ${sourceInfo.icon}"></i> ${sourceName}
                        </div>
                        <div class="source-info">
                            <div>Verification Date: ${new Date().toLocaleDateString()}</div>
                            <div class="source-credibility">
                                Credibility: 
                                <span class="credibility-stars">
                                    ${'â˜…'.repeat(sourceInfo.credibility)}${'â˜†'.repeat(5 - sourceInfo.credibility)}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle flag
        function toggleFlag(claim) {
            if (flaggedClaims.has(claim)) {
                flaggedClaims.delete(claim);
            } else {
                flaggedClaims.add(claim);
            }
            
            // Update UI
            displayFilteredResults(currentFilter === 'all' ? factCheckResults : 
                factCheckResults.filter(r => {
                    if (currentFilter === 'flagged') return flaggedClaims.has(r.claim);
                    return r.verdict === currentFilter;
                }));
        }

        // Animate numbers
        function animateNumber(id, start, end) {
            const element = document.getElementById(id);
            const duration = 1000;
            const steps = 30;
            const increment = (end - start) / steps;
            let current = start;
            let step = 0;
            
            const timer = setInterval(() => {
                current += increment;
                step++;
                
                if (step >= steps) {
                    current = end;
                    clearInterval(timer);
                }
                
                element.textContent = Math.round(current);
            }, duration / steps);
        }

        // Highlight key parts of claims
        function highlightClaim(claim) {
            // Highlight numbers and percentages
            return claim.replace(/(\d+\.?\d*\s*(?:percent|%|million|billion|trillion)?)/gi, '<strong style="color: #667eea;">$1</strong>');
        }

        // Toggle sources
        function toggleSources(index) {
            const sources = document.getElementById(`sources-${index}`);
            sources.style.display = sources.style.display === 'none' ? 'block' : 'none';
        }

        // Show summary with enhanced gauge
        function showSummary(results) {
            const trueCount = results.filter(r => r.verdict === 'true').length;
            const accuracy = results.length > 0 ? Math.round((trueCount / results.length) * 100) : 0;
            
            document.getElementById('summaryCard').style.display = 'block';
            
            // Animate gauge
            const circumference = 2 * Math.PI * 70;
            const offset = circumference * (1 - accuracy / 100);
            const gaugeFill = document.getElementById('gaugeFill');
            gaugeFill.style.strokeDasharray = `${circumference} ${circumference}`;
            
            setTimeout(() => {
                gaugeFill.style.strokeDasharray = `${circumference - offset} ${circumference}`;
            }, 100);
            
            animateNumber('accuracyPercent', 0, accuracy);
        }

        // Update word count
        function updateWordCount() {
            const text = document.getElementById('transcript').textContent;
            const words = text.trim().split(/\s+/).filter(w => w.length > 0);
            document.getElementById('wordCountDisplay').textContent = words.length;
            
            // Also update in stats if visible
            if (document.getElementById('resultsSection').style.display !== 'none') {
                document.getElementById('wordCount').textContent = words.length;
            }
        }

        // Update claim count
        function updateClaimCount() {
            document.getElementById('claimCountDisplay').textContent = claims.length;
            document.getElementById('liveClaimCount').textContent = claims.length;
        }

        // Clear all
        function clearAll() {
            if (!confirm('Are you sure you want to clear all content and results?')) {
                return;
            }
            
            document.getElementById('transcript').innerHTML = '';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('hintText').textContent = selectedSource === 'microphone' ? 
                'Click "Start Recording" to begin capturing speech' : 
                'Type or paste text, then click "Check Facts" to analyze';
            updateWordCount();
            updateClaimCount();
            
            // Reset variables
            claims = [];
            timeline = [];
            flaggedClaims.clear();
            duration = 0;
            document.getElementById('durationDisplay').textContent = '00:00';
            
            // Clear live panel
            document.getElementById('liveClaims').innerHTML = '<p style="text-align: center; color: #6b7280; font-style: italic;">Claims will appear here as they\'re detected...</p>';
            
            // Clear timeline
            document.getElementById('timelineContent').innerHTML = '<p style="text-align: center; color: #6b7280; font-style: italic;">Timeline will populate as claims are detected...</p>';
            
            // Hide real-time counter
            document.getElementById('realtimeCounter').classList.remove('active');
            
            // Stop recording if active
            if (isRecording && recognition) {
                recognition.stop();
            }
        }

        // Load demo
        function loadDemo() {
            const demoText = `Good evening, everyone. I want to share some important facts about our world today.

The global population has now exceeded 8 billion people, with China and India being the most populous nations. Climate change continues to be a pressing issue, with global temperatures rising by 1.1 degrees Celsius since pre-industrial times.

In the United States, the unemployment rate currently stands at 3.5 percent, near historic lows. The federal minimum wage remains at $7.25 per hour, unchanged since 2009.

Renewable energy is growing rapidly. Solar and wind power now account for over 12% of global electricity generation. Electric vehicle sales increased by 60% in 2022 compared to the previous year.

According to recent studies, smartphone usage has reached 6.8 billion users worldwide, representing 85% of the global population. Social media platforms collectively have over 4.7 billion active users.

In healthcare, life expectancy has increased to 73.4 years globally, though significant disparities exist between countries. COVID-19 vaccines have been administered to over 70% of the world's population.

Thank you for your attention to these facts.`;
            
            document.getElementById('transcript').innerHTML = highlightClaimsInTranscript(demoText);
            updateWordCount();
            
            // Simulate claim detection
            detectClaimsInText(demoText);
            updateClaimCount();
            
            // Show real-time counter
            document.getElementById('realtimeCounter').classList.add('active');
        }

        // Download report
        function downloadReport(format) {
            const transcript = document.getElementById('transcript').textContent;
            const stats = {
                words: document.getElementById('wordCount').textContent,
                claims: document.getElementById('claimsCount').textContent,
                true: document.getElementById('trueCount').textContent,
                false: document.getElementById('falseCount').textContent,
                accuracy: document.getElementById('accuracyPercent').textContent
            };
            
            if (format === 'txt') {
                let report = `SPEECH FACT-CHECK REPORT
Generated: ${new Date().toLocaleString()}
=====================================

TRANSCRIPT:
${transcript}

STATISTICS:
- Total Words: ${stats.words}
- Claims Checked: ${stats.claims}
- True Claims: ${stats.true}
- False Claims: ${stats.false}
- Accuracy Rate: ${stats.accuracy}%

DETAILED FACT-CHECKS:
`;

                factCheckResults.forEach((result, i) => {
                    report += `
${i + 1}. ${result.claim}
   Verdict: ${result.verdict.toUpperCase()}
   Confidence: ${Math.round(result.confidence * 100)}%
   Sources: ${result.sources.map(s => s.source || s).join(', ')}
   ${flaggedClaims.has(result.claim) ? '[FLAGGED FOR FOLLOW-UP]' : ''}
`;
                });

                const blob = new Blob([report], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `speech-fact-check-${new Date().toISOString().slice(0, 10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
            } else if (format === 'json') {
                const jsonReport = {
                    metadata: {
                        generated: new Date().toISOString(),
                        duration: document.getElementById('durationDisplay').textContent,
                        language: currentLanguage
                    },
                    statistics: stats,
                    transcript: transcript,
                    factChecks: factCheckResults,
                    flaggedClaims: Array.from(flaggedClaims),
                    timeline: timeline
                };
                
                const blob = new Blob([JSON.stringify(jsonReport, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `speech-fact-check-${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
            } else if (format === 'csv') {
                let csv = 'Claim,Verdict,Confidence,Sources,Flagged\n';
                factCheckResults.forEach(result => {
                    csv += `"${result.claim}","${result.verdict}","${Math.round(result.confidence * 100)}%","${result.sources.map(s => s.source || s).join('; ')}","${flaggedClaims.has(result.claim) ? 'Yes' : 'No'}"\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `speech-fact-check-${new Date().toISOString().slice(0, 10)}.csv`;
                a.click();
                URL.revokeObjectURL(url);
                
            } else if (format === 'pdf') {
                alert('PDF export would be implemented with a PDF generation library like jsPDF');
            }
        }

        // Share report
        function shareReport() {
            const shareUrl = window.location.href + '#report-' + Date.now();
            
            if (navigator.share) {
                navigator.share({
                    title: 'Speech Fact-Check Report',
                    text: `Fact-check report: ${factCheckResults.length} claims analyzed, ${document.getElementById('accuracyPercent').textContent}% accuracy`,
                    url: shareUrl
                }).catch(err => console.log('Error sharing:', err));
            } else {
                // Fallback - copy to clipboard
                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert('Share link copied to clipboard!');
                });
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Don't trigger shortcuts when typing in inputs
            if (e.target.matches('input, textarea, [contenteditable="true"]')) {
                return;
            }
            
            switch(e.key.toLowerCase()) {
                case ' ':
                    e.preventDefault();
                    if (isRecording) {
                        stopRecording();
                    } else if (selectedSource === 'microphone') {
                        startRecording();
                    }
                    break;
                case 'p':
                    if (isRecording) {
                        if (isPaused) {
                            resumeRecording();
                        } else {
                            pauseRecording();
                        }
                    }
                    break;
                case 'c':
                    checkFacts();
                    break;
                case 'r':
                    clearAll();
                    break;
                case 'l':
                    toggleLivePanel();
                    break;
                case 't':
                    toggleTimeline();
                    break;
                case 'escape':
                    // Close any open modals
                    document.querySelectorAll('[style*="position: fixed"]').forEach(el => {
                        if (el.style.zIndex >= 10000) el.remove();
                    });
                    break;
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize header navigation
            window.ffNav.init();
            
            // Test API connection (skip in preview/local mode)
            async function testAPIConnection() {
                try {
                    // Skip API test if running locally or in preview
                    if (window.location.protocol === 'file:' || window.location.hostname === 'localhost' || !window.location.hostname) {
                        console.log('Running in preview mode - API features disabled');
                        return false;
                    }
                    
                    const response = await fetch('/api/test');
                    if (!response.ok) {
                        return false;
                    }
                    const data = await response.json();
                    console.log('API Test:', data);
                    return data.success;
                } catch (error) {
                    // Silently fail in preview mode
                    return false;
                }
            }
            
            testAPIConnection().then(apiWorking => {
                if (apiWorking) {
                    console.log('âœ“ API connection verified');
                } else {
                    console.log('â„¹ Running without API backend - some features may be limited');
                }
            });
            
            // Initialize speech recognition
            initSpeechRecognition();
            
            // Handle paste
            document.getElementById('transcript').addEventListener('paste', (e) => {
                if (selectedSource === 'text') {
                    setTimeout(() => {
                        updateWordCount();
                        // Auto-detect claims
                        const text = document.getElementById('transcript').textContent;
                        detectClaimsInText(text);
                        updateClaimCount();
                        
                        if (text.length > 50) {
                            // Auto-start fact-checking for pasted content
                            setTimeout(() => checkFacts(), 500);
                        }
                    }, 100);
                }
            });
            
            // Handle typing
            let typingTimer;
            document.getElementById('transcript').addEventListener('input', () => {
                clearTimeout(typingTimer);
                updateWordCount();
                
                if (selectedSource === 'text') {
                    typingTimer = setTimeout(() => {
                        const text = document.getElementById('transcript').textContent;
                        detectClaimsInText(text);
                        updateClaimCount();
                        
                        if (text.length > 50) {
                            document.getElementById('hintText').textContent = `Text ready. ${claims.length} potential claims detected. Click "Check Facts" to analyze`;
                        }
                    }, 1000);
                }
            });
            
            // Set default mode
            selectSource('microphone');
        });
    </script>
</body>
</html>
